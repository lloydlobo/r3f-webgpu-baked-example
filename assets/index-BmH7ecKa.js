function Lq(i,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in i)){const r=Object.getOwnPropertyDescriptor(n,s);r&&Object.defineProperty(i,s,r.get?r:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function $p(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var BR={exports:{}},ab={};var nI;function Iq(){if(nI)return ab;nI=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,r){var a=null;if(r!==void 0&&(a=""+r),s.key!==void 0&&(a=""+s.key),"key"in s){r={};for(var o in s)o!=="key"&&(r[o]=s[o])}else r=s;return s=r.ref,{$$typeof:i,type:n,key:a,ref:s!==void 0?s:null,props:r}}return ab.Fragment=e,ab.jsx=t,ab.jsxs=t,ab}var iI;function Pq(){return iI||(iI=1,BR.exports=Iq()),BR.exports}var Pt=Pq(),DR={exports:{}},Xn={};var sI;function Fq(){if(sI)return Xn;sI=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),x=Symbol.iterator;function y(K){return K===null||typeof K!="object"?null:(K=x&&K[x]||K["@@iterator"],typeof K=="function"?K:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,A={};function S(K,pe,we){this.props=K,this.context=pe,this.refs=A,this.updater=we||_}S.prototype.isReactComponent={},S.prototype.setState=function(K,pe){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,pe,"setState")},S.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function C(){}C.prototype=S.prototype;function w(K,pe,we){this.props=K,this.context=pe,this.refs=A,this.updater=we||_}var B=w.prototype=new C;B.constructor=w,T(B,S.prototype),B.isPureReactComponent=!0;var L=Array.isArray;function D(){}var O={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function U(K,pe,we){var Ne=we.ref;return{$$typeof:i,type:K,key:pe,ref:Ne!==void 0?Ne:null,props:we}}function P(K,pe){return U(K.type,pe,K.props)}function X(K){return typeof K=="object"&&K!==null&&K.$$typeof===i}function Z(K){var pe={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(we){return pe[we]})}var ee=/\/+/g;function te(K,pe){return typeof K=="object"&&K!==null&&K.key!=null?Z(""+K.key):pe.toString(36)}function re(K){switch(K.status){case"fulfilled":return K.value;case"rejected":throw K.reason;default:switch(typeof K.status=="string"?K.then(D,D):(K.status="pending",K.then(function(pe){K.status==="pending"&&(K.status="fulfilled",K.value=pe)},function(pe){K.status==="pending"&&(K.status="rejected",K.reason=pe)})),K.status){case"fulfilled":return K.value;case"rejected":throw K.reason}}throw K}function W(K,pe,we,Ne,gt){var Se=typeof K;(Se==="undefined"||Se==="boolean")&&(K=null);var Be=!1;if(K===null)Be=!0;else switch(Se){case"bigint":case"string":case"number":Be=!0;break;case"object":switch(K.$$typeof){case i:case e:Be=!0;break;case f:return Be=K._init,W(Be(K._payload),pe,we,Ne,gt)}}if(Be)return gt=gt(K),Be=Ne===""?"."+te(K,0):Ne,L(gt)?(we="",Be!=null&&(we=Be.replace(ee,"$&/")+"/"),W(gt,pe,we,"",function(Nt){return Nt})):gt!=null&&(X(gt)&&(gt=P(gt,we+(gt.key==null||K&&K.key===gt.key?"":(""+gt.key).replace(ee,"$&/")+"/")+Be)),pe.push(gt)),1;Be=0;var ct=Ne===""?".":Ne+":";if(L(K))for(var Dt=0;Dt<K.length;Dt++)Ne=K[Dt],Se=ct+te(Ne,Dt),Be+=W(Ne,pe,we,Se,gt);else if(Dt=y(K),typeof Dt=="function")for(K=Dt.call(K),Dt=0;!(Ne=K.next()).done;)Ne=Ne.value,Se=ct+te(Ne,Dt++),Be+=W(Ne,pe,we,Se,gt);else if(Se==="object"){if(typeof K.then=="function")return W(re(K),pe,we,Ne,gt);throw pe=String(K),Error("Objects are not valid as a React child (found: "+(pe==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":pe)+"). If you meant to render a collection of children, use an array instead.")}return Be}function ne(K,pe,we){if(K==null)return K;var Ne=[],gt=0;return W(K,Ne,"","",function(Se){return pe.call(we,Se,gt++)}),Ne}function se(K){if(K._status===-1){var pe=K._result;pe=pe(),pe.then(function(we){(K._status===0||K._status===-1)&&(K._status=1,K._result=we)},function(we){(K._status===0||K._status===-1)&&(K._status=2,K._result=we)}),K._status===-1&&(K._status=0,K._result=pe)}if(K._status===1)return K._result.default;throw K._result}var ge=typeof reportError=="function"?reportError:function(K){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var pe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof K=="object"&&K!==null&&typeof K.message=="string"?String(K.message):String(K),error:K});if(!window.dispatchEvent(pe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",K);return}console.error(K)},_e={map:ne,forEach:function(K,pe,we){ne(K,function(){pe.apply(this,arguments)},we)},count:function(K){var pe=0;return ne(K,function(){pe++}),pe},toArray:function(K){return ne(K,function(pe){return pe})||[]},only:function(K){if(!X(K))throw Error("React.Children.only expected to receive a single React element child.");return K}};return Xn.Activity=p,Xn.Children=_e,Xn.Component=S,Xn.Fragment=t,Xn.Profiler=s,Xn.PureComponent=w,Xn.StrictMode=n,Xn.Suspense=l,Xn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Xn.__COMPILER_RUNTIME={__proto__:null,c:function(K){return O.H.useMemoCache(K)}},Xn.cache=function(K){return function(){return K.apply(null,arguments)}},Xn.cacheSignal=function(){return null},Xn.cloneElement=function(K,pe,we){if(K==null)throw Error("The argument must be a React element, but you passed "+K+".");var Ne=T({},K.props),gt=K.key;if(pe!=null)for(Se in pe.key!==void 0&&(gt=""+pe.key),pe)!F.call(pe,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&pe.ref===void 0||(Ne[Se]=pe[Se]);var Se=arguments.length-2;if(Se===1)Ne.children=we;else if(1<Se){for(var Be=Array(Se),ct=0;ct<Se;ct++)Be[ct]=arguments[ct+2];Ne.children=Be}return U(K.type,gt,Ne)},Xn.createContext=function(K){return K={$$typeof:a,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null},K.Provider=K,K.Consumer={$$typeof:r,_context:K},K},Xn.createElement=function(K,pe,we){var Ne,gt={},Se=null;if(pe!=null)for(Ne in pe.key!==void 0&&(Se=""+pe.key),pe)F.call(pe,Ne)&&Ne!=="key"&&Ne!=="__self"&&Ne!=="__source"&&(gt[Ne]=pe[Ne]);var Be=arguments.length-2;if(Be===1)gt.children=we;else if(1<Be){for(var ct=Array(Be),Dt=0;Dt<Be;Dt++)ct[Dt]=arguments[Dt+2];gt.children=ct}if(K&&K.defaultProps)for(Ne in Be=K.defaultProps,Be)gt[Ne]===void 0&&(gt[Ne]=Be[Ne]);return U(K,Se,gt)},Xn.createRef=function(){return{current:null}},Xn.forwardRef=function(K){return{$$typeof:o,render:K}},Xn.isValidElement=X,Xn.lazy=function(K){return{$$typeof:f,_payload:{_status:-1,_result:K},_init:se}},Xn.memo=function(K,pe){return{$$typeof:u,type:K,compare:pe===void 0?null:pe}},Xn.startTransition=function(K){var pe=O.T,we={};O.T=we;try{var Ne=K(),gt=O.S;gt!==null&&gt(we,Ne),typeof Ne=="object"&&Ne!==null&&typeof Ne.then=="function"&&Ne.then(D,ge)}catch(Se){ge(Se)}finally{pe!==null&&we.types!==null&&(pe.types=we.types),O.T=pe}},Xn.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Xn.use=function(K){return O.H.use(K)},Xn.useActionState=function(K,pe,we){return O.H.useActionState(K,pe,we)},Xn.useCallback=function(K,pe){return O.H.useCallback(K,pe)},Xn.useContext=function(K){return O.H.useContext(K)},Xn.useDebugValue=function(){},Xn.useDeferredValue=function(K,pe){return O.H.useDeferredValue(K,pe)},Xn.useEffect=function(K,pe){return O.H.useEffect(K,pe)},Xn.useEffectEvent=function(K){return O.H.useEffectEvent(K)},Xn.useId=function(){return O.H.useId()},Xn.useImperativeHandle=function(K,pe,we){return O.H.useImperativeHandle(K,pe,we)},Xn.useInsertionEffect=function(K,pe){return O.H.useInsertionEffect(K,pe)},Xn.useLayoutEffect=function(K,pe){return O.H.useLayoutEffect(K,pe)},Xn.useMemo=function(K,pe){return O.H.useMemo(K,pe)},Xn.useOptimistic=function(K,pe){return O.H.useOptimistic(K,pe)},Xn.useReducer=function(K,pe,we){return O.H.useReducer(K,pe,we)},Xn.useRef=function(K){return O.H.useRef(K)},Xn.useState=function(K){return O.H.useState(K)},Xn.useSyncExternalStore=function(K,pe,we){return O.H.useSyncExternalStore(K,pe,we)},Xn.useTransition=function(){return O.H.useTransition()},Xn.version="19.2.0",Xn}var rI;function Qy(){return rI||(rI=1,DR.exports=Fq()),DR.exports}var G=Qy();const ue=$p(G),gB=Lq({__proto__:null,default:ue},[G]);var OR={exports:{}},ob={},UR={exports:{}},LR={};var aI;function Gq(){return aI||(aI=1,(function(i){function e(W,ne){var se=W.length;W.push(ne);e:for(;0<se;){var ge=se-1>>>1,_e=W[ge];if(0<s(_e,ne))W[ge]=ne,W[se]=_e,se=ge;else break e}}function t(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var ne=W[0],se=W.pop();if(se!==ne){W[0]=se;e:for(var ge=0,_e=W.length,K=_e>>>1;ge<K;){var pe=2*(ge+1)-1,we=W[pe],Ne=pe+1,gt=W[Ne];if(0>s(we,se))Ne<_e&&0>s(gt,we)?(W[ge]=gt,W[Ne]=se,ge=Ne):(W[ge]=we,W[pe]=se,ge=pe);else if(Ne<_e&&0>s(gt,se))W[ge]=gt,W[Ne]=se,ge=Ne;else break e}}return ne}function s(W,ne){var se=W.sortIndex-ne.sortIndex;return se!==0?se:W.id-ne.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],u=[],f=1,p=null,x=3,y=!1,_=!1,T=!1,A=!1,S=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function B(W){for(var ne=t(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=W)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=t(u)}}function L(W){if(T=!1,B(W),!_)if(t(l)!==null)_=!0,D||(D=!0,Z());else{var ne=t(u);ne!==null&&re(L,ne.startTime-W)}}var D=!1,O=-1,F=5,U=-1;function P(){return A?!0:!(i.unstable_now()-U<F)}function X(){if(A=!1,D){var W=i.unstable_now();U=W;var ne=!0;try{e:{_=!1,T&&(T=!1,C(O),O=-1),y=!0;var se=x;try{t:{for(B(W),p=t(l);p!==null&&!(p.expirationTime>W&&P());){var ge=p.callback;if(typeof ge=="function"){p.callback=null,x=p.priorityLevel;var _e=ge(p.expirationTime<=W);if(W=i.unstable_now(),typeof _e=="function"){p.callback=_e,B(W),ne=!0;break t}p===t(l)&&n(l),B(W)}else n(l);p=t(l)}if(p!==null)ne=!0;else{var K=t(u);K!==null&&re(L,K.startTime-W),ne=!1}}break e}finally{p=null,x=se,y=!1}ne=void 0}}finally{ne?Z():D=!1}}}var Z;if(typeof w=="function")Z=function(){w(X)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,te=ee.port2;ee.port1.onmessage=X,Z=function(){te.postMessage(null)}}else Z=function(){S(X,0)};function re(W,ne){O=S(function(){W(i.unstable_now())},ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(W){W.callback=null},i.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<W?Math.floor(1e3/W):5},i.unstable_getCurrentPriorityLevel=function(){return x},i.unstable_next=function(W){switch(x){case 1:case 2:case 3:var ne=3;break;default:ne=x}var se=x;x=ne;try{return W()}finally{x=se}},i.unstable_requestPaint=function(){A=!0},i.unstable_runWithPriority=function(W,ne){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var se=x;x=W;try{return ne()}finally{x=se}},i.unstable_scheduleCallback=function(W,ne,se){var ge=i.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ge+se:ge):se=ge,W){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=se+_e,W={id:f++,callback:ne,priorityLevel:W,startTime:se,expirationTime:_e,sortIndex:-1},se>ge?(W.sortIndex=se,e(u,W),t(l)===null&&W===t(u)&&(T?(C(O),O=-1):T=!0,re(L,se-ge))):(W.sortIndex=_e,e(l,W),_||y||(_=!0,D||(D=!0,Z()))),W},i.unstable_shouldYield=P,i.unstable_wrapCallback=function(W){var ne=x;return function(){var se=x;x=ne;try{return W.apply(this,arguments)}finally{x=se}}}})(LR)),LR}var oI;function zq(){return oI||(oI=1,UR.exports=Gq()),UR.exports}var IR={exports:{}},Ua={};var lI;function Vq(){if(lI)return Ua;lI=1;var i=Qy();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(l,u,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:p==null?null:""+p,children:l,containerInfo:u,implementation:f}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Ua.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Ua.createPortal=function(l,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(l,u,null,f)},Ua.flushSync=function(l){var u=a.T,f=n.p;try{if(a.T=null,n.p=2,l)return l()}finally{a.T=u,n.p=f,n.d.f()}},Ua.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(l,u))},Ua.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},Ua.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var f=u.as,p=o(f,u.crossOrigin),x=typeof u.integrity=="string"?u.integrity:void 0,y=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?n.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:p,integrity:x,fetchPriority:y}):f==="script"&&n.d.X(l,{crossOrigin:p,integrity:x,fetchPriority:y,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Ua.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=o(u.as,u.crossOrigin);n.d.M(l,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(l)},Ua.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,p=o(f,u.crossOrigin);n.d.L(l,f,{crossOrigin:p,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Ua.preloadModule=function(l,u){if(typeof l=="string")if(u){var f=o(u.as,u.crossOrigin);n.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(l)},Ua.requestFormReset=function(l){n.d.r(l)},Ua.unstable_batchedUpdates=function(l,u){return l(u)},Ua.useFormState=function(l,u,f){return a.H.useFormState(l,u,f)},Ua.useFormStatus=function(){return a.H.useHostTransitionStatus()},Ua.version="19.2.0",Ua}var cI;function Az(){if(cI)return IR.exports;cI=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),IR.exports=Vq(),IR.exports}var uI;function Hq(){if(uI)return ob;uI=1;var i=zq(),e=Qy(),t=Az();function n(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function r(c){var d=c,g=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,(d.flags&4098)!==0&&(g=d.return),c=d.return;while(c)}return d.tag===3?g:null}function a(c){if(c.tag===13){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function o(c){if(c.tag===31){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function l(c){if(r(c)!==c)throw Error(n(188))}function u(c){var d=c.alternate;if(!d){if(d=r(c),d===null)throw Error(n(188));return d!==c?null:c}for(var g=c,v=d;;){var E=g.return;if(E===null)break;var R=E.alternate;if(R===null){if(v=E.return,v!==null){g=v;continue}break}if(E.child===R.child){for(R=E.child;R;){if(R===g)return l(E),c;if(R===v)return l(E),d;R=R.sibling}throw Error(n(188))}if(g.return!==v.return)g=E,v=R;else{for(var z=!1,Y=E.child;Y;){if(Y===g){z=!0,g=E,v=R;break}if(Y===v){z=!0,v=E,g=R;break}Y=Y.sibling}if(!z){for(Y=R.child;Y;){if(Y===g){z=!0,g=R,v=E;break}if(Y===v){z=!0,v=R,g=E;break}Y=Y.sibling}if(!z)throw Error(n(189))}}if(g.alternate!==v)throw Error(n(190))}if(g.tag!==3)throw Error(n(188));return g.stateNode.current===g?c:d}function f(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c;for(c=c.child;c!==null;){if(d=f(c),d!==null)return d;c=c.sibling}return null}var p=Object.assign,x=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),w=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),X=Symbol.iterator;function Z(c){return c===null||typeof c!="object"?null:(c=X&&c[X]||c["@@iterator"],typeof c=="function"?c:null)}var ee=Symbol.for("react.client.reference");function te(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===ee?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case T:return"Fragment";case S:return"Profiler";case A:return"StrictMode";case L:return"Suspense";case D:return"SuspenseList";case U:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case _:return"Portal";case w:return c.displayName||"Context";case C:return(c._context.displayName||"Context")+".Consumer";case B:var d=c.render;return c=c.displayName,c||(c=d.displayName||d.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case O:return d=c.displayName||null,d!==null?d:te(c.type)||"Memo";case F:d=c._payload,c=c._init;try{return te(c(d))}catch{}}return null}var re=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},ge=[],_e=-1;function K(c){return{current:c}}function pe(c){0>_e||(c.current=ge[_e],ge[_e]=null,_e--)}function we(c,d){_e++,ge[_e]=c.current,c.current=d}var Ne=K(null),gt=K(null),Se=K(null),Be=K(null);function ct(c,d){switch(we(Se,d),we(gt,c),we(Ne,null),d.nodeType){case 9:case 11:c=(c=d.documentElement)&&(c=c.namespaceURI)?EL(c):0;break;default:if(c=d.tagName,d=d.namespaceURI)d=EL(d),c=ML(d,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}pe(Ne),we(Ne,c)}function Dt(){pe(Ne),pe(gt),pe(Se)}function Nt(c){c.memoizedState!==null&&we(Be,c);var d=Ne.current,g=ML(d,c.type);d!==g&&(we(gt,c),we(Ne,g))}function It(c){gt.current===c&&(pe(Ne),pe(gt)),Be.current===c&&(pe(Be),nb._currentValue=se)}var Mn,Gt;function Qe(c){if(Mn===void 0)try{throw Error()}catch(g){var d=g.stack.trim().match(/\n( *(at )?)/);Mn=d&&d[1]||"",Gt=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Mn+c+Gt}var ie=!1;function ot(c,d){if(!c||ie)return"";ie=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(d){var ut=function(){throw Error()};if(Object.defineProperty(ut.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ut,[])}catch(We){var Pe=We}Reflect.construct(c,[],ut)}else{try{ut.call()}catch(We){Pe=We}c.call(ut.prototype)}}else{try{throw Error()}catch(We){Pe=We}(ut=c())&&typeof ut.catch=="function"&&ut.catch(function(){})}}catch(We){if(We&&Pe&&typeof We.stack=="string")return[We.stack,Pe.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=v.DetermineComponentFrameRoot(),z=R[0],Y=R[1];if(z&&Y){var he=z.split(`
`),Ue=Y.split(`
`);for(E=v=0;v<he.length&&!he[v].includes("DetermineComponentFrameRoot");)v++;for(;E<Ue.length&&!Ue[E].includes("DetermineComponentFrameRoot");)E++;if(v===he.length||E===Ue.length)for(v=he.length-1,E=Ue.length-1;1<=v&&0<=E&&he[v]!==Ue[E];)E--;for(;1<=v&&0<=E;v--,E--)if(he[v]!==Ue[E]){if(v!==1||E!==1)do if(v--,E--,0>E||he[v]!==Ue[E]){var tt=`
`+he[v].replace(" at new "," at ");return c.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",c.displayName)),tt}while(1<=v&&0<=E);break}}}finally{ie=!1,Error.prepareStackTrace=g}return(g=c?c.displayName||c.name:"")?Qe(g):""}function dt(c,d){switch(c.tag){case 26:case 27:case 5:return Qe(c.type);case 16:return Qe("Lazy");case 13:return c.child!==d&&d!==null?Qe("Suspense Fallback"):Qe("Suspense");case 19:return Qe("SuspenseList");case 0:case 15:return ot(c.type,!1);case 11:return ot(c.type.render,!1);case 1:return ot(c.type,!0);case 31:return Qe("Activity");default:return""}}function Tt(c){try{var d="",g=null;do d+=dt(c,g),g=c,c=c.return;while(c);return d}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}var ht=Object.prototype.hasOwnProperty,Ut=i.unstable_scheduleCallback,At=i.unstable_cancelCallback,Ht=i.unstable_shouldYield,q=i.unstable_requestPaint,V=i.unstable_now,Te=i.unstable_getCurrentPriorityLevel,Ge=i.unstable_ImmediatePriority,$e=i.unstable_UserBlockingPriority,Ve=i.unstable_NormalPriority,Xt=i.unstable_LowPriority,Ot=i.unstable_IdlePriority,cn=i.log,Qt=i.unstable_setDisableYieldValue,et=null,st=null;function nn(c){if(typeof cn=="function"&&Qt(c),st&&typeof st.setStrictMode=="function")try{st.setStrictMode(et,c)}catch{}}var zt=Math.clz32?Math.clz32:ve,Mt=Math.log,Kt=Math.LN2;function ve(c){return c>>>=0,c===0?32:31-(Mt(c)/Kt|0)|0}var ze=256,Et=262144,wt=4194304;function pt(c){var d=c&42;if(d!==0)return d;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function lt(c,d,g){var v=c.pendingLanes;if(v===0)return 0;var E=0,R=c.suspendedLanes,z=c.pingedLanes;c=c.warmLanes;var Y=v&134217727;return Y!==0?(v=Y&~R,v!==0?E=pt(v):(z&=Y,z!==0?E=pt(z):g||(g=Y&~c,g!==0&&(E=pt(g))))):(Y=v&~R,Y!==0?E=pt(Y):z!==0?E=pt(z):g||(g=v&~c,g!==0&&(E=pt(g)))),E===0?0:d!==0&&d!==E&&(d&R)===0&&(R=E&-E,g=d&-d,R>=g||R===32&&(g&4194048)!==0)?d:E}function en(c,d){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&d)===0}function Tn(c,d){switch(c){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gi(){var c=wt;return wt<<=1,(wt&62914560)===0&&(wt=4194304),c}function ni(c){for(var d=[],g=0;31>g;g++)d.push(c);return d}function rr(c,d){c.pendingLanes|=d,d!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Yr(c,d,g,v,E,R){var z=c.pendingLanes;c.pendingLanes=g,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=g,c.entangledLanes&=g,c.errorRecoveryDisabledLanes&=g,c.shellSuspendCounter=0;var Y=c.entanglements,he=c.expirationTimes,Ue=c.hiddenUpdates;for(g=z&~g;0<g;){var tt=31-zt(g),ut=1<<tt;Y[tt]=0,he[tt]=-1;var Pe=Ue[tt];if(Pe!==null)for(Ue[tt]=null,tt=0;tt<Pe.length;tt++){var We=Pe[tt];We!==null&&(We.lane&=-536870913)}g&=~ut}v!==0&&Ld(c,v,0),R!==0&&E===0&&c.tag!==0&&(c.suspendedLanes|=R&~(z&~d))}function Ld(c,d,g){c.pendingLanes|=d,c.suspendedLanes&=~d;var v=31-zt(d);c.entangledLanes|=d,c.entanglements[v]=c.entanglements[v]|1073741824|g&261930}function Mc(c,d){var g=c.entangledLanes|=d;for(c=c.entanglements;g;){var v=31-zt(g),E=1<<v;E&d|c[v]&d&&(c[v]|=d),g&=~E}}function Uo(c,d){var g=d&-d;return g=(g&42)!==0?1:$s(g),(g&(c.suspendedLanes|d))!==0?0:g}function $s(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Sa(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function xr(){var c=ne.p;return c!==0?c:(c=window.event,c===void 0?32:$L(c.type))}function wn(c,d){var g=ne.p;try{return ne.p=c,d()}finally{ne.p=g}}var ar=Math.random().toString(36).slice(2),Wn="__reactFiber$"+ar,H="__reactProps$"+ar,J="__reactContainer$"+ar,xe="__reactEvents$"+ar,Ie="__reactListeners$"+ar,Ye="__reactHandles$"+ar,qe="__reactResources$"+ar,vt="__reactMarker$"+ar;function mt(c){delete c[Wn],delete c[H],delete c[xe],delete c[Ie],delete c[Ye]}function xt(c){var d=c[Wn];if(d)return d;for(var g=c.parentNode;g;){if(d=g[J]||g[Wn]){if(g=d.alternate,d.child!==null||g!==null&&g.child!==null)for(c=OL(c);c!==null;){if(g=c[Wn])return g;c=OL(c)}return d}c=g,g=c.parentNode}return null}function k(c){if(c=c[Wn]||c[J]){var d=c.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return c}return null}function ae(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c.stateNode;throw Error(n(33))}function ce(c){var d=c[qe];return d||(d=c[qe]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Ae(c){c[vt]=!0}var le=new Set,ke={};function it(c,d){ft(c,d),ft(c+"Capture",d)}function ft(c,d){for(ke[c]=d,c=0;c<d.length;c++)le.add(d[c])}var bt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ft={},Jt={};function $t(c){return ht.call(Jt,c)?!0:ht.call(Ft,c)?!1:bt.test(c)?Jt[c]=!0:(Ft[c]=!0,!1)}function tn(c,d,g){if($t(d))if(g===null)c.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":c.removeAttribute(d);return;case"boolean":var v=d.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){c.removeAttribute(d);return}}c.setAttribute(d,""+g)}}function Gn(c,d,g){if(g===null)c.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(d);return}c.setAttribute(d,""+g)}}function fn(c,d,g,v){if(v===null)c.removeAttribute(g);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(g);return}c.setAttributeNS(d,g,""+v)}}function bn(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function $n(c){var d=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function hn(c,d,g){var v=Object.getOwnPropertyDescriptor(c.constructor.prototype,d);if(!c.hasOwnProperty(d)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var E=v.get,R=v.set;return Object.defineProperty(c,d,{configurable:!0,get:function(){return E.call(this)},set:function(z){g=""+z,R.call(this,z)}}),Object.defineProperty(c,d,{enumerable:v.enumerable}),{getValue:function(){return g},setValue:function(z){g=""+z},stopTracking:function(){c._valueTracker=null,delete c[d]}}}}function qn(c){if(!c._valueTracker){var d=$n(c)?"checked":"value";c._valueTracker=hn(c,d,""+c[d])}}function on(c){if(!c)return!1;var d=c._valueTracker;if(!d)return!0;var g=d.getValue(),v="";return c&&(v=$n(c)?c.checked?"true":"false":c.value),c=v,c!==g?(d.setValue(c),!0):!1}function ii(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var xi=/[\n"\\]/g;function xn(c){return c.replace(xi,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function As(c,d,g,v,E,R,z,Y){c.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?c.type=z:c.removeAttribute("type"),d!=null?z==="number"?(d===0&&c.value===""||c.value!=d)&&(c.value=""+bn(d)):c.value!==""+bn(d)&&(c.value=""+bn(d)):z!=="submit"&&z!=="reset"||c.removeAttribute("value"),d!=null?Ei(c,z,bn(d)):g!=null?Ei(c,z,bn(g)):v!=null&&c.removeAttribute("value"),E==null&&R!=null&&(c.defaultChecked=!!R),E!=null&&(c.checked=E&&typeof E!="function"&&typeof E!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?c.name=""+bn(Y):c.removeAttribute("name")}function ci(c,d,g,v,E,R,z,Y){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(c.type=R),d!=null||g!=null){if(!(R!=="submit"&&R!=="reset"||d!=null)){qn(c);return}g=g!=null?""+bn(g):"",d=d!=null?""+bn(d):g,Y||d===c.value||(c.value=d),c.defaultValue=d}v=v??E,v=typeof v!="function"&&typeof v!="symbol"&&!!v,c.checked=Y?c.checked:!!v,c.defaultChecked=!!v,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(c.name=z),qn(c)}function Ei(c,d,g){d==="number"&&ii(c.ownerDocument)===c||c.defaultValue===""+g||(c.defaultValue=""+g)}function $i(c,d,g,v){if(c=c.options,d){d={};for(var E=0;E<g.length;E++)d["$"+g[E]]=!0;for(g=0;g<c.length;g++)E=d.hasOwnProperty("$"+c[g].value),c[g].selected!==E&&(c[g].selected=E),E&&v&&(c[g].defaultSelected=!0)}else{for(g=""+bn(g),d=null,E=0;E<c.length;E++){if(c[E].value===g){c[E].selected=!0,v&&(c[E].defaultSelected=!0);return}d!==null||c[E].disabled||(d=c[E])}d!==null&&(d.selected=!0)}}function or(c,d,g){if(d!=null&&(d=""+bn(d),d!==c.value&&(c.value=d),g==null)){c.defaultValue!==d&&(c.defaultValue=d);return}c.defaultValue=g!=null?""+bn(g):""}function ws(c,d,g,v){if(d==null){if(v!=null){if(g!=null)throw Error(n(92));if(re(v)){if(1<v.length)throw Error(n(93));v=v[0]}g=v}g==null&&(g=""),d=g}g=bn(d),c.defaultValue=g,v=c.textContent,v===g&&v!==""&&v!==null&&(c.value=v),qn(c)}function il(c,d){if(d){var g=c.firstChild;if(g&&g===c.lastChild&&g.nodeType===3){g.nodeValue=d;return}}c.textContent=d}var Lo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function lm(c,d,g){var v=d.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?v?c.setProperty(d,""):d==="float"?c.cssFloat="":c[d]="":v?c.setProperty(d,g):typeof g!="number"||g===0||Lo.has(d)?d==="float"?c.cssFloat=g:c[d]=(""+g).trim():c[d]=g+"px"}function Iv(c,d,g){if(d!=null&&typeof d!="object")throw Error(n(62));if(c=c.style,g!=null){for(var v in g)!g.hasOwnProperty(v)||d!=null&&d.hasOwnProperty(v)||(v.indexOf("--")===0?c.setProperty(v,""):v==="float"?c.cssFloat="":c[v]="");for(var E in d)v=d[E],d.hasOwnProperty(E)&&g[E]!==v&&lm(c,E,v)}else for(var R in d)d.hasOwnProperty(R)&&lm(c,R,d[R])}function cm(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),uA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function um(c){return uA.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function Fl(){}var dm=null;function C0(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Id=null,yu=null;function Pv(c){var d=k(c);if(d&&(c=d.stateNode)){var g=c[H]||null;e:switch(c=d.stateNode,d.type){case"input":if(As(c,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),d=g.name,g.type==="radio"&&d!=null){for(g=c;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+xn(""+d)+'"][type="radio"]'),d=0;d<g.length;d++){var v=g[d];if(v!==c&&v.form===c.form){var E=v[H]||null;if(!E)throw Error(n(90));As(v,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(d=0;d<g.length;d++)v=g[d],v.form===c.form&&on(v)}break e;case"textarea":or(c,g.value,g.defaultValue);break e;case"select":d=g.value,d!=null&&$i(c,!!g.multiple,d,!1)}}}var R0=!1;function Fv(c,d,g){if(R0)return c(d,g);R0=!0;try{var v=c(d);return v}finally{if(R0=!1,(Id!==null||yu!==null)&&($(),Id&&(d=Id,c=yu,yu=Id=null,Pv(d),c)))for(d=0;d<c.length;d++)Pv(c[d])}}function Pd(c,d){var g=c.stateNode;if(g===null)return null;var v=g[H]||null;if(v===null)return null;g=v[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(c=c.type,v=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!v;break e;default:c=!1}if(c)return null;if(g&&typeof g!="function")throw Error(n(231,d,typeof g));return g}var Gl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),w0=!1;if(Gl)try{var fm={};Object.defineProperty(fm,"passive",{get:function(){w0=!0}}),window.addEventListener("test",fm,fm),window.removeEventListener("test",fm,fm)}catch{w0=!1}var vu=null,N0=null,_u=null;function B0(){if(_u)return _u;var c,d=N0,g=d.length,v,E="value"in vu?vu.value:vu.textContent,R=E.length;for(c=0;c<g&&d[c]===E[c];c++);var z=g-c;for(v=1;v<=z&&d[g-v]===E[R-v];v++);return _u=E.slice(c,1<v?1-v:void 0)}function Fd(c){var d=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&d===13&&(c=13)):c=d,c===10&&(c=13),32<=c||c===13?c:0}function hm(){return!0}function Gv(){return!1}function jr(c){function d(g,v,E,R,z){this._reactName=g,this._targetInst=E,this.type=v,this.nativeEvent=R,this.target=z,this.currentTarget=null;for(var Y in c)c.hasOwnProperty(Y)&&(g=c[Y],this[Y]=g?g(R):R[Y]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?hm:Gv,this.isPropagationStopped=Gv,this}return p(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=hm)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=hm)},persist:function(){},isPersistent:hm}),d}var bu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pm=jr(bu),sl=p({},bu,{view:0,detail:0}),D0=jr(sl),O0,mm,rh,gm=p({},sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ym,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==rh&&(rh&&c.type==="mousemove"?(O0=c.screenX-rh.screenX,mm=c.screenY-rh.screenY):mm=O0=0,rh=c),O0)},movementY:function(c){return"movementY"in c?c.movementY:mm}}),dA=jr(gm),Br=p({},gm,{dataTransfer:0}),fA=jr(Br),hA=p({},sl,{relatedTarget:0}),U0=jr(hA),pA=p({},bu,{animationName:0,elapsedTime:0,pseudoElement:0}),mA=jr(pA),xm=p({},bu,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),zv=jr(xm),gA=p({},bu,{data:0}),Vv=jr(gA),xA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yA(c){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(c):(c=kv[c])?!!d[c]:!1}function ym(){return yA}var Wv=p({},sl,{key:function(c){if(c.key){var d=xA[c.key]||c.key;if(d!=="Unidentified")return d}return c.type==="keypress"?(c=Fd(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Hv[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ym,charCode:function(c){return c.type==="keypress"?Fd(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Fd(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Xv=jr(Wv),vA=p({},gm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),L0=jr(vA),_A=p({},sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ym}),Cc=jr(_A),qv=p({},bu,{propertyName:0,elapsedTime:0,pseudoElement:0}),K3=jr(qv),bA=p({},gm,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Su=jr(bA),Rc=p({},bu,{newState:0,oldState:0}),Yv=jr(Rc),jv=[9,13,27,32],Gd=Gl&&"CompositionEvent"in window,Tu=null;Gl&&"documentMode"in document&&(Tu=document.documentMode);var zd=Gl&&"TextEvent"in window&&!Tu,Dr=Gl&&(!Gd||Tu&&8<Tu&&11>=Tu),vm=" ",$v=!1;function I0(c,d){switch(c){case"keyup":return jv.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ah(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Au=!1;function P0(c,d){switch(c){case"compositionend":return ah(d);case"keypress":return d.which!==32?null:($v=!0,vm);case"textInput":return c=d.data,c===vm&&$v?null:c;default:return null}}function SA(c,d){if(Au)return c==="compositionend"||!Gd&&I0(c,d)?(c=B0(),_u=N0=vu=null,Au=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Dr&&d.locale!=="ko"?null:d.data;default:return null}}var ja={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kv(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d==="input"?!!ja[c.type]:d==="textarea"}function F0(c,d,g,v){Id?yu?yu.push(v):yu=[v]:Id=v,d=h1(d,"onChange"),0<d.length&&(g=new pm("onChange","change",null,g,v),c.push({event:g,listeners:d}))}var oh=null,lh=null;function Jv(c){vL(c,0)}function ch(c){var d=ae(c);if(on(d))return c}function Zv(c,d){if(c==="change")return d}var _m=!1;if(Gl){var Vd;if(Gl){var hs="oninput"in document;if(!hs){var TA=document.createElement("div");TA.setAttribute("oninput","return;"),hs=typeof TA.oninput=="function"}Vd=hs}else Vd=!1;_m=Vd&&(!document.documentMode||9<document.documentMode)}function AA(){oh&&(oh.detachEvent("onpropertychange",Qv),lh=oh=null)}function Qv(c){if(c.propertyName==="value"&&ch(lh)){var d=[];F0(d,lh,c,C0(c)),Fv(Jv,d)}}function bm(c,d,g){c==="focusin"?(AA(),oh=d,lh=g,oh.attachEvent("onpropertychange",Qv)):c==="focusout"&&AA()}function Eu(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return ch(lh)}function EA(c,d){if(c==="click")return ch(d)}function MA(c,d){if(c==="input"||c==="change")return ch(d)}function Hd(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var ps=typeof Object.is=="function"?Object.is:Hd;function uh(c,d){if(ps(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var g=Object.keys(c),v=Object.keys(d);if(g.length!==v.length)return!1;for(v=0;v<g.length;v++){var E=g[v];if(!ht.call(d,E)||!ps(c[E],d[E]))return!1}return!0}function e_(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function t_(c,d){var g=e_(c);c=0;for(var v;g;){if(g.nodeType===3){if(v=c+g.textContent.length,c<=d&&v>=d)return{node:g,offset:d-c};c=v}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=e_(g)}}function G0(c,d){return c&&d?c===d?!0:c&&c.nodeType===3?!1:d&&d.nodeType===3?G0(c,d.parentNode):"contains"in c?c.contains(d):c.compareDocumentPosition?!!(c.compareDocumentPosition(d)&16):!1:!1}function z0(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var d=ii(c.document);d instanceof c.HTMLIFrameElement;){try{var g=typeof d.contentWindow.location.href=="string"}catch{g=!1}if(g)c=d.contentWindow;else break;d=ii(c.document)}return d}function dh(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d&&(d==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||d==="textarea"||c.contentEditable==="true")}var CA=Gl&&"documentMode"in document&&11>=document.documentMode,fh=null,V0=null,hh=null,$a=!1;function H0(c,d,g){var v=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;$a||fh==null||fh!==ii(v)||(v=fh,"selectionStart"in v&&dh(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),hh&&uh(hh,v)||(hh=v,v=h1(V0,"onSelect"),0<v.length&&(d=new pm("onSelect","select",null,d,g),c.push({event:d,listeners:v}),d.target=fh)))}function Mu(c,d){var g={};return g[c.toLowerCase()]=d.toLowerCase(),g["Webkit"+c]="webkit"+d,g["Moz"+c]="moz"+d,g}var ph={animationend:Mu("Animation","AnimationEnd"),animationiteration:Mu("Animation","AnimationIteration"),animationstart:Mu("Animation","AnimationStart"),transitionrun:Mu("Transition","TransitionRun"),transitionstart:Mu("Transition","TransitionStart"),transitioncancel:Mu("Transition","TransitionCancel"),transitionend:Mu("Transition","TransitionEnd")},Sm={},da={};Gl&&(da=document.createElement("div").style,"AnimationEvent"in window||(delete ph.animationend.animation,delete ph.animationiteration.animation,delete ph.animationstart.animation),"TransitionEvent"in window||delete ph.transitionend.transition);function Cu(c){if(Sm[c])return Sm[c];if(!ph[c])return c;var d=ph[c],g;for(g in d)if(d.hasOwnProperty(g)&&g in da)return Sm[c]=d[g];return c}var Ta=Cu("animationend"),n_=Cu("animationiteration"),zl=Cu("animationstart"),mh=Cu("transitionrun"),Ru=Cu("transitionstart"),i_=Cu("transitioncancel"),k0=Cu("transitionend"),wc=new Map,W0="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");W0.push("scrollEnd");function $r(c,d){wc.set(c,d),it(d,[c])}var wu=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},yr=[],kd=0,X0=0;function Nu(){for(var c=kd,d=X0=kd=0;d<c;){var g=yr[d];yr[d++]=null;var v=yr[d];yr[d++]=null;var E=yr[d];yr[d++]=null;var R=yr[d];if(yr[d++]=null,v!==null&&E!==null){var z=v.pending;z===null?E.next=E:(E.next=z.next,z.next=E),v.pending=E}R!==0&&q0(g,E,R)}}function Tm(c,d,g,v){yr[kd++]=c,yr[kd++]=d,yr[kd++]=g,yr[kd++]=v,X0|=v,c.lanes|=v,c=c.alternate,c!==null&&(c.lanes|=v)}function gh(c,d,g,v){return Tm(c,d,g,v),xh(c)}function Bu(c,d){return Tm(c,null,null,d),xh(c)}function q0(c,d,g){c.lanes|=g;var v=c.alternate;v!==null&&(v.lanes|=g);for(var E=!1,R=c.return;R!==null;)R.childLanes|=g,v=R.alternate,v!==null&&(v.childLanes|=g),R.tag===22&&(c=R.stateNode,c===null||c._visibility&1||(E=!0)),c=R,R=R.return;return c.tag===3?(R=c.stateNode,E&&d!==null&&(E=31-zt(g),c=R.hiddenUpdates,v=c[E],v===null?c[E]=[d]:v.push(d),d.lane=g|536870912),R):null}function xh(c){if(50<of)throw of=0,lf=null,Error(n(185));for(var d=c.return;d!==null;)c=d,d=c.return;return c.tag===3?c.stateNode:null}var Du={};function RA(c,d,g,v){this.tag=c,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fa(c,d,g,v){return new RA(c,d,g,v)}function ha(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Vl(c,d){var g=c.alternate;return g===null?(g=fa(c.tag,d,c.key,c.mode),g.elementType=c.elementType,g.type=c.type,g.stateNode=c.stateNode,g.alternate=c,c.alternate=g):(g.pendingProps=d,g.type=c.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=c.flags&65011712,g.childLanes=c.childLanes,g.lanes=c.lanes,g.child=c.child,g.memoizedProps=c.memoizedProps,g.memoizedState=c.memoizedState,g.updateQueue=c.updateQueue,d=c.dependencies,g.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},g.sibling=c.sibling,g.index=c.index,g.ref=c.ref,g.refCleanup=c.refCleanup,g}function Kr(c,d){c.flags&=65011714;var g=c.alternate;return g===null?(c.childLanes=0,c.lanes=d,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=g.childLanes,c.lanes=g.lanes,c.child=g.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=g.memoizedProps,c.memoizedState=g.memoizedState,c.updateQueue=g.updateQueue,c.type=g.type,d=g.dependencies,c.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),c}function Am(c,d,g,v,E,R){var z=0;if(v=c,typeof c=="function")ha(c)&&(z=1);else if(typeof c=="string")z=Tq(c,g,Ne.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case U:return c=fa(31,g,d,E),c.elementType=U,c.lanes=R,c;case T:return Nc(g.children,E,R,d);case A:z=8,E|=24;break;case S:return c=fa(12,g,d,E|2),c.elementType=S,c.lanes=R,c;case L:return c=fa(13,g,d,E),c.elementType=L,c.lanes=R,c;case D:return c=fa(19,g,d,E),c.elementType=D,c.lanes=R,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case w:z=10;break e;case C:z=9;break e;case B:z=11;break e;case O:z=14;break e;case F:z=16,v=null;break e}z=29,g=Error(n(130,c===null?"null":typeof c,"")),v=null}return d=fa(z,g,d,E),d.elementType=c,d.type=v,d.lanes=R,d}function Nc(c,d,g,v){return c=fa(7,c,v,d),c.lanes=g,c}function Y0(c,d,g){return c=fa(6,c,null,d),c.lanes=g,c}function wA(c){var d=fa(18,null,null,0);return d.stateNode=c,d}function rl(c,d,g){return d=fa(4,c.children!==null?c.children:[],c.key,d),d.lanes=g,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}var s_=new WeakMap;function Aa(c,d){if(typeof c=="object"&&c!==null){var g=s_.get(c);return g!==void 0?g:(d={value:c,source:d,stack:Tt(d)},s_.set(c,d),d)}return{value:c,source:d,stack:Tt(d)}}var al=[],Wd=0,Em=null,yh=0,Ka=[],Ea=0,Hl=null,kl=1,Wl="";function Bc(c,d){al[Wd++]=yh,al[Wd++]=Em,Em=c,yh=d}function r_(c,d,g){Ka[Ea++]=kl,Ka[Ea++]=Wl,Ka[Ea++]=Hl,Hl=c;var v=kl;c=Wl;var E=32-zt(v)-1;v&=~(1<<E),g+=1;var R=32-zt(d)+E;if(30<R){var z=E-E%5;R=(v&(1<<z)-1).toString(32),v>>=z,E-=z,kl=1<<32-zt(d)+E|g<<E|v,Wl=R+c}else kl=1<<R|g<<E|v,Wl=c}function j0(c){c.return!==null&&(Bc(c,1),r_(c,1,0))}function Ou(c){for(;c===Em;)Em=al[--Wd],al[Wd]=null,yh=al[--Wd],al[Wd]=null;for(;c===Hl;)Hl=Ka[--Ea],Ka[Ea]=null,Wl=Ka[--Ea],Ka[Ea]=null,kl=Ka[--Ea],Ka[Ea]=null}function Mm(c,d){Ka[Ea++]=kl,Ka[Ea++]=Wl,Ka[Ea++]=Hl,kl=d.id,Wl=d.overflow,Hl=c}var vr=null,rs=null,ui=!1,Dc=null,_r=!1,$0=Error(n(519));function ai(c){var d=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Cm(Aa(d,c)),$0}function K0(c){var d=c.stateNode,g=c.type,v=c.memoizedProps;switch(d[Wn]=c,d[H]=v,g){case"dialog":di("cancel",d),di("close",d);break;case"iframe":case"object":case"embed":di("load",d);break;case"video":case"audio":for(g=0;g<J_.length;g++)di(J_[g],d);break;case"source":di("error",d);break;case"img":case"image":case"link":di("error",d),di("load",d);break;case"details":di("toggle",d);break;case"input":di("invalid",d),ci(d,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0);break;case"select":di("invalid",d);break;case"textarea":di("invalid",d),ws(d,v.value,v.defaultValue,v.children)}g=v.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||d.textContent===""+g||v.suppressHydrationWarning===!0||TL(d.textContent,g)?(v.popover!=null&&(di("beforetoggle",d),di("toggle",d)),v.onScroll!=null&&di("scroll",d),v.onScrollEnd!=null&&di("scrollend",d),v.onClick!=null&&(d.onclick=Fl),d=!0):d=!1,d||ai(c,!0)}function NA(c){for(vr=c.return;vr;)switch(vr.tag){case 5:case 31:case 13:_r=!1;return;case 27:case 3:_r=!0;return;default:vr=vr.return}}function Xd(c){if(c!==vr)return!1;if(!ui)return NA(c),ui=!0,!1;var d=c.tag,g;if((g=d!==3&&d!==27)&&((g=d===5)&&(g=c.type,g=!(g!=="form"&&g!=="button")||gR(c.type,c.memoizedProps)),g=!g),g&&rs&&ai(c),NA(c),d===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));rs=DL(c)}else if(d===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));rs=DL(c)}else d===27?(d=rs,Ph(c.type)?(c=bR,bR=null,rs=c):rs=d):rs=vr?tc(c.stateNode.nextSibling):null;return!0}function qd(){rs=vr=null,ui=!1}function a_(){var c=Dc;return c!==null&&(na===null?na=c:na.push.apply(na,c),Dc=null),c}function Cm(c){Dc===null?Dc=[c]:Dc.push(c)}var o_=K(null),Oc=null,Jr=null;function Uc(c,d,g){we(o_,d._currentValue),d._currentValue=g}function Io(c){c._currentValue=o_.current,pe(o_)}function Lc(c,d,g){for(;c!==null;){var v=c.alternate;if((c.childLanes&d)!==d?(c.childLanes|=d,v!==null&&(v.childLanes|=d)):v!==null&&(v.childLanes&d)!==d&&(v.childLanes|=d),c===g)break;c=c.return}}function J0(c,d,g,v){var E=c.child;for(E!==null&&(E.return=c);E!==null;){var R=E.dependencies;if(R!==null){var z=E.child;R=R.firstContext;e:for(;R!==null;){var Y=R;R=E;for(var he=0;he<d.length;he++)if(Y.context===d[he]){R.lanes|=g,Y=R.alternate,Y!==null&&(Y.lanes|=g),Lc(R.return,g,c),v||(z=null);break e}R=Y.next}}else if(E.tag===18){if(z=E.return,z===null)throw Error(n(341));z.lanes|=g,R=z.alternate,R!==null&&(R.lanes|=g),Lc(z,g,c),z=null}else z=E.child;if(z!==null)z.return=E;else for(z=E;z!==null;){if(z===c){z=null;break}if(E=z.sibling,E!==null){E.return=z.return,z=E;break}z=z.return}E=z}}function Uu(c,d,g,v){c=null;for(var E=d,R=!1;E!==null;){if(!R){if((E.flags&524288)!==0)R=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var z=E.alternate;if(z===null)throw Error(n(387));if(z=z.memoizedProps,z!==null){var Y=E.type;ps(E.pendingProps.value,z.value)||(c!==null?c.push(Y):c=[Y])}}else if(E===Be.current){if(z=E.alternate,z===null)throw Error(n(387));z.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(c!==null?c.push(nb):c=[nb])}E=E.return}c!==null&&J0(d,c,g,v),d.flags|=262144}function vh(c){for(c=c.firstContext;c!==null;){if(!ps(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Yd(c){Oc=c,Jr=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function br(c){return l_(Oc,c)}function Rm(c,d){return Oc===null&&Yd(c),l_(c,d)}function l_(c,d){var g=d._currentValue;if(d={context:d,memoizedValue:g,next:null},Jr===null){if(c===null)throw Error(n(308));Jr=d,c.dependencies={lanes:0,firstContext:d},c.flags|=524288}else Jr=Jr.next=d;return g}var BA=typeof AbortController<"u"?AbortController:function(){var c=[],d=this.signal={aborted:!1,addEventListener:function(g,v){c.push(v)}};this.abort=function(){d.aborted=!0,c.forEach(function(g){return g()})}},DA=i.unstable_scheduleCallback,c_=i.unstable_NormalPriority,vn={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function u_(){return{controller:new BA,data:new Map,refCount:0}}function Or(c){c.refCount--,c.refCount===0&&DA(c_,function(){c.controller.abort()})}var jd=null,d_=0,Ic=0,ol=null;function _h(c,d){if(jd===null){var g=jd=[];d_=0,Ic=oR(),ol={status:"pending",value:void 0,then:function(v){g.push(v)}}}return d_++,d.then(f_,f_),d}function f_(){if(--d_===0&&jd!==null){ol!==null&&(ol.status="fulfilled");var c=jd;jd=null,Ic=0,ol=null;for(var d=0;d<c.length;d++)(0,c[d])()}}function h_(c,d){var g=[],v={status:"pending",value:null,reason:null,then:function(E){g.push(E)}};return c.then(function(){v.status="fulfilled",v.value=d;for(var E=0;E<g.length;E++)(0,g[E])(d)},function(E){for(v.status="rejected",v.reason=E,E=0;E<g.length;E++)(0,g[E])(void 0)}),v}var OA=W.S;W.S=function(c,d){Uh=V(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&_h(c,d),OA!==null&&OA(c,d)};var Lu=K(null);function Xl(){var c=Lu.current;return c!==null?c:Ii.pooledCache}function bh(c,d){d===null?we(Lu,Lu.current):we(Lu,d.pool)}function Z0(){var c=Xl();return c===null?null:{parent:vn._currentValue,pool:c}}var Iu=Error(n(460)),wm=Error(n(474)),ll=Error(n(542)),Nm={then:function(){}};function UA(c){return c=c.status,c==="fulfilled"||c==="rejected"}function p_(c,d,g){switch(g=c[g],g===void 0?c.push(d):g!==d&&(d.then(Fl,Fl),d=g),d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,m_(c),c;default:if(typeof d.status=="string")d.then(Fl,Fl);else{if(c=Ii,c!==null&&100<c.shellSuspendCounter)throw Error(n(482));c=d,c.status="pending",c.then(function(v){if(d.status==="pending"){var E=d;E.status="fulfilled",E.value=v}},function(v){if(d.status==="pending"){var E=d;E.status="rejected",E.reason=v}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,m_(c),c}throw An=d,Iu}}function $d(c){try{var d=c._init;return d(c._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(An=g,Iu):g}}var An=null;function Q0(){if(An===null)throw Error(n(459));var c=An;return An=null,c}function m_(c){if(c===Iu||c===ll)throw Error(n(483))}var Pu=null,Fu=0;function ex(c){var d=Fu;return Fu+=1,Pu===null&&(Pu=[]),p_(Pu,c,d)}function Bm(c,d){d=d.props.ref,c.ref=d!==void 0?d:null}function Dm(c,d){throw d.$$typeof===x?Error(n(525)):(c=Object.prototype.toString.call(d),Error(n(31,c==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":c)))}function Sh(c){function d(Me,be){if(c){var Oe=Me.deletions;Oe===null?(Me.deletions=[be],Me.flags|=16):Oe.push(be)}}function g(Me,be){if(!c)return null;for(;be!==null;)d(Me,be),be=be.sibling;return null}function v(Me){for(var be=new Map;Me!==null;)Me.key!==null?be.set(Me.key,Me):be.set(Me.index,Me),Me=Me.sibling;return be}function E(Me,be){return Me=Vl(Me,be),Me.index=0,Me.sibling=null,Me}function R(Me,be,Oe){return Me.index=Oe,c?(Oe=Me.alternate,Oe!==null?(Oe=Oe.index,Oe<be?(Me.flags|=67108866,be):Oe):(Me.flags|=67108866,be)):(Me.flags|=1048576,be)}function z(Me){return c&&Me.alternate===null&&(Me.flags|=67108866),Me}function Y(Me,be,Oe,at){return be===null||be.tag!==6?(be=Y0(Oe,Me.mode,at),be.return=Me,be):(be=E(be,Oe),be.return=Me,be)}function he(Me,be,Oe,at){var Sn=Oe.type;return Sn===T?tt(Me,be,Oe.props.children,at,Oe.key):be!==null&&(be.elementType===Sn||typeof Sn=="object"&&Sn!==null&&Sn.$$typeof===F&&$d(Sn)===be.type)?(be=E(be,Oe.props),Bm(be,Oe),be.return=Me,be):(be=Am(Oe.type,Oe.key,Oe.props,null,Me.mode,at),Bm(be,Oe),be.return=Me,be)}function Ue(Me,be,Oe,at){return be===null||be.tag!==4||be.stateNode.containerInfo!==Oe.containerInfo||be.stateNode.implementation!==Oe.implementation?(be=rl(Oe,Me.mode,at),be.return=Me,be):(be=E(be,Oe.children||[]),be.return=Me,be)}function tt(Me,be,Oe,at,Sn){return be===null||be.tag!==7?(be=Nc(Oe,Me.mode,at,Sn),be.return=Me,be):(be=E(be,Oe),be.return=Me,be)}function ut(Me,be,Oe){if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return be=Y0(""+be,Me.mode,Oe),be.return=Me,be;if(typeof be=="object"&&be!==null){switch(be.$$typeof){case y:return Oe=Am(be.type,be.key,be.props,null,Me.mode,Oe),Bm(Oe,be),Oe.return=Me,Oe;case _:return be=rl(be,Me.mode,Oe),be.return=Me,be;case F:return be=$d(be),ut(Me,be,Oe)}if(re(be)||Z(be))return be=Nc(be,Me.mode,Oe,null),be.return=Me,be;if(typeof be.then=="function")return ut(Me,ex(be),Oe);if(be.$$typeof===w)return ut(Me,Rm(Me,be),Oe);Dm(Me,be)}return null}function Pe(Me,be,Oe,at){var Sn=be!==null?be.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return Sn!==null?null:Y(Me,be,""+Oe,at);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case y:return Oe.key===Sn?he(Me,be,Oe,at):null;case _:return Oe.key===Sn?Ue(Me,be,Oe,at):null;case F:return Oe=$d(Oe),Pe(Me,be,Oe,at)}if(re(Oe)||Z(Oe))return Sn!==null?null:tt(Me,be,Oe,at,null);if(typeof Oe.then=="function")return Pe(Me,be,ex(Oe),at);if(Oe.$$typeof===w)return Pe(Me,be,Rm(Me,Oe),at);Dm(Me,Oe)}return null}function We(Me,be,Oe,at,Sn){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return Me=Me.get(Oe)||null,Y(be,Me,""+at,Sn);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case y:return Me=Me.get(at.key===null?Oe:at.key)||null,he(be,Me,at,Sn);case _:return Me=Me.get(at.key===null?Oe:at.key)||null,Ue(be,Me,at,Sn);case F:return at=$d(at),We(Me,be,Oe,at,Sn)}if(re(at)||Z(at))return Me=Me.get(Oe)||null,tt(be,Me,at,Sn,null);if(typeof at.then=="function")return We(Me,be,Oe,ex(at),Sn);if(at.$$typeof===w)return We(Me,be,Oe,Rm(be,at),Sn);Dm(be,at)}return null}function un(Me,be,Oe,at){for(var Sn=null,Fi=null,pn=be,Zn=be=0,_i=null;pn!==null&&Zn<Oe.length;Zn++){pn.index>Zn?(_i=pn,pn=null):_i=pn.sibling;var Gi=Pe(Me,pn,Oe[Zn],at);if(Gi===null){pn===null&&(pn=_i);break}c&&pn&&Gi.alternate===null&&d(Me,pn),be=R(Gi,be,Zn),Fi===null?Sn=Gi:Fi.sibling=Gi,Fi=Gi,pn=_i}if(Zn===Oe.length)return g(Me,pn),ui&&Bc(Me,Zn),Sn;if(pn===null){for(;Zn<Oe.length;Zn++)pn=ut(Me,Oe[Zn],at),pn!==null&&(be=R(pn,be,Zn),Fi===null?Sn=pn:Fi.sibling=pn,Fi=pn);return ui&&Bc(Me,Zn),Sn}for(pn=v(pn);Zn<Oe.length;Zn++)_i=We(pn,Me,Zn,Oe[Zn],at),_i!==null&&(c&&_i.alternate!==null&&pn.delete(_i.key===null?Zn:_i.key),be=R(_i,be,Zn),Fi===null?Sn=_i:Fi.sibling=_i,Fi=_i);return c&&pn.forEach(function(Hh){return d(Me,Hh)}),ui&&Bc(Me,Zn),Sn}function Nn(Me,be,Oe,at){if(Oe==null)throw Error(n(151));for(var Sn=null,Fi=null,pn=be,Zn=be=0,_i=null,Gi=Oe.next();pn!==null&&!Gi.done;Zn++,Gi=Oe.next()){pn.index>Zn?(_i=pn,pn=null):_i=pn.sibling;var Hh=Pe(Me,pn,Gi.value,at);if(Hh===null){pn===null&&(pn=_i);break}c&&pn&&Hh.alternate===null&&d(Me,pn),be=R(Hh,be,Zn),Fi===null?Sn=Hh:Fi.sibling=Hh,Fi=Hh,pn=_i}if(Gi.done)return g(Me,pn),ui&&Bc(Me,Zn),Sn;if(pn===null){for(;!Gi.done;Zn++,Gi=Oe.next())Gi=ut(Me,Gi.value,at),Gi!==null&&(be=R(Gi,be,Zn),Fi===null?Sn=Gi:Fi.sibling=Gi,Fi=Gi);return ui&&Bc(Me,Zn),Sn}for(pn=v(pn);!Gi.done;Zn++,Gi=Oe.next())Gi=We(pn,Me,Zn,Gi.value,at),Gi!==null&&(c&&Gi.alternate!==null&&pn.delete(Gi.key===null?Zn:Gi.key),be=R(Gi,be,Zn),Fi===null?Sn=Gi:Fi.sibling=Gi,Fi=Gi);return c&&pn.forEach(function(Uq){return d(Me,Uq)}),ui&&Bc(Me,Zn),Sn}function ls(Me,be,Oe,at){if(typeof Oe=="object"&&Oe!==null&&Oe.type===T&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case y:e:{for(var Sn=Oe.key;be!==null;){if(be.key===Sn){if(Sn=Oe.type,Sn===T){if(be.tag===7){g(Me,be.sibling),at=E(be,Oe.props.children),at.return=Me,Me=at;break e}}else if(be.elementType===Sn||typeof Sn=="object"&&Sn!==null&&Sn.$$typeof===F&&$d(Sn)===be.type){g(Me,be.sibling),at=E(be,Oe.props),Bm(at,Oe),at.return=Me,Me=at;break e}g(Me,be);break}else d(Me,be);be=be.sibling}Oe.type===T?(at=Nc(Oe.props.children,Me.mode,at,Oe.key),at.return=Me,Me=at):(at=Am(Oe.type,Oe.key,Oe.props,null,Me.mode,at),Bm(at,Oe),at.return=Me,Me=at)}return z(Me);case _:e:{for(Sn=Oe.key;be!==null;){if(be.key===Sn)if(be.tag===4&&be.stateNode.containerInfo===Oe.containerInfo&&be.stateNode.implementation===Oe.implementation){g(Me,be.sibling),at=E(be,Oe.children||[]),at.return=Me,Me=at;break e}else{g(Me,be);break}else d(Me,be);be=be.sibling}at=rl(Oe,Me.mode,at),at.return=Me,Me=at}return z(Me);case F:return Oe=$d(Oe),ls(Me,be,Oe,at)}if(re(Oe))return un(Me,be,Oe,at);if(Z(Oe)){if(Sn=Z(Oe),typeof Sn!="function")throw Error(n(150));return Oe=Sn.call(Oe),Nn(Me,be,Oe,at)}if(typeof Oe.then=="function")return ls(Me,be,ex(Oe),at);if(Oe.$$typeof===w)return ls(Me,be,Rm(Me,Oe),at);Dm(Me,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint"?(Oe=""+Oe,be!==null&&be.tag===6?(g(Me,be.sibling),at=E(be,Oe),at.return=Me,Me=at):(g(Me,be),at=Y0(Oe,Me.mode,at),at.return=Me,Me=at),z(Me)):g(Me,be)}return function(Me,be,Oe,at){try{Fu=0;var Sn=ls(Me,be,Oe,at);return Pu=null,Sn}catch(pn){if(pn===Iu||pn===ll)throw pn;var Fi=fa(29,pn,null,Me.mode);return Fi.lanes=at,Fi.return=Me,Fi}finally{}}}var Kd=Sh(!0),LA=Sh(!1),Gu=!1;function g_(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function x_(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function ql(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function Pc(c,d,g){var v=c.updateQueue;if(v===null)return null;if(v=v.shared,(yi&2)!==0){var E=v.pending;return E===null?d.next=d:(d.next=E.next,E.next=d),v.pending=d,d=xh(c),q0(c,null,g),d}return Tm(c,v,d,g),xh(c)}function zu(c,d,g){if(d=d.updateQueue,d!==null&&(d=d.shared,(g&4194048)!==0)){var v=d.lanes;v&=c.pendingLanes,g|=v,d.lanes=g,Mc(c,g)}}function tx(c,d){var g=c.updateQueue,v=c.alternate;if(v!==null&&(v=v.updateQueue,g===v)){var E=null,R=null;if(g=g.firstBaseUpdate,g!==null){do{var z={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};R===null?E=R=z:R=R.next=z,g=g.next}while(g!==null);R===null?E=R=d:R=R.next=d}else E=R=d;g={baseState:v.baseState,firstBaseUpdate:E,lastBaseUpdate:R,shared:v.shared,callbacks:v.callbacks},c.updateQueue=g;return}c=g.lastBaseUpdate,c===null?g.firstBaseUpdate=d:c.next=d,g.lastBaseUpdate=d}var y_=!1;function Om(){if(y_){var c=ol;if(c!==null)throw c}}function Jd(c,d,g,v){y_=!1;var E=c.updateQueue;Gu=!1;var R=E.firstBaseUpdate,z=E.lastBaseUpdate,Y=E.shared.pending;if(Y!==null){E.shared.pending=null;var he=Y,Ue=he.next;he.next=null,z===null?R=Ue:z.next=Ue,z=he;var tt=c.alternate;tt!==null&&(tt=tt.updateQueue,Y=tt.lastBaseUpdate,Y!==z&&(Y===null?tt.firstBaseUpdate=Ue:Y.next=Ue,tt.lastBaseUpdate=he))}if(R!==null){var ut=E.baseState;z=0,tt=Ue=he=null,Y=R;do{var Pe=Y.lane&-536870913,We=Pe!==Y.lane;if(We?(oi&Pe)===Pe:(v&Pe)===Pe){Pe!==0&&Pe===Ic&&(y_=!0),tt!==null&&(tt=tt.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var un=c,Nn=Y;Pe=d;var ls=g;switch(Nn.tag){case 1:if(un=Nn.payload,typeof un=="function"){ut=un.call(ls,ut,Pe);break e}ut=un;break e;case 3:un.flags=un.flags&-65537|128;case 0:if(un=Nn.payload,Pe=typeof un=="function"?un.call(ls,ut,Pe):un,Pe==null)break e;ut=p({},ut,Pe);break e;case 2:Gu=!0}}Pe=Y.callback,Pe!==null&&(c.flags|=64,We&&(c.flags|=8192),We=E.callbacks,We===null?E.callbacks=[Pe]:We.push(Pe))}else We={lane:Pe,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},tt===null?(Ue=tt=We,he=ut):tt=tt.next=We,z|=Pe;if(Y=Y.next,Y===null){if(Y=E.shared.pending,Y===null)break;We=Y,Y=We.next,We.next=null,E.lastBaseUpdate=We,E.shared.pending=null}}while(!0);tt===null&&(he=ut),E.baseState=he,E.firstBaseUpdate=Ue,E.lastBaseUpdate=tt,R===null&&(E.shared.lanes=0),oo|=z,c.lanes=z,c.memoizedState=ut}}function Yl(c,d){if(typeof c!="function")throw Error(n(191,c));c.call(d)}function Ur(c,d){var g=c.callbacks;if(g!==null)for(c.callbacks=null,c=0;c<g.length;c++)Yl(g[c],d)}var Ja=K(null),pa=K(0);function v_(c,d){c=Hs,we(pa,c),we(Ja,d),Hs=c|d.baseLanes}function __(){we(pa,Hs),we(Ja,Ja.current)}function Zr(){Hs=pa.current,pe(Ja),pe(pa)}var lr=K(null),Po=null;function Vu(c){var d=c.alternate;we(Ns,Ns.current&1),we(lr,c),Po===null&&(d===null||Ja.current!==null||d.memoizedState!==null)&&(Po=c)}function b_(c){we(Ns,Ns.current),we(lr,c),Po===null&&(Po=c)}function IA(c){c.tag===22?(we(Ns,Ns.current),we(lr,c),Po===null&&(Po=c)):Fc()}function Fc(){we(Ns,Ns.current),we(lr,lr.current)}function Za(c){pe(lr),Po===c&&(Po=null),pe(Ns)}var Ns=K(0);function nx(c){for(var d=c;d!==null;){if(d.tag===13){var g=d.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||vR(g)||_R(g)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Ma=0,On=null,Ki=null,Ks=null,ix=!1,jl=!1,Zd=!1,sx=0,Um=0,$l=null,J3=0;function Bs(){throw Error(n(321))}function S_(c,d){if(d===null)return!1;for(var g=0;g<d.length&&g<c.length;g++)if(!ps(c[g],d[g]))return!1;return!0}function T_(c,d,g,v,E,R){return Ma=R,On=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,W.H=c===null||c.memoizedState===null?n1:Eh,Zd=!1,R=g(v,E),Zd=!1,jl&&(R=FA(d,g,v,E)),PA(c),R}function PA(c){W.H=Gm;var d=Ki!==null&&Ki.next!==null;if(Ma=0,Ks=Ki=On=null,ix=!1,Um=0,$l=null,d)throw Error(n(300));c===null||ms||(c=c.dependencies,c!==null&&vh(c)&&(ms=!0))}function FA(c,d,g,v){On=c;var E=0;do{if(jl&&($l=null),Um=0,jl=!1,25<=E)throw Error(n(301));if(E+=1,Ks=Ki=null,c.updateQueue!=null){var R=c.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}W.H=zm,R=d(g,v)}while(jl);return R}function Z3(){var c=W.H,d=c.useState()[0];return d=typeof d.then=="function"?Im(d):d,c=c.useState()[0],(Ki!==null?Ki.memoizedState:null)!==c&&(On.flags|=1024),d}function A_(){var c=sx!==0;return sx=0,c}function E_(c,d,g){d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~g}function M_(c){if(ix){for(c=c.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}ix=!1}Ma=0,Ks=Ki=On=null,jl=!1,Um=sx=0,$l=null}function ma(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?On.memoizedState=Ks=c:Ks=Ks.next=c,Ks}function Fs(){if(Ki===null){var c=On.alternate;c=c!==null?c.memoizedState:null}else c=Ki.next;var d=Ks===null?On.memoizedState:Ks.next;if(d!==null)Ks=d,Ki=c;else{if(c===null)throw On.alternate===null?Error(n(467)):Error(n(310));Ki=c,c={memoizedState:Ki.memoizedState,baseState:Ki.baseState,baseQueue:Ki.baseQueue,queue:Ki.queue,next:null},Ks===null?On.memoizedState=Ks=c:Ks=Ks.next=c}return Ks}function Lm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Im(c){var d=Um;return Um+=1,$l===null&&($l=[]),c=p_($l,c,d),d=On,(Ks===null?d.memoizedState:Ks.next)===null&&(d=d.alternate,W.H=d===null||d.memoizedState===null?n1:Eh),c}function rx(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return Im(c);if(c.$$typeof===w)return br(c)}throw Error(n(438,String(c)))}function C_(c){var d=null,g=On.updateQueue;if(g!==null&&(d=g.memoCache),d==null){var v=On.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(d={data:v.data.map(function(E){return E.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),g===null&&(g=Lm(),On.updateQueue=g),g.memoCache=d,g=d.data[d.index],g===void 0)for(g=d.data[d.index]=Array(c),v=0;v<c;v++)g[v]=P;return d.index++,g}function Gc(c,d){return typeof d=="function"?d(c):d}function ax(c){var d=Fs();return R_(d,Ki,c)}function R_(c,d,g){var v=c.queue;if(v===null)throw Error(n(311));v.lastRenderedReducer=g;var E=c.baseQueue,R=v.pending;if(R!==null){if(E!==null){var z=E.next;E.next=R.next,R.next=z}d.baseQueue=E=R,v.pending=null}if(R=c.baseState,E===null)c.memoizedState=R;else{d=E.next;var Y=z=null,he=null,Ue=d,tt=!1;do{var ut=Ue.lane&-536870913;if(ut!==Ue.lane?(oi&ut)===ut:(Ma&ut)===ut){var Pe=Ue.revertLane;if(Pe===0)he!==null&&(he=he.next={lane:0,revertLane:0,gesture:null,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null}),ut===Ic&&(tt=!0);else if((Ma&Pe)===Pe){Ue=Ue.next,Pe===Ic&&(tt=!0);continue}else ut={lane:0,revertLane:Ue.revertLane,gesture:null,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},he===null?(Y=he=ut,z=R):he=he.next=ut,On.lanes|=Pe,oo|=Pe;ut=Ue.action,Zd&&g(R,ut),R=Ue.hasEagerState?Ue.eagerState:g(R,ut)}else Pe={lane:ut,revertLane:Ue.revertLane,gesture:Ue.gesture,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},he===null?(Y=he=Pe,z=R):he=he.next=Pe,On.lanes|=ut,oo|=ut;Ue=Ue.next}while(Ue!==null&&Ue!==d);if(he===null?z=R:he.next=Y,!ps(R,c.memoizedState)&&(ms=!0,tt&&(g=ol,g!==null)))throw g;c.memoizedState=R,c.baseState=z,c.baseQueue=he,v.lastRenderedState=R}return E===null&&(v.lanes=0),[c.memoizedState,v.dispatch]}function ox(c){var d=Fs(),g=d.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=c;var v=g.dispatch,E=g.pending,R=d.memoizedState;if(E!==null){g.pending=null;var z=E=E.next;do R=c(R,z.action),z=z.next;while(z!==E);ps(R,d.memoizedState)||(ms=!0),d.memoizedState=R,d.baseQueue===null&&(d.baseState=R),g.lastRenderedState=R}return[R,v]}function w_(c,d,g){var v=On,E=Fs(),R=ui;if(R){if(g===void 0)throw Error(n(407));g=g()}else g=d();var z=!ps((Ki||E).memoizedState,g);if(z&&(E.memoizedState=g,ms=!0),E=E.queue,U_(B_.bind(null,v,E,c),[c]),E.getSnapshot!==d||z||Ks!==null&&Ks.memoizedState.tag&1){if(v.flags|=2048,Th(9,{destroy:void 0},N_.bind(null,v,E,g,d),null),Ii===null)throw Error(n(349));R||(Ma&127)!==0||GA(v,d,g)}return g}function GA(c,d,g){c.flags|=16384,c={getSnapshot:d,value:g},d=On.updateQueue,d===null?(d=Lm(),On.updateQueue=d,d.stores=[c]):(g=d.stores,g===null?d.stores=[c]:g.push(c))}function N_(c,d,g,v){d.value=g,d.getSnapshot=v,D_(d)&&lx(c)}function B_(c,d,g){return g(function(){D_(d)&&lx(c)})}function D_(c){var d=c.getSnapshot;c=c.value;try{var g=d();return!ps(c,g)}catch{return!0}}function lx(c){var d=Bu(c,2);d!==null&&m(d,c,2)}function Pm(c){var d=ma();if(typeof c=="function"){var g=c;if(c=g(),Zd){nn(!0);try{g()}finally{nn(!1)}}}return d.memoizedState=d.baseState=c,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:c},d}function zA(c,d,g,v){return c.baseState=g,R_(c,Ki,typeof v=="function"?v:Gc)}function Q3(c,d,g,v,E){if(zc(c))throw Error(n(485));if(c=d.action,c!==null){var R={payload:E,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){R.listeners.push(z)}};W.T!==null?g(!0):R.isTransition=!1,v(R),g=d.pending,g===null?(R.next=d.pending=R,VA(d,R)):(R.next=g.next,d.pending=g.next=R)}}function VA(c,d){var g=d.action,v=d.payload,E=c.state;if(d.isTransition){var R=W.T,z={};W.T=z;try{var Y=g(E,v),he=W.S;he!==null&&he(z,Y),HA(c,d,Y)}catch(Ue){cx(c,d,Ue)}finally{R!==null&&z.types!==null&&(R.types=z.types),W.T=R}}else try{R=g(E,v),HA(c,d,R)}catch(Ue){cx(c,d,Ue)}}function HA(c,d,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(v){O_(c,d,v)},function(v){return cx(c,d,v)}):O_(c,d,g)}function O_(c,d,g){d.status="fulfilled",d.value=g,kA(d),c.state=g,d=c.pending,d!==null&&(g=d.next,g===d?c.pending=null:(g=g.next,d.next=g,VA(c,g)))}function cx(c,d,g){var v=c.pending;if(c.pending=null,v!==null){v=v.next;do d.status="rejected",d.reason=g,kA(d),d=d.next;while(d!==v)}c.action=null}function kA(c){c=c.listeners;for(var d=0;d<c.length;d++)(0,c[d])()}function WA(c,d){return d}function XA(c,d){if(ui){var g=Ii.formState;if(g!==null){e:{var v=On;if(ui){if(rs){t:{for(var E=rs,R=_r;E.nodeType!==8;){if(!R){E=null;break t}if(E=tc(E.nextSibling),E===null){E=null;break t}}R=E.data,E=R==="F!"||R==="F"?E:null}if(E){rs=tc(E.nextSibling),v=E.data==="F!";break e}}ai(v)}v=!1}v&&(d=g[0])}}return g=ma(),g.memoizedState=g.baseState=d,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:WA,lastRenderedState:d},g.queue=v,g=t1.bind(null,On,v),v.dispatch=g,v=Pm(!1),R=Fm.bind(null,On,!1,v.queue),v=ma(),E={state:d,dispatch:null,action:c,pending:null},v.queue=E,g=Q3.bind(null,On,E,R,g),E.dispatch=g,v.memoizedState=c,[d,g,!1]}function qA(c){var d=Fs();return YA(d,Ki,c)}function YA(c,d,g){if(d=R_(c,d,WA)[0],c=ax(Gc)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var v=Im(d)}catch(z){throw z===Iu?ll:z}else v=d;d=Fs();var E=d.queue,R=E.dispatch;return g!==d.memoizedState&&(On.flags|=2048,Th(9,{destroy:void 0},eR.bind(null,E,g),null)),[v,R,c]}function eR(c,d){c.action=d}function jA(c){var d=Fs(),g=Ki;if(g!==null)return YA(d,g,c);Fs(),d=d.memoizedState,g=Fs();var v=g.queue.dispatch;return g.memoizedState=c,[d,v,!1]}function Th(c,d,g,v){return c={tag:c,create:g,deps:v,inst:d,next:null},d=On.updateQueue,d===null&&(d=Lm(),On.updateQueue=d),g=d.lastEffect,g===null?d.lastEffect=c.next=c:(v=g.next,g.next=c,c.next=v,d.lastEffect=c),c}function $A(){return Fs().memoizedState}function ux(c,d,g,v){var E=ma();On.flags|=c,E.memoizedState=Th(1|d,{destroy:void 0},g,v===void 0?null:v)}function dx(c,d,g,v){var E=Fs();v=v===void 0?null:v;var R=E.memoizedState.inst;Ki!==null&&v!==null&&S_(v,Ki.memoizedState.deps)?E.memoizedState=Th(d,R,g,v):(On.flags|=c,E.memoizedState=Th(1|d,R,g,v))}function KA(c,d){ux(8390656,8,c,d)}function U_(c,d){dx(2048,8,c,d)}function JA(c){On.flags|=4;var d=On.updateQueue;if(d===null)d=Lm(),On.updateQueue=d,d.events=[c];else{var g=d.events;g===null?d.events=[c]:g.push(c)}}function ZA(c){var d=Fs().memoizedState;return JA({ref:d,nextImpl:c}),function(){if((yi&2)!==0)throw Error(n(440));return d.impl.apply(void 0,arguments)}}function QA(c,d){return dx(4,2,c,d)}function Qa(c,d){return dx(4,4,c,d)}function L_(c,d){if(typeof d=="function"){c=c();var g=d(c);return function(){typeof g=="function"?g():d(null)}}if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function fx(c,d,g){g=g!=null?g.concat([c]):null,dx(4,4,L_.bind(null,d,c),g)}function hx(){}function I_(c,d){var g=Fs();d=d===void 0?null:d;var v=g.memoizedState;return d!==null&&S_(d,v[1])?v[0]:(g.memoizedState=[c,d],c)}function P_(c,d){var g=Fs();d=d===void 0?null:d;var v=g.memoizedState;if(d!==null&&S_(d,v[1]))return v[0];if(v=c(),Zd){nn(!0);try{c()}finally{nn(!1)}}return g.memoizedState=[v,d],v}function F_(c,d,g){return g===void 0||(Ma&1073741824)!==0&&(oi&261930)===0?c.memoizedState=d:(c.memoizedState=g,c=h(),On.lanes|=c,oo|=c,g)}function G_(c,d,g,v){return ps(g,d)?g:Ja.current!==null?(c=F_(c,g,v),ps(c,d)||(ms=!0),c):(Ma&42)===0||(Ma&1073741824)!==0&&(oi&261930)===0?(ms=!0,c.memoizedState=g):(c=h(),On.lanes|=c,oo|=c,d)}function z_(c,d,g,v,E){var R=ne.p;ne.p=R!==0&&8>R?R:8;var z=W.T,Y={};W.T=Y,Fm(c,!1,d,g);try{var he=E(),Ue=W.S;if(Ue!==null&&Ue(Y,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var tt=h_(he,v);Ah(c,d,tt,xa(c))}else Ah(c,d,v,xa(c))}catch(ut){Ah(c,d,{then:function(){},status:"rejected",reason:ut},xa())}finally{ne.p=R,z!==null&&Y.types!==null&&(z.types=Y.types),W.T=z}}function tR(){}function V_(c,d,g,v){if(c.tag!==5)throw Error(n(476));var E=e1(c).queue;z_(c,E,d,se,g===null?tR:function(){return H_(c),g(v)})}function e1(c){var d=c.memoizedState;if(d!==null)return d;d={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:se},next:null};var g={};return d.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:g},next:null},c.memoizedState=d,c=c.alternate,c!==null&&(c.memoizedState=d),d}function H_(c){var d=e1(c);d.next===null&&(d=c.alternate.memoizedState),Ah(c,d.next.queue,{},xa())}function k_(){return br(nb)}function Lr(){return Fs().memoizedState}function W_(){return Fs().memoizedState}function nR(c){for(var d=c.return;d!==null;){switch(d.tag){case 24:case 3:var g=xa();c=ql(g);var v=Pc(d,c,g);v!==null&&(m(v,d,g),zu(v,d,g)),d={cache:u_()},c.payload=d;return}d=d.return}}function iR(c,d,g){var v=xa();g={lane:v,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},zc(c)?Qd(d,g):(g=gh(c,d,g,v),g!==null&&(m(g,c,v),Ca(g,d,v)))}function t1(c,d,g){var v=xa();Ah(c,d,g,v)}function Ah(c,d,g,v){var E={lane:v,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(zc(c))Qd(d,E);else{var R=c.alternate;if(c.lanes===0&&(R===null||R.lanes===0)&&(R=d.lastRenderedReducer,R!==null))try{var z=d.lastRenderedState,Y=R(z,g);if(E.hasEagerState=!0,E.eagerState=Y,ps(Y,z))return Tm(c,d,E,0),Ii===null&&Nu(),!1}catch{}finally{}if(g=gh(c,d,E,v),g!==null)return m(g,c,v),Ca(g,d,v),!0}return!1}function Fm(c,d,g,v){if(v={lane:2,revertLane:oR(),gesture:null,action:v,hasEagerState:!1,eagerState:null,next:null},zc(c)){if(d)throw Error(n(479))}else d=gh(c,g,v,2),d!==null&&m(d,c,2)}function zc(c){var d=c.alternate;return c===On||d!==null&&d===On}function Qd(c,d){jl=ix=!0;var g=c.pending;g===null?d.next=d:(d.next=g.next,g.next=d),c.pending=d}function Ca(c,d,g){if((g&4194048)!==0){var v=d.lanes;v&=c.pendingLanes,g|=v,d.lanes=g,Mc(c,g)}}var Gm={readContext:br,use:rx,useCallback:Bs,useContext:Bs,useEffect:Bs,useImperativeHandle:Bs,useLayoutEffect:Bs,useInsertionEffect:Bs,useMemo:Bs,useReducer:Bs,useRef:Bs,useState:Bs,useDebugValue:Bs,useDeferredValue:Bs,useTransition:Bs,useSyncExternalStore:Bs,useId:Bs,useHostTransitionStatus:Bs,useFormState:Bs,useActionState:Bs,useOptimistic:Bs,useMemoCache:Bs,useCacheRefresh:Bs};Gm.useEffectEvent=Bs;var n1={readContext:br,use:rx,useCallback:function(c,d){return ma().memoizedState=[c,d===void 0?null:d],c},useContext:br,useEffect:KA,useImperativeHandle:function(c,d,g){g=g!=null?g.concat([c]):null,ux(4194308,4,L_.bind(null,d,c),g)},useLayoutEffect:function(c,d){return ux(4194308,4,c,d)},useInsertionEffect:function(c,d){ux(4,2,c,d)},useMemo:function(c,d){var g=ma();d=d===void 0?null:d;var v=c();if(Zd){nn(!0);try{c()}finally{nn(!1)}}return g.memoizedState=[v,d],v},useReducer:function(c,d,g){var v=ma();if(g!==void 0){var E=g(d);if(Zd){nn(!0);try{g(d)}finally{nn(!1)}}}else E=d;return v.memoizedState=v.baseState=E,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:E},v.queue=c,c=c.dispatch=iR.bind(null,On,c),[v.memoizedState,c]},useRef:function(c){var d=ma();return c={current:c},d.memoizedState=c},useState:function(c){c=Pm(c);var d=c.queue,g=t1.bind(null,On,d);return d.dispatch=g,[c.memoizedState,g]},useDebugValue:hx,useDeferredValue:function(c,d){var g=ma();return F_(g,c,d)},useTransition:function(){var c=Pm(!1);return c=z_.bind(null,On,c.queue,!0,!1),ma().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,d,g){var v=On,E=ma();if(ui){if(g===void 0)throw Error(n(407));g=g()}else{if(g=d(),Ii===null)throw Error(n(349));(oi&127)!==0||GA(v,d,g)}E.memoizedState=g;var R={value:g,getSnapshot:d};return E.queue=R,KA(B_.bind(null,v,R,c),[c]),v.flags|=2048,Th(9,{destroy:void 0},N_.bind(null,v,R,g,d),null),g},useId:function(){var c=ma(),d=Ii.identifierPrefix;if(ui){var g=Wl,v=kl;g=(v&~(1<<32-zt(v)-1)).toString(32)+g,d="_"+d+"R_"+g,g=sx++,0<g&&(d+="H"+g.toString(32)),d+="_"}else g=J3++,d="_"+d+"r_"+g.toString(32)+"_";return c.memoizedState=d},useHostTransitionStatus:k_,useFormState:XA,useActionState:XA,useOptimistic:function(c){var d=ma();d.memoizedState=d.baseState=c;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=g,d=Fm.bind(null,On,!0,g),g.dispatch=d,[c,d]},useMemoCache:C_,useCacheRefresh:function(){return ma().memoizedState=nR.bind(null,On)},useEffectEvent:function(c){var d=ma(),g={impl:c};return d.memoizedState=g,function(){if((yi&2)!==0)throw Error(n(440));return g.impl.apply(void 0,arguments)}}},Eh={readContext:br,use:rx,useCallback:I_,useContext:br,useEffect:U_,useImperativeHandle:fx,useInsertionEffect:QA,useLayoutEffect:Qa,useMemo:P_,useReducer:ax,useRef:$A,useState:function(){return ax(Gc)},useDebugValue:hx,useDeferredValue:function(c,d){var g=Fs();return G_(g,Ki.memoizedState,c,d)},useTransition:function(){var c=ax(Gc)[0],d=Fs().memoizedState;return[typeof c=="boolean"?c:Im(c),d]},useSyncExternalStore:w_,useId:Lr,useHostTransitionStatus:k_,useFormState:qA,useActionState:qA,useOptimistic:function(c,d){var g=Fs();return zA(g,Ki,c,d)},useMemoCache:C_,useCacheRefresh:W_};Eh.useEffectEvent=ZA;var zm={readContext:br,use:rx,useCallback:I_,useContext:br,useEffect:U_,useImperativeHandle:fx,useInsertionEffect:QA,useLayoutEffect:Qa,useMemo:P_,useReducer:ox,useRef:$A,useState:function(){return ox(Gc)},useDebugValue:hx,useDeferredValue:function(c,d){var g=Fs();return Ki===null?F_(g,c,d):G_(g,Ki.memoizedState,c,d)},useTransition:function(){var c=ox(Gc)[0],d=Fs().memoizedState;return[typeof c=="boolean"?c:Im(c),d]},useSyncExternalStore:w_,useId:Lr,useHostTransitionStatus:k_,useFormState:jA,useActionState:jA,useOptimistic:function(c,d){var g=Fs();return Ki!==null?zA(g,Ki,c,d):(g.baseState=c,[c,g.queue.dispatch])},useMemoCache:C_,useCacheRefresh:W_};zm.useEffectEvent=ZA;function Mh(c,d,g,v){d=c.memoizedState,g=g(v,d),g=g==null?d:p({},d,g),c.memoizedState=g,c.lanes===0&&(c.updateQueue.baseState=g)}var Vm={enqueueSetState:function(c,d,g){c=c._reactInternals;var v=xa(),E=ql(v);E.payload=d,g!=null&&(E.callback=g),d=Pc(c,E,v),d!==null&&(m(d,c,v),zu(d,c,v))},enqueueReplaceState:function(c,d,g){c=c._reactInternals;var v=xa(),E=ql(v);E.tag=1,E.payload=d,g!=null&&(E.callback=g),d=Pc(c,E,v),d!==null&&(m(d,c,v),zu(d,c,v))},enqueueForceUpdate:function(c,d){c=c._reactInternals;var g=xa(),v=ql(g);v.tag=2,d!=null&&(v.callback=d),d=Pc(c,v,g),d!==null&&(m(d,c,g),zu(d,c,g))}};function i1(c,d,g,v,E,R,z){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(v,R,z):d.prototype&&d.prototype.isPureReactComponent?!uh(g,v)||!uh(E,R):!0}function s1(c,d,g,v){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(g,v),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(g,v),d.state!==c&&Vm.enqueueReplaceState(d,d.state,null)}function Ir(c,d){var g=d;if("ref"in d){g={};for(var v in d)v!=="ref"&&(g[v]=d[v])}if(c=c.defaultProps){g===d&&(g=p({},g));for(var E in c)g[E]===void 0&&(g[E]=c[E])}return g}function X_(c){wu(c)}function r1(c){console.error(c)}function px(c){wu(c)}function mx(c,d){try{var g=c.onUncaughtError;g(d.value,{componentStack:d.stack})}catch(v){setTimeout(function(){throw v})}}function a1(c,d,g){try{var v=c.onCaughtError;v(g.value,{componentStack:g.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function q_(c,d,g){return g=ql(g),g.tag=3,g.payload={element:null},g.callback=function(){mx(c,d)},g}function Ch(c){return c=ql(c),c.tag=3,c}function Ra(c,d,g,v){var E=g.type.getDerivedStateFromError;if(typeof E=="function"){var R=v.value;c.payload=function(){return E(R)},c.callback=function(){a1(d,g,v)}}var z=g.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(c.callback=function(){a1(d,g,v),typeof E!="function"&&(ec===null?ec=new Set([this]):ec.add(this));var Y=v.stack;this.componentDidCatch(v.value,{componentStack:Y!==null?Y:""})})}function eo(c,d,g,v,E){if(g.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(d=g.alternate,d!==null&&Uu(d,g,E,!0),g=lr.current,g!==null){switch(g.tag){case 31:case 13:return Po===null?zn():g.alternate===null&&Pi===0&&(Pi=3),g.flags&=-257,g.flags|=65536,g.lanes=E,v===Nm?g.flags|=16384:(d=g.updateQueue,d===null?g.updateQueue=new Set([v]):d.add(v),sR(c,v,E)),!1;case 22:return g.flags|=65536,v===Nm?g.flags|=16384:(d=g.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([v])},g.updateQueue=d):(g=d.retryQueue,g===null?d.retryQueue=new Set([v]):g.add(v)),sR(c,v,E)),!1}throw Error(n(435,g.tag))}return sR(c,v,E),zn(),!1}if(ui)return d=lr.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=E,v!==$0&&(c=Error(n(422),{cause:v}),Cm(Aa(c,g)))):(v!==$0&&(d=Error(n(423),{cause:v}),Cm(Aa(d,g))),c=c.current.alternate,c.flags|=65536,E&=-E,c.lanes|=E,v=Aa(v,g),E=q_(c.stateNode,v,E),tx(c,E),Pi!==4&&(Pi=2)),!1;var R=Error(n(520),{cause:v});if(R=Aa(R,g),hl===null?hl=[R]:hl.push(R),Pi!==4&&(Pi=2),d===null)return!0;v=Aa(v,g),g=d;do{switch(g.tag){case 3:return g.flags|=65536,c=E&-E,g.lanes|=c,c=q_(g.stateNode,v,c),tx(g,c),!1;case 1:if(d=g.type,R=g.stateNode,(g.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(ec===null||!ec.has(R))))return g.flags|=65536,E&=-E,g.lanes|=E,E=Ch(E),Ra(E,c,g,v),tx(g,E),!1}g=g.return}while(g!==null);return!1}var gx=Error(n(461)),ms=!1;function Ds(c,d,g,v){d.child=c===null?LA(d,null,g,v):Kd(d,c.child,g,v)}function Hm(c,d,g,v,E){g=g.render;var R=d.ref;if("ref"in v){var z={};for(var Y in v)Y!=="ref"&&(z[Y]=v[Y])}else z=v;return Yd(d),v=T_(c,d,g,z,R,E),Y=A_(),c!==null&&!ms?(E_(c,d,E),dl(c,d,E)):(ui&&Y&&j0(d),d.flags|=1,Ds(c,d,v,E),d.child)}function km(c,d,g,v,E){if(c===null){var R=g.type;return typeof R=="function"&&!ha(R)&&R.defaultProps===void 0&&g.compare===null?(d.tag=15,d.type=R,to(c,d,R,v,E)):(c=Am(g.type,null,v,d,d.mode,E),c.ref=d.ref,c.return=d,d.child=c)}if(R=c.child,!ku(c,E)){var z=R.memoizedProps;if(g=g.compare,g=g!==null?g:uh,g(z,v)&&c.ref===d.ref)return dl(c,d,E)}return d.flags|=1,c=Vl(R,v),c.ref=d.ref,c.return=d,d.child=c}function to(c,d,g,v,E){if(c!==null){var R=c.memoizedProps;if(uh(R,v)&&c.ref===d.ref)if(ms=!1,d.pendingProps=v=R,ku(c,E))(c.flags&131072)!==0&&(ms=!0);else return d.lanes=c.lanes,dl(c,d,E)}return Rh(c,d,g,v,E)}function no(c,d,g,v){var E=v.children,R=c!==null?c.memoizedState:null;if(c===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),v.mode==="hidden"){if((d.flags&128)!==0){if(R=R!==null?R.baseLanes|g:g,c!==null){for(v=d.child=c.child,E=0;v!==null;)E=E|v.lanes|v.childLanes,v=v.sibling;v=E&~R}else v=0,d.child=null;return Kl(c,d,R,g,v)}if((g&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},c!==null&&bh(d,R!==null?R.cachePool:null),R!==null?v_(d,R):__(),IA(d);else return v=d.lanes=536870912,Kl(c,d,R!==null?R.baseLanes|g:g,g,v)}else R!==null?(bh(d,R.cachePool),v_(d,R),Fc(),d.memoizedState=null):(c!==null&&bh(d,null),__(),Fc());return Ds(c,d,E,g),d.child}function cl(c,d){return c!==null&&c.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function Kl(c,d,g,v,E){var R=Xl();return R=R===null?null:{parent:vn._currentValue,pool:R},d.memoizedState={baseLanes:g,cachePool:R},c!==null&&bh(d,null),__(),IA(d),c!==null&&Uu(c,d,v,!0),d.childLanes=E,null}function Fo(c,d){return d=wh({mode:d.mode,children:d.children},c.mode),d.ref=c.ref,c.child=d,d.return=c,d}function Sr(c,d,g){return Kd(d,c.child,null,g),c=Fo(d,d.pendingProps),c.flags|=2,Za(d),d.memoizedState=null,c}function Wm(c,d,g){var v=d.pendingProps,E=(d.flags&128)!==0;if(d.flags&=-129,c===null){if(ui){if(v.mode==="hidden")return c=Fo(d,v),d.lanes=536870912,cl(null,c);if(b_(d),(c=rs)?(c=BL(c,_r),c=c!==null&&c.data==="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:Hl!==null?{id:kl,overflow:Wl}:null,retryLane:536870912,hydrationErrors:null},g=wA(c),g.return=d,d.child=g,vr=d,rs=null)):c=null,c===null)throw ai(d);return d.lanes=536870912,null}return Fo(d,v)}var R=c.memoizedState;if(R!==null){var z=R.dehydrated;if(b_(d),E)if(d.flags&256)d.flags&=-257,d=Sr(c,d,g);else if(d.memoizedState!==null)d.child=c.child,d.flags|=128,d=null;else throw Error(n(558));else if(ms||Uu(c,d,g,!1),E=(g&c.childLanes)!==0,ms||E){if(v=Ii,v!==null&&(z=Uo(v,g),z!==0&&z!==R.retryLane))throw R.retryLane=z,Bu(c,z),m(v,c,z),gx;zn(),d=Sr(c,d,g)}else c=R.treeContext,rs=tc(z.nextSibling),vr=d,ui=!0,Dc=null,_r=!1,c!==null&&Mm(d,c),d=Fo(d,v),d.flags|=4096;return d}return c=Vl(c.child,{mode:v.mode,children:v.children}),c.ref=d.ref,d.child=c,c.return=d,c}function ul(c,d){var g=d.ref;if(g===null)c!==null&&c.ref!==null&&(d.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(n(284));(c===null||c.ref!==g)&&(d.flags|=4194816)}}function Rh(c,d,g,v,E){return Yd(d),g=T_(c,d,g,v,void 0,E),v=A_(),c!==null&&!ms?(E_(c,d,E),dl(c,d,E)):(ui&&v&&j0(d),d.flags|=1,Ds(c,d,g,E),d.child)}function Qr(c,d,g,v,E,R){return Yd(d),d.updateQueue=null,g=FA(d,v,g,E),PA(c),v=A_(),c!==null&&!ms?(E_(c,d,R),dl(c,d,R)):(ui&&v&&j0(d),d.flags|=1,Ds(c,d,g,R),d.child)}function Pr(c,d,g,v,E){if(Yd(d),d.stateNode===null){var R=Du,z=g.contextType;typeof z=="object"&&z!==null&&(R=br(z)),R=new g(v,R),d.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=Vm,d.stateNode=R,R._reactInternals=d,R=d.stateNode,R.props=v,R.state=d.memoizedState,R.refs={},g_(d),z=g.contextType,R.context=typeof z=="object"&&z!==null?br(z):Du,R.state=d.memoizedState,z=g.getDerivedStateFromProps,typeof z=="function"&&(Mh(d,g,z,v),R.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(z=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),z!==R.state&&Vm.enqueueReplaceState(R,R.state,null),Jd(d,v,R,E),Om(),R.state=d.memoizedState),typeof R.componentDidMount=="function"&&(d.flags|=4194308),v=!0}else if(c===null){R=d.stateNode;var Y=d.memoizedProps,he=Ir(g,Y);R.props=he;var Ue=R.context,tt=g.contextType;z=Du,typeof tt=="object"&&tt!==null&&(z=br(tt));var ut=g.getDerivedStateFromProps;tt=typeof ut=="function"||typeof R.getSnapshotBeforeUpdate=="function",Y=d.pendingProps!==Y,tt||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(Y||Ue!==z)&&s1(d,R,v,z),Gu=!1;var Pe=d.memoizedState;R.state=Pe,Jd(d,v,R,E),Om(),Ue=d.memoizedState,Y||Pe!==Ue||Gu?(typeof ut=="function"&&(Mh(d,g,ut,v),Ue=d.memoizedState),(he=Gu||i1(d,g,he,v,Pe,Ue,z))?(tt||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(d.flags|=4194308)):(typeof R.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=v,d.memoizedState=Ue),R.props=v,R.state=Ue,R.context=z,v=he):(typeof R.componentDidMount=="function"&&(d.flags|=4194308),v=!1)}else{R=d.stateNode,x_(c,d),z=d.memoizedProps,tt=Ir(g,z),R.props=tt,ut=d.pendingProps,Pe=R.context,Ue=g.contextType,he=Du,typeof Ue=="object"&&Ue!==null&&(he=br(Ue)),Y=g.getDerivedStateFromProps,(Ue=typeof Y=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(z!==ut||Pe!==he)&&s1(d,R,v,he),Gu=!1,Pe=d.memoizedState,R.state=Pe,Jd(d,v,R,E),Om();var We=d.memoizedState;z!==ut||Pe!==We||Gu||c!==null&&c.dependencies!==null&&vh(c.dependencies)?(typeof Y=="function"&&(Mh(d,g,Y,v),We=d.memoizedState),(tt=Gu||i1(d,g,tt,v,Pe,We,he)||c!==null&&c.dependencies!==null&&vh(c.dependencies))?(Ue||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(v,We,he),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(v,We,he)),typeof R.componentDidUpdate=="function"&&(d.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof R.componentDidUpdate!="function"||z===c.memoizedProps&&Pe===c.memoizedState||(d.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||z===c.memoizedProps&&Pe===c.memoizedState||(d.flags|=1024),d.memoizedProps=v,d.memoizedState=We),R.props=v,R.state=We,R.context=he,v=tt):(typeof R.componentDidUpdate!="function"||z===c.memoizedProps&&Pe===c.memoizedState||(d.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||z===c.memoizedProps&&Pe===c.memoizedState||(d.flags|=1024),v=!1)}return R=v,ul(c,d),v=(d.flags&128)!==0,R||v?(R=d.stateNode,g=v&&typeof g.getDerivedStateFromError!="function"?null:R.render(),d.flags|=1,c!==null&&v?(d.child=Kd(d,c.child,null,E),d.child=Kd(d,null,g,E)):Ds(c,d,g,E),d.memoizedState=R.state,c=d.child):c=dl(c,d,E),c}function Mi(c,d,g,v){return qd(),d.flags|=256,Ds(c,d,g,v),d.child}var io={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Go(c){return{baseLanes:c,cachePool:Z0()}}function Xm(c,d,g){return c=c!==null?c.childLanes&~g:0,d&&(c|=vi),c}function so(c,d,g){var v=d.pendingProps,E=!1,R=(d.flags&128)!==0,z;if((z=R)||(z=c!==null&&c.memoizedState===null?!1:(Ns.current&2)!==0),z&&(E=!0,d.flags&=-129),z=(d.flags&32)!==0,d.flags&=-33,c===null){if(ui){if(E?Vu(d):Fc(),(c=rs)?(c=BL(c,_r),c=c!==null&&c.data!=="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:Hl!==null?{id:kl,overflow:Wl}:null,retryLane:536870912,hydrationErrors:null},g=wA(c),g.return=d,d.child=g,vr=d,rs=null)):c=null,c===null)throw ai(d);return _R(c)?d.lanes=32:d.lanes=536870912,null}var Y=v.children;return v=v.fallback,E?(Fc(),E=d.mode,Y=wh({mode:"hidden",children:Y},E),v=Nc(v,E,g,null),Y.return=d,v.return=d,Y.sibling=v,d.child=Y,v=d.child,v.memoizedState=Go(g),v.childLanes=Xm(c,z,g),d.memoizedState=io,cl(null,v)):(Vu(d),Hu(d,Y))}var he=c.memoizedState;if(he!==null&&(Y=he.dehydrated,Y!==null)){if(R)d.flags&256?(Vu(d),d.flags&=-257,d=Nh(c,d,g)):d.memoizedState!==null?(Fc(),d.child=c.child,d.flags|=128,d=null):(Fc(),Y=v.fallback,E=d.mode,v=wh({mode:"visible",children:v.children},E),Y=Nc(Y,E,g,null),Y.flags|=2,v.return=d,Y.return=d,v.sibling=Y,d.child=v,Kd(d,c.child,null,g),v=d.child,v.memoizedState=Go(g),v.childLanes=Xm(c,z,g),d.memoizedState=io,d=cl(null,v));else if(Vu(d),_R(Y)){if(z=Y.nextSibling&&Y.nextSibling.dataset,z)var Ue=z.dgst;z=Ue,v=Error(n(419)),v.stack="",v.digest=z,Cm({value:v,source:null,stack:null}),d=Nh(c,d,g)}else if(ms||Uu(c,d,g,!1),z=(g&c.childLanes)!==0,ms||z){if(z=Ii,z!==null&&(v=Uo(z,g),v!==0&&v!==he.retryLane))throw he.retryLane=v,Bu(c,v),m(z,c,v),gx;vR(Y)||zn(),d=Nh(c,d,g)}else vR(Y)?(d.flags|=192,d.child=c.child,d=null):(c=he.treeContext,rs=tc(Y.nextSibling),vr=d,ui=!0,Dc=null,_r=!1,c!==null&&Mm(d,c),d=Hu(d,v.children),d.flags|=4096);return d}return E?(Fc(),Y=v.fallback,E=d.mode,he=c.child,Ue=he.sibling,v=Vl(he,{mode:"hidden",children:v.children}),v.subtreeFlags=he.subtreeFlags&65011712,Ue!==null?Y=Vl(Ue,Y):(Y=Nc(Y,E,g,null),Y.flags|=2),Y.return=d,v.return=d,v.sibling=Y,d.child=v,cl(null,v),v=d.child,Y=c.child.memoizedState,Y===null?Y=Go(g):(E=Y.cachePool,E!==null?(he=vn._currentValue,E=E.parent!==he?{parent:he,pool:he}:E):E=Z0(),Y={baseLanes:Y.baseLanes|g,cachePool:E}),v.memoizedState=Y,v.childLanes=Xm(c,z,g),d.memoizedState=io,cl(c.child,v)):(Vu(d),g=c.child,c=g.sibling,g=Vl(g,{mode:"visible",children:v.children}),g.return=d,g.sibling=null,c!==null&&(z=d.deletions,z===null?(d.deletions=[c],d.flags|=16):z.push(c)),d.child=g,d.memoizedState=null,g)}function Hu(c,d){return d=wh({mode:"visible",children:d},c.mode),d.return=c,c.child=d}function wh(c,d){return c=fa(22,c,null,d),c.lanes=0,c}function Nh(c,d,g){return Kd(d,c.child,null,g),c=Hu(d,d.pendingProps.children),c.flags|=2,d.memoizedState=null,c}function ef(c,d,g){c.lanes|=d;var v=c.alternate;v!==null&&(v.lanes|=d),Lc(c.return,d,g)}function qm(c,d,g,v,E,R){var z=c.memoizedState;z===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:v,tail:g,tailMode:E,treeForkCount:R}:(z.isBackwards=d,z.rendering=null,z.renderingStartTime=0,z.last=v,z.tail=g,z.tailMode=E,z.treeForkCount=R)}function Ym(c,d,g){var v=d.pendingProps,E=v.revealOrder,R=v.tail;v=v.children;var z=Ns.current,Y=(z&2)!==0;if(Y?(z=z&1|2,d.flags|=128):z&=1,we(Ns,z),Ds(c,d,v,g),v=ui?yh:0,!Y&&c!==null&&(c.flags&128)!==0)e:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&ef(c,g,d);else if(c.tag===19)ef(c,g,d);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break e;for(;c.sibling===null;){if(c.return===null||c.return===d)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(E){case"forwards":for(g=d.child,E=null;g!==null;)c=g.alternate,c!==null&&nx(c)===null&&(E=g),g=g.sibling;g=E,g===null?(E=d.child,d.child=null):(E=g.sibling,g.sibling=null),qm(d,!1,E,g,R,v);break;case"backwards":case"unstable_legacy-backwards":for(g=null,E=d.child,d.child=null;E!==null;){if(c=E.alternate,c!==null&&nx(c)===null){d.child=E;break}c=E.sibling,E.sibling=g,g=E,E=c}qm(d,!0,g,null,R,v);break;case"together":qm(d,!1,null,null,void 0,v);break;default:d.memoizedState=null}return d.child}function dl(c,d,g){if(c!==null&&(d.dependencies=c.dependencies),oo|=d.lanes,(g&d.childLanes)===0)if(c!==null){if(Uu(c,d,g,!1),(g&d.childLanes)===0)return null}else return null;if(c!==null&&d.child!==c.child)throw Error(n(153));if(d.child!==null){for(c=d.child,g=Vl(c,c.pendingProps),d.child=g,g.return=d;c.sibling!==null;)c=c.sibling,g=g.sibling=Vl(c,c.pendingProps),g.return=d;g.sibling=null}return d.child}function ku(c,d){return(c.lanes&d)!==0?!0:(c=c.dependencies,!!(c!==null&&vh(c)))}function jm(c,d,g){switch(d.tag){case 3:ct(d,d.stateNode.containerInfo),Uc(d,vn,c.memoizedState.cache),qd();break;case 27:case 5:Nt(d);break;case 4:ct(d,d.stateNode.containerInfo);break;case 10:Uc(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,b_(d),null;break;case 13:var v=d.memoizedState;if(v!==null)return v.dehydrated!==null?(Vu(d),d.flags|=128,null):(g&d.child.childLanes)!==0?so(c,d,g):(Vu(d),c=dl(c,d,g),c!==null?c.sibling:null);Vu(d);break;case 19:var E=(c.flags&128)!==0;if(v=(g&d.childLanes)!==0,v||(Uu(c,d,g,!1),v=(g&d.childLanes)!==0),E){if(v)return Ym(c,d,g);d.flags|=128}if(E=d.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),we(Ns,Ns.current),v)break;return null;case 22:return d.lanes=0,no(c,d,g,d.pendingProps);case 24:Uc(d,vn,c.memoizedState.cache)}return dl(c,d,g)}function xx(c,d,g){if(c!==null)if(c.memoizedProps!==d.pendingProps)ms=!0;else{if(!ku(c,g)&&(d.flags&128)===0)return ms=!1,jm(c,d,g);ms=(c.flags&131072)!==0}else ms=!1,ui&&(d.flags&1048576)!==0&&r_(d,yh,d.index);switch(d.lanes=0,d.tag){case 16:e:{var v=d.pendingProps;if(c=$d(d.elementType),d.type=c,typeof c=="function")ha(c)?(v=Ir(c,v),d.tag=1,d=Pr(null,d,c,v,g)):(d.tag=0,d=Rh(null,d,c,v,g));else{if(c!=null){var E=c.$$typeof;if(E===B){d.tag=11,d=Hm(null,d,c,v,g);break e}else if(E===O){d.tag=14,d=km(null,d,c,v,g);break e}}throw d=te(c)||c,Error(n(306,d,""))}}return d;case 0:return Rh(c,d,d.type,d.pendingProps,g);case 1:return v=d.type,E=Ir(v,d.pendingProps),Pr(c,d,v,E,g);case 3:e:{if(ct(d,d.stateNode.containerInfo),c===null)throw Error(n(387));v=d.pendingProps;var R=d.memoizedState;E=R.element,x_(c,d),Jd(d,v,null,g);var z=d.memoizedState;if(v=z.cache,Uc(d,vn,v),v!==R.cache&&J0(d,[vn],g,!0),Om(),v=z.element,R.isDehydrated)if(R={element:v,isDehydrated:!1,cache:z.cache},d.updateQueue.baseState=R,d.memoizedState=R,d.flags&256){d=Mi(c,d,v,g);break e}else if(v!==E){E=Aa(Error(n(424)),d),Cm(E),d=Mi(c,d,v,g);break e}else{switch(c=d.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(rs=tc(c.firstChild),vr=d,ui=!0,Dc=null,_r=!0,g=LA(d,null,v,g),d.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(qd(),v===E){d=dl(c,d,g);break e}Ds(c,d,v,g)}d=d.child}return d;case 26:return ul(c,d),c===null?(g=PL(d.type,null,d.pendingProps,null))?d.memoizedState=g:ui||(g=d.type,c=d.pendingProps,v=p1(Se.current).createElement(g),v[Wn]=d,v[H]=c,ya(v,g,c),Ae(v),d.stateNode=v):d.memoizedState=PL(d.type,c.memoizedProps,d.pendingProps,c.memoizedState),null;case 27:return Nt(d),c===null&&ui&&(v=d.stateNode=UL(d.type,d.pendingProps,Se.current),vr=d,_r=!0,E=rs,Ph(d.type)?(bR=E,rs=tc(v.firstChild)):rs=E),Ds(c,d,d.pendingProps.children,g),ul(c,d),c===null&&(d.flags|=4194304),d.child;case 5:return c===null&&ui&&((E=v=rs)&&(v=uq(v,d.type,d.pendingProps,_r),v!==null?(d.stateNode=v,vr=d,rs=tc(v.firstChild),_r=!1,E=!0):E=!1),E||ai(d)),Nt(d),E=d.type,R=d.pendingProps,z=c!==null?c.memoizedProps:null,v=R.children,gR(E,R)?v=null:z!==null&&gR(E,z)&&(d.flags|=32),d.memoizedState!==null&&(E=T_(c,d,Z3,null,null,g),nb._currentValue=E),ul(c,d),Ds(c,d,v,g),d.child;case 6:return c===null&&ui&&((c=g=rs)&&(g=dq(g,d.pendingProps,_r),g!==null?(d.stateNode=g,vr=d,rs=null,c=!0):c=!1),c||ai(d)),null;case 13:return so(c,d,g);case 4:return ct(d,d.stateNode.containerInfo),v=d.pendingProps,c===null?d.child=Kd(d,null,v,g):Ds(c,d,v,g),d.child;case 11:return Hm(c,d,d.type,d.pendingProps,g);case 7:return Ds(c,d,d.pendingProps,g),d.child;case 8:return Ds(c,d,d.pendingProps.children,g),d.child;case 12:return Ds(c,d,d.pendingProps.children,g),d.child;case 10:return v=d.pendingProps,Uc(d,d.type,v.value),Ds(c,d,v.children,g),d.child;case 9:return E=d.type._context,v=d.pendingProps.children,Yd(d),E=br(E),v=v(E),d.flags|=1,Ds(c,d,v,g),d.child;case 14:return km(c,d,d.type,d.pendingProps,g);case 15:return to(c,d,d.type,d.pendingProps,g);case 19:return Ym(c,d,g);case 31:return Wm(c,d,g);case 22:return no(c,d,g,d.pendingProps);case 24:return Yd(d),v=br(vn),c===null?(E=Xl(),E===null&&(E=Ii,R=u_(),E.pooledCache=R,R.refCount++,R!==null&&(E.pooledCacheLanes|=g),E=R),d.memoizedState={parent:v,cache:E},g_(d),Uc(d,vn,E)):((c.lanes&g)!==0&&(x_(c,d),Jd(d,null,null,g),Om()),E=c.memoizedState,R=d.memoizedState,E.parent!==v?(E={parent:v,cache:v},d.memoizedState=E,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=E),Uc(d,vn,v)):(v=R.cache,Uc(d,vn,v),v!==E.cache&&J0(d,[vn],g,!0))),Ds(c,d,d.pendingProps.children,g),d.child;case 29:throw d.pendingProps}throw Error(n(156,d.tag))}function wa(c){c.flags|=4}function Wu(c,d,g,v,E){if((d=(c.mode&32)!==0)&&(d=!1),d){if(c.flags|=16777216,(E&335544128)===E)if(c.stateNode.complete)c.flags|=8192;else if(Ct())c.flags|=8192;else throw An=Nm,wm}else c.flags&=-16777217}function Vc(c,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!HL(d))if(Ct())c.flags|=8192;else throw An=Nm,wm}function Bh(c,d){d!==null&&(c.flags|=4),c.flags&16384&&(d=c.tag!==22?gi():536870912,c.lanes|=d,lo|=d)}function $m(c,d){if(!ui)switch(c.tailMode){case"hidden":d=c.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?c.tail=null:g.sibling=null;break;case"collapsed":g=c.tail;for(var v=null;g!==null;)g.alternate!==null&&(v=g),g=g.sibling;v===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:v.sibling=null}}function ki(c){var d=c.alternate!==null&&c.alternate.child===c.child,g=0,v=0;if(d)for(var E=c.child;E!==null;)g|=E.lanes|E.childLanes,v|=E.subtreeFlags&65011712,v|=E.flags&65011712,E.return=c,E=E.sibling;else for(E=c.child;E!==null;)g|=E.lanes|E.childLanes,v|=E.subtreeFlags,v|=E.flags,E.return=c,E=E.sibling;return c.subtreeFlags|=v,c.childLanes=g,d}function Y_(c,d,g){var v=d.pendingProps;switch(Ou(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ki(d),null;case 1:return ki(d),null;case 3:return g=d.stateNode,v=null,c!==null&&(v=c.memoizedState.cache),d.memoizedState.cache!==v&&(d.flags|=2048),Io(vn),Dt(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(c===null||c.child===null)&&(Xd(d)?wa(d):c===null||c.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,a_())),ki(d),null;case 26:var E=d.type,R=d.memoizedState;return c===null?(wa(d),R!==null?(ki(d),Vc(d,R)):(ki(d),Wu(d,E,null,v,g))):R?R!==c.memoizedState?(wa(d),ki(d),Vc(d,R)):(ki(d),d.flags&=-16777217):(c=c.memoizedProps,c!==v&&wa(d),ki(d),Wu(d,E,c,v,g)),null;case 27:if(It(d),g=Se.current,E=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==v&&wa(d);else{if(!v){if(d.stateNode===null)throw Error(n(166));return ki(d),null}c=Ne.current,Xd(d)?K0(d):(c=UL(E,v,g),d.stateNode=c,wa(d))}return ki(d),null;case 5:if(It(d),E=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==v&&wa(d);else{if(!v){if(d.stateNode===null)throw Error(n(166));return ki(d),null}if(R=Ne.current,Xd(d))K0(d);else{var z=p1(Se.current);switch(R){case 1:R=z.createElementNS("http://www.w3.org/2000/svg",E);break;case 2:R=z.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;default:switch(E){case"svg":R=z.createElementNS("http://www.w3.org/2000/svg",E);break;case"math":R=z.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;case"script":R=z.createElement("div"),R.innerHTML="<script><\/script>",R=R.removeChild(R.firstChild);break;case"select":R=typeof v.is=="string"?z.createElement("select",{is:v.is}):z.createElement("select"),v.multiple?R.multiple=!0:v.size&&(R.size=v.size);break;default:R=typeof v.is=="string"?z.createElement(E,{is:v.is}):z.createElement(E)}}R[Wn]=d,R[H]=v;e:for(z=d.child;z!==null;){if(z.tag===5||z.tag===6)R.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===d)break e;for(;z.sibling===null;){if(z.return===null||z.return===d)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}d.stateNode=R;e:switch(ya(R,E,v),E){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}v&&wa(d)}}return ki(d),Wu(d,d.type,c===null?null:c.memoizedProps,d.pendingProps,g),null;case 6:if(c&&d.stateNode!=null)c.memoizedProps!==v&&wa(d);else{if(typeof v!="string"&&d.stateNode===null)throw Error(n(166));if(c=Se.current,Xd(d)){if(c=d.stateNode,g=d.memoizedProps,v=null,E=vr,E!==null)switch(E.tag){case 27:case 5:v=E.memoizedProps}c[Wn]=d,c=!!(c.nodeValue===g||v!==null&&v.suppressHydrationWarning===!0||TL(c.nodeValue,g)),c||ai(d,!0)}else c=p1(c).createTextNode(v),c[Wn]=d,d.stateNode=c}return ki(d),null;case 31:if(g=d.memoizedState,c===null||c.memoizedState!==null){if(v=Xd(d),g!==null){if(c===null){if(!v)throw Error(n(318));if(c=d.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(557));c[Wn]=d}else qd(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ki(d),c=!1}else g=a_(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=g),c=!0;if(!c)return d.flags&256?(Za(d),d):(Za(d),null);if((d.flags&128)!==0)throw Error(n(558))}return ki(d),null;case 13:if(v=d.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(E=Xd(d),v!==null&&v.dehydrated!==null){if(c===null){if(!E)throw Error(n(318));if(E=d.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(n(317));E[Wn]=d}else qd(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ki(d),E=!1}else E=a_(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=E),E=!0;if(!E)return d.flags&256?(Za(d),d):(Za(d),null)}return Za(d),(d.flags&128)!==0?(d.lanes=g,d):(g=v!==null,c=c!==null&&c.memoizedState!==null,g&&(v=d.child,E=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(E=v.alternate.memoizedState.cachePool.pool),R=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(R=v.memoizedState.cachePool.pool),R!==E&&(v.flags|=2048)),g!==c&&g&&(d.child.flags|=8192),Bh(d,d.updateQueue),ki(d),null);case 4:return Dt(),c===null&&dR(d.stateNode.containerInfo),ki(d),null;case 10:return Io(d.type),ki(d),null;case 19:if(pe(Ns),v=d.memoizedState,v===null)return ki(d),null;if(E=(d.flags&128)!==0,R=v.rendering,R===null)if(E)$m(v,!1);else{if(Pi!==0||c!==null&&(c.flags&128)!==0)for(c=d.child;c!==null;){if(R=nx(c),R!==null){for(d.flags|=128,$m(v,!1),c=R.updateQueue,d.updateQueue=c,Bh(d,c),d.subtreeFlags=0,c=g,g=d.child;g!==null;)Kr(g,c),g=g.sibling;return we(Ns,Ns.current&1|2),ui&&Bc(d,v.treeForkCount),d.child}c=c.sibling}v.tail!==null&&V()>co&&(d.flags|=128,E=!0,$m(v,!1),d.lanes=4194304)}else{if(!E)if(c=nx(R),c!==null){if(d.flags|=128,E=!0,c=c.updateQueue,d.updateQueue=c,Bh(d,c),$m(v,!0),v.tail===null&&v.tailMode==="hidden"&&!R.alternate&&!ui)return ki(d),null}else 2*V()-v.renderingStartTime>co&&g!==536870912&&(d.flags|=128,E=!0,$m(v,!1),d.lanes=4194304);v.isBackwards?(R.sibling=d.child,d.child=R):(c=v.last,c!==null?c.sibling=R:d.child=R,v.last=R)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=V(),c.sibling=null,g=Ns.current,we(Ns,E?g&1|2:g&1),ui&&Bc(d,v.treeForkCount),c):(ki(d),null);case 22:case 23:return Za(d),Zr(),v=d.memoizedState!==null,c!==null?c.memoizedState!==null!==v&&(d.flags|=8192):v&&(d.flags|=8192),v?(g&536870912)!==0&&(d.flags&128)===0&&(ki(d),d.subtreeFlags&6&&(d.flags|=8192)):ki(d),g=d.updateQueue,g!==null&&Bh(d,g.retryQueue),g=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==g&&(d.flags|=2048),c!==null&&pe(Lu),null;case 24:return g=null,c!==null&&(g=c.memoizedState.cache),d.memoizedState.cache!==g&&(d.flags|=2048),Io(vn),ki(d),null;case 25:return null;case 30:return null}throw Error(n(156,d.tag))}function yx(c,d){switch(Ou(d),d.tag){case 1:return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 3:return Io(vn),Dt(),c=d.flags,(c&65536)!==0&&(c&128)===0?(d.flags=c&-65537|128,d):null;case 26:case 27:case 5:return It(d),null;case 31:if(d.memoizedState!==null){if(Za(d),d.alternate===null)throw Error(n(340));qd()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 13:if(Za(d),c=d.memoizedState,c!==null&&c.dehydrated!==null){if(d.alternate===null)throw Error(n(340));qd()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 19:return pe(Ns),null;case 4:return Dt(),null;case 10:return Io(d.type),null;case 22:case 23:return Za(d),Zr(),c!==null&&pe(Lu),c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 24:return Io(vn),null;case 25:return null;default:return null}}function tf(c,d){switch(Ou(d),d.tag){case 3:Io(vn),Dt();break;case 26:case 27:case 5:It(d);break;case 4:Dt();break;case 31:d.memoizedState!==null&&Za(d);break;case 13:Za(d);break;case 19:pe(Ns);break;case 10:Io(d.type);break;case 22:case 23:Za(d),Zr(),c!==null&&pe(Lu);break;case 24:Io(vn)}}function Jl(c,d){try{var g=d.updateQueue,v=g!==null?g.lastEffect:null;if(v!==null){var E=v.next;g=E;do{if((g.tag&c)===c){v=void 0;var R=g.create,z=g.inst;v=R(),z.destroy=v}g=g.next}while(g!==E)}}catch(Y){ns(d,d.return,Y)}}function zo(c,d,g){try{var v=d.updateQueue,E=v!==null?v.lastEffect:null;if(E!==null){var R=E.next;v=R;do{if((v.tag&c)===c){var z=v.inst,Y=z.destroy;if(Y!==void 0){z.destroy=void 0,E=d;var he=g,Ue=Y;try{Ue()}catch(tt){ns(E,he,tt)}}}v=v.next}while(v!==R)}}catch(tt){ns(d,d.return,tt)}}function Xu(c){var d=c.updateQueue;if(d!==null){var g=c.stateNode;try{Ur(d,g)}catch(v){ns(c,c.return,v)}}}function j_(c,d,g){g.props=Ir(c.type,c.memoizedProps),g.state=c.memoizedState;try{g.componentWillUnmount()}catch(v){ns(c,d,v)}}function Zl(c,d){try{var g=c.ref;if(g!==null){switch(c.tag){case 26:case 27:case 5:var v=c.stateNode;break;case 30:v=c.stateNode;break;default:v=c.stateNode}typeof g=="function"?c.refCleanup=g(v):g.current=v}}catch(E){ns(c,d,E)}}function ro(c,d){var g=c.ref,v=c.refCleanup;if(g!==null)if(typeof v=="function")try{v()}catch(E){ns(c,d,E)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(E){ns(c,d,E)}else g.current=null}function ao(c){var d=c.type,g=c.memoizedProps,v=c.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":g.autoFocus&&v.focus();break e;case"img":g.src?v.src=g.src:g.srcSet&&(v.srcset=g.srcSet)}}catch(E){ns(c,c.return,E)}}function Vo(c,d,g){try{var v=c.stateNode;sq(v,c.type,g,d),v[H]=d}catch(E){ns(c,c.return,E)}}function Js(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Ph(c.type)||c.tag===4}function Ql(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||Js(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Ph(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Yn(c,d,g){var v=c.tag;if(v===5||v===6)c=c.stateNode,d?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(c,d):(d=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,d.appendChild(c),g=g._reactRootContainer,g!=null||d.onclick!==null||(d.onclick=Fl));else if(v!==4&&(v===27&&Ph(c.type)&&(g=c.stateNode,d=null),c=c.child,c!==null))for(Yn(c,d,g),c=c.sibling;c!==null;)Yn(c,d,g),c=c.sibling}function Bi(c,d,g){var v=c.tag;if(v===5||v===6)c=c.stateNode,d?g.insertBefore(c,d):g.appendChild(c);else if(v!==4&&(v===27&&Ph(c.type)&&(g=c.stateNode),c=c.child,c!==null))for(Bi(c,d,g),c=c.sibling;c!==null;)Bi(c,d,g),c=c.sibling}function Gs(c){var d=c.stateNode,g=c.memoizedProps;try{for(var v=c.type,E=d.attributes;E.length;)d.removeAttributeNode(E[0]);ya(d,v,g),d[Wn]=c,d[H]=g}catch(R){ns(c,c.return,R)}}var Ho=!1,gs=!1,Hc=!1,Km=typeof WeakSet=="function"?WeakSet:Set,Os=null;function Dh(c,d){if(c=c.containerInfo,pR=b1,c=z0(c),dh(c)){if("selectionStart"in c)var g={start:c.selectionStart,end:c.selectionEnd};else e:{g=(g=c.ownerDocument)&&g.defaultView||window;var v=g.getSelection&&g.getSelection();if(v&&v.rangeCount!==0){g=v.anchorNode;var E=v.anchorOffset,R=v.focusNode;v=v.focusOffset;try{g.nodeType,R.nodeType}catch{g=null;break e}var z=0,Y=-1,he=-1,Ue=0,tt=0,ut=c,Pe=null;t:for(;;){for(var We;ut!==g||E!==0&&ut.nodeType!==3||(Y=z+E),ut!==R||v!==0&&ut.nodeType!==3||(he=z+v),ut.nodeType===3&&(z+=ut.nodeValue.length),(We=ut.firstChild)!==null;)Pe=ut,ut=We;for(;;){if(ut===c)break t;if(Pe===g&&++Ue===E&&(Y=z),Pe===R&&++tt===v&&(he=z),(We=ut.nextSibling)!==null)break;ut=Pe,Pe=ut.parentNode}ut=We}g=Y===-1||he===-1?null:{start:Y,end:he}}else g=null}g=g||{start:0,end:0}}else g=null;for(mR={focusedElem:c,selectionRange:g},b1=!1,Os=d;Os!==null;)if(d=Os,c=d.child,(d.subtreeFlags&1028)!==0&&c!==null)c.return=d,Os=c;else for(;Os!==null;){switch(d=Os,R=d.alternate,c=d.flags,d.tag){case 0:if((c&4)!==0&&(c=d.updateQueue,c=c!==null?c.events:null,c!==null))for(g=0;g<c.length;g++)E=c[g],E.ref.impl=E.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&R!==null){c=void 0,g=d,E=R.memoizedProps,R=R.memoizedState,v=g.stateNode;try{var un=Ir(g.type,E);c=v.getSnapshotBeforeUpdate(un,R),v.__reactInternalSnapshotBeforeUpdate=c}catch(Nn){ns(g,g.return,Nn)}}break;case 3:if((c&1024)!==0){if(c=d.stateNode.containerInfo,g=c.nodeType,g===9)yR(c);else if(g===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":yR(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(n(163))}if(c=d.sibling,c!==null){c.return=d.return,Os=c;break}Os=d.return}}function o1(c,d,g){var v=g.flags;switch(g.tag){case 0:case 11:case 15:kc(c,g),v&4&&Jl(5,g);break;case 1:if(kc(c,g),v&4)if(c=g.stateNode,d===null)try{c.componentDidMount()}catch(z){ns(g,g.return,z)}else{var E=Ir(g.type,d.memoizedProps);d=d.memoizedState;try{c.componentDidUpdate(E,d,c.__reactInternalSnapshotBeforeUpdate)}catch(z){ns(g,g.return,z)}}v&64&&Xu(g),v&512&&Zl(g,g.return);break;case 3:if(kc(c,g),v&64&&(c=g.updateQueue,c!==null)){if(d=null,g.child!==null)switch(g.child.tag){case 27:case 5:d=g.child.stateNode;break;case 1:d=g.child.stateNode}try{Ur(c,d)}catch(z){ns(g,g.return,z)}}break;case 27:d===null&&v&4&&Gs(g);case 26:case 5:kc(c,g),d===null&&v&4&&ao(g),v&512&&Zl(g,g.return);break;case 12:kc(c,g);break;case 31:kc(c,g),v&4&&_x(c,g);break;case 13:kc(c,g),v&4&&$_(c,g),v&64&&(c=g.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(g=qX.bind(null,g),fq(c,g))));break;case 22:if(v=g.memoizedState!==null||Ho,!v){d=d!==null&&d.memoizedState!==null||gs,E=Ho;var R=gs;Ho=v,(gs=d)&&!R?Li(c,g,(g.subtreeFlags&8772)!==0):kc(c,g),Ho=E,gs=R}break;case 30:break;default:kc(c,g)}}function vx(c){var d=c.alternate;d!==null&&(c.alternate=null,vx(d)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(d=c.stateNode,d!==null&&mt(d)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Ci=null,Zs=!1;function ea(c,d,g){for(g=g.child;g!==null;)qu(c,d,g),g=g.sibling}function qu(c,d,g){if(st&&typeof st.onCommitFiberUnmount=="function")try{st.onCommitFiberUnmount(et,g)}catch{}switch(g.tag){case 26:gs||ro(g,d),ea(c,d,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:gs||ro(g,d);var v=Ci,E=Zs;Ph(g.type)&&(Ci=g.stateNode,Zs=!1),ea(c,d,g),Q_(g.stateNode),Ci=v,Zs=E;break;case 5:gs||ro(g,d);case 6:if(v=Ci,E=Zs,Ci=null,ea(c,d,g),Ci=v,Zs=E,Ci!==null)if(Zs)try{(Ci.nodeType===9?Ci.body:Ci.nodeName==="HTML"?Ci.ownerDocument.body:Ci).removeChild(g.stateNode)}catch(R){ns(g,d,R)}else try{Ci.removeChild(g.stateNode)}catch(R){ns(g,d,R)}break;case 18:Ci!==null&&(Zs?(c=Ci,wL(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,g.stateNode),Bx(c)):wL(Ci,g.stateNode));break;case 4:v=Ci,E=Zs,Ci=g.stateNode.containerInfo,Zs=!0,ea(c,d,g),Ci=v,Zs=E;break;case 0:case 11:case 14:case 15:zo(2,g,d),gs||zo(4,g,d),ea(c,d,g);break;case 1:gs||(ro(g,d),v=g.stateNode,typeof v.componentWillUnmount=="function"&&j_(g,d,v)),ea(c,d,g);break;case 21:ea(c,d,g);break;case 22:gs=(v=gs)||g.memoizedState!==null,ea(c,d,g),gs=v;break;default:ea(c,d,g)}}function _x(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{Bx(c)}catch(g){ns(d,d.return,g)}}}function $_(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{Bx(c)}catch(g){ns(d,d.return,g)}}function l1(c){switch(c.tag){case 31:case 13:case 19:var d=c.stateNode;return d===null&&(d=c.stateNode=new Km),d;case 22:return c=c.stateNode,d=c._retryCache,d===null&&(d=c._retryCache=new Km),d;default:throw Error(n(435,c.tag))}}function zs(c,d){var g=l1(c);d.forEach(function(v){if(!g.has(v)){g.add(v);var E=YX.bind(null,c,v);v.then(E,E)}})}function ta(c,d){var g=d.deletions;if(g!==null)for(var v=0;v<g.length;v++){var E=g[v],R=c,z=d,Y=z;e:for(;Y!==null;){switch(Y.tag){case 27:if(Ph(Y.type)){Ci=Y.stateNode,Zs=!1;break e}break;case 5:Ci=Y.stateNode,Zs=!1;break e;case 3:case 4:Ci=Y.stateNode.containerInfo,Zs=!0;break e}Y=Y.return}if(Ci===null)throw Error(n(160));qu(R,z,E),Ci=null,Zs=!1,R=E.alternate,R!==null&&(R.return=null),E.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)Yu(d,c),d=d.sibling}var Na=null;function Yu(c,d){var g=c.alternate,v=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:ta(d,c),Us(c),v&4&&(zo(3,c,c.return),Jl(3,c),zo(5,c,c.return));break;case 1:ta(d,c),Us(c),v&512&&(gs||g===null||ro(g,g.return)),v&64&&Ho&&(c=c.updateQueue,c!==null&&(v=c.callbacks,v!==null&&(g=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=g===null?v:g.concat(v))));break;case 26:var E=Na;if(ta(d,c),Us(c),v&512&&(gs||g===null||ro(g,g.return)),v&4){var R=g!==null?g.memoizedState:null;if(v=c.memoizedState,g===null)if(v===null)if(c.stateNode===null){e:{v=c.type,g=c.memoizedProps,E=E.ownerDocument||E;t:switch(v){case"title":R=E.getElementsByTagName("title")[0],(!R||R[vt]||R[Wn]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=E.createElement(v),E.head.insertBefore(R,E.querySelector("head > title"))),ya(R,v,g),R[Wn]=c,Ae(R),v=R;break e;case"link":var z=zL("link","href",E).get(v+(g.href||""));if(z){for(var Y=0;Y<z.length;Y++)if(R=z[Y],R.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&R.getAttribute("rel")===(g.rel==null?null:g.rel)&&R.getAttribute("title")===(g.title==null?null:g.title)&&R.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){z.splice(Y,1);break t}}R=E.createElement(v),ya(R,v,g),E.head.appendChild(R);break;case"meta":if(z=zL("meta","content",E).get(v+(g.content||""))){for(Y=0;Y<z.length;Y++)if(R=z[Y],R.getAttribute("content")===(g.content==null?null:""+g.content)&&R.getAttribute("name")===(g.name==null?null:g.name)&&R.getAttribute("property")===(g.property==null?null:g.property)&&R.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&R.getAttribute("charset")===(g.charSet==null?null:g.charSet)){z.splice(Y,1);break t}}R=E.createElement(v),ya(R,v,g),E.head.appendChild(R);break;default:throw Error(n(468,v))}R[Wn]=c,Ae(R),v=R}c.stateNode=v}else VL(E,c.type,c.stateNode);else c.stateNode=GL(E,v,c.memoizedProps);else R!==v?(R===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):R.count--,v===null?VL(E,c.type,c.stateNode):GL(E,v,c.memoizedProps)):v===null&&c.stateNode!==null&&Vo(c,c.memoizedProps,g.memoizedProps)}break;case 27:ta(d,c),Us(c),v&512&&(gs||g===null||ro(g,g.return)),g!==null&&v&4&&Vo(c,c.memoizedProps,g.memoizedProps);break;case 5:if(ta(d,c),Us(c),v&512&&(gs||g===null||ro(g,g.return)),c.flags&32){E=c.stateNode;try{il(E,"")}catch(un){ns(c,c.return,un)}}v&4&&c.stateNode!=null&&(E=c.memoizedProps,Vo(c,E,g!==null?g.memoizedProps:E)),v&1024&&(Hc=!0);break;case 6:if(ta(d,c),Us(c),v&4){if(c.stateNode===null)throw Error(n(162));v=c.memoizedProps,g=c.stateNode;try{g.nodeValue=v}catch(un){ns(c,c.return,un)}}break;case 3:if(x1=null,E=Na,Na=m1(d.containerInfo),ta(d,c),Na=E,Us(c),v&4&&g!==null&&g.memoizedState.isDehydrated)try{Bx(d.containerInfo)}catch(un){ns(c,c.return,un)}Hc&&(Hc=!1,c1(c));break;case 4:v=Na,Na=m1(c.stateNode.containerInfo),ta(d,c),Us(c),Na=v;break;case 12:ta(d,c),Us(c);break;case 31:ta(d,c),Us(c),v&4&&(v=c.updateQueue,v!==null&&(c.updateQueue=null,zs(c,v)));break;case 13:ta(d,c),Us(c),c.child.flags&8192&&c.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(qc=V()),v&4&&(v=c.updateQueue,v!==null&&(c.updateQueue=null,zs(c,v)));break;case 22:E=c.memoizedState!==null;var he=g!==null&&g.memoizedState!==null,Ue=Ho,tt=gs;if(Ho=Ue||E,gs=tt||he,ta(d,c),gs=tt,Ho=Ue,Us(c),v&8192)e:for(d=c.stateNode,d._visibility=E?d._visibility&-2:d._visibility|1,E&&(g===null||he||Ho||gs||nf(c)),g=null,d=c;;){if(d.tag===5||d.tag===26){if(g===null){he=g=d;try{if(R=he.stateNode,E)z=R.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Y=he.stateNode;var ut=he.memoizedProps.style,Pe=ut!=null&&ut.hasOwnProperty("display")?ut.display:null;Y.style.display=Pe==null||typeof Pe=="boolean"?"":(""+Pe).trim()}}catch(un){ns(he,he.return,un)}}}else if(d.tag===6){if(g===null){he=d;try{he.stateNode.nodeValue=E?"":he.memoizedProps}catch(un){ns(he,he.return,un)}}}else if(d.tag===18){if(g===null){he=d;try{var We=he.stateNode;E?NL(We,!0):NL(he.stateNode,!1)}catch(un){ns(he,he.return,un)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===c)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break e;for(;d.sibling===null;){if(d.return===null||d.return===c)break e;g===d&&(g=null),d=d.return}g===d&&(g=null),d.sibling.return=d.return,d=d.sibling}v&4&&(v=c.updateQueue,v!==null&&(g=v.retryQueue,g!==null&&(v.retryQueue=null,zs(c,g))));break;case 19:ta(d,c),Us(c),v&4&&(v=c.updateQueue,v!==null&&(c.updateQueue=null,zs(c,v)));break;case 30:break;case 21:break;default:ta(d,c),Us(c)}}function Us(c){var d=c.flags;if(d&2){try{for(var g,v=c.return;v!==null;){if(Js(v)){g=v;break}v=v.return}if(g==null)throw Error(n(160));switch(g.tag){case 27:var E=g.stateNode,R=Ql(c);Bi(c,R,E);break;case 5:var z=g.stateNode;g.flags&32&&(il(z,""),g.flags&=-33);var Y=Ql(c);Bi(c,Y,z);break;case 3:case 4:var he=g.stateNode.containerInfo,Ue=Ql(c);Yn(c,Ue,he);break;default:throw Error(n(161))}}catch(tt){ns(c,c.return,tt)}c.flags&=-3}d&4096&&(c.flags&=-4097)}function c1(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var d=c;c1(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),c=c.sibling}}function kc(c,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)o1(c,d.alternate,d),d=d.sibling}function nf(c){for(c=c.child;c!==null;){var d=c;switch(d.tag){case 0:case 11:case 14:case 15:zo(4,d,d.return),nf(d);break;case 1:ro(d,d.return);var g=d.stateNode;typeof g.componentWillUnmount=="function"&&j_(d,d.return,g),nf(d);break;case 27:Q_(d.stateNode);case 26:case 5:ro(d,d.return),nf(d);break;case 22:d.memoizedState===null&&nf(d);break;case 30:nf(d);break;default:nf(d)}c=c.sibling}}function Li(c,d,g){for(g=g&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var v=d.alternate,E=c,R=d,z=R.flags;switch(R.tag){case 0:case 11:case 15:Li(E,R,g),Jl(4,R);break;case 1:if(Li(E,R,g),v=R,E=v.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Ue){ns(v,v.return,Ue)}if(v=R,E=v.updateQueue,E!==null){var Y=v.stateNode;try{var he=E.shared.hiddenCallbacks;if(he!==null)for(E.shared.hiddenCallbacks=null,E=0;E<he.length;E++)Yl(he[E],Y)}catch(Ue){ns(v,v.return,Ue)}}g&&z&64&&Xu(R),Zl(R,R.return);break;case 27:Gs(R);case 26:case 5:Li(E,R,g),g&&v===null&&z&4&&ao(R),Zl(R,R.return);break;case 12:Li(E,R,g);break;case 31:Li(E,R,g),g&&z&4&&_x(E,R);break;case 13:Li(E,R,g),g&&z&4&&$_(E,R);break;case 22:R.memoizedState===null&&Li(E,R,g),Zl(R,R.return);break;case 30:break;default:Li(E,R,g)}d=d.sibling}}function bx(c,d){var g=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),c=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(c=d.memoizedState.cachePool.pool),c!==g&&(c!=null&&c.refCount++,g!=null&&Or(g))}function Wc(c,d){c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&Or(c))}function cr(c,d,g,v){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Es(c,d,g,v),d=d.sibling}function Es(c,d,g,v){var E=d.flags;switch(d.tag){case 0:case 11:case 15:cr(c,d,g,v),E&2048&&Jl(9,d);break;case 1:cr(c,d,g,v);break;case 3:cr(c,d,g,v),E&2048&&(c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&Or(c)));break;case 12:if(E&2048){cr(c,d,g,v),c=d.stateNode;try{var R=d.memoizedProps,z=R.id,Y=R.onPostCommit;typeof Y=="function"&&Y(z,d.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(he){ns(d,d.return,he)}}else cr(c,d,g,v);break;case 31:cr(c,d,g,v);break;case 13:cr(c,d,g,v);break;case 23:break;case 22:R=d.stateNode,z=d.alternate,d.memoizedState!==null?R._visibility&2?cr(c,d,g,v):Oh(c,d):R._visibility&2?cr(c,d,g,v):(R._visibility|=2,ju(c,d,g,v,(d.subtreeFlags&10256)!==0||!1)),E&2048&&bx(z,d);break;case 24:cr(c,d,g,v),E&2048&&Wc(d.alternate,d);break;default:cr(c,d,g,v)}}function ju(c,d,g,v,E){for(E=E&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var R=c,z=d,Y=g,he=v,Ue=z.flags;switch(z.tag){case 0:case 11:case 15:ju(R,z,Y,he,E),Jl(8,z);break;case 23:break;case 22:var tt=z.stateNode;z.memoizedState!==null?tt._visibility&2?ju(R,z,Y,he,E):Oh(R,z):(tt._visibility|=2,ju(R,z,Y,he,E)),E&&Ue&2048&&bx(z.alternate,z);break;case 24:ju(R,z,Y,he,E),E&&Ue&2048&&Wc(z.alternate,z);break;default:ju(R,z,Y,he,E)}d=d.sibling}}function Oh(c,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var g=c,v=d,E=v.flags;switch(v.tag){case 22:Oh(g,v),E&2048&&bx(v.alternate,v);break;case 24:Oh(g,v),E&2048&&Wc(v.alternate,v);break;default:Oh(g,v)}d=d.sibling}}var Ls=8192;function sf(c,d,g){if(c.subtreeFlags&Ls)for(c=c.child;c!==null;)Vs(c,d,g),c=c.sibling}function Vs(c,d,g){switch(c.tag){case 26:sf(c,d,g),c.flags&Ls&&c.memoizedState!==null&&Aq(g,Na,c.memoizedState,c.memoizedProps);break;case 5:sf(c,d,g);break;case 3:case 4:var v=Na;Na=m1(c.stateNode.containerInfo),sf(c,d,g),Na=v;break;case 22:c.memoizedState===null&&(v=c.alternate,v!==null&&v.memoizedState!==null?(v=Ls,Ls=16777216,sf(c,d,g),Ls=v):sf(c,d,g));break;default:sf(c,d,g)}}function Ba(c){var d=c.alternate;if(d!==null&&(c=d.child,c!==null)){d.child=null;do d=c.sibling,c.sibling=null,c=d;while(c!==null)}}function ga(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var v=d[g];Os=v,Jm(v,c)}Ba(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)rf(c),c=c.sibling}function rf(c){switch(c.tag){case 0:case 11:case 15:ga(c),c.flags&2048&&zo(9,c,c.return);break;case 3:ga(c);break;case 12:ga(c);break;case 22:var d=c.stateNode;c.memoizedState!==null&&d._visibility&2&&(c.return===null||c.return.tag!==13)?(d._visibility&=-3,Sx(c)):ga(c);break;default:ga(c)}}function Sx(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var v=d[g];Os=v,Jm(v,c)}Ba(c)}for(c=c.child;c!==null;){switch(d=c,d.tag){case 0:case 11:case 15:zo(8,d,d.return),Sx(d);break;case 22:g=d.stateNode,g._visibility&2&&(g._visibility&=-3,Sx(d));break;default:Sx(d)}c=c.sibling}}function Jm(c,d){for(;Os!==null;){var g=Os;switch(g.tag){case 0:case 11:case 15:zo(8,g,d);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var v=g.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:Or(g.memoizedState.cache)}if(v=g.child,v!==null)v.return=g,Os=v;else e:for(g=c;Os!==null;){v=Os;var E=v.sibling,R=v.return;if(vx(v),v===g){Os=null;break e}if(E!==null){E.return=R,Os=E;break e}Os=R}}}var Tx={getCacheForType:function(c){var d=br(vn),g=d.data.get(c);return g===void 0&&(g=c(),d.data.set(c,g)),g},cacheSignal:function(){return br(vn).controller.signal}},Ax=typeof WeakMap=="function"?WeakMap:Map,yi=0,Ii=null,jn=null,oi=0,_n=0,ti=null,Hn=!1,Jn=!1,Ji=!1,Hs=0,Pi=0,oo=0,Xc=0,fl=0,vi=0,lo=0,hl=null,na=null,Da=!1,qc=0,Uh=0,co=1/0,Lh=null,ec=null,Ms=0,pl=null,uo=null,ko=0,Yc=0,af=null,Ex=null,of=0,lf=null;function xa(){return(yi&2)!==0&&oi!==0?oi&-oi:W.T!==null?oR():xr()}function h(){if(vi===0)if((oi&536870912)===0||ui){var c=Et;Et<<=1,(Et&3932160)===0&&(Et=262144),vi=c}else vi=536870912;return c=lr.current,c!==null&&(c.flags|=32),vi}function m(c,d,g){(c===Ii&&(_n===2||_n===9)||c.cancelPendingCommit!==null)&&(Ce(c,0),I(c,oi,vi,!1)),rr(c,g),((yi&2)===0||c!==Ii)&&(c===Ii&&((yi&2)===0&&(Xc|=g),Pi===4&&I(c,oi,vi,!1)),$u(c))}function b(c,d,g){if((yi&6)!==0)throw Error(n(327));var v=!g&&(d&127)===0&&(d&c.expiredLanes)===0||en(c,d),E=v?cf(c,d):Oa(c,d,!0),R=v;do{if(E===0){Jn&&!v&&I(c,d,0,!1);break}else{if(g=c.current.alternate,R&&!N(g)){E=Oa(c,d,!1),R=!1;continue}if(E===2){if(R=d,c.errorRecoveryDisabledLanes&R)var z=0;else z=c.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){d=z;e:{var Y=c;E=hl;var he=Y.current.memoizedState.isDehydrated;if(he&&(Ce(Y,z).flags|=256),z=Oa(Y,z,!1),z!==2){if(Ji&&!he){Y.errorRecoveryDisabledLanes|=R,Xc|=R,E=4;break e}R=na,na=E,R!==null&&(na===null?na=R:na.push.apply(na,R))}E=z}if(R=!1,E!==2)continue}}if(E===1){Ce(c,0),I(c,d,0,!0);break}e:{switch(v=c,R=E,R){case 0:case 1:throw Error(n(345));case 4:if((d&4194048)!==d)break;case 6:I(v,d,vi,!Hn);break e;case 2:na=null;break;case 3:case 5:break;default:throw Error(n(329))}if((d&62914560)===d&&(E=qc+300-V(),10<E)){if(I(v,d,vi,!Hn),lt(v,0,!0)!==0)break e;ko=d,v.timeoutHandle=CL(M.bind(null,v,g,na,Lh,Da,d,vi,Xc,lo,Hn,R,"Throttled",-0,0),E);break e}M(v,g,na,Lh,Da,d,vi,Xc,lo,Hn,R,null,-0,0)}}break}while(!0);$u(c)}function M(c,d,g,v,E,R,z,Y,he,Ue,tt,ut,Pe,We){if(c.timeoutHandle=-1,ut=d.subtreeFlags,ut&8192||(ut&16785408)===16785408){ut={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fl},Vs(d,R,ut);var un=(R&62914560)===R?qc-V():(R&4194048)===R?Uh-V():0;if(un=Eq(ut,un),un!==null){ko=R,c.cancelPendingCommit=un(Un.bind(null,c,d,R,g,v,E,z,Y,he,tt,ut,null,Pe,We)),I(c,R,z,!Ue);return}}Un(c,d,R,g,v,E,z,Y,he)}function N(c){for(var d=c;;){var g=d.tag;if((g===0||g===11||g===15)&&d.flags&16384&&(g=d.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var v=0;v<g.length;v++){var E=g[v],R=E.getSnapshot;E=E.value;try{if(!ps(R(),E))return!1}catch{return!1}}if(g=d.child,d.subtreeFlags&16384&&g!==null)g.return=d,d=g;else{if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function I(c,d,g,v){d&=~fl,d&=~Xc,c.suspendedLanes|=d,c.pingedLanes&=~d,v&&(c.warmLanes|=d),v=c.expirationTimes;for(var E=d;0<E;){var R=31-zt(E),z=1<<R;v[R]=-1,E&=~z}g!==0&&Ld(c,g,d)}function $(){return(yi&6)===0?(K_(0),!1):!0}function fe(){if(jn!==null){if(_n===0)var c=jn.return;else c=jn,Jr=Oc=null,M_(c),Pu=null,Fu=0,c=jn;for(;c!==null;)tf(c.alternate,c),c=c.return;jn=null}}function Ce(c,d){var g=c.timeoutHandle;g!==-1&&(c.timeoutHandle=-1,oq(g)),g=c.cancelPendingCommit,g!==null&&(c.cancelPendingCommit=null,g()),ko=0,fe(),Ii=c,jn=g=Vl(c.current,null),oi=d,_n=0,ti=null,Hn=!1,Jn=en(c,d),Ji=!1,lo=vi=fl=Xc=oo=Pi=0,na=hl=null,Da=!1,(d&8)!==0&&(d|=d&32);var v=c.entangledLanes;if(v!==0)for(c=c.entanglements,v&=d;0<v;){var E=31-zt(v),R=1<<E;d|=c[E],v&=~R}return Hs=d,Nu(),g}function rt(c,d){On=null,W.H=Gm,d===Iu||d===ll?(d=Q0(),_n=3):d===wm?(d=Q0(),_n=4):_n=d===gx?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,ti=d,jn===null&&(Pi=1,mx(c,Aa(d,c.current)))}function Ct(){var c=lr.current;return c===null?!0:(oi&4194048)===oi?Po===null:(oi&62914560)===oi||(oi&536870912)!==0?c===Po:!1}function kt(){var c=W.H;return W.H=Gm,c===null?Gm:c}function Zt(){var c=W.A;return W.A=Tx,c}function zn(){Pi=4,Hn||(oi&4194048)!==oi&&lr.current!==null||(Jn=!0),(oo&134217727)===0&&(Xc&134217727)===0||Ii===null||I(Ii,oi,vi,!1)}function Oa(c,d,g){var v=yi;yi|=2;var E=kt(),R=Zt();(Ii!==c||oi!==d)&&(Lh=null,Ce(c,d)),d=!1;var z=Pi;e:do try{if(_n!==0&&jn!==null){var Y=jn,he=ti;switch(_n){case 8:fe(),z=6;break e;case 3:case 2:case 9:case 6:lr.current===null&&(d=!0);var Ue=_n;if(_n=0,ti=null,_t(c,Y,he,Ue),g&&Jn){z=0;break e}break;default:Ue=_n,_n=0,ti=null,_t(c,Y,he,Ue)}}Zm(),z=Pi;break}catch(tt){rt(c,tt)}while(!0);return d&&c.shellSuspendCounter++,Jr=Oc=null,yi=v,W.H=E,W.A=R,jn===null&&(Ii=null,oi=0,Nu()),z}function Zm(){for(;jn!==null;)Ee(jn)}function cf(c,d){var g=yi;yi|=2;var v=kt(),E=Zt();Ii!==c||oi!==d?(Lh=null,co=V()+500,Ce(c,d)):Jn=en(c,d);e:do try{if(_n!==0&&jn!==null){d=jn;var R=ti;t:switch(_n){case 1:_n=0,ti=null,_t(c,d,R,1);break;case 2:case 9:if(UA(R)){_n=0,ti=null,He(d);break}d=function(){_n!==2&&_n!==9||Ii!==c||(_n=7),$u(c)},R.then(d,d);break e;case 3:_n=7;break e;case 4:_n=5;break e;case 7:UA(R)?(_n=0,ti=null,He(d)):(_n=0,ti=null,_t(c,d,R,7));break;case 5:var z=null;switch(jn.tag){case 26:z=jn.memoizedState;case 5:case 27:var Y=jn;if(z?HL(z):Y.stateNode.complete){_n=0,ti=null;var he=Y.sibling;if(he!==null)jn=he;else{var Ue=Y.return;Ue!==null?(jn=Ue,gn(Ue)):jn=null}break t}}_n=0,ti=null,_t(c,d,R,5);break;case 6:_n=0,ti=null,_t(c,d,R,6);break;case 8:fe(),Pi=6;break e;default:throw Error(n(462))}}Le();break}catch(tt){rt(c,tt)}while(!0);return Jr=Oc=null,W.H=v,W.A=E,yi=g,jn!==null?0:(Ii=null,oi=0,Nu(),Pi)}function Le(){for(;jn!==null&&!Ht();)Ee(jn)}function Ee(c){var d=xx(c.alternate,c,Hs);c.memoizedProps=c.pendingProps,d===null?gn(c):jn=d}function He(c){var d=c,g=d.alternate;switch(d.tag){case 15:case 0:d=Qr(g,d,d.pendingProps,d.type,void 0,oi);break;case 11:d=Qr(g,d,d.pendingProps,d.type.render,d.ref,oi);break;case 5:M_(d);default:tf(g,d),d=jn=Kr(d,Hs),d=xx(g,d,Hs)}c.memoizedProps=c.pendingProps,d===null?gn(c):jn=d}function _t(c,d,g,v){Jr=Oc=null,M_(d),Pu=null,Fu=0;var E=d.return;try{if(eo(c,E,d,g,oi)){Pi=1,mx(c,Aa(g,c.current)),jn=null;return}}catch(R){if(E!==null)throw jn=E,R;Pi=1,mx(c,Aa(g,c.current)),jn=null;return}d.flags&32768?(ui||v===1?c=!0:Jn||(oi&536870912)!==0?c=!1:(Hn=c=!0,(v===2||v===9||v===3||v===6)&&(v=lr.current,v!==null&&v.tag===13&&(v.flags|=16384))),as(d,c)):gn(d)}function gn(c){var d=c;do{if((d.flags&32768)!==0){as(d,Hn);return}c=d.return;var g=Y_(d.alternate,d,Hs);if(g!==null){jn=g;return}if(d=d.sibling,d!==null){jn=d;return}jn=d=c}while(d!==null);Pi===0&&(Pi=5)}function as(c,d){do{var g=yx(c.alternate,c);if(g!==null){g.flags&=32767,jn=g;return}if(g=c.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!d&&(c=c.sibling,c!==null)){jn=c;return}jn=c=g}while(c!==null);Pi=6,jn=null}function Un(c,d,g,v,E,R,z,Y,he){c.cancelPendingCommit=null;do Mx();while(Ms!==0);if((yi&6)!==0)throw Error(n(327));if(d!==null){if(d===c.current)throw Error(n(177));if(R=d.lanes|d.childLanes,R|=X0,Yr(c,g,R,z,Y,he),c===Ii&&(jn=Ii=null,oi=0),uo=d,pl=c,ko=g,Yc=R,af=E,Ex=v,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,jX(Ve,function(){return uL(),null})):(c.callbackNode=null,c.callbackPriority=0),v=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||v){v=W.T,W.T=null,E=ne.p,ne.p=2,z=yi,yi|=4;try{Dh(c,d,g)}finally{yi=z,ne.p=E,W.T=v}}Ms=1,Ri(),ur(),wi()}}function Ri(){if(Ms===1){Ms=0;var c=pl,d=uo,g=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||g){g=W.T,W.T=null;var v=ne.p;ne.p=2;var E=yi;yi|=4;try{Yu(d,c);var R=mR,z=z0(c.containerInfo),Y=R.focusedElem,he=R.selectionRange;if(z!==Y&&Y&&Y.ownerDocument&&G0(Y.ownerDocument.documentElement,Y)){if(he!==null&&dh(Y)){var Ue=he.start,tt=he.end;if(tt===void 0&&(tt=Ue),"selectionStart"in Y)Y.selectionStart=Ue,Y.selectionEnd=Math.min(tt,Y.value.length);else{var ut=Y.ownerDocument||document,Pe=ut&&ut.defaultView||window;if(Pe.getSelection){var We=Pe.getSelection(),un=Y.textContent.length,Nn=Math.min(he.start,un),ls=he.end===void 0?Nn:Math.min(he.end,un);!We.extend&&Nn>ls&&(z=ls,ls=Nn,Nn=z);var Me=t_(Y,Nn),be=t_(Y,ls);if(Me&&be&&(We.rangeCount!==1||We.anchorNode!==Me.node||We.anchorOffset!==Me.offset||We.focusNode!==be.node||We.focusOffset!==be.offset)){var Oe=ut.createRange();Oe.setStart(Me.node,Me.offset),We.removeAllRanges(),Nn>ls?(We.addRange(Oe),We.extend(be.node,be.offset)):(Oe.setEnd(be.node,be.offset),We.addRange(Oe))}}}}for(ut=[],We=Y;We=We.parentNode;)We.nodeType===1&&ut.push({element:We,left:We.scrollLeft,top:We.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<ut.length;Y++){var at=ut[Y];at.element.scrollLeft=at.left,at.element.scrollTop=at.top}}b1=!!pR,mR=pR=null}finally{yi=E,ne.p=v,W.T=g}}c.current=d,Ms=2}}function ur(){if(Ms===2){Ms=0;var c=pl,d=uo,g=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||g){g=W.T,W.T=null;var v=ne.p;ne.p=2;var E=yi;yi|=4;try{o1(c,d.alternate,d)}finally{yi=E,ne.p=v,W.T=g}}Ms=3}}function wi(){if(Ms===4||Ms===3){Ms=0,q();var c=pl,d=uo,g=ko,v=Ex;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Ms=5:(Ms=0,uo=pl=null,jc(c,c.pendingLanes));var E=c.pendingLanes;if(E===0&&(ec=null),Sa(g),d=d.stateNode,st&&typeof st.onCommitFiberRoot=="function")try{st.onCommitFiberRoot(et,d,void 0,(d.current.flags&128)===128)}catch{}if(v!==null){d=W.T,E=ne.p,ne.p=2,W.T=null;try{for(var R=c.onRecoverableError,z=0;z<v.length;z++){var Y=v[z];R(Y.value,{componentStack:Y.stack})}}finally{W.T=d,ne.p=E}}(ko&3)!==0&&Mx(),$u(c),E=c.pendingLanes,(g&261930)!==0&&(E&42)!==0?c===lf?of++:(of=0,lf=c):of=0,K_(0)}}function jc(c,d){(c.pooledCacheLanes&=d)===0&&(d=c.pooledCache,d!=null&&(c.pooledCache=null,Or(d)))}function Mx(){return Ri(),ur(),wi(),uL()}function uL(){if(Ms!==5)return!1;var c=pl,d=Yc;Yc=0;var g=Sa(ko),v=W.T,E=ne.p;try{ne.p=32>g?32:g,W.T=null,g=af,af=null;var R=pl,z=ko;if(Ms=0,uo=pl=null,ko=0,(yi&6)!==0)throw Error(n(331));var Y=yi;if(yi|=4,rf(R.current),Es(R,R.current,z,g),yi=Y,K_(0,!1),st&&typeof st.onPostCommitFiberRoot=="function")try{st.onPostCommitFiberRoot(et,R)}catch{}return!0}finally{ne.p=E,W.T=v,jc(c,d)}}function dL(c,d,g){d=Aa(g,d),d=q_(c.stateNode,d,2),c=Pc(c,d,2),c!==null&&(rr(c,2),$u(c))}function ns(c,d,g){if(c.tag===3)dL(c,c,g);else for(;d!==null;){if(d.tag===3){dL(d,c,g);break}else if(d.tag===1){var v=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(ec===null||!ec.has(v))){c=Aa(g,c),g=Ch(2),v=Pc(d,g,2),v!==null&&(Ra(g,v,d,c),rr(v,2),$u(v));break}}d=d.return}}function sR(c,d,g){var v=c.pingCache;if(v===null){v=c.pingCache=new Ax;var E=new Set;v.set(d,E)}else E=v.get(d),E===void 0&&(E=new Set,v.set(d,E));E.has(g)||(Ji=!0,E.add(g),c=XX.bind(null,c,d,g),d.then(c,c))}function XX(c,d,g){var v=c.pingCache;v!==null&&v.delete(d),c.pingedLanes|=c.suspendedLanes&g,c.warmLanes&=~g,Ii===c&&(oi&g)===g&&(Pi===4||Pi===3&&(oi&62914560)===oi&&300>V()-qc?(yi&2)===0&&Ce(c,0):fl|=g,lo===oi&&(lo=0)),$u(c)}function fL(c,d){d===0&&(d=gi()),c=Bu(c,d),c!==null&&(rr(c,d),$u(c))}function qX(c){var d=c.memoizedState,g=0;d!==null&&(g=d.retryLane),fL(c,g)}function YX(c,d){var g=0;switch(c.tag){case 31:case 13:var v=c.stateNode,E=c.memoizedState;E!==null&&(g=E.retryLane);break;case 19:v=c.stateNode;break;case 22:v=c.stateNode._retryCache;break;default:throw Error(n(314))}v!==null&&v.delete(d),fL(c,g)}function jX(c,d){return Ut(c,d)}var u1=null,Cx=null,rR=!1,d1=!1,aR=!1,Ih=0;function $u(c){c!==Cx&&c.next===null&&(Cx===null?u1=Cx=c:Cx=Cx.next=c),d1=!0,rR||(rR=!0,KX())}function K_(c,d){if(!aR&&d1){aR=!0;do for(var g=!1,v=u1;v!==null;){if(c!==0){var E=v.pendingLanes;if(E===0)var R=0;else{var z=v.suspendedLanes,Y=v.pingedLanes;R=(1<<31-zt(42|c)+1)-1,R&=E&~(z&~Y),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(g=!0,gL(v,R))}else R=oi,R=lt(v,v===Ii?R:0,v.cancelPendingCommit!==null||v.timeoutHandle!==-1),(R&3)===0||en(v,R)||(g=!0,gL(v,R));v=v.next}while(g);aR=!1}}function $X(){hL()}function hL(){d1=rR=!1;var c=0;Ih!==0&&aq()&&(c=Ih);for(var d=V(),g=null,v=u1;v!==null;){var E=v.next,R=pL(v,d);R===0?(v.next=null,g===null?u1=E:g.next=E,E===null&&(Cx=g)):(g=v,(c!==0||(R&3)!==0)&&(d1=!0)),v=E}Ms!==0&&Ms!==5||K_(c),Ih!==0&&(Ih=0)}function pL(c,d){for(var g=c.suspendedLanes,v=c.pingedLanes,E=c.expirationTimes,R=c.pendingLanes&-62914561;0<R;){var z=31-zt(R),Y=1<<z,he=E[z];he===-1?((Y&g)===0||(Y&v)!==0)&&(E[z]=Tn(Y,d)):he<=d&&(c.expiredLanes|=Y),R&=~Y}if(d=Ii,g=oi,g=lt(c,c===d?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),v=c.callbackNode,g===0||c===d&&(_n===2||_n===9)||c.cancelPendingCommit!==null)return v!==null&&v!==null&&At(v),c.callbackNode=null,c.callbackPriority=0;if((g&3)===0||en(c,g)){if(d=g&-g,d===c.callbackPriority)return d;switch(v!==null&&At(v),Sa(g)){case 2:case 8:g=$e;break;case 32:g=Ve;break;case 268435456:g=Ot;break;default:g=Ve}return v=mL.bind(null,c),g=Ut(g,v),c.callbackPriority=d,c.callbackNode=g,d}return v!==null&&v!==null&&At(v),c.callbackPriority=2,c.callbackNode=null,2}function mL(c,d){if(Ms!==0&&Ms!==5)return c.callbackNode=null,c.callbackPriority=0,null;var g=c.callbackNode;if(Mx()&&c.callbackNode!==g)return null;var v=oi;return v=lt(c,c===Ii?v:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),v===0?null:(b(c,v,d),pL(c,V()),c.callbackNode!=null&&c.callbackNode===g?mL.bind(null,c):null)}function gL(c,d){if(Mx())return null;b(c,d,!0)}function KX(){lq(function(){(yi&6)!==0?Ut(Ge,$X):hL()})}function oR(){if(Ih===0){var c=Ic;c===0&&(c=ze,ze<<=1,(ze&261888)===0&&(ze=256)),Ih=c}return Ih}function xL(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:um(""+c)}function yL(c,d){var g=d.ownerDocument.createElement("input");return g.name=d.name,g.value=d.value,c.id&&g.setAttribute("form",c.id),d.parentNode.insertBefore(g,d),c=new FormData(c),g.parentNode.removeChild(g),c}function JX(c,d,g,v,E){if(d==="submit"&&g&&g.stateNode===E){var R=xL((E[H]||null).action),z=v.submitter;z&&(d=(d=z[H]||null)?xL(d.formAction):z.getAttribute("formAction"),d!==null&&(R=d,z=null));var Y=new pm("action","action",null,v,E);c.push({event:Y,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(Ih!==0){var he=z?yL(E,z):new FormData(E);V_(g,{pending:!0,data:he,method:E.method,action:R},null,he)}}else typeof R=="function"&&(Y.preventDefault(),he=z?yL(E,z):new FormData(E),V_(g,{pending:!0,data:he,method:E.method,action:R},R,he))},currentTarget:E}]})}}for(var lR=0;lR<W0.length;lR++){var cR=W0[lR],ZX=cR.toLowerCase(),QX=cR[0].toUpperCase()+cR.slice(1);$r(ZX,"on"+QX)}$r(Ta,"onAnimationEnd"),$r(n_,"onAnimationIteration"),$r(zl,"onAnimationStart"),$r("dblclick","onDoubleClick"),$r("focusin","onFocus"),$r("focusout","onBlur"),$r(mh,"onTransitionRun"),$r(Ru,"onTransitionStart"),$r(i_,"onTransitionCancel"),$r(k0,"onTransitionEnd"),ft("onMouseEnter",["mouseout","mouseover"]),ft("onMouseLeave",["mouseout","mouseover"]),ft("onPointerEnter",["pointerout","pointerover"]),ft("onPointerLeave",["pointerout","pointerover"]),it("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),it("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),it("onBeforeInput",["compositionend","keypress","textInput","paste"]),it("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),it("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),it("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var J_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eq=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(J_));function vL(c,d){d=(d&4)!==0;for(var g=0;g<c.length;g++){var v=c[g],E=v.event;v=v.listeners;e:{var R=void 0;if(d)for(var z=v.length-1;0<=z;z--){var Y=v[z],he=Y.instance,Ue=Y.currentTarget;if(Y=Y.listener,he!==R&&E.isPropagationStopped())break e;R=Y,E.currentTarget=Ue;try{R(E)}catch(tt){wu(tt)}E.currentTarget=null,R=he}else for(z=0;z<v.length;z++){if(Y=v[z],he=Y.instance,Ue=Y.currentTarget,Y=Y.listener,he!==R&&E.isPropagationStopped())break e;R=Y,E.currentTarget=Ue;try{R(E)}catch(tt){wu(tt)}E.currentTarget=null,R=he}}}}function di(c,d){var g=d[xe];g===void 0&&(g=d[xe]=new Set);var v=c+"__bubble";g.has(v)||(_L(d,c,2,!1),g.add(v))}function uR(c,d,g){var v=0;d&&(v|=4),_L(g,c,v,d)}var f1="_reactListening"+Math.random().toString(36).slice(2);function dR(c){if(!c[f1]){c[f1]=!0,le.forEach(function(g){g!=="selectionchange"&&(eq.has(g)||uR(g,!1,c),uR(g,!0,c))});var d=c.nodeType===9?c:c.ownerDocument;d===null||d[f1]||(d[f1]=!0,uR("selectionchange",!1,d))}}function _L(c,d,g,v){switch($L(d)){case 2:var E=Rq;break;case 8:E=wq;break;default:E=MR}g=E.bind(null,d,g,c),E=void 0,!w0||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(E=!0),v?E!==void 0?c.addEventListener(d,g,{capture:!0,passive:E}):c.addEventListener(d,g,!0):E!==void 0?c.addEventListener(d,g,{passive:E}):c.addEventListener(d,g,!1)}function fR(c,d,g,v,E){var R=v;if((d&1)===0&&(d&2)===0&&v!==null)e:for(;;){if(v===null)return;var z=v.tag;if(z===3||z===4){var Y=v.stateNode.containerInfo;if(Y===E)break;if(z===4)for(z=v.return;z!==null;){var he=z.tag;if((he===3||he===4)&&z.stateNode.containerInfo===E)return;z=z.return}for(;Y!==null;){if(z=xt(Y),z===null)return;if(he=z.tag,he===5||he===6||he===26||he===27){v=R=z;continue e}Y=Y.parentNode}}v=v.return}Fv(function(){var Ue=R,tt=C0(g),ut=[];e:{var Pe=wc.get(c);if(Pe!==void 0){var We=pm,un=c;switch(c){case"keypress":if(Fd(g)===0)break e;case"keydown":case"keyup":We=Xv;break;case"focusin":un="focus",We=U0;break;case"focusout":un="blur",We=U0;break;case"beforeblur":case"afterblur":We=U0;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":We=dA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":We=fA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":We=Cc;break;case Ta:case n_:case zl:We=mA;break;case k0:We=K3;break;case"scroll":case"scrollend":We=D0;break;case"wheel":We=Su;break;case"copy":case"cut":case"paste":We=zv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":We=L0;break;case"toggle":case"beforetoggle":We=Yv}var Nn=(d&4)!==0,ls=!Nn&&(c==="scroll"||c==="scrollend"),Me=Nn?Pe!==null?Pe+"Capture":null:Pe;Nn=[];for(var be=Ue,Oe;be!==null;){var at=be;if(Oe=at.stateNode,at=at.tag,at!==5&&at!==26&&at!==27||Oe===null||Me===null||(at=Pd(be,Me),at!=null&&Nn.push(Z_(be,at,Oe))),ls)break;be=be.return}0<Nn.length&&(Pe=new We(Pe,un,null,g,tt),ut.push({event:Pe,listeners:Nn}))}}if((d&7)===0){e:{if(Pe=c==="mouseover"||c==="pointerover",We=c==="mouseout"||c==="pointerout",Pe&&g!==dm&&(un=g.relatedTarget||g.fromElement)&&(xt(un)||un[J]))break e;if((We||Pe)&&(Pe=tt.window===tt?tt:(Pe=tt.ownerDocument)?Pe.defaultView||Pe.parentWindow:window,We?(un=g.relatedTarget||g.toElement,We=Ue,un=un?xt(un):null,un!==null&&(ls=r(un),Nn=un.tag,un!==ls||Nn!==5&&Nn!==27&&Nn!==6)&&(un=null)):(We=null,un=Ue),We!==un)){if(Nn=dA,at="onMouseLeave",Me="onMouseEnter",be="mouse",(c==="pointerout"||c==="pointerover")&&(Nn=L0,at="onPointerLeave",Me="onPointerEnter",be="pointer"),ls=We==null?Pe:ae(We),Oe=un==null?Pe:ae(un),Pe=new Nn(at,be+"leave",We,g,tt),Pe.target=ls,Pe.relatedTarget=Oe,at=null,xt(tt)===Ue&&(Nn=new Nn(Me,be+"enter",un,g,tt),Nn.target=Oe,Nn.relatedTarget=ls,at=Nn),ls=at,We&&un)t:{for(Nn=tq,Me=We,be=un,Oe=0,at=Me;at;at=Nn(at))Oe++;at=0;for(var Sn=be;Sn;Sn=Nn(Sn))at++;for(;0<Oe-at;)Me=Nn(Me),Oe--;for(;0<at-Oe;)be=Nn(be),at--;for(;Oe--;){if(Me===be||be!==null&&Me===be.alternate){Nn=Me;break t}Me=Nn(Me),be=Nn(be)}Nn=null}else Nn=null;We!==null&&bL(ut,Pe,We,Nn,!1),un!==null&&ls!==null&&bL(ut,ls,un,Nn,!0)}}e:{if(Pe=Ue?ae(Ue):window,We=Pe.nodeName&&Pe.nodeName.toLowerCase(),We==="select"||We==="input"&&Pe.type==="file")var Fi=Zv;else if(Kv(Pe))if(_m)Fi=MA;else{Fi=Eu;var pn=bm}else We=Pe.nodeName,!We||We.toLowerCase()!=="input"||Pe.type!=="checkbox"&&Pe.type!=="radio"?Ue&&cm(Ue.elementType)&&(Fi=Zv):Fi=EA;if(Fi&&(Fi=Fi(c,Ue))){F0(ut,Fi,g,tt);break e}pn&&pn(c,Pe,Ue),c==="focusout"&&Ue&&Pe.type==="number"&&Ue.memoizedProps.value!=null&&Ei(Pe,"number",Pe.value)}switch(pn=Ue?ae(Ue):window,c){case"focusin":(Kv(pn)||pn.contentEditable==="true")&&(fh=pn,V0=Ue,hh=null);break;case"focusout":hh=V0=fh=null;break;case"mousedown":$a=!0;break;case"contextmenu":case"mouseup":case"dragend":$a=!1,H0(ut,g,tt);break;case"selectionchange":if(CA)break;case"keydown":case"keyup":H0(ut,g,tt)}var Zn;if(Gd)e:{switch(c){case"compositionstart":var _i="onCompositionStart";break e;case"compositionend":_i="onCompositionEnd";break e;case"compositionupdate":_i="onCompositionUpdate";break e}_i=void 0}else Au?I0(c,g)&&(_i="onCompositionEnd"):c==="keydown"&&g.keyCode===229&&(_i="onCompositionStart");_i&&(Dr&&g.locale!=="ko"&&(Au||_i!=="onCompositionStart"?_i==="onCompositionEnd"&&Au&&(Zn=B0()):(vu=tt,N0="value"in vu?vu.value:vu.textContent,Au=!0)),pn=h1(Ue,_i),0<pn.length&&(_i=new Vv(_i,c,null,g,tt),ut.push({event:_i,listeners:pn}),Zn?_i.data=Zn:(Zn=ah(g),Zn!==null&&(_i.data=Zn)))),(Zn=zd?P0(c,g):SA(c,g))&&(_i=h1(Ue,"onBeforeInput"),0<_i.length&&(pn=new Vv("onBeforeInput","beforeinput",null,g,tt),ut.push({event:pn,listeners:_i}),pn.data=Zn)),JX(ut,c,Ue,g,tt)}vL(ut,d)})}function Z_(c,d,g){return{instance:c,listener:d,currentTarget:g}}function h1(c,d){for(var g=d+"Capture",v=[];c!==null;){var E=c,R=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||R===null||(E=Pd(c,g),E!=null&&v.unshift(Z_(c,E,R)),E=Pd(c,d),E!=null&&v.push(Z_(c,E,R))),c.tag===3)return v;c=c.return}return[]}function tq(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function bL(c,d,g,v,E){for(var R=d._reactName,z=[];g!==null&&g!==v;){var Y=g,he=Y.alternate,Ue=Y.stateNode;if(Y=Y.tag,he!==null&&he===v)break;Y!==5&&Y!==26&&Y!==27||Ue===null||(he=Ue,E?(Ue=Pd(g,R),Ue!=null&&z.unshift(Z_(g,Ue,he))):E||(Ue=Pd(g,R),Ue!=null&&z.push(Z_(g,Ue,he)))),g=g.return}z.length!==0&&c.push({event:d,listeners:z})}var nq=/\r\n?/g,iq=/\u0000|\uFFFD/g;function SL(c){return(typeof c=="string"?c:""+c).replace(nq,`
`).replace(iq,"")}function TL(c,d){return d=SL(d),SL(c)===d}function os(c,d,g,v,E,R){switch(g){case"children":typeof v=="string"?d==="body"||d==="textarea"&&v===""||il(c,v):(typeof v=="number"||typeof v=="bigint")&&d!=="body"&&il(c,""+v);break;case"className":Gn(c,"class",v);break;case"tabIndex":Gn(c,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":Gn(c,g,v);break;case"style":Iv(c,v,R);break;case"data":if(d!=="object"){Gn(c,"data",v);break}case"src":case"href":if(v===""&&(d!=="a"||g!=="href")){c.removeAttribute(g);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){c.removeAttribute(g);break}v=um(""+v),c.setAttribute(g,v);break;case"action":case"formAction":if(typeof v=="function"){c.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(g==="formAction"?(d!=="input"&&os(c,d,"name",E.name,E,null),os(c,d,"formEncType",E.formEncType,E,null),os(c,d,"formMethod",E.formMethod,E,null),os(c,d,"formTarget",E.formTarget,E,null)):(os(c,d,"encType",E.encType,E,null),os(c,d,"method",E.method,E,null),os(c,d,"target",E.target,E,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){c.removeAttribute(g);break}v=um(""+v),c.setAttribute(g,v);break;case"onClick":v!=null&&(c.onclick=Fl);break;case"onScroll":v!=null&&di("scroll",c);break;case"onScrollEnd":v!=null&&di("scrollend",c);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(n(61));if(g=v.__html,g!=null){if(E.children!=null)throw Error(n(60));c.innerHTML=g}}break;case"multiple":c.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":c.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){c.removeAttribute("xlink:href");break}g=um(""+v),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(g,""+v):c.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(g,""):c.removeAttribute(g);break;case"capture":case"download":v===!0?c.setAttribute(g,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(g,v):c.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?c.setAttribute(g,v):c.removeAttribute(g);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?c.removeAttribute(g):c.setAttribute(g,v);break;case"popover":di("beforetoggle",c),di("toggle",c),tn(c,"popover",v);break;case"xlinkActuate":fn(c,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":fn(c,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":fn(c,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":fn(c,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":fn(c,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":fn(c,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":fn(c,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":fn(c,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":fn(c,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":tn(c,"is",v);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=cA.get(g)||g,tn(c,g,v))}}function hR(c,d,g,v,E,R){switch(g){case"style":Iv(c,v,R);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(n(61));if(g=v.__html,g!=null){if(E.children!=null)throw Error(n(60));c.innerHTML=g}}break;case"children":typeof v=="string"?il(c,v):(typeof v=="number"||typeof v=="bigint")&&il(c,""+v);break;case"onScroll":v!=null&&di("scroll",c);break;case"onScrollEnd":v!=null&&di("scrollend",c);break;case"onClick":v!=null&&(c.onclick=Fl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ke.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(E=g.endsWith("Capture"),d=g.slice(2,E?g.length-7:void 0),R=c[H]||null,R=R!=null?R[g]:null,typeof R=="function"&&c.removeEventListener(d,R,E),typeof v=="function")){typeof R!="function"&&R!==null&&(g in c?c[g]=null:c.hasAttribute(g)&&c.removeAttribute(g)),c.addEventListener(d,v,E);break e}g in c?c[g]=v:v===!0?c.setAttribute(g,""):tn(c,g,v)}}}function ya(c,d,g){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":di("error",c),di("load",c);var v=!1,E=!1,R;for(R in g)if(g.hasOwnProperty(R)){var z=g[R];if(z!=null)switch(R){case"src":v=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:os(c,d,R,z,g,null)}}E&&os(c,d,"srcSet",g.srcSet,g,null),v&&os(c,d,"src",g.src,g,null);return;case"input":di("invalid",c);var Y=R=z=E=null,he=null,Ue=null;for(v in g)if(g.hasOwnProperty(v)){var tt=g[v];if(tt!=null)switch(v){case"name":E=tt;break;case"type":z=tt;break;case"checked":he=tt;break;case"defaultChecked":Ue=tt;break;case"value":R=tt;break;case"defaultValue":Y=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(n(137,d));break;default:os(c,d,v,tt,g,null)}}ci(c,R,Y,he,Ue,z,E,!1);return;case"select":di("invalid",c),v=z=R=null;for(E in g)if(g.hasOwnProperty(E)&&(Y=g[E],Y!=null))switch(E){case"value":R=Y;break;case"defaultValue":z=Y;break;case"multiple":v=Y;default:os(c,d,E,Y,g,null)}d=R,g=z,c.multiple=!!v,d!=null?$i(c,!!v,d,!1):g!=null&&$i(c,!!v,g,!0);return;case"textarea":di("invalid",c),R=E=v=null;for(z in g)if(g.hasOwnProperty(z)&&(Y=g[z],Y!=null))switch(z){case"value":v=Y;break;case"defaultValue":E=Y;break;case"children":R=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(n(91));break;default:os(c,d,z,Y,g,null)}ws(c,v,E,R);return;case"option":for(he in g)if(g.hasOwnProperty(he)&&(v=g[he],v!=null))switch(he){case"selected":c.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:os(c,d,he,v,g,null)}return;case"dialog":di("beforetoggle",c),di("toggle",c),di("cancel",c),di("close",c);break;case"iframe":case"object":di("load",c);break;case"video":case"audio":for(v=0;v<J_.length;v++)di(J_[v],c);break;case"image":di("error",c),di("load",c);break;case"details":di("toggle",c);break;case"embed":case"source":case"link":di("error",c),di("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ue in g)if(g.hasOwnProperty(Ue)&&(v=g[Ue],v!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:os(c,d,Ue,v,g,null)}return;default:if(cm(d)){for(tt in g)g.hasOwnProperty(tt)&&(v=g[tt],v!==void 0&&hR(c,d,tt,v,g,void 0));return}}for(Y in g)g.hasOwnProperty(Y)&&(v=g[Y],v!=null&&os(c,d,Y,v,g,null))}function sq(c,d,g,v){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,R=null,z=null,Y=null,he=null,Ue=null,tt=null;for(We in g){var ut=g[We];if(g.hasOwnProperty(We)&&ut!=null)switch(We){case"checked":break;case"value":break;case"defaultValue":he=ut;default:v.hasOwnProperty(We)||os(c,d,We,null,v,ut)}}for(var Pe in v){var We=v[Pe];if(ut=g[Pe],v.hasOwnProperty(Pe)&&(We!=null||ut!=null))switch(Pe){case"type":R=We;break;case"name":E=We;break;case"checked":Ue=We;break;case"defaultChecked":tt=We;break;case"value":z=We;break;case"defaultValue":Y=We;break;case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(n(137,d));break;default:We!==ut&&os(c,d,Pe,We,v,ut)}}As(c,z,Y,he,Ue,tt,R,E);return;case"select":We=z=Y=Pe=null;for(R in g)if(he=g[R],g.hasOwnProperty(R)&&he!=null)switch(R){case"value":break;case"multiple":We=he;default:v.hasOwnProperty(R)||os(c,d,R,null,v,he)}for(E in v)if(R=v[E],he=g[E],v.hasOwnProperty(E)&&(R!=null||he!=null))switch(E){case"value":Pe=R;break;case"defaultValue":Y=R;break;case"multiple":z=R;default:R!==he&&os(c,d,E,R,v,he)}d=Y,g=z,v=We,Pe!=null?$i(c,!!g,Pe,!1):!!v!=!!g&&(d!=null?$i(c,!!g,d,!0):$i(c,!!g,g?[]:"",!1));return;case"textarea":We=Pe=null;for(Y in g)if(E=g[Y],g.hasOwnProperty(Y)&&E!=null&&!v.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:os(c,d,Y,null,v,E)}for(z in v)if(E=v[z],R=g[z],v.hasOwnProperty(z)&&(E!=null||R!=null))switch(z){case"value":Pe=E;break;case"defaultValue":We=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(n(91));break;default:E!==R&&os(c,d,z,E,v,R)}or(c,Pe,We);return;case"option":for(var un in g)if(Pe=g[un],g.hasOwnProperty(un)&&Pe!=null&&!v.hasOwnProperty(un))switch(un){case"selected":c.selected=!1;break;default:os(c,d,un,null,v,Pe)}for(he in v)if(Pe=v[he],We=g[he],v.hasOwnProperty(he)&&Pe!==We&&(Pe!=null||We!=null))switch(he){case"selected":c.selected=Pe&&typeof Pe!="function"&&typeof Pe!="symbol";break;default:os(c,d,he,Pe,v,We)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Nn in g)Pe=g[Nn],g.hasOwnProperty(Nn)&&Pe!=null&&!v.hasOwnProperty(Nn)&&os(c,d,Nn,null,v,Pe);for(Ue in v)if(Pe=v[Ue],We=g[Ue],v.hasOwnProperty(Ue)&&Pe!==We&&(Pe!=null||We!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(n(137,d));break;default:os(c,d,Ue,Pe,v,We)}return;default:if(cm(d)){for(var ls in g)Pe=g[ls],g.hasOwnProperty(ls)&&Pe!==void 0&&!v.hasOwnProperty(ls)&&hR(c,d,ls,void 0,v,Pe);for(tt in v)Pe=v[tt],We=g[tt],!v.hasOwnProperty(tt)||Pe===We||Pe===void 0&&We===void 0||hR(c,d,tt,Pe,v,We);return}}for(var Me in g)Pe=g[Me],g.hasOwnProperty(Me)&&Pe!=null&&!v.hasOwnProperty(Me)&&os(c,d,Me,null,v,Pe);for(ut in v)Pe=v[ut],We=g[ut],!v.hasOwnProperty(ut)||Pe===We||Pe==null&&We==null||os(c,d,ut,Pe,v,We)}function AL(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function rq(){if(typeof performance.getEntriesByType=="function"){for(var c=0,d=0,g=performance.getEntriesByType("resource"),v=0;v<g.length;v++){var E=g[v],R=E.transferSize,z=E.initiatorType,Y=E.duration;if(R&&Y&&AL(z)){for(z=0,Y=E.responseEnd,v+=1;v<g.length;v++){var he=g[v],Ue=he.startTime;if(Ue>Y)break;var tt=he.transferSize,ut=he.initiatorType;tt&&AL(ut)&&(he=he.responseEnd,z+=tt*(he<Y?1:(Y-Ue)/(he-Ue)))}if(--v,d+=8*(R+z)/(E.duration/1e3),c++,10<c)break}}if(0<c)return d/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var pR=null,mR=null;function p1(c){return c.nodeType===9?c:c.ownerDocument}function EL(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ML(c,d){if(c===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&d==="foreignObject"?0:c}function gR(c,d){return c==="textarea"||c==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var xR=null;function aq(){var c=window.event;return c&&c.type==="popstate"?c===xR?!1:(xR=c,!0):(xR=null,!1)}var CL=typeof setTimeout=="function"?setTimeout:void 0,oq=typeof clearTimeout=="function"?clearTimeout:void 0,RL=typeof Promise=="function"?Promise:void 0,lq=typeof queueMicrotask=="function"?queueMicrotask:typeof RL<"u"?function(c){return RL.resolve(null).then(c).catch(cq)}:CL;function cq(c){setTimeout(function(){throw c})}function Ph(c){return c==="head"}function wL(c,d){var g=d,v=0;do{var E=g.nextSibling;if(c.removeChild(g),E&&E.nodeType===8)if(g=E.data,g==="/$"||g==="/&"){if(v===0){c.removeChild(E),Bx(d);return}v--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")v++;else if(g==="html")Q_(c.ownerDocument.documentElement);else if(g==="head"){g=c.ownerDocument.head,Q_(g);for(var R=g.firstChild;R;){var z=R.nextSibling,Y=R.nodeName;R[vt]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&R.rel.toLowerCase()==="stylesheet"||g.removeChild(R),R=z}}else g==="body"&&Q_(c.ownerDocument.body);g=E}while(g);Bx(d)}function NL(c,d){var g=c;c=0;do{var v=g.nextSibling;if(g.nodeType===1?d?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(d?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),v&&v.nodeType===8)if(g=v.data,g==="/$"){if(c===0)break;c--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||c++;g=v}while(g)}function yR(c){var d=c.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var g=d;switch(d=d.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":yR(g),mt(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}c.removeChild(g)}}function uq(c,d,g,v){for(;c.nodeType===1;){var E=g;if(c.nodeName.toLowerCase()!==d.toLowerCase()){if(!v&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(v){if(!c[vt])switch(d){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(R=c.getAttribute("rel"),R==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(R!==E.rel||c.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||c.getAttribute("title")!==(E.title==null?null:E.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(R=c.getAttribute("src"),(R!==(E.src==null?null:E.src)||c.getAttribute("type")!==(E.type==null?null:E.type)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&R&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(d==="input"&&c.type==="hidden"){var R=E.name==null?null:""+E.name;if(E.type==="hidden"&&c.getAttribute("name")===R)return c}else return c;if(c=tc(c.nextSibling),c===null)break}return null}function dq(c,d,g){if(d==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!g||(c=tc(c.nextSibling),c===null))return null;return c}function BL(c,d){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!d||(c=tc(c.nextSibling),c===null))return null;return c}function vR(c){return c.data==="$?"||c.data==="$~"}function _R(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function fq(c,d){var g=c.ownerDocument;if(c.data==="$~")c._reactRetry=d;else if(c.data!=="$?"||g.readyState!=="loading")d();else{var v=function(){d(),g.removeEventListener("DOMContentLoaded",v)};g.addEventListener("DOMContentLoaded",v),c._reactRetry=v}}function tc(c){for(;c!=null;c=c.nextSibling){var d=c.nodeType;if(d===1||d===3)break;if(d===8){if(d=c.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return c}var bR=null;function DL(c){c=c.nextSibling;for(var d=0;c;){if(c.nodeType===8){var g=c.data;if(g==="/$"||g==="/&"){if(d===0)return tc(c.nextSibling);d--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||d++}c=c.nextSibling}return null}function OL(c){c=c.previousSibling;for(var d=0;c;){if(c.nodeType===8){var g=c.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(d===0)return c;d--}else g!=="/$"&&g!=="/&"||d++}c=c.previousSibling}return null}function UL(c,d,g){switch(d=p1(g),c){case"html":if(c=d.documentElement,!c)throw Error(n(452));return c;case"head":if(c=d.head,!c)throw Error(n(453));return c;case"body":if(c=d.body,!c)throw Error(n(454));return c;default:throw Error(n(451))}}function Q_(c){for(var d=c.attributes;d.length;)c.removeAttributeNode(d[0]);mt(c)}var nc=new Map,LL=new Set;function m1(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var uf=ne.d;ne.d={f:hq,r:pq,D:mq,C:gq,L:xq,m:yq,X:_q,S:vq,M:bq};function hq(){var c=uf.f(),d=$();return c||d}function pq(c){var d=k(c);d!==null&&d.tag===5&&d.type==="form"?H_(d):uf.r(c)}var Rx=typeof document>"u"?null:document;function IL(c,d,g){var v=Rx;if(v&&typeof d=="string"&&d){var E=xn(d);E='link[rel="'+c+'"][href="'+E+'"]',typeof g=="string"&&(E+='[crossorigin="'+g+'"]'),LL.has(E)||(LL.add(E),c={rel:c,crossOrigin:g,href:d},v.querySelector(E)===null&&(d=v.createElement("link"),ya(d,"link",c),Ae(d),v.head.appendChild(d)))}}function mq(c){uf.D(c),IL("dns-prefetch",c,null)}function gq(c,d){uf.C(c,d),IL("preconnect",c,d)}function xq(c,d,g){uf.L(c,d,g);var v=Rx;if(v&&c&&d){var E='link[rel="preload"][as="'+xn(d)+'"]';d==="image"&&g&&g.imageSrcSet?(E+='[imagesrcset="'+xn(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(E+='[imagesizes="'+xn(g.imageSizes)+'"]')):E+='[href="'+xn(c)+'"]';var R=E;switch(d){case"style":R=wx(c);break;case"script":R=Nx(c)}nc.has(R)||(c=p({rel:"preload",href:d==="image"&&g&&g.imageSrcSet?void 0:c,as:d},g),nc.set(R,c),v.querySelector(E)!==null||d==="style"&&v.querySelector(eb(R))||d==="script"&&v.querySelector(tb(R))||(d=v.createElement("link"),ya(d,"link",c),Ae(d),v.head.appendChild(d)))}}function yq(c,d){uf.m(c,d);var g=Rx;if(g&&c){var v=d&&typeof d.as=="string"?d.as:"script",E='link[rel="modulepreload"][as="'+xn(v)+'"][href="'+xn(c)+'"]',R=E;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=Nx(c)}if(!nc.has(R)&&(c=p({rel:"modulepreload",href:c},d),nc.set(R,c),g.querySelector(E)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(tb(R)))return}v=g.createElement("link"),ya(v,"link",c),Ae(v),g.head.appendChild(v)}}}function vq(c,d,g){uf.S(c,d,g);var v=Rx;if(v&&c){var E=ce(v).hoistableStyles,R=wx(c);d=d||"default";var z=E.get(R);if(!z){var Y={loading:0,preload:null};if(z=v.querySelector(eb(R)))Y.loading=5;else{c=p({rel:"stylesheet",href:c,"data-precedence":d},g),(g=nc.get(R))&&SR(c,g);var he=z=v.createElement("link");Ae(he),ya(he,"link",c),he._p=new Promise(function(Ue,tt){he.onload=Ue,he.onerror=tt}),he.addEventListener("load",function(){Y.loading|=1}),he.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,g1(z,d,v)}z={type:"stylesheet",instance:z,count:1,state:Y},E.set(R,z)}}}function _q(c,d){uf.X(c,d);var g=Rx;if(g&&c){var v=ce(g).hoistableScripts,E=Nx(c),R=v.get(E);R||(R=g.querySelector(tb(E)),R||(c=p({src:c,async:!0},d),(d=nc.get(E))&&TR(c,d),R=g.createElement("script"),Ae(R),ya(R,"link",c),g.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},v.set(E,R))}}function bq(c,d){uf.M(c,d);var g=Rx;if(g&&c){var v=ce(g).hoistableScripts,E=Nx(c),R=v.get(E);R||(R=g.querySelector(tb(E)),R||(c=p({src:c,async:!0,type:"module"},d),(d=nc.get(E))&&TR(c,d),R=g.createElement("script"),Ae(R),ya(R,"link",c),g.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},v.set(E,R))}}function PL(c,d,g,v){var E=(E=Se.current)?m1(E):null;if(!E)throw Error(n(446));switch(c){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(d=wx(g.href),g=ce(E).hoistableStyles,v=g.get(d),v||(v={type:"style",instance:null,count:0,state:null},g.set(d,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){c=wx(g.href);var R=ce(E).hoistableStyles,z=R.get(c);if(z||(E=E.ownerDocument||E,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(c,z),(R=E.querySelector(eb(c)))&&!R._p&&(z.instance=R,z.state.loading=5),nc.has(c)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},nc.set(c,g),R||Sq(E,c,g,z.state))),d&&v===null)throw Error(n(528,""));return z}if(d&&v!==null)throw Error(n(529,""));return null;case"script":return d=g.async,g=g.src,typeof g=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Nx(g),g=ce(E).hoistableScripts,v=g.get(d),v||(v={type:"script",instance:null,count:0,state:null},g.set(d,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,c))}}function wx(c){return'href="'+xn(c)+'"'}function eb(c){return'link[rel="stylesheet"]['+c+"]"}function FL(c){return p({},c,{"data-precedence":c.precedence,precedence:null})}function Sq(c,d,g,v){c.querySelector('link[rel="preload"][as="style"]['+d+"]")?v.loading=1:(d=c.createElement("link"),v.preload=d,d.addEventListener("load",function(){return v.loading|=1}),d.addEventListener("error",function(){return v.loading|=2}),ya(d,"link",g),Ae(d),c.head.appendChild(d))}function Nx(c){return'[src="'+xn(c)+'"]'}function tb(c){return"script[async]"+c}function GL(c,d,g){if(d.count++,d.instance===null)switch(d.type){case"style":var v=c.querySelector('style[data-href~="'+xn(g.href)+'"]');if(v)return d.instance=v,Ae(v),v;var E=p({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return v=(c.ownerDocument||c).createElement("style"),Ae(v),ya(v,"style",E),g1(v,g.precedence,c),d.instance=v;case"stylesheet":E=wx(g.href);var R=c.querySelector(eb(E));if(R)return d.state.loading|=4,d.instance=R,Ae(R),R;v=FL(g),(E=nc.get(E))&&SR(v,E),R=(c.ownerDocument||c).createElement("link"),Ae(R);var z=R;return z._p=new Promise(function(Y,he){z.onload=Y,z.onerror=he}),ya(R,"link",v),d.state.loading|=4,g1(R,g.precedence,c),d.instance=R;case"script":return R=Nx(g.src),(E=c.querySelector(tb(R)))?(d.instance=E,Ae(E),E):(v=g,(E=nc.get(R))&&(v=p({},g),TR(v,E)),c=c.ownerDocument||c,E=c.createElement("script"),Ae(E),ya(E,"link",v),c.head.appendChild(E),d.instance=E);case"void":return null;default:throw Error(n(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(v=d.instance,d.state.loading|=4,g1(v,g.precedence,c));return d.instance}function g1(c,d,g){for(var v=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=v.length?v[v.length-1]:null,R=E,z=0;z<v.length;z++){var Y=v[z];if(Y.dataset.precedence===d)R=Y;else if(R!==E)break}R?R.parentNode.insertBefore(c,R.nextSibling):(d=g.nodeType===9?g.head:g,d.insertBefore(c,d.firstChild))}function SR(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.title==null&&(c.title=d.title)}function TR(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.integrity==null&&(c.integrity=d.integrity)}var x1=null;function zL(c,d,g){if(x1===null){var v=new Map,E=x1=new Map;E.set(g,v)}else E=x1,v=E.get(g),v||(v=new Map,E.set(g,v));if(v.has(c))return v;for(v.set(c,null),g=g.getElementsByTagName(c),E=0;E<g.length;E++){var R=g[E];if(!(R[vt]||R[Wn]||c==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var z=R.getAttribute(d)||"";z=c+z;var Y=v.get(z);Y?Y.push(R):v.set(z,[R])}}return v}function VL(c,d,g){c=c.ownerDocument||c,c.head.insertBefore(g,d==="title"?c.querySelector("head > title"):null)}function Tq(c,d,g){if(g===1||d.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return c=d.disabled,typeof d.precedence=="string"&&c==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function HL(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function Aq(c,d,g,v){if(g.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var E=wx(v.href),R=d.querySelector(eb(E));if(R){d=R._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(c.count++,c=y1.bind(c),d.then(c,c)),g.state.loading|=4,g.instance=R,Ae(R);return}R=d.ownerDocument||d,v=FL(v),(E=nc.get(E))&&SR(v,E),R=R.createElement("link"),Ae(R);var z=R;z._p=new Promise(function(Y,he){z.onload=Y,z.onerror=he}),ya(R,"link",v),g.instance=R}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(g,d),(d=g.state.preload)&&(g.state.loading&3)===0&&(c.count++,g=y1.bind(c),d.addEventListener("load",g),d.addEventListener("error",g))}}var AR=0;function Eq(c,d){return c.stylesheets&&c.count===0&&_1(c,c.stylesheets),0<c.count||0<c.imgCount?function(g){var v=setTimeout(function(){if(c.stylesheets&&_1(c,c.stylesheets),c.unsuspend){var R=c.unsuspend;c.unsuspend=null,R()}},6e4+d);0<c.imgBytes&&AR===0&&(AR=62500*rq());var E=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&_1(c,c.stylesheets),c.unsuspend)){var R=c.unsuspend;c.unsuspend=null,R()}},(c.imgBytes>AR?50:800)+d);return c.unsuspend=g,function(){c.unsuspend=null,clearTimeout(v),clearTimeout(E)}}:null}function y1(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_1(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var v1=null;function _1(c,d){c.stylesheets=null,c.unsuspend!==null&&(c.count++,v1=new Map,d.forEach(Mq,c),v1=null,y1.call(c))}function Mq(c,d){if(!(d.state.loading&4)){var g=v1.get(c);if(g)var v=g.get(null);else{g=new Map,v1.set(c,g);for(var E=c.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<E.length;R++){var z=E[R];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(g.set(z.dataset.precedence,z),v=z)}v&&g.set(null,v)}E=d.instance,z=E.getAttribute("data-precedence"),R=g.get(z)||v,R===v&&g.set(null,E),g.set(z,E),this.count++,v=y1.bind(this),E.addEventListener("load",v),E.addEventListener("error",v),R?R.parentNode.insertBefore(E,R.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(E,c.firstChild)),d.state.loading|=4}}var nb={$$typeof:w,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function Cq(c,d,g,v,E,R,z,Y,he){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ni(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ni(0),this.hiddenUpdates=ni(null),this.identifierPrefix=v,this.onUncaughtError=E,this.onCaughtError=R,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function kL(c,d,g,v,E,R,z,Y,he,Ue,tt,ut){return c=new Cq(c,d,g,z,he,Ue,tt,ut,Y),d=1,R===!0&&(d|=24),R=fa(3,null,null,d),c.current=R,R.stateNode=c,d=u_(),d.refCount++,c.pooledCache=d,d.refCount++,R.memoizedState={element:v,isDehydrated:g,cache:d},g_(R),c}function WL(c){return c?(c=Du,c):Du}function XL(c,d,g,v,E,R){E=WL(E),v.context===null?v.context=E:v.pendingContext=E,v=ql(d),v.payload={element:g},R=R===void 0?null:R,R!==null&&(v.callback=R),g=Pc(c,v,d),g!==null&&(m(g,c,d),zu(g,c,d))}function qL(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var g=c.retryLane;c.retryLane=g!==0&&g<d?g:d}}function ER(c,d){qL(c,d),(c=c.alternate)&&qL(c,d)}function YL(c){if(c.tag===13||c.tag===31){var d=Bu(c,67108864);d!==null&&m(d,c,67108864),ER(c,67108864)}}function jL(c){if(c.tag===13||c.tag===31){var d=xa();d=$s(d);var g=Bu(c,d);g!==null&&m(g,c,d),ER(c,d)}}var b1=!0;function Rq(c,d,g,v){var E=W.T;W.T=null;var R=ne.p;try{ne.p=2,MR(c,d,g,v)}finally{ne.p=R,W.T=E}}function wq(c,d,g,v){var E=W.T;W.T=null;var R=ne.p;try{ne.p=8,MR(c,d,g,v)}finally{ne.p=R,W.T=E}}function MR(c,d,g,v){if(b1){var E=CR(v);if(E===null)fR(c,d,v,S1,g),KL(c,v);else if(Bq(E,c,d,g,v))v.stopPropagation();else if(KL(c,v),d&4&&-1<Nq.indexOf(c)){for(;E!==null;){var R=k(E);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var z=pt(R.pendingLanes);if(z!==0){var Y=R;for(Y.pendingLanes|=2,Y.entangledLanes|=2;z;){var he=1<<31-zt(z);Y.entanglements[1]|=he,z&=~he}$u(R),(yi&6)===0&&(co=V()+500,K_(0))}}break;case 31:case 13:Y=Bu(R,2),Y!==null&&m(Y,R,2),$(),ER(R,2)}if(R=CR(v),R===null&&fR(c,d,v,S1,g),R===E)break;E=R}E!==null&&v.stopPropagation()}else fR(c,d,v,null,g)}}function CR(c){return c=C0(c),RR(c)}var S1=null;function RR(c){if(S1=null,c=xt(c),c!==null){var d=r(c);if(d===null)c=null;else{var g=d.tag;if(g===13){if(c=a(d),c!==null)return c;c=null}else if(g===31){if(c=o(d),c!==null)return c;c=null}else if(g===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;c=null}else d!==c&&(c=null)}}return S1=c,null}function $L(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Te()){case Ge:return 2;case $e:return 8;case Ve:case Xt:return 32;case Ot:return 268435456;default:return 32}default:return 32}}var wR=!1,Fh=null,Gh=null,zh=null,ib=new Map,sb=new Map,Vh=[],Nq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function KL(c,d){switch(c){case"focusin":case"focusout":Fh=null;break;case"dragenter":case"dragleave":Gh=null;break;case"mouseover":case"mouseout":zh=null;break;case"pointerover":case"pointerout":ib.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":sb.delete(d.pointerId)}}function rb(c,d,g,v,E,R){return c===null||c.nativeEvent!==R?(c={blockedOn:d,domEventName:g,eventSystemFlags:v,nativeEvent:R,targetContainers:[E]},d!==null&&(d=k(d),d!==null&&YL(d)),c):(c.eventSystemFlags|=v,d=c.targetContainers,E!==null&&d.indexOf(E)===-1&&d.push(E),c)}function Bq(c,d,g,v,E){switch(d){case"focusin":return Fh=rb(Fh,c,d,g,v,E),!0;case"dragenter":return Gh=rb(Gh,c,d,g,v,E),!0;case"mouseover":return zh=rb(zh,c,d,g,v,E),!0;case"pointerover":var R=E.pointerId;return ib.set(R,rb(ib.get(R)||null,c,d,g,v,E)),!0;case"gotpointercapture":return R=E.pointerId,sb.set(R,rb(sb.get(R)||null,c,d,g,v,E)),!0}return!1}function JL(c){var d=xt(c.target);if(d!==null){var g=r(d);if(g!==null){if(d=g.tag,d===13){if(d=a(g),d!==null){c.blockedOn=d,wn(c.priority,function(){jL(g)});return}}else if(d===31){if(d=o(g),d!==null){c.blockedOn=d,wn(c.priority,function(){jL(g)});return}}else if(d===3&&g.stateNode.current.memoizedState.isDehydrated){c.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}c.blockedOn=null}function T1(c){if(c.blockedOn!==null)return!1;for(var d=c.targetContainers;0<d.length;){var g=CR(c.nativeEvent);if(g===null){g=c.nativeEvent;var v=new g.constructor(g.type,g);dm=v,g.target.dispatchEvent(v),dm=null}else return d=k(g),d!==null&&YL(d),c.blockedOn=g,!1;d.shift()}return!0}function ZL(c,d,g){T1(c)&&g.delete(d)}function Dq(){wR=!1,Fh!==null&&T1(Fh)&&(Fh=null),Gh!==null&&T1(Gh)&&(Gh=null),zh!==null&&T1(zh)&&(zh=null),ib.forEach(ZL),sb.forEach(ZL)}function A1(c,d){c.blockedOn===d&&(c.blockedOn=null,wR||(wR=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Dq)))}var E1=null;function QL(c){E1!==c&&(E1=c,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){E1===c&&(E1=null);for(var d=0;d<c.length;d+=3){var g=c[d],v=c[d+1],E=c[d+2];if(typeof v!="function"){if(RR(v||g)===null)continue;break}var R=k(g);R!==null&&(c.splice(d,3),d-=3,V_(R,{pending:!0,data:E,method:g.method,action:v},v,E))}}))}function Bx(c){function d(he){return A1(he,c)}Fh!==null&&A1(Fh,c),Gh!==null&&A1(Gh,c),zh!==null&&A1(zh,c),ib.forEach(d),sb.forEach(d);for(var g=0;g<Vh.length;g++){var v=Vh[g];v.blockedOn===c&&(v.blockedOn=null)}for(;0<Vh.length&&(g=Vh[0],g.blockedOn===null);)JL(g),g.blockedOn===null&&Vh.shift();if(g=(c.ownerDocument||c).$$reactFormReplay,g!=null)for(v=0;v<g.length;v+=3){var E=g[v],R=g[v+1],z=E[H]||null;if(typeof R=="function")z||QL(g);else if(z){var Y=null;if(R&&R.hasAttribute("formAction")){if(E=R,z=R[H]||null)Y=z.formAction;else if(RR(E)!==null)continue}else Y=z.action;typeof Y=="function"?g[v+1]=Y:(g.splice(v,3),v-=3),QL(g)}}}function eI(){function c(R){R.canIntercept&&R.info==="react-transition"&&R.intercept({handler:function(){return new Promise(function(z){return E=z})},focusReset:"manual",scroll:"manual"})}function d(){E!==null&&(E(),E=null),v||setTimeout(g,20)}function g(){if(!v&&!navigation.transition){var R=navigation.currentEntry;R&&R.url!=null&&navigation.navigate(R.url,{state:R.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var v=!1,E=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(g,100),function(){v=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),E!==null&&(E(),E=null)}}}function NR(c){this._internalRoot=c}M1.prototype.render=NR.prototype.render=function(c){var d=this._internalRoot;if(d===null)throw Error(n(409));var g=d.current,v=xa();XL(g,v,c,d,null,null)},M1.prototype.unmount=NR.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var d=c.containerInfo;XL(c.current,2,null,c,null,null),$(),d[J]=null}};function M1(c){this._internalRoot=c}M1.prototype.unstable_scheduleHydration=function(c){if(c){var d=xr();c={blockedOn:null,target:c,priority:d};for(var g=0;g<Vh.length&&d!==0&&d<Vh[g].priority;g++);Vh.splice(g,0,c),g===0&&JL(c)}};var tI=e.version;if(tI!=="19.2.0")throw Error(n(527,tI,"19.2.0"));ne.findDOMNode=function(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(n(188)):(c=Object.keys(c).join(","),Error(n(268,c)));return c=u(d),c=c!==null?f(c):null,c=c===null?null:c.stateNode,c};var Oq={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var C1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!C1.isDisabled&&C1.supportsFiber)try{et=C1.inject(Oq),st=C1}catch{}}return ob.createRoot=function(c,d){if(!s(c))throw Error(n(299));var g=!1,v="",E=X_,R=r1,z=px;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(v=d.identifierPrefix),d.onUncaughtError!==void 0&&(E=d.onUncaughtError),d.onCaughtError!==void 0&&(R=d.onCaughtError),d.onRecoverableError!==void 0&&(z=d.onRecoverableError)),d=kL(c,1,!1,null,null,g,v,null,E,R,z,eI),c[J]=d.current,dR(c),new NR(d)},ob.hydrateRoot=function(c,d,g){if(!s(c))throw Error(n(299));var v=!1,E="",R=X_,z=r1,Y=px,he=null;return g!=null&&(g.unstable_strictMode===!0&&(v=!0),g.identifierPrefix!==void 0&&(E=g.identifierPrefix),g.onUncaughtError!==void 0&&(R=g.onUncaughtError),g.onCaughtError!==void 0&&(z=g.onCaughtError),g.onRecoverableError!==void 0&&(Y=g.onRecoverableError),g.formState!==void 0&&(he=g.formState)),d=kL(c,1,!0,d,g??null,v,E,he,R,z,Y,eI),d.context=WL(null),g=d.current,v=xa(),v=$s(v),E=ql(v),E.callback=null,Pc(g,E,v),g=v,d.current.lanes=g,rr(d,g),$u(d),c[J]=d.current,dR(c),new M1(d)},ob.version="19.2.0",ob}var dI;function kq(){if(dI)return OR.exports;dI=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),OR.exports=Hq(),OR.exports}var xB=kq();const Wq=$p(xB);const $f="181",Ez={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Mz={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},rC=0,vS=1,aC=2,Cz=3,oC=0,ev=1,My=2,Fa=3,Ha=0,Yi=1,hr=2,ca=0,Mo=1,mp=2,gp=3,xp=4,fp=5,aa=100,jS=101,$S=102,lC=103,cC=104,nu=200,KS=201,JS=202,ZS=203,Vg=204,Hg=205,QS=206,eT=207,tT=208,nT=209,iT=210,yB=211,vB=212,_B=213,bB=214,kg=0,Wg=1,Xg=2,Sd=3,qg=4,Yg=5,jg=6,$g=7,h0=0,uC=1,dC=2,zr=0,fC=1,hC=2,pC=3,sT=4,SB=5,mC=6,gC=7,pM="attached",TB="detached",Td=300,Do=301,Rl=302,Ad=303,zf=304,Ed=306,wl=1e3,ts=1001,lu=1002,es=1003,p0=1004,Rz=1004,Sl=1005,wz=1005,Dn=1006,ud=1007,Nz=1007,Cr=1008,_S=1008,ss=1009,dd=1010,fd=1011,Tl=1012,fr=1013,Xi=1014,Ti=1015,Ai=1016,tv=1017,nv=1018,Co=1020,iv=35902,sv=35899,rT=1021,m0=1022,Oi=1023,Ro=1026,wo=1027,Kf=1028,Jf=1029,Al=1030,Kp=1031,AB=1032,Jp=1033,hd=33776,pd=33777,md=33778,gd=33779,Kg=35840,Jg=35841,Zg=35842,Qg=35843,yp=36196,vp=37492,_p=37496,bp=37808,Sp=37809,Tp=37810,Ap=37811,Ep=37812,Mp=37813,Cp=37814,Rp=37815,wp=37816,Np=37817,Bp=37818,Dp=37819,Op=37820,Up=37821,Lp=36492,bS=36494,SS=36495,Ip=36283,Pp=36284,Fp=36285,Gp=36286,EB=2200,MB=2201,CB=2202,e0=2300,t0=2301,tS=2302,sp=2400,rp=2401,Gy=2402,aT=2500,xC=2501,RB=0,yC=1,TS=2,wB=3200,NB=3201,Bz=3202,Dz=3203,cu=0,vC=1,Ga="",Mr="srgb",Qo="srgb-linear",zp="linear",qt="srgb",BB=0,Tf=7680,DB=7681,OB=7682,UB=7683,LB=34055,IB=34056,PB=5386,FB=512,GB=513,zB=514,VB=515,HB=516,kB=517,WB=518,AS=519,oT=512,rv=513,lT=514,av=515,cT=516,uT=517,dT=518,fT=519,n0=35044,ap=35048,Oz=35040,Uz=35045,Lz=35049,Iz=35041,Pz=35046,Fz=35050,Gz=35042,zz="100",mM="300 es",oa=2e3,Nl=2001,dc={COMPUTE:"compute",RENDER:"render"},Vz={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Hz={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function XB(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const Xq={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function by(i,e){return new Xq[i](e)}function ES(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function _C(){const i=ES("canvas");return i.style.display="block",i}const fI={};let Vp=null;function kz(i){Vp=i}function Wz(){return Vp}function i0(...i){const e="THREE."+i.shift();Vp?Vp("log",e,...i):console.log(e,...i)}function De(...i){const e="THREE."+i.shift();Vp?Vp("warn",e,...i):console.warn(e,...i)}function nt(...i){const e="THREE."+i.shift();Vp?Vp("error",e,...i):console.error(e,...i)}function qi(...i){const e=i.join(" ");e in fI||(fI[e]=!0,De(...i))}function qq(i,e,t){return new Promise(function(n,s){function r(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:s();break;case i.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}let Oo=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const s=n[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}};const La=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let hI=1234567;const Og=Math.PI/180,s0=180/Math.PI;function El(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(La[i&255]+La[i>>8&255]+La[i>>16&255]+La[i>>24&255]+"-"+La[e&255]+La[e>>8&255]+"-"+La[e>>16&15|64]+La[e>>24&255]+"-"+La[t&63|128]+La[t>>8&255]+"-"+La[t>>16&255]+La[t>>24&255]+La[n&255]+La[n>>8&255]+La[n>>16&255]+La[n>>24&255]).toLowerCase()}function Pn(i,e,t){return Math.max(e,Math.min(t,i))}function qB(i,e){return(i%e+e)%e}function Yq(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function jq(i,e,t){return i!==e?(t-i)/(e-i):0}function nS(i,e,t){return(1-t)*i+t*e}function $q(i,e,t,n){return nS(i,e,1-Math.exp(-t*n))}function Kq(i,e=1){return e-Math.abs(qB(i,e*2)-e)}function Jq(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function Zq(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function Qq(i,e){return i+Math.floor(Math.random()*(e-i+1))}function eY(i,e){return i+Math.random()*(e-i)}function tY(i){return i*(.5-Math.random())}function nY(i){i!==void 0&&(hI=i);let e=hI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function iY(i){return i*Og}function sY(i){return i*s0}function rY(i){return(i&i-1)===0&&i!==0}function aY(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function oY(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function lY(i,e,t,n,s){const r=Math.cos,a=Math.sin,o=r(t/2),l=a(t/2),u=r((e+n)/2),f=a((e+n)/2),p=r((e-n)/2),x=a((e-n)/2),y=r((n-e)/2),_=a((n-e)/2);switch(s){case"XYX":i.set(o*f,l*p,l*x,o*u);break;case"YZY":i.set(l*x,o*f,l*p,o*u);break;case"ZXZ":i.set(l*p,l*x,o*f,o*u);break;case"XZX":i.set(o*f,l*_,l*y,o*u);break;case"YXY":i.set(l*y,o*f,l*_,o*u);break;case"ZYZ":i.set(l*_,l*y,o*f,o*u);break;default:De("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function _o(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Kn(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const ov={DEG2RAD:Og,RAD2DEG:s0,generateUUID:El,clamp:Pn,euclideanModulo:qB,mapLinear:Yq,inverseLerp:jq,lerp:nS,damp:$q,pingpong:Kq,smoothstep:Jq,smootherstep:Zq,randInt:Qq,randFloat:eY,randFloatSpread:tY,seededRandom:nY,degToRad:iY,radToDeg:sY,isPowerOfTwo:rY,ceilPowerOfTwo:aY,floorPowerOfTwo:oY,setQuaternionFromProperEuler:lY,normalize:Kn,denormalize:_o};class Ze{constructor(e=0,t=0){Ze.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Pn(this.x,e.x,t.x),this.y=Pn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Pn(this.x,e,t),this.y=Pn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Pn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*s+e.x,this.y=r*s+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wr{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,a,o){let l=n[s+0],u=n[s+1],f=n[s+2],p=n[s+3],x=r[a+0],y=r[a+1],_=r[a+2],T=r[a+3];if(o<=0){e[t+0]=l,e[t+1]=u,e[t+2]=f,e[t+3]=p;return}if(o>=1){e[t+0]=x,e[t+1]=y,e[t+2]=_,e[t+3]=T;return}if(p!==T||l!==x||u!==y||f!==_){let A=l*x+u*y+f*_+p*T;A<0&&(x=-x,y=-y,_=-_,T=-T,A=-A);let S=1-o;if(A<.9995){const C=Math.acos(A),w=Math.sin(C);S=Math.sin(S*C)/w,o=Math.sin(o*C)/w,l=l*S+x*o,u=u*S+y*o,f=f*S+_*o,p=p*S+T*o}else{l=l*S+x*o,u=u*S+y*o,f=f*S+_*o,p=p*S+T*o;const C=1/Math.sqrt(l*l+u*u+f*f+p*p);l*=C,u*=C,f*=C,p*=C}}e[t]=l,e[t+1]=u,e[t+2]=f,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,s,r,a){const o=n[s],l=n[s+1],u=n[s+2],f=n[s+3],p=r[a],x=r[a+1],y=r[a+2],_=r[a+3];return e[t]=o*_+f*p+l*y-u*x,e[t+1]=l*_+f*x+u*p-o*y,e[t+2]=u*_+f*y+o*x-l*p,e[t+3]=f*_-o*p-l*x-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,u=o(n/2),f=o(s/2),p=o(r/2),x=l(n/2),y=l(s/2),_=l(r/2);switch(a){case"XYZ":this._x=x*f*p+u*y*_,this._y=u*y*p-x*f*_,this._z=u*f*_+x*y*p,this._w=u*f*p-x*y*_;break;case"YXZ":this._x=x*f*p+u*y*_,this._y=u*y*p-x*f*_,this._z=u*f*_-x*y*p,this._w=u*f*p+x*y*_;break;case"ZXY":this._x=x*f*p-u*y*_,this._y=u*y*p+x*f*_,this._z=u*f*_+x*y*p,this._w=u*f*p-x*y*_;break;case"ZYX":this._x=x*f*p-u*y*_,this._y=u*y*p+x*f*_,this._z=u*f*_-x*y*p,this._w=u*f*p+x*y*_;break;case"YZX":this._x=x*f*p+u*y*_,this._y=u*y*p+x*f*_,this._z=u*f*_-x*y*p,this._w=u*f*p-x*y*_;break;case"XZY":this._x=x*f*p-u*y*_,this._y=u*y*p-x*f*_,this._z=u*f*_+x*y*p,this._w=u*f*p+x*y*_;break;default:De("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],a=t[1],o=t[5],l=t[9],u=t[2],f=t[6],p=t[10],x=n+o+p;if(x>0){const y=.5/Math.sqrt(x+1);this._w=.25/y,this._x=(f-l)*y,this._y=(r-u)*y,this._z=(a-s)*y}else if(n>o&&n>p){const y=2*Math.sqrt(1+n-o-p);this._w=(f-l)/y,this._x=.25*y,this._y=(s+a)/y,this._z=(r+u)/y}else if(o>p){const y=2*Math.sqrt(1+o-n-p);this._w=(r-u)/y,this._x=(s+a)/y,this._y=.25*y,this._z=(l+f)/y}else{const y=2*Math.sqrt(1+p-n-o);this._w=(a-s)/y,this._x=(r+u)/y,this._y=(l+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Pn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,a=e._w,o=t._x,l=t._y,u=t._z,f=t._w;return this._x=n*f+a*o+s*u-r*l,this._y=s*f+a*l+r*o-n*u,this._z=r*f+a*u+n*l-s*o,this._w=a*f-n*o-s*l-r*u,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,s=e._y,r=e._z,a=e._w,o=this.dot(e);o<0&&(n=-n,s=-s,r=-r,a=-a,o=-o);let l=1-t;if(o<.9995){const u=Math.acos(o),f=Math.sin(u);l=Math.sin(l*u)/f,t=Math.sin(t*u)/f,this._x=this._x*l+n*t,this._y=this._y*l+s*t,this._z=this._z*l+r*t,this._w=this._w*l+a*t,this._onChangeCallback()}else this._x=this._x*l+n*t,this._y=this._y*l+s*t,this._z=this._z*l+r*t,this._w=this._w*l+a*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Q{constructor(e=0,t=0,n=0){Q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(pI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(pI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z,l=e.w,u=2*(a*s-o*n),f=2*(o*t-r*s),p=2*(r*n-a*t);return this.x=t+l*u+a*p-o*f,this.y=n+l*f+o*u-r*p,this.z=s+l*p+r*f-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Pn(this.x,e.x,t.x),this.y=Pn(this.y,e.y,t.y),this.z=Pn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Pn(this.x,e,t),this.y=Pn(this.y,e,t),this.z=Pn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-r*o,this.y=r*a-n*l,this.z=n*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return PR.copy(this).projectOnVector(e),this.sub(PR)}reflect(e){return this.sub(PR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Pn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const PR=new Q,pI=new wr;class Ln{constructor(e,t,n,s,r,a,o,l,u){Ln.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,u)}set(e,t,n,s,r,a,o,l,u){const f=this.elements;return f[0]=e,f[1]=s,f[2]=o,f[3]=t,f[4]=r,f[5]=l,f[6]=n,f[7]=a,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[3],l=n[6],u=n[1],f=n[4],p=n[7],x=n[2],y=n[5],_=n[8],T=s[0],A=s[3],S=s[6],C=s[1],w=s[4],B=s[7],L=s[2],D=s[5],O=s[8];return r[0]=a*T+o*C+l*L,r[3]=a*A+o*w+l*D,r[6]=a*S+o*B+l*O,r[1]=u*T+f*C+p*L,r[4]=u*A+f*w+p*D,r[7]=u*S+f*B+p*O,r[2]=x*T+y*C+_*L,r[5]=x*A+y*w+_*D,r[8]=x*S+y*B+_*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],f=e[8];return t*a*f-t*o*u-n*r*f+n*o*l+s*r*u-s*a*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],f=e[8],p=f*a-o*u,x=o*l-f*r,y=u*r-a*l,_=t*p+n*x+s*y;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const T=1/_;return e[0]=p*T,e[1]=(s*u-f*n)*T,e[2]=(o*n-s*a)*T,e[3]=x*T,e[4]=(f*t-s*l)*T,e[5]=(s*r-o*t)*T,e[6]=y*T,e[7]=(n*l-u*t)*T,e[8]=(a*t-n*r)*T,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,a,o){const l=Math.cos(r),u=Math.sin(r);return this.set(n*l,n*u,-n*(l*a+u*o)+a+e,-s*u,s*l,-s*(-u*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(FR.makeScale(e,t)),this}rotate(e){return this.premultiply(FR.makeRotation(-e)),this}translate(e,t){return this.premultiply(FR.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const FR=new Ln,mI=new Ln().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),gI=new Ln().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function cY(){const i={enabled:!0,workingColorSpace:Qo,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===qt&&(s.r=Of(s.r),s.g=Of(s.g),s.b=Of(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===qt&&(s.r=Cy(s.r),s.g=Cy(s.g),s.b=Cy(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Ga?zp:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return qi("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return qi("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(s,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[Qo]:{primaries:e,whitePoint:n,transfer:zp,toXYZ:mI,fromXYZ:gI,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Mr},outputColorSpaceConfig:{drawingBufferColorSpace:Mr}},[Mr]:{primaries:e,whitePoint:n,transfer:qt,toXYZ:mI,fromXYZ:gI,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Mr}}}),i}const yn=cY();function Of(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Cy(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let Dx;class YB{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Dx===void 0&&(Dx=ES("canvas")),Dx.width=e.width,Dx.height=e.height;const s=Dx.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),n=Dx}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=ES("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=Of(r[a]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Of(t[n]/255)*255):t[n]=Of(t[n]);return{data:t,width:e.width,height:e.height}}else return De("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let uY=0;class Bf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:uY++}),this.uuid=El(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(GR(s[a].image)):r.push(GR(s[a]))}else r=GR(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function GR(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?YB.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(De("Texture: Unable to serialize Texture."),{})}let dY=0;const zR=new Q;class pi extends Oo{constructor(e=pi.DEFAULT_IMAGE,t=pi.DEFAULT_MAPPING,n=ts,s=ts,r=Dn,a=Cr,o=Oi,l=ss,u=pi.DEFAULT_ANISOTROPY,f=Ga){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dY++}),this.uuid=El(),this.name="",this.source=new Bf(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Ze(0,0),this.repeat=new Ze(1,1),this.center=new Ze(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ln,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(zR).x}get height(){return this.source.getSize(zR).y}get depth(){return this.source.getSize(zR).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){De(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){De(`Texture.setValues(): property '${t}' does not exist.`);continue}s&&n&&s.isVector2&&n.isVector2||s&&n&&s.isVector3&&n.isVector3||s&&n&&s.isMatrix3&&n.isMatrix3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Td)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case wl:e.x=e.x-Math.floor(e.x);break;case ts:e.x=e.x<0?0:1;break;case lu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case wl:e.y=e.y-Math.floor(e.y);break;case ts:e.y=e.y<0?0:1;break;case lu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pi.DEFAULT_IMAGE=null;pi.DEFAULT_MAPPING=Td;pi.DEFAULT_ANISOTROPY=1;class mn{constructor(e=0,t=0,n=0,s=1){mn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*s+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,u=l[0],f=l[4],p=l[8],x=l[1],y=l[5],_=l[9],T=l[2],A=l[6],S=l[10];if(Math.abs(f-x)<.01&&Math.abs(p-T)<.01&&Math.abs(_-A)<.01){if(Math.abs(f+x)<.1&&Math.abs(p+T)<.1&&Math.abs(_+A)<.1&&Math.abs(u+y+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const w=(u+1)/2,B=(y+1)/2,L=(S+1)/2,D=(f+x)/4,O=(p+T)/4,F=(_+A)/4;return w>B&&w>L?w<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(w),s=D/n,r=O/n):B>L?B<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(B),n=D/s,r=F/s):L<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(L),n=O/r,s=F/r),this.set(n,s,r,t),this}let C=Math.sqrt((A-_)*(A-_)+(p-T)*(p-T)+(x-f)*(x-f));return Math.abs(C)<.001&&(C=1),this.x=(A-_)/C,this.y=(p-T)/C,this.z=(x-f)/C,this.w=Math.acos((u+y+S-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Pn(this.x,e.x,t.x),this.y=Pn(this.y,e.y,t.y),this.z=Pn(this.z,e.z,t.z),this.w=Pn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Pn(this.x,e,t),this.y=Pn(this.y,e,t),this.z=Pn(this.z,e,t),this.w=Pn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bc extends Oo{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new mn(0,0,e,t),this.scissorTest=!1,this.viewport=new mn(0,0,e,t);const s={width:e,height:t,depth:n.depth},r=new pi(s);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Dn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n,this.textures[s].isData3DTexture!==!0&&(this.textures[s].isArrayTexture=this.textures[s].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new Bf(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Bl extends bc{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class lv extends pi{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=es,this.minFilter=es,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Xz extends Bl{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new lv(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class hT extends pi{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=es,this.minFilter=es,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class qz extends Bl{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new hT(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class Vr{constructor(e=new Q(1/0,1/0,1/0),t=new Q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint($c.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint($c.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=$c.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,$c):$c.fromBufferAttribute(r,a),$c.applyMatrix4(e.matrixWorld),this.expandByPoint($c);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),R1.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),R1.copy(n.boundingBox)),R1.applyMatrix4(e.matrixWorld),this.union(R1)}const s=e.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,$c),$c.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lb),w1.subVectors(this.max,lb),Ox.subVectors(e.a,lb),Ux.subVectors(e.b,lb),Lx.subVectors(e.c,lb),kh.subVectors(Ux,Ox),Wh.subVectors(Lx,Ux),Qm.subVectors(Ox,Lx);let t=[0,-kh.z,kh.y,0,-Wh.z,Wh.y,0,-Qm.z,Qm.y,kh.z,0,-kh.x,Wh.z,0,-Wh.x,Qm.z,0,-Qm.x,-kh.y,kh.x,0,-Wh.y,Wh.x,0,-Qm.y,Qm.x,0];return!VR(t,Ox,Ux,Lx,w1)||(t=[1,0,0,0,1,0,0,0,1],!VR(t,Ox,Ux,Lx,w1))?!1:(N1.crossVectors(kh,Wh),t=[N1.x,N1.y,N1.z],VR(t,Ox,Ux,Lx,w1))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$c).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize($c).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(df[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),df[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),df[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),df[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),df[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),df[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),df[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),df[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(df),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const df=[new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q],$c=new Q,R1=new Vr,Ox=new Q,Ux=new Q,Lx=new Q,kh=new Q,Wh=new Q,Qm=new Q,lb=new Q,w1=new Q,N1=new Q,eg=new Q;function VR(i,e,t,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){eg.fromArray(i,r);const o=s.x*Math.abs(eg.x)+s.y*Math.abs(eg.y)+s.z*Math.abs(eg.z),l=e.dot(eg),u=t.dot(eg),f=n.dot(eg);if(Math.max(-Math.max(l,u,f),Math.min(l,u,f))>o)return!1}return!0}const fY=new Vr,cb=new Q,HR=new Q;class mr{constructor(e=new Q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):fY.setFromPoints(e).getCenter(n);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;cb.subVectors(e,this.center);const t=cb.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(cb,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(HR.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(cb.copy(e.center).add(HR)),this.expandByPoint(cb.copy(e.center).sub(HR))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ff=new Q,kR=new Q,B1=new Q,Xh=new Q,WR=new Q,D1=new Q,XR=new Q;class g0{constructor(e=new Q,t=new Q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ff)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ff.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ff.copy(this.origin).addScaledVector(this.direction,t),ff.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){kR.copy(e).add(t).multiplyScalar(.5),B1.copy(t).sub(e).normalize(),Xh.copy(this.origin).sub(kR);const r=e.distanceTo(t)*.5,a=-this.direction.dot(B1),o=Xh.dot(this.direction),l=-Xh.dot(B1),u=Xh.lengthSq(),f=Math.abs(1-a*a);let p,x,y,_;if(f>0)if(p=a*l-o,x=a*o-l,_=r*f,p>=0)if(x>=-_)if(x<=_){const T=1/f;p*=T,x*=T,y=p*(p+a*x+2*o)+x*(a*p+x+2*l)+u}else x=r,p=Math.max(0,-(a*x+o)),y=-p*p+x*(x+2*l)+u;else x=-r,p=Math.max(0,-(a*x+o)),y=-p*p+x*(x+2*l)+u;else x<=-_?(p=Math.max(0,-(-a*r+o)),x=p>0?-r:Math.min(Math.max(-r,-l),r),y=-p*p+x*(x+2*l)+u):x<=_?(p=0,x=Math.min(Math.max(-r,-l),r),y=x*(x+2*l)+u):(p=Math.max(0,-(a*r+o)),x=p>0?r:Math.min(Math.max(-r,-l),r),y=-p*p+x*(x+2*l)+u);else x=a>0?-r:r,p=Math.max(0,-(a*x+o)),y=-p*p+x*(x+2*l)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,p),s&&s.copy(kR).addScaledVector(B1,x),y}intersectSphere(e,t){ff.subVectors(e.center,this.origin);const n=ff.dot(this.direction),s=ff.dot(ff)-n*n,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,a,o,l;const u=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,x=this.origin;return u>=0?(n=(e.min.x-x.x)*u,s=(e.max.x-x.x)*u):(n=(e.max.x-x.x)*u,s=(e.min.x-x.x)*u),f>=0?(r=(e.min.y-x.y)*f,a=(e.max.y-x.y)*f):(r=(e.max.y-x.y)*f,a=(e.min.y-x.y)*f),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),p>=0?(o=(e.min.z-x.z)*p,l=(e.max.z-x.z)*p):(o=(e.max.z-x.z)*p,l=(e.min.z-x.z)*p),n>l||o>s)||((o>n||n!==n)&&(n=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,ff)!==null}intersectTriangle(e,t,n,s,r){WR.subVectors(t,e),D1.subVectors(n,e),XR.crossVectors(WR,D1);let a=this.direction.dot(XR),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Xh.subVectors(this.origin,e);const l=o*this.direction.dot(D1.crossVectors(Xh,D1));if(l<0)return null;const u=o*this.direction.dot(WR.cross(Xh));if(u<0||l+u>a)return null;const f=-o*Xh.dot(XR);return f<0?null:this.at(f/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Yt{constructor(e,t,n,s,r,a,o,l,u,f,p,x,y,_,T,A){Yt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,u,f,p,x,y,_,T,A)}set(e,t,n,s,r,a,o,l,u,f,p,x,y,_,T,A){const S=this.elements;return S[0]=e,S[4]=t,S[8]=n,S[12]=s,S[1]=r,S[5]=a,S[9]=o,S[13]=l,S[2]=u,S[6]=f,S[10]=p,S[14]=x,S[3]=y,S[7]=_,S[11]=T,S[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Yt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/Ix.setFromMatrixColumn(e,0).length(),r=1/Ix.setFromMatrixColumn(e,1).length(),a=1/Ix.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(s),u=Math.sin(s),f=Math.cos(r),p=Math.sin(r);if(e.order==="XYZ"){const x=a*f,y=a*p,_=o*f,T=o*p;t[0]=l*f,t[4]=-l*p,t[8]=u,t[1]=y+_*u,t[5]=x-T*u,t[9]=-o*l,t[2]=T-x*u,t[6]=_+y*u,t[10]=a*l}else if(e.order==="YXZ"){const x=l*f,y=l*p,_=u*f,T=u*p;t[0]=x+T*o,t[4]=_*o-y,t[8]=a*u,t[1]=a*p,t[5]=a*f,t[9]=-o,t[2]=y*o-_,t[6]=T+x*o,t[10]=a*l}else if(e.order==="ZXY"){const x=l*f,y=l*p,_=u*f,T=u*p;t[0]=x-T*o,t[4]=-a*p,t[8]=_+y*o,t[1]=y+_*o,t[5]=a*f,t[9]=T-x*o,t[2]=-a*u,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const x=a*f,y=a*p,_=o*f,T=o*p;t[0]=l*f,t[4]=_*u-y,t[8]=x*u+T,t[1]=l*p,t[5]=T*u+x,t[9]=y*u-_,t[2]=-u,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const x=a*l,y=a*u,_=o*l,T=o*u;t[0]=l*f,t[4]=T-x*p,t[8]=_*p+y,t[1]=p,t[5]=a*f,t[9]=-o*f,t[2]=-u*f,t[6]=y*p+_,t[10]=x-T*p}else if(e.order==="XZY"){const x=a*l,y=a*u,_=o*l,T=o*u;t[0]=l*f,t[4]=-p,t[8]=u*f,t[1]=x*p+T,t[5]=a*f,t[9]=y*p-_,t[2]=_*p-y,t[6]=o*f,t[10]=T*p+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hY,e,pY)}lookAt(e,t,n){const s=this.elements;return ml.subVectors(e,t),ml.lengthSq()===0&&(ml.z=1),ml.normalize(),qh.crossVectors(n,ml),qh.lengthSq()===0&&(Math.abs(n.z)===1?ml.x+=1e-4:ml.z+=1e-4,ml.normalize(),qh.crossVectors(n,ml)),qh.normalize(),O1.crossVectors(ml,qh),s[0]=qh.x,s[4]=O1.x,s[8]=ml.x,s[1]=qh.y,s[5]=O1.y,s[9]=ml.y,s[2]=qh.z,s[6]=O1.z,s[10]=ml.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[4],l=n[8],u=n[12],f=n[1],p=n[5],x=n[9],y=n[13],_=n[2],T=n[6],A=n[10],S=n[14],C=n[3],w=n[7],B=n[11],L=n[15],D=s[0],O=s[4],F=s[8],U=s[12],P=s[1],X=s[5],Z=s[9],ee=s[13],te=s[2],re=s[6],W=s[10],ne=s[14],se=s[3],ge=s[7],_e=s[11],K=s[15];return r[0]=a*D+o*P+l*te+u*se,r[4]=a*O+o*X+l*re+u*ge,r[8]=a*F+o*Z+l*W+u*_e,r[12]=a*U+o*ee+l*ne+u*K,r[1]=f*D+p*P+x*te+y*se,r[5]=f*O+p*X+x*re+y*ge,r[9]=f*F+p*Z+x*W+y*_e,r[13]=f*U+p*ee+x*ne+y*K,r[2]=_*D+T*P+A*te+S*se,r[6]=_*O+T*X+A*re+S*ge,r[10]=_*F+T*Z+A*W+S*_e,r[14]=_*U+T*ee+A*ne+S*K,r[3]=C*D+w*P+B*te+L*se,r[7]=C*O+w*X+B*re+L*ge,r[11]=C*F+w*Z+B*W+L*_e,r[15]=C*U+w*ee+B*ne+L*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],a=e[1],o=e[5],l=e[9],u=e[13],f=e[2],p=e[6],x=e[10],y=e[14],_=e[3],T=e[7],A=e[11],S=e[15];return _*(+r*l*p-s*u*p-r*o*x+n*u*x+s*o*y-n*l*y)+T*(+t*l*y-t*u*x+r*a*x-s*a*y+s*u*f-r*l*f)+A*(+t*u*p-t*o*y-r*a*p+n*a*y+r*o*f-n*u*f)+S*(-s*o*f-t*l*p+t*o*x+s*a*p-n*a*x+n*l*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],f=e[8],p=e[9],x=e[10],y=e[11],_=e[12],T=e[13],A=e[14],S=e[15],C=p*A*u-T*x*u+T*l*y-o*A*y-p*l*S+o*x*S,w=_*x*u-f*A*u-_*l*y+a*A*y+f*l*S-a*x*S,B=f*T*u-_*p*u+_*o*y-a*T*y-f*o*S+a*p*S,L=_*p*l-f*T*l-_*o*x+a*T*x+f*o*A-a*p*A,D=t*C+n*w+s*B+r*L;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/D;return e[0]=C*O,e[1]=(T*x*r-p*A*r-T*s*y+n*A*y+p*s*S-n*x*S)*O,e[2]=(o*A*r-T*l*r+T*s*u-n*A*u-o*s*S+n*l*S)*O,e[3]=(p*l*r-o*x*r-p*s*u+n*x*u+o*s*y-n*l*y)*O,e[4]=w*O,e[5]=(f*A*r-_*x*r+_*s*y-t*A*y-f*s*S+t*x*S)*O,e[6]=(_*l*r-a*A*r-_*s*u+t*A*u+a*s*S-t*l*S)*O,e[7]=(a*x*r-f*l*r+f*s*u-t*x*u-a*s*y+t*l*y)*O,e[8]=B*O,e[9]=(_*p*r-f*T*r-_*n*y+t*T*y+f*n*S-t*p*S)*O,e[10]=(a*T*r-_*o*r+_*n*u-t*T*u-a*n*S+t*o*S)*O,e[11]=(f*o*r-a*p*r-f*n*u+t*p*u+a*n*y-t*o*y)*O,e[12]=L*O,e[13]=(f*T*s-_*p*s+_*n*x-t*T*x-f*n*A+t*p*A)*O,e[14]=(_*o*s-a*T*s-_*n*l+t*T*l+a*n*A-t*o*A)*O,e[15]=(a*p*s-f*o*s+f*n*l-t*p*l-a*n*x+t*o*x)*O,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,a=e.x,o=e.y,l=e.z,u=r*a,f=r*o;return this.set(u*a+n,u*o-s*l,u*l+s*o,0,u*o+s*l,f*o+n,f*l-s*a,0,u*l-s*o,f*l+s*a,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,a){return this.set(1,n,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,u=r+r,f=a+a,p=o+o,x=r*u,y=r*f,_=r*p,T=a*f,A=a*p,S=o*p,C=l*u,w=l*f,B=l*p,L=n.x,D=n.y,O=n.z;return s[0]=(1-(T+S))*L,s[1]=(y+B)*L,s[2]=(_-w)*L,s[3]=0,s[4]=(y-B)*D,s[5]=(1-(x+S))*D,s[6]=(A+C)*D,s[7]=0,s[8]=(_+w)*O,s[9]=(A-C)*O,s[10]=(1-(x+T))*O,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=Ix.set(s[0],s[1],s[2]).length();const a=Ix.set(s[4],s[5],s[6]).length(),o=Ix.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Kc.copy(this);const u=1/r,f=1/a,p=1/o;return Kc.elements[0]*=u,Kc.elements[1]*=u,Kc.elements[2]*=u,Kc.elements[4]*=f,Kc.elements[5]*=f,Kc.elements[6]*=f,Kc.elements[8]*=p,Kc.elements[9]*=p,Kc.elements[10]*=p,t.setFromRotationMatrix(Kc),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,s,r,a,o=oa,l=!1){const u=this.elements,f=2*r/(t-e),p=2*r/(n-s),x=(t+e)/(t-e),y=(n+s)/(n-s);let _,T;if(l)_=r/(a-r),T=a*r/(a-r);else if(o===oa)_=-(a+r)/(a-r),T=-2*a*r/(a-r);else if(o===Nl)_=-a/(a-r),T=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=f,u[4]=0,u[8]=x,u[12]=0,u[1]=0,u[5]=p,u[9]=y,u[13]=0,u[2]=0,u[6]=0,u[10]=_,u[14]=T,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,n,s,r,a,o=oa,l=!1){const u=this.elements,f=2/(t-e),p=2/(n-s),x=-(t+e)/(t-e),y=-(n+s)/(n-s);let _,T;if(l)_=1/(a-r),T=a/(a-r);else if(o===oa)_=-2/(a-r),T=-(a+r)/(a-r);else if(o===Nl)_=-1/(a-r),T=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=f,u[4]=0,u[8]=0,u[12]=x,u[1]=0,u[5]=p,u[9]=0,u[13]=y,u[2]=0,u[6]=0,u[10]=_,u[14]=T,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Ix=new Q,Kc=new Yt,hY=new Q(0,0,0),pY=new Q(1,1,1),qh=new Q,O1=new Q,ml=new Q,xI=new Yt,yI=new wr;class Wa{constructor(e=0,t=0,n=0,s=Wa.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],l=s[1],u=s[5],f=s[9],p=s[2],x=s[6],y=s[10];switch(t){case"XYZ":this._y=Math.asin(Pn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(x,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Pn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(o,y),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-p,r),this._z=0);break;case"ZXY":this._x=Math.asin(Pn(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Pn(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(x,y),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Pn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-p,r)):(this._x=0,this._y=Math.atan2(o,y));break;case"XZY":this._z=Math.asin(-Pn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(x,u),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-f,y),this._y=0);break;default:De("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return xI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xI,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return yI.setFromEuler(this),this.setFromQuaternion(yI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Wa.DEFAULT_ORDER="XYZ";class r0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let mY=0;const vI=new Q,Px=new wr,hf=new Yt,U1=new Q,ub=new Q,gY=new Q,xY=new wr,_I=new Q(1,0,0),bI=new Q(0,1,0),SI=new Q(0,0,1),TI={type:"added"},yY={type:"removed"},Fx={type:"childadded",child:null},qR={type:"childremoved",child:null};class mi extends Oo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:mY++}),this.uuid=El(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mi.DEFAULT_UP.clone();const e=new Q,t=new Wa,n=new wr,s=new Q(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Yt},normalMatrix:{value:new Ln}}),this.matrix=new Yt,this.matrixWorld=new Yt,this.matrixAutoUpdate=mi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=mi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new r0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Px.setFromAxisAngle(e,t),this.quaternion.multiply(Px),this}rotateOnWorldAxis(e,t){return Px.setFromAxisAngle(e,t),this.quaternion.premultiply(Px),this}rotateX(e){return this.rotateOnAxis(_I,e)}rotateY(e){return this.rotateOnAxis(bI,e)}rotateZ(e){return this.rotateOnAxis(SI,e)}translateOnAxis(e,t){return vI.copy(e).applyQuaternion(this.quaternion),this.position.add(vI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_I,e)}translateY(e){return this.translateOnAxis(bI,e)}translateZ(e){return this.translateOnAxis(SI,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hf.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?U1.copy(e):U1.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),ub.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hf.lookAt(ub,U1,this.up):hf.lookAt(U1,ub,this.up),this.quaternion.setFromRotationMatrix(hf),s&&(hf.extractRotation(s.matrixWorld),Px.setFromRotationMatrix(hf),this.quaternion.premultiply(Px.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(nt("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(TI),Fx.child=e,this.dispatchEvent(Fx),Fx.child=null):nt("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(yY),qR.child=e,this.dispatchEvent(qR),qR.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),hf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hf.multiply(e.parent.matrixWorld)),e.applyMatrix4(hf),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(TI),Fx.child=e,this.dispatchEvent(Fx),Fx.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ub,e,gY),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ub,xY,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,f=l.length;u<f;u++){const p=l[u];r(e.shapes,p)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(r(e.materials,this.material[l]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),u=a(e.textures),f=a(e.images),p=a(e.shapes),x=a(e.skeletons),y=a(e.animations),_=a(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),p.length>0&&(n.shapes=p),x.length>0&&(n.skeletons=x),y.length>0&&(n.animations=y),_.length>0&&(n.nodes=_)}return n.object=s,n;function a(o){const l=[];for(const u in o){const f=o[u];delete f.metadata,l.push(f)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}mi.DEFAULT_UP=new Q(0,1,0);mi.DEFAULT_MATRIX_AUTO_UPDATE=!0;mi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Jc=new Q,pf=new Q,YR=new Q,mf=new Q,Gx=new Q,zx=new Q,AI=new Q,jR=new Q,$R=new Q,KR=new Q,JR=new mn,ZR=new mn,QR=new mn;class bo{constructor(e=new Q,t=new Q,n=new Q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),Jc.subVectors(e,t),s.cross(Jc);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){Jc.subVectors(s,t),pf.subVectors(n,t),YR.subVectors(e,t);const a=Jc.dot(Jc),o=Jc.dot(pf),l=Jc.dot(YR),u=pf.dot(pf),f=pf.dot(YR),p=a*u-o*o;if(p===0)return r.set(0,0,0),null;const x=1/p,y=(u*l-o*f)*x,_=(a*f-o*l)*x;return r.set(1-y-_,_,y)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,mf)===null?!1:mf.x>=0&&mf.y>=0&&mf.x+mf.y<=1}static getInterpolation(e,t,n,s,r,a,o,l){return this.getBarycoord(e,t,n,s,mf)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,mf.x),l.addScaledVector(a,mf.y),l.addScaledVector(o,mf.z),l)}static getInterpolatedAttribute(e,t,n,s,r,a){return JR.setScalar(0),ZR.setScalar(0),QR.setScalar(0),JR.fromBufferAttribute(e,t),ZR.fromBufferAttribute(e,n),QR.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(JR,r.x),a.addScaledVector(ZR,r.y),a.addScaledVector(QR,r.z),a}static isFrontFacing(e,t,n,s){return Jc.subVectors(n,t),pf.subVectors(e,t),Jc.cross(pf).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Jc.subVectors(this.c,this.b),pf.subVectors(this.a,this.b),Jc.cross(pf).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,r){return bo.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return bo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let a,o;Gx.subVectors(s,n),zx.subVectors(r,n),jR.subVectors(e,n);const l=Gx.dot(jR),u=zx.dot(jR);if(l<=0&&u<=0)return t.copy(n);$R.subVectors(e,s);const f=Gx.dot($R),p=zx.dot($R);if(f>=0&&p<=f)return t.copy(s);const x=l*p-f*u;if(x<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(n).addScaledVector(Gx,a);KR.subVectors(e,r);const y=Gx.dot(KR),_=zx.dot(KR);if(_>=0&&y<=_)return t.copy(r);const T=y*u-l*_;if(T<=0&&u>=0&&_<=0)return o=u/(u-_),t.copy(n).addScaledVector(zx,o);const A=f*_-y*p;if(A<=0&&p-f>=0&&y-_>=0)return AI.subVectors(r,s),o=(p-f)/(p-f+(y-_)),t.copy(s).addScaledVector(AI,o);const S=1/(A+T+x);return a=T*S,o=x*S,t.copy(n).addScaledVector(Gx,a).addScaledVector(zx,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Yz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yh={h:0,s:0,l:0},L1={h:0,s:0,l:0};function ew(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}let Bt=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Mr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,yn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,s=yn.workingColorSpace){return this.r=e,this.g=t,this.b=n,yn.colorSpaceToWorking(this,s),this}setHSL(e,t,n,s=yn.workingColorSpace){if(e=qB(e,1),t=Pn(t,0,1),n=Pn(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=ew(a,r,e+1/3),this.g=ew(a,r,e),this.b=ew(a,r,e-1/3)}return yn.colorSpaceToWorking(this,s),this}setStyle(e,t=Mr){function n(r){r!==void 0&&parseFloat(r)<1&&De("Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:De("Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);De("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Mr){const n=Yz[e.toLowerCase()];return n!==void 0?this.setHex(n,t):De("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Of(e.r),this.g=Of(e.g),this.b=Of(e.b),this}copyLinearToSRGB(e){return this.r=Cy(e.r),this.g=Cy(e.g),this.b=Cy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Mr){return yn.workingToColorSpace(Ia.copy(this),e),Math.round(Pn(Ia.r*255,0,255))*65536+Math.round(Pn(Ia.g*255,0,255))*256+Math.round(Pn(Ia.b*255,0,255))}getHexString(e=Mr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=yn.workingColorSpace){yn.workingToColorSpace(Ia.copy(this),t);const n=Ia.r,s=Ia.g,r=Ia.b,a=Math.max(n,s,r),o=Math.min(n,s,r);let l,u;const f=(o+a)/2;if(o===a)l=0,u=0;else{const p=a-o;switch(u=f<=.5?p/(a+o):p/(2-a-o),a){case n:l=(s-r)/p+(s<r?6:0);break;case s:l=(r-n)/p+2;break;case r:l=(n-s)/p+4;break}l/=6}return e.h=l,e.s=u,e.l=f,e}getRGB(e,t=yn.workingColorSpace){return yn.workingToColorSpace(Ia.copy(this),t),e.r=Ia.r,e.g=Ia.g,e.b=Ia.b,e}getStyle(e=Mr){yn.workingToColorSpace(Ia.copy(this),e);const t=Ia.r,n=Ia.g,s=Ia.b;return e!==Mr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,t,n){return this.getHSL(Yh),this.setHSL(Yh.h+e,Yh.s+t,Yh.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Yh),e.getHSL(L1);const n=nS(Yh.h,L1.h,t),s=nS(Yh.s,L1.s,t),r=nS(Yh.l,L1.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ia=new Bt;Bt.NAMES=Yz;let vY=0;class ir extends Oo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:vY++}),this.uuid=El(),this.name="",this.type="Material",this.blending=Mo,this.side=Ha,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Vg,this.blendDst=Hg,this.blendEquation=aa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Bt(0,0,0),this.blendAlpha=0,this.depthFunc=Sd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Tf,this.stencilZFail=Tf,this.stencilZPass=Tf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){De(`Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){De(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Mo&&(n.blending=this.blending),this.side!==Ha&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Vg&&(n.blendSrc=this.blendSrc),this.blendDst!==Hg&&(n.blendDst=this.blendDst),this.blendEquation!==aa&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Sd&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AS&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Tf&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Tf&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Tf&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class er extends ir{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Wa,this.combine=h0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Mf=_Y();function _Y(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(n[l]=0,n[l|256]=32768,s[l]=24,s[l|256]=24):u<-14?(n[l]=1024>>-u-14,n[l|256]=1024>>-u-14|32768,s[l]=-u-1,s[l|256]=-u-1):u<=15?(n[l]=u+15<<10,n[l|256]=u+15<<10|32768,s[l]=13,s[l|256]=13):u<128?(n[l]=31744,n[l|256]=64512,s[l]=24,s[l|256]=24):(n[l]=31744,n[l|256]=64512,s[l]=13,s[l|256]=13)}const r=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,f=0;for(;(u&8388608)===0;)u<<=1,f-=8388608;u&=-8388609,f+=947912704,r[l]=u|f}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:s,mantissaTable:r,exponentTable:a,offsetTable:o}}function qo(i){Math.abs(i)>65504&&De("DataUtils.toHalfFloat(): Value out of range."),i=Pn(i,-65504,65504),Mf.floatView[0]=i;const e=Mf.uint32View[0],t=e>>23&511;return Mf.baseTable[t]+((e&8388607)>>Mf.shiftTable[t])}function $b(i){const e=i>>10;return Mf.uint32View[0]=Mf.mantissaTable[Mf.offsetTable[e]+(i&1023)]+Mf.exponentTable[e],Mf.floatView[0]}class op{static toHalfFloat(e){return qo(e)}static fromHalfFloat(e){return $b(e)}}const Tr=new Q,I1=new Ze;let bY=0;class li{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:bY++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=n0,this.updateRanges=[],this.gpuType=Ti,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)I1.fromBufferAttribute(this,t),I1.applyMatrix3(e),this.setXY(t,I1.x,I1.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Tr.fromBufferAttribute(this,t),Tr.applyMatrix3(e),this.setXYZ(t,Tr.x,Tr.y,Tr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Tr.fromBufferAttribute(this,t),Tr.applyMatrix4(e),this.setXYZ(t,Tr.x,Tr.y,Tr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Tr.fromBufferAttribute(this,t),Tr.applyNormalMatrix(e),this.setXYZ(t,Tr.x,Tr.y,Tr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Tr.fromBufferAttribute(this,t),Tr.transformDirection(e),this.setXYZ(t,Tr.x,Tr.y,Tr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=_o(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Kn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=_o(t,this.array)),t}setX(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=_o(t,this.array)),t}setY(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=_o(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=_o(t,this.array)),t}setW(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array),r=Kn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==n0&&(e.usage=this.usage),e}}class jz extends li{constructor(e,t,n){super(new Int8Array(e),t,n)}}class $z extends li{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Kz extends li{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Jz extends li{constructor(e,t,n){super(new Int16Array(e),t,n)}}class pT extends li{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Zz extends li{constructor(e,t,n){super(new Int32Array(e),t,n)}}class mT extends li{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class bC extends li{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=$b(this.array[e*this.itemSize]);return this.normalized&&(t=_o(t,this.array)),t}setX(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize]=qo(t),this}getY(e){let t=$b(this.array[e*this.itemSize+1]);return this.normalized&&(t=_o(t,this.array)),t}setY(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+1]=qo(t),this}getZ(e){let t=$b(this.array[e*this.itemSize+2]);return this.normalized&&(t=_o(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+2]=qo(t),this}getW(e){let t=$b(this.array[e*this.itemSize+3]);return this.normalized&&(t=_o(t,this.array)),t}setW(e,t){return this.normalized&&(t=Kn(t,this.array)),this.array[e*this.itemSize+3]=qo(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(n),this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(n),this.array[e+2]=qo(s),this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array),r=Kn(r,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(n),this.array[e+2]=qo(s),this.array[e+3]=qo(r),this}}class an extends li{constructor(e,t,n){super(new Float32Array(e),t,n)}}let SY=0;const ic=new Yt,tw=new mi,Vx=new Q,gl=new Vr,db=new Vr,ia=new Q;class Fn extends Oo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:SY++}),this.uuid=El(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(XB(e)?mT:pT)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Ln().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ic.makeRotationFromQuaternion(e),this.applyMatrix4(ic),this}rotateX(e){return ic.makeRotationX(e),this.applyMatrix4(ic),this}rotateY(e){return ic.makeRotationY(e),this.applyMatrix4(ic),this}rotateZ(e){return ic.makeRotationZ(e),this.applyMatrix4(ic),this}translate(e,t,n){return ic.makeTranslation(e,t,n),this.applyMatrix4(ic),this}scale(e,t,n){return ic.makeScale(e,t,n),this.applyMatrix4(ic),this}lookAt(e){return tw.lookAt(e),tw.updateMatrix(),this.applyMatrix4(tw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vx).negate(),this.translate(Vx.x,Vx.y,Vx.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let s=0,r=e.length;s<r;s++){const a=e[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new an(n,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&De("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){nt("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Q(-1/0,-1/0,-1/0),new Q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];gl.setFromBufferAttribute(r),this.morphTargetsRelative?(ia.addVectors(this.boundingBox.min,gl.min),this.boundingBox.expandByPoint(ia),ia.addVectors(this.boundingBox.max,gl.max),this.boundingBox.expandByPoint(ia)):(this.boundingBox.expandByPoint(gl.min),this.boundingBox.expandByPoint(gl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&nt('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new mr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){nt("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Q,1/0);return}if(e){const n=this.boundingSphere.center;if(gl.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];db.setFromBufferAttribute(o),this.morphTargetsRelative?(ia.addVectors(gl.min,db.min),gl.expandByPoint(ia),ia.addVectors(gl.max,db.max),gl.expandByPoint(ia)):(gl.expandByPoint(db.min),gl.expandByPoint(db.max))}gl.getCenter(n);let s=0;for(let r=0,a=e.count;r<a;r++)ia.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(ia));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let u=0,f=o.count;u<f;u++)ia.fromBufferAttribute(o,u),l&&(Vx.fromBufferAttribute(e,u),ia.add(Vx)),s=Math.max(s,n.distanceToSquared(ia))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&nt('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){nt("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new li(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let F=0;F<n.count;F++)o[F]=new Q,l[F]=new Q;const u=new Q,f=new Q,p=new Q,x=new Ze,y=new Ze,_=new Ze,T=new Q,A=new Q;function S(F,U,P){u.fromBufferAttribute(n,F),f.fromBufferAttribute(n,U),p.fromBufferAttribute(n,P),x.fromBufferAttribute(r,F),y.fromBufferAttribute(r,U),_.fromBufferAttribute(r,P),f.sub(u),p.sub(u),y.sub(x),_.sub(x);const X=1/(y.x*_.y-_.x*y.y);isFinite(X)&&(T.copy(f).multiplyScalar(_.y).addScaledVector(p,-y.y).multiplyScalar(X),A.copy(p).multiplyScalar(y.x).addScaledVector(f,-_.x).multiplyScalar(X),o[F].add(T),o[U].add(T),o[P].add(T),l[F].add(A),l[U].add(A),l[P].add(A))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let F=0,U=C.length;F<U;++F){const P=C[F],X=P.start,Z=P.count;for(let ee=X,te=X+Z;ee<te;ee+=3)S(e.getX(ee+0),e.getX(ee+1),e.getX(ee+2))}const w=new Q,B=new Q,L=new Q,D=new Q;function O(F){L.fromBufferAttribute(s,F),D.copy(L);const U=o[F];w.copy(U),w.sub(L.multiplyScalar(L.dot(U))).normalize(),B.crossVectors(D,U);const X=B.dot(l[F])<0?-1:1;a.setXYZW(F,w.x,w.y,w.z,X)}for(let F=0,U=C.length;F<U;++F){const P=C[F],X=P.start,Z=P.count;for(let ee=X,te=X+Z;ee<te;ee+=3)O(e.getX(ee+0)),O(e.getX(ee+1)),O(e.getX(ee+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new li(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let x=0,y=n.count;x<y;x++)n.setXYZ(x,0,0,0);const s=new Q,r=new Q,a=new Q,o=new Q,l=new Q,u=new Q,f=new Q,p=new Q;if(e)for(let x=0,y=e.count;x<y;x+=3){const _=e.getX(x+0),T=e.getX(x+1),A=e.getX(x+2);s.fromBufferAttribute(t,_),r.fromBufferAttribute(t,T),a.fromBufferAttribute(t,A),f.subVectors(a,r),p.subVectors(s,r),f.cross(p),o.fromBufferAttribute(n,_),l.fromBufferAttribute(n,T),u.fromBufferAttribute(n,A),o.add(f),l.add(f),u.add(f),n.setXYZ(_,o.x,o.y,o.z),n.setXYZ(T,l.x,l.y,l.z),n.setXYZ(A,u.x,u.y,u.z)}else for(let x=0,y=t.count;x<y;x+=3)s.fromBufferAttribute(t,x+0),r.fromBufferAttribute(t,x+1),a.fromBufferAttribute(t,x+2),f.subVectors(a,r),p.subVectors(s,r),f.cross(p),n.setXYZ(x+0,f.x,f.y,f.z),n.setXYZ(x+1,f.x,f.y,f.z),n.setXYZ(x+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ia.fromBufferAttribute(e,t),ia.normalize(),e.setXYZ(t,ia.x,ia.y,ia.z)}toNonIndexed(){function e(o,l){const u=o.array,f=o.itemSize,p=o.normalized,x=new u.constructor(l.length*f);let y=0,_=0;for(let T=0,A=l.length;T<A;T++){o.isInterleavedBufferAttribute?y=l[T]*o.data.stride+o.offset:y=l[T]*f;for(let S=0;S<f;S++)x[_++]=u[y++]}return new li(x,f,p)}if(this.index===null)return De("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Fn,n=this.index.array,s=this.attributes;for(const o in s){const l=s[o],u=e(l,n);t.setAttribute(o,u)}const r=this.morphAttributes;for(const o in r){const l=[],u=r[o];for(let f=0,p=u.length;f<p;f++){const x=u[f],y=e(x,n);l.push(y)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const u=n[l];e.data.attributes[l]=u.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],f=[];for(let p=0,x=u.length;p<x;p++){const y=u[p];f.push(y.toJSON(e.data))}f.length>0&&(s[l]=f,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const s=e.attributes;for(const u in s){const f=s[u];this.setAttribute(u,f.clone(t))}const r=e.morphAttributes;for(const u in r){const f=[],p=r[u];for(let x=0,y=p.length;x<y;x++)f.push(p[x].clone(t));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,f=a.length;u<f;u++){const p=a[u];this.addGroup(p.start,p.count,p.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const EI=new Yt,tg=new g0,P1=new mr,MI=new Q,F1=new Q,G1=new Q,z1=new Q,nw=new Q,V1=new Q,CI=new Q,H1=new Q;class Ui extends mi{constructor(e=new Fn,t=new er){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(r&&o){V1.set(0,0,0);for(let l=0,u=r.length;l<u;l++){const f=o[l],p=r[l];f!==0&&(nw.fromBufferAttribute(p,e),a?V1.addScaledVector(nw,f):V1.addScaledVector(nw.sub(t),f))}t.add(V1)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),P1.copy(n.boundingSphere),P1.applyMatrix4(r),tg.copy(e.ray).recast(e.near),!(P1.containsPoint(tg.origin)===!1&&(tg.intersectSphere(P1,MI)===null||tg.origin.distanceToSquared(MI)>(e.far-e.near)**2))&&(EI.copy(r).invert(),tg.copy(e.ray).applyMatrix4(EI),!(n.boundingBox!==null&&tg.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,tg)))}_computeIntersections(e,t,n){let s;const r=this.geometry,a=this.material,o=r.index,l=r.attributes.position,u=r.attributes.uv,f=r.attributes.uv1,p=r.attributes.normal,x=r.groups,y=r.drawRange;if(o!==null)if(Array.isArray(a))for(let _=0,T=x.length;_<T;_++){const A=x[_],S=a[A.materialIndex],C=Math.max(A.start,y.start),w=Math.min(o.count,Math.min(A.start+A.count,y.start+y.count));for(let B=C,L=w;B<L;B+=3){const D=o.getX(B),O=o.getX(B+1),F=o.getX(B+2);s=k1(this,S,e,n,u,f,p,D,O,F),s&&(s.faceIndex=Math.floor(B/3),s.face.materialIndex=A.materialIndex,t.push(s))}}else{const _=Math.max(0,y.start),T=Math.min(o.count,y.start+y.count);for(let A=_,S=T;A<S;A+=3){const C=o.getX(A),w=o.getX(A+1),B=o.getX(A+2);s=k1(this,a,e,n,u,f,p,C,w,B),s&&(s.faceIndex=Math.floor(A/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(a))for(let _=0,T=x.length;_<T;_++){const A=x[_],S=a[A.materialIndex],C=Math.max(A.start,y.start),w=Math.min(l.count,Math.min(A.start+A.count,y.start+y.count));for(let B=C,L=w;B<L;B+=3){const D=B,O=B+1,F=B+2;s=k1(this,S,e,n,u,f,p,D,O,F),s&&(s.faceIndex=Math.floor(B/3),s.face.materialIndex=A.materialIndex,t.push(s))}}else{const _=Math.max(0,y.start),T=Math.min(l.count,y.start+y.count);for(let A=_,S=T;A<S;A+=3){const C=A,w=A+1,B=A+2;s=k1(this,a,e,n,u,f,p,C,w,B),s&&(s.faceIndex=Math.floor(A/3),t.push(s))}}}}function TY(i,e,t,n,s,r,a,o){let l;if(e.side===Yi?l=n.intersectTriangle(a,r,s,!0,o):l=n.intersectTriangle(s,r,a,e.side===Ha,o),l===null)return null;H1.copy(o),H1.applyMatrix4(i.matrixWorld);const u=t.ray.origin.distanceTo(H1);return u<t.near||u>t.far?null:{distance:u,point:H1.clone(),object:i}}function k1(i,e,t,n,s,r,a,o,l,u){i.getVertexPosition(o,F1),i.getVertexPosition(l,G1),i.getVertexPosition(u,z1);const f=TY(i,e,t,n,F1,G1,z1,CI);if(f){const p=new Q;bo.getBarycoord(CI,F1,G1,z1,p),s&&(f.uv=bo.getInterpolatedAttribute(s,o,l,u,p,new Ze)),r&&(f.uv1=bo.getInterpolatedAttribute(r,o,l,u,p,new Ze)),a&&(f.normal=bo.getInterpolatedAttribute(a,o,l,u,p,new Q),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const x={a:o,b:l,c:u,normal:new Q,materialIndex:0};bo.getNormal(F1,G1,z1,x.normal),f.face=x,f.barycoord=p}return f}class Nd extends Fn{constructor(e=1,t=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],u=[],f=[],p=[];let x=0,y=0;_("z","y","x",-1,-1,n,t,e,a,r,0),_("z","y","x",1,-1,n,t,-e,a,r,1),_("x","z","y",1,1,e,n,t,s,a,2),_("x","z","y",1,-1,e,n,-t,s,a,3),_("x","y","z",1,-1,e,t,n,s,r,4),_("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new an(u,3)),this.setAttribute("normal",new an(f,3)),this.setAttribute("uv",new an(p,2));function _(T,A,S,C,w,B,L,D,O,F,U){const P=B/O,X=L/F,Z=B/2,ee=L/2,te=D/2,re=O+1,W=F+1;let ne=0,se=0;const ge=new Q;for(let _e=0;_e<W;_e++){const K=_e*X-ee;for(let pe=0;pe<re;pe++){const we=pe*P-Z;ge[T]=we*C,ge[A]=K*w,ge[S]=te,u.push(ge.x,ge.y,ge.z),ge[T]=0,ge[A]=0,ge[S]=D>0?1:-1,f.push(ge.x,ge.y,ge.z),p.push(pe/O),p.push(1-_e/F),ne+=1}}for(let _e=0;_e<F;_e++)for(let K=0;K<O;K++){const pe=x+K+re*_e,we=x+K+re*(_e+1),Ne=x+(K+1)+re*(_e+1),gt=x+(K+1)+re*_e;l.push(pe,we,gt),l.push(we,Ne,gt),se+=6}o.addGroup(y,se,U),y+=se,x+=ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zy(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(De("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function po(i){const e={};for(let t=0;t<i.length;t++){const n=zy(i[t]);for(const s in n)e[s]=n[s]}return e}function AY(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function Qz(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:yn.workingColorSpace}const eV={clone:zy,merge:po};var EY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,MY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xa extends ir{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=EY,this.fragmentShader=MY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zy(e.uniforms),this.uniformsGroups=AY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class cv extends mi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yt,this.projectionMatrix=new Yt,this.projectionMatrixInverse=new Yt,this.coordinateSystem=oa,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const jh=new Q,RI=new Ze,wI=new Ze;class bs extends cv{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=s0*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Og*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return s0*2*Math.atan(Math.tan(Og*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){jh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(jh.x,jh.y).multiplyScalar(-e/jh.z),jh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(jh.x,jh.y).multiplyScalar(-e/jh.z)}getViewSize(e,t){return this.getViewBounds(e,RI,wI),t.subVectors(wI,RI)}setViewOffset(e,t,n,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Og*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;r+=a.offsetX*s/l,t-=a.offsetY*n/u,s*=a.width/l,n*=a.height/u}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Hx=-90,kx=1;class SC extends mi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new bs(Hx,kx,e,t);s.layers=this.layers,this.add(s);const r=new bs(Hx,kx,e,t);r.layers=this.layers,this.add(r);const a=new bs(Hx,kx,e,t);a.layers=this.layers,this.add(a);const o=new bs(Hx,kx,e,t);o.layers=this.layers,this.add(o);const l=new bs(Hx,kx,e,t);l.layers=this.layers,this.add(l);const u=new bs(Hx,kx,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,s,r,a,o,l]=t;for(const u of t)this.remove(u);if(e===oa)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Nl)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,l,u,f]=this.children,p=e.getRenderTarget(),x=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const T=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,r),e.setRenderTarget(n,1,s),e.render(t,a),e.setRenderTarget(n,2,s),e.render(t,o),e.setRenderTarget(n,3,s),e.render(t,l),e.setRenderTarget(n,4,s),e.render(t,u),n.texture.generateMipmaps=T,e.setRenderTarget(n,5,s),e.render(t,f),e.setRenderTarget(p,x,y),e.xr.enabled=_,n.texture.needsPMREMUpdate=!0}}class Zf extends pi{constructor(e=[],t=Do,n,s,r,a,o,l,u,f){super(e,t,n,s,r,a,o,l,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class gT extends Bl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new Zf(s),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Nd(5,5,5),r=new Xa({name:"CubemapFromEquirect",uniforms:zy(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Yi,blending:ca});r.uniforms.tEquirect.value=t;const a=new Ui(s,r),o=t.minFilter;return t.minFilter===Cr&&(t.minFilter=Dn),new SC(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,s=!0){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,s);e.setRenderTarget(r)}}class fc extends mi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const CY={type:"move"};class Ry{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new fc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new fc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new fc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const T of e.hand.values()){const A=t.getJointPose(T,n),S=this._getHandJoint(u,T);A!==null&&(S.matrix.fromArray(A.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=A.radius),S.visible=A!==null}const f=u.joints["index-finger-tip"],p=u.joints["thumb-tip"],x=f.position.distanceTo(p.position),y=.02,_=.005;u.inputState.pinching&&x>y+_?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&x<=y-_&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(CY)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=r!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new fc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class xT{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Bt(e),this.density=t}clone(){return new xT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class yT{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Bt(e),this.near=t,this.far=n}clone(){return new yT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Qf extends mi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Wa,this.environmentIntensity=1,this.environmentRotation=new Wa,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class x0{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=n0,this.updateRanges=[],this.version=0,this.uuid=El()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=El()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=El()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const fo=new Q;class Md{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)fo.fromBufferAttribute(this,t),fo.applyMatrix4(e),this.setXYZ(t,fo.x,fo.y,fo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)fo.fromBufferAttribute(this,t),fo.applyNormalMatrix(e),this.setXYZ(t,fo.x,fo.y,fo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)fo.fromBufferAttribute(this,t),fo.transformDirection(e),this.setXYZ(t,fo.x,fo.y,fo.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=_o(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Kn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Kn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Kn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Kn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Kn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=_o(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=_o(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=_o(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=_o(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Kn(t,this.array),n=Kn(n,this.array),s=Kn(s,this.array),r=Kn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){i0("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new li(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Md(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){i0("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class vT extends ir{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Bt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Wx;const fb=new Q,Xx=new Q,qx=new Q,Yx=new Ze,hb=new Ze,tV=new Yt,W1=new Q,pb=new Q,X1=new Q,NI=new Ze,iw=new Ze,BI=new Ze;class jB extends mi{constructor(e=new vT){if(super(),this.isSprite=!0,this.type="Sprite",Wx===void 0){Wx=new Fn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new x0(t,5);Wx.setIndex([0,1,2,0,2,3]),Wx.setAttribute("position",new Md(n,3,0,!1)),Wx.setAttribute("uv",new Md(n,2,3,!1))}this.geometry=Wx,this.material=e,this.center=new Ze(.5,.5),this.count=1}raycast(e,t){e.camera===null&&nt('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xx.setFromMatrixScale(this.matrixWorld),tV.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),qx.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Xx.multiplyScalar(-qx.z);const n=this.material.rotation;let s,r;n!==0&&(r=Math.cos(n),s=Math.sin(n));const a=this.center;q1(W1.set(-.5,-.5,0),qx,a,Xx,s,r),q1(pb.set(.5,-.5,0),qx,a,Xx,s,r),q1(X1.set(.5,.5,0),qx,a,Xx,s,r),NI.set(0,0),iw.set(1,0),BI.set(1,1);let o=e.ray.intersectTriangle(W1,pb,X1,!1,fb);if(o===null&&(q1(pb.set(-.5,.5,0),qx,a,Xx,s,r),iw.set(0,1),o=e.ray.intersectTriangle(W1,X1,pb,!1,fb),o===null))return;const l=e.ray.origin.distanceTo(fb);l<e.near||l>e.far||t.push({distance:l,point:fb.clone(),uv:bo.getInterpolation(fb,W1,pb,X1,NI,iw,BI,new Ze),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function q1(i,e,t,n,s,r){Yx.subVectors(i,t).addScalar(.5).multiply(n),s!==void 0?(hb.x=r*Yx.x-s*Yx.y,hb.y=s*Yx.x+r*Yx.y):hb.copy(Yx),i.copy(e),i.x+=hb.x,i.y+=hb.y,i.applyMatrix4(tV)}const Y1=new Q,DI=new Q;class $B extends mi{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,s=t.length;n<s;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const s=t.splice(n,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Y1.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(Y1);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Y1.setFromMatrixPosition(e.matrixWorld),DI.setFromMatrixPosition(this.matrixWorld);const n=Y1.distanceTo(DI)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let a=t[s].distance;if(t[s].object.visible&&(a-=a*t[s].hysteresis),n>=a)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let s=0,r=n.length;s<r;s++){const a=n[s];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const OI=new Q,UI=new mn,LI=new mn,RY=new Q,II=new Yt,j1=new Q,sw=new mr,PI=new Yt,rw=new g0;class TC extends Ui{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=pM,this.bindMatrix=new Yt,this.bindMatrixInverse=new Yt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Vr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,j1),this.boundingBox.expandByPoint(j1)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new mr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,j1),this.boundingSphere.expandByPoint(j1)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),sw.copy(this.boundingSphere),sw.applyMatrix4(s),e.ray.intersectsSphere(sw)!==!1&&(PI.copy(s).invert(),rw.copy(e.ray).applyMatrix4(PI),!(this.boundingBox!==null&&rw.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,rw)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new mn,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===pM?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===TB?this.bindMatrixInverse.copy(this.bindMatrix).invert():De("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,s=this.geometry;UI.fromBufferAttribute(s.attributes.skinIndex,e),LI.fromBufferAttribute(s.attributes.skinWeight,e),OI.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const a=LI.getComponent(r);if(a!==0){const o=UI.getComponent(r);II.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(RY.copy(OI).applyMatrix4(II),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class _T extends mi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class No extends pi{constructor(e=null,t=1,n=1,s,r,a,o,l,u=es,f=es,p,x){super(null,a,o,l,u,f,s,r,p,x),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const FI=new Yt,wY=new Yt;class uv{constructor(e=[],t=[]){this.uuid=El(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){De("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new Yt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Yt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let r=0,a=e.length;r<a;r++){const o=e[r]?e[r].matrixWorld:wY;FI.multiplyMatrices(o,t[r]),FI.toArray(n,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new uv(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new No(t,e,e,Oi,Ti);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const r=e.bones[n];let a=t[r];a===void 0&&(De("Skeleton: No bone found with UUID:",r),a=new _T),this.bones.push(a),this.boneInverses.push(new Yt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const a=t[s];e.bones.push(a.uuid);const o=n[s];e.boneInverses.push(o.toArray())}return e}}class Jo extends li{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const jx=new Yt,GI=new Yt,$1=[],zI=new Vr,NY=new Yt,mb=new Ui,gb=new mr;class AC extends Ui{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Jo(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<n;s++)this.setMatrixAt(s,NY)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Vr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,jx),zI.copy(e.boundingBox).applyMatrix4(jx),this.boundingBox.union(zI)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new mr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,jx),gb.copy(e.boundingSphere).applyMatrix4(jx),this.boundingSphere.union(gb)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=n.length+1,a=e*r+1;for(let o=0;o<n.length;o++)n[o]=s[a+o]}raycast(e,t){const n=this.matrixWorld,s=this.count;if(mb.geometry=this.geometry,mb.material=this.material,mb.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),gb.copy(this.boundingSphere),gb.applyMatrix4(n),e.ray.intersectsSphere(gb)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,jx),GI.multiplyMatrices(n,jx),mb.matrixWorld=GI,mb.raycast(e,$1);for(let a=0,o=$1.length;a<o;a++){const l=$1[a];l.instanceId=r,l.object=this,t.push(l)}$1.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Jo(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,s=n.length+1;this.morphTexture===null&&(this.morphTexture=new No(new Float32Array(s*this.count),s,this.count,Kf,Ti));const r=this.morphTexture.source.data.data;let a=0;for(let u=0;u<n.length;u++)a+=n[u];const o=this.geometry.morphTargetsRelative?1:1-a,l=s*e;r[l]=o,r.set(n,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const aw=new Q,BY=new Q,DY=new Ln;class iu{constructor(e=new Q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=aw.subVectors(n,t).cross(BY.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(aw),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||DY.getNormalMatrix(e),s=this.coplanarPoint(aw).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ng=new mr,OY=new Ze(.5,.5),K1=new Q;class Zp{constructor(e=new iu,t=new iu,n=new iu,s=new iu,r=new iu,a=new iu){this.planes=[e,t,n,s,r,a]}set(e,t,n,s,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=oa,n=!1){const s=this.planes,r=e.elements,a=r[0],o=r[1],l=r[2],u=r[3],f=r[4],p=r[5],x=r[6],y=r[7],_=r[8],T=r[9],A=r[10],S=r[11],C=r[12],w=r[13],B=r[14],L=r[15];if(s[0].setComponents(u-a,y-f,S-_,L-C).normalize(),s[1].setComponents(u+a,y+f,S+_,L+C).normalize(),s[2].setComponents(u+o,y+p,S+T,L+w).normalize(),s[3].setComponents(u-o,y-p,S-T,L-w).normalize(),n)s[4].setComponents(l,x,A,B).normalize(),s[5].setComponents(u-l,y-x,S-A,L-B).normalize();else if(s[4].setComponents(u-l,y-x,S-A,L-B).normalize(),t===oa)s[5].setComponents(u+l,y+x,S+A,L+B).normalize();else if(t===Nl)s[5].setComponents(l,x,A,B).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ng.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ng.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ng)}intersectsSprite(e){ng.center.set(0,0,0);const t=OY.distanceTo(e.center);return ng.radius=.7071067811865476+t,ng.applyMatrix4(e.matrixWorld),this.intersectsSphere(ng)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(K1.x=s.normal.x>0?e.max.x:e.min.x,K1.y=s.normal.y>0?e.max.y:e.min.y,K1.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(K1)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Ku=new Yt,Ju=new Zp;class dv{constructor(){this.coordinateSystem=oa}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Ku.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Ju.setFromProjectionMatrix(Ku,s.coordinateSystem,s.reversedDepth),Ju.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Ku.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Ju.setFromProjectionMatrix(Ku,s.coordinateSystem,s.reversedDepth),Ju.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Ku.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Ju.setFromProjectionMatrix(Ku,s.coordinateSystem,s.reversedDepth),Ju.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Ku.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Ju.setFromProjectionMatrix(Ku,s.coordinateSystem,s.reversedDepth),Ju.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Ku.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Ju.setFromProjectionMatrix(Ku,s.coordinateSystem,s.reversedDepth),Ju.containsPoint(e))return!0}return!1}clone(){return new dv}}function ow(i,e){return i-e}function UY(i,e){return i.z-e.z}function LY(i,e){return e.z-i.z}class IY{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,s){const r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=s}reset(){this.list.length=0,this.index=0}}const Wo=new Yt,PY=new Bt(1,1,1),VI=new Zp,FY=new dv,J1=new Vr,ig=new mr,xb=new Q,HI=new Q,GY=new Q,lw=new IY,Pa=new Ui,Z1=[];function zY(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const s=i.count;for(let r=0;r<s;r++)for(let a=0;a<n;a++)e.setComponent(r+t,a,i.getComponent(r,a))}else e.array.set(i.array,t*n);e.needsUpdate=!0}function sg(i,e){if(i.constructor!==e.constructor){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++)e[n]=i[n]}else{const t=Math.min(i.length,e.length);e.set(new i.constructor(i.buffer,0,t))}}class KB extends Ui{constructor(e,t,n=t*2,s){super(new Fn,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new No(t,e,e,Oi,Ti);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new No(t,e,e,Jf,Xi);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new No(t,e,e,Oi,Ti);n.colorSpace=yn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const a=e.getAttribute(r),{array:o,itemSize:l,normalized:u}=a,f=new o.constructor(n*l),p=new li(f,l,u);t.setAttribute(r,p)}if(e.getIndex()!==null){const r=n>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new li(r,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const s=e.getAttribute(n),r=t.getAttribute(n);if(s.itemSize!==r.itemSize||s.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vr);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,s=t.length;n<s;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Wo),this.getBoundingBoxAt(r,J1).applyMatrix4(Wo),e.union(J1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new mr);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,s=t.length;n<s;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Wo),this.getBoundingSphereAt(r,ig).applyMatrix4(Wo),e.union(ig)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ow),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=n):(s=this._instanceInfo.length,this._instanceInfo.push(n));const r=this._matricesTexture;Wo.identity().toArray(r.image.data,s*16),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(PY.toArray(a.image.data,s*4),a.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=n===-1?a.count:n),s.indexStart!==-1&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ow),l=this._availableGeometryIds.shift(),r[l]=s):(l=this._geometryCount,this._geometryCount++,r.push(s)),this.setGeometryAt(l,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,s=n.getIndex()!==null,r=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(s&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,u=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const f in n.attributes){const p=t.getAttribute(f),x=n.getAttribute(f);zY(p,x,l);const y=p.itemSize;for(let _=p.count,T=u;_<T;_++){const A=l+_;for(let S=0;S<y;S++)x.setComponent(A,S,0)}x.needsUpdate=!0,x.addUpdateRange(l*y,u*y)}if(s){const f=o.indexStart,p=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let x=0;x<a.count;x++)r.setX(f+x,l+a.getX(x));for(let x=a.count,y=p;x<y;x++)r.setX(f+x,l);r.needsUpdate=!0,r.addUpdateRange(f,o.reservedIndexCount)}return o.start=s?o.indexStart:o.vertexStart,o.count=s?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let s=0,r=n.length;s<r;s++)n[s].active&&n[s].geometryIndex===e&&this.deleteInstance(s);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,s=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),r=this.geometry;for(let a=0,o=n.length;a<o;a++){const l=s[a],u=n[l];if(u.active!==!1){if(r.index!==null){if(u.indexStart!==t){const{indexStart:f,vertexStart:p,reservedIndexCount:x}=u,y=r.index,_=y.array,T=e-p;for(let A=f;A<f+x;A++)_[A]=_[A]+T;y.array.copyWithin(t,f,f+x),y.addUpdateRange(t,x),u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:f,reservedVertexCount:p}=u,x=r.attributes;for(const y in x){const _=x[y],{array:T,itemSize:A}=_;T.copyWithin(e*A,f*A,(f+p)*A),_.addUpdateRange(e*A,p*A)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=r.index?u.indexStart:u.vertexStart,this._nextIndexStart=r.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,s=this._geometryInfo[e];if(s.boundingBox===null){const r=new Vr,a=n.index,o=n.attributes.position;for(let l=s.start,u=s.start+s.count;l<u;l++){let f=l;a&&(f=a.getX(f)),r.expandByPoint(xb.fromBufferAttribute(o,f))}s.boundingBox=r}return t.copy(s.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,s=this._geometryInfo[e];if(s.boundingSphere===null){const r=new mr;this.getBoundingBoxAt(e,J1),J1.getCenter(r.center);const a=n.index,o=n.attributes.position;let l=0;for(let u=s.start,f=s.start+s.count;u<f;u++){let p=u;a&&(p=a.getX(p)),xb.fromBufferAttribute(o,p),l=Math.max(l,r.center.distanceToSquared(xb))}r.radius=Math.sqrt(l),s.boundingSphere=r}return t.copy(s.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,s=this._matricesTexture.image.data;return t.toArray(s,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(ow);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const s=new Int32Array(e),r=new Int32Array(e);sg(this._multiDrawCounts,s),sg(this._multiDrawStarts,r),this._multiDrawCounts=s,this._multiDrawStarts=r,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),sg(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),sg(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),sg(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Fn,this._initializeGeometry(r));const a=this.geometry;r.index&&sg(r.index.array,a.index.array);for(const o in r.attributes)sg(r.attributes[o].array,a.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,s=this._geometryInfo,r=this.matrixWorld,a=this.geometry;Pa.material=this.material,Pa.geometry.index=a.index,Pa.geometry.attributes=a.attributes,Pa.geometry.boundingBox===null&&(Pa.geometry.boundingBox=new Vr),Pa.geometry.boundingSphere===null&&(Pa.geometry.boundingSphere=new mr);for(let o=0,l=n.length;o<l;o++){if(!n[o].visible||!n[o].active)continue;const u=n[o].geometryIndex,f=s[u];Pa.geometry.setDrawRange(f.start,f.count),this.getMatrixAt(o,Pa.matrixWorld).premultiply(r),this.getBoundingBoxAt(u,Pa.geometry.boundingBox),this.getBoundingSphereAt(u,Pa.geometry.boundingSphere),Pa.raycast(e,Z1);for(let p=0,x=Z1.length;p<x;p++){const y=Z1[p];y.object=this,y.batchId=o,t.push(y)}Z1.length=0}Pa.material=null,Pa.geometry.index=null,Pa.geometry.attributes={},Pa.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,s,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=s.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,u=this._multiDrawStarts,f=this._multiDrawCounts,p=this._geometryInfo,x=this.perObjectFrustumCulled,y=this._indirectTexture,_=y.image.data,T=n.isArrayCamera?FY:VI;x&&!n.isArrayCamera&&(Wo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),VI.setFromProjectionMatrix(Wo,n.coordinateSystem,n.reversedDepth));let A=0;if(this.sortObjects){Wo.copy(this.matrixWorld).invert(),xb.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Wo),HI.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Wo);for(let w=0,B=l.length;w<B;w++)if(l[w].visible&&l[w].active){const L=l[w].geometryIndex;this.getMatrixAt(w,Wo),this.getBoundingSphereAt(L,ig).applyMatrix4(Wo);let D=!1;if(x&&(D=!T.intersectsSphere(ig,n)),!D){const O=p[L],F=GY.subVectors(ig.center,xb).dot(HI);lw.push(O.start,O.count,F,w)}}const S=lw.list,C=this.customSort;C===null?S.sort(r.transparent?LY:UY):C.call(this,S,n);for(let w=0,B=S.length;w<B;w++){const L=S[w];u[A]=L.start*o,f[A]=L.count,_[A]=L.index,A++}lw.reset()}else for(let S=0,C=l.length;S<C;S++)if(l[S].visible&&l[S].active){const w=l[S].geometryIndex;let B=!1;if(x&&(this.getMatrixAt(S,Wo),this.getBoundingSphereAt(w,ig).applyMatrix4(Wo),B=!T.intersectsSphere(ig,n)),!B){const L=p[w];u[A]=L.start*o,f[A]=L.count,_[A]=S,A++}}y.needsUpdate=!0,this._multiDrawCount=A,this._visibilityChanged=!1}onBeforeShadow(e,t,n,s,r,a){this.onBeforeRender(e,null,s,r,a)}}class ua extends ir{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Bt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const gM=new Q,xM=new Q,kI=new Yt,yb=new g0,Q1=new mr,cw=new Q,WI=new Q;class Cd extends mi{constructor(e=new Fn,t=new ua){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)gM.fromBufferAttribute(t,s-1),xM.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=gM.distanceTo(xM);e.setAttribute("lineDistance",new an(n,1))}else De("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Q1.copy(n.boundingSphere),Q1.applyMatrix4(s),Q1.radius+=r,e.ray.intersectsSphere(Q1)===!1)return;kI.copy(s).invert(),yb.copy(e.ray).applyMatrix4(kI);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,f=n.index,x=n.attributes.position;if(f!==null){const y=Math.max(0,a.start),_=Math.min(f.count,a.start+a.count);for(let T=y,A=_-1;T<A;T+=u){const S=f.getX(T),C=f.getX(T+1),w=eE(this,e,yb,l,S,C,T);w&&t.push(w)}if(this.isLineLoop){const T=f.getX(_-1),A=f.getX(y),S=eE(this,e,yb,l,T,A,_-1);S&&t.push(S)}}else{const y=Math.max(0,a.start),_=Math.min(x.count,a.start+a.count);for(let T=y,A=_-1;T<A;T+=u){const S=eE(this,e,yb,l,T,T+1,T);S&&t.push(S)}if(this.isLineLoop){const T=eE(this,e,yb,l,_-1,y,_-1);T&&t.push(T)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function eE(i,e,t,n,s,r,a){const o=i.geometry.attributes.position;if(gM.fromBufferAttribute(o,s),xM.fromBufferAttribute(o,r),t.distanceSqToSegment(gM,xM,cw,WI)>n)return;cw.applyMatrix4(i.matrixWorld);const u=e.ray.origin.distanceTo(cw);if(!(u<e.near||u>e.far))return{distance:u,point:WI.clone().applyMatrix4(i.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:i}}const XI=new Q,qI=new Q;class Sc extends Cd{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,r=t.count;s<r;s+=2)XI.fromBufferAttribute(t,s),qI.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+XI.distanceTo(qI);e.setAttribute("lineDistance",new an(n,1))}else De("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class EC extends Cd{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class fv extends ir{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Bt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const YI=new Yt,rN=new g0,tE=new mr,nE=new Q;class MC extends mi{constructor(e=new Fn,t=new fv){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),tE.copy(n.boundingSphere),tE.applyMatrix4(s),tE.radius+=r,e.ray.intersectsSphere(tE)===!1)return;YI.copy(s).invert(),rN.copy(e.ray).applyMatrix4(YI);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=n.index,p=n.attributes.position;if(u!==null){const x=Math.max(0,a.start),y=Math.min(u.count,a.start+a.count);for(let _=x,T=y;_<T;_++){const A=u.getX(_);nE.fromBufferAttribute(p,A),jI(nE,A,l,s,e,t,this)}}else{const x=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let _=x,T=y;_<T;_++)nE.fromBufferAttribute(p,_),jI(nE,_,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function jI(i,e,t,n,s,r,a){const o=rN.distanceSqToPoint(i);if(o<t){const l=new Q;rN.closestPointToPoint(i,l),l.applyMatrix4(n);const u=s.ray.origin.distanceTo(l);if(u<s.near||u>s.far)return;r.push({distance:u,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class JB extends pi{constructor(e,t,n,s,r=Dn,a=Dn,o,l,u){super(e,t,n,s,r,a,o,l,u),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const f=this;function p(){f.needsUpdate=!0,f._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class nV extends JB{constructor(e,t,n,s,r,a,o,l){super({},e,t,n,s,r,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class bT extends pi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=es,this.minFilter=es,this.generateMipmaps=!1,this.needsUpdate=!0}}class ST extends pi{constructor(e,t,n,s,r,a,o,l,u,f,p,x){super(null,a,o,l,u,f,s,r,p,x),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class iV extends ST{constructor(e,t,n,s,r,a){super(e,t,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=ts,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class sV extends ST{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Do),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class rV extends pi{constructor(e,t,n,s,r,a,o,l,u){super(e,t,n,s,r,a,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Bo extends pi{constructor(e,t,n=Xi,s,r,a,o=es,l=es,u,f=Ro,p=1){if(f!==Ro&&f!==wo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const x={width:e,height:t,depth:p};super(x,s,r,a,o,l,f,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Bf(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class CC extends pi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class TT extends Fn{constructor(e=1,t=1,n=4,s=8,r=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:s,heightSegments:r},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),s=Math.max(3,Math.floor(s)),r=Math.max(1,Math.floor(r));const a=[],o=[],l=[],u=[],f=t/2,p=Math.PI/2*e,x=t,y=2*p+x,_=n*2+r,T=s+1,A=new Q,S=new Q;for(let C=0;C<=_;C++){let w=0,B=0,L=0,D=0;if(C<=n){const U=C/n,P=U*Math.PI/2;B=-f-e*Math.cos(P),L=e*Math.sin(P),D=-e*Math.cos(P),w=U*p}else if(C<=n+r){const U=(C-n)/r;B=-f+U*t,L=e,D=0,w=p+U*x}else{const U=(C-n-r)/n,P=U*Math.PI/2;B=f+e*Math.sin(P),L=e*Math.cos(P),D=e*Math.sin(P),w=p+x+U*p}const O=Math.max(0,Math.min(1,w/y));let F=0;C===0?F=.5/s:C===_&&(F=-.5/s);for(let U=0;U<=s;U++){const P=U/s,X=P*Math.PI*2,Z=Math.sin(X),ee=Math.cos(X);S.x=-L*ee,S.y=B,S.z=L*Z,o.push(S.x,S.y,S.z),A.set(-L*ee,D,L*Z),A.normalize(),l.push(A.x,A.y,A.z),u.push(P+F,O)}if(C>0){const U=(C-1)*T;for(let P=0;P<s;P++){const X=U+P,Z=U+P+1,ee=C*T+P,te=C*T+P+1;a.push(X,Z,ee),a.push(Z,te,ee)}}}this.setIndex(a),this.setAttribute("position",new an(o,3)),this.setAttribute("normal",new an(l,3)),this.setAttribute("uv",new an(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TT(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class AT extends Fn{constructor(e=1,t=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const r=[],a=[],o=[],l=[],u=new Q,f=new Ze;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let p=0,x=3;p<=t;p++,x+=3){const y=n+p/t*s;u.x=e*Math.cos(y),u.y=e*Math.sin(y),a.push(u.x,u.y,u.z),o.push(0,0,1),f.x=(a[x]/e+1)/2,f.y=(a[x+1]/e+1)/2,l.push(f.x,f.y)}for(let p=1;p<=t;p++)r.push(p,p+1,0);this.setIndex(r),this.setAttribute("position",new an(a,3)),this.setAttribute("normal",new an(o,3)),this.setAttribute("uv",new an(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new AT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class y0 extends Fn{constructor(e=1,t=1,n=1,s=32,r=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:l};const u=this;s=Math.floor(s),r=Math.floor(r);const f=[],p=[],x=[],y=[];let _=0;const T=[],A=n/2;let S=0;C(),a===!1&&(e>0&&w(!0),t>0&&w(!1)),this.setIndex(f),this.setAttribute("position",new an(p,3)),this.setAttribute("normal",new an(x,3)),this.setAttribute("uv",new an(y,2));function C(){const B=new Q,L=new Q;let D=0;const O=(t-e)/n;for(let F=0;F<=r;F++){const U=[],P=F/r,X=P*(t-e)+e;for(let Z=0;Z<=s;Z++){const ee=Z/s,te=ee*l+o,re=Math.sin(te),W=Math.cos(te);L.x=X*re,L.y=-P*n+A,L.z=X*W,p.push(L.x,L.y,L.z),B.set(re,O,W).normalize(),x.push(B.x,B.y,B.z),y.push(ee,1-P),U.push(_++)}T.push(U)}for(let F=0;F<s;F++)for(let U=0;U<r;U++){const P=T[U][F],X=T[U+1][F],Z=T[U+1][F+1],ee=T[U][F+1];(e>0||U!==0)&&(f.push(P,X,ee),D+=3),(t>0||U!==r-1)&&(f.push(X,Z,ee),D+=3)}u.addGroup(S,D,0),S+=D}function w(B){const L=_,D=new Ze,O=new Q;let F=0;const U=B===!0?e:t,P=B===!0?1:-1;for(let Z=1;Z<=s;Z++)p.push(0,A*P,0),x.push(0,P,0),y.push(.5,.5),_++;const X=_;for(let Z=0;Z<=s;Z++){const te=Z/s*l+o,re=Math.cos(te),W=Math.sin(te);O.x=U*W,O.y=A*P,O.z=U*re,p.push(O.x,O.y,O.z),x.push(0,P,0),D.x=re*.5+.5,D.y=W*.5*P+.5,y.push(D.x,D.y),_++}for(let Z=0;Z<s;Z++){const ee=L+Z,te=X+Z;B===!0?f.push(te,te+1,ee):f.push(te+1,te,ee),F+=3}u.addGroup(S,F,B===!0?1:2),S+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new y0(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hv extends y0{constructor(e=1,t=1,n=32,s=1,r=!1,a=0,o=Math.PI*2){super(0,e,t,n,s,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(e){return new hv(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class eh extends Fn{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const r=[],a=[];o(s),u(n),f(),this.setAttribute("position",new an(r,3)),this.setAttribute("normal",new an(r.slice(),3)),this.setAttribute("uv",new an(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function o(C){const w=new Q,B=new Q,L=new Q;for(let D=0;D<t.length;D+=3)y(t[D+0],w),y(t[D+1],B),y(t[D+2],L),l(w,B,L,C)}function l(C,w,B,L){const D=L+1,O=[];for(let F=0;F<=D;F++){O[F]=[];const U=C.clone().lerp(B,F/D),P=w.clone().lerp(B,F/D),X=D-F;for(let Z=0;Z<=X;Z++)Z===0&&F===D?O[F][Z]=U:O[F][Z]=U.clone().lerp(P,Z/X)}for(let F=0;F<D;F++)for(let U=0;U<2*(D-F)-1;U++){const P=Math.floor(U/2);U%2===0?(x(O[F][P+1]),x(O[F+1][P]),x(O[F][P])):(x(O[F][P+1]),x(O[F+1][P+1]),x(O[F+1][P]))}}function u(C){const w=new Q;for(let B=0;B<r.length;B+=3)w.x=r[B+0],w.y=r[B+1],w.z=r[B+2],w.normalize().multiplyScalar(C),r[B+0]=w.x,r[B+1]=w.y,r[B+2]=w.z}function f(){const C=new Q;for(let w=0;w<r.length;w+=3){C.x=r[w+0],C.y=r[w+1],C.z=r[w+2];const B=A(C)/2/Math.PI+.5,L=S(C)/Math.PI+.5;a.push(B,1-L)}_(),p()}function p(){for(let C=0;C<a.length;C+=6){const w=a[C+0],B=a[C+2],L=a[C+4],D=Math.max(w,B,L),O=Math.min(w,B,L);D>.9&&O<.1&&(w<.2&&(a[C+0]+=1),B<.2&&(a[C+2]+=1),L<.2&&(a[C+4]+=1))}}function x(C){r.push(C.x,C.y,C.z)}function y(C,w){const B=C*3;w.x=e[B+0],w.y=e[B+1],w.z=e[B+2]}function _(){const C=new Q,w=new Q,B=new Q,L=new Q,D=new Ze,O=new Ze,F=new Ze;for(let U=0,P=0;U<r.length;U+=9,P+=6){C.set(r[U+0],r[U+1],r[U+2]),w.set(r[U+3],r[U+4],r[U+5]),B.set(r[U+6],r[U+7],r[U+8]),D.set(a[P+0],a[P+1]),O.set(a[P+2],a[P+3]),F.set(a[P+4],a[P+5]),L.copy(C).add(w).add(B).divideScalar(3);const X=A(L);T(D,P+0,C,X),T(O,P+2,w,X),T(F,P+4,B,X)}}function T(C,w,B,L){L<0&&C.x===1&&(a[w]=C.x-1),B.x===0&&B.z===0&&(a[w]=L/2/Math.PI+.5)}function A(C){return Math.atan2(C.z,-C.x)}function S(C){return Math.atan2(-C.y,Math.sqrt(C.x*C.x+C.z*C.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eh(e.vertices,e.indices,e.radius,e.details)}}class ET extends eh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ET(e.radius,e.detail)}}const iE=new Q,sE=new Q,uw=new Q,rE=new bo;class ZB extends Fn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(Og*t),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,u=[0,0,0],f=["a","b","c"],p=new Array(3),x={},y=[];for(let _=0;_<l;_+=3){a?(u[0]=a.getX(_),u[1]=a.getX(_+1),u[2]=a.getX(_+2)):(u[0]=_,u[1]=_+1,u[2]=_+2);const{a:T,b:A,c:S}=rE;if(T.fromBufferAttribute(o,u[0]),A.fromBufferAttribute(o,u[1]),S.fromBufferAttribute(o,u[2]),rE.getNormal(uw),p[0]=`${Math.round(T.x*s)},${Math.round(T.y*s)},${Math.round(T.z*s)}`,p[1]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,p[2]=`${Math.round(S.x*s)},${Math.round(S.y*s)},${Math.round(S.z*s)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let C=0;C<3;C++){const w=(C+1)%3,B=p[C],L=p[w],D=rE[f[C]],O=rE[f[w]],F=`${B}_${L}`,U=`${L}_${B}`;U in x&&x[U]?(uw.dot(x[U].normal)<=r&&(y.push(D.x,D.y,D.z),y.push(O.x,O.y,O.z)),x[U]=null):F in x||(x[F]={index0:u[C],index1:u[w],normal:uw.clone()})}}for(const _ in x)if(x[_]){const{index0:T,index1:A}=x[_];iE.fromBufferAttribute(o,T),sE.fromBufferAttribute(o,A),y.push(iE.x,iE.y,iE.z),y.push(sE.x,sE.y,sE.z)}this.setAttribute("position",new an(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Tc{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){De("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),r+=n.distanceTo(s),t.push(r),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let s=0;const r=n.length;let a;t?a=t:a=e*n[r-1];let o=0,l=r-1,u;for(;o<=l;)if(s=Math.floor(o+(l-o)/2),u=n[s]-a,u<0)o=s+1;else if(u>0)l=s-1;else{l=s;break}if(s=l,n[s]===a)return s/(r-1);const f=n[s],x=n[s+1]-f,y=(a-f)/x;return(s+y)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const a=this.getPoint(s),o=this.getPoint(r),l=t||(a.isVector2?new Ze:new Q);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new Q,s=[],r=[],a=[],o=new Q,l=new Yt;for(let y=0;y<=e;y++){const _=y/e;s[y]=this.getTangentAt(_,new Q)}r[0]=new Q,a[0]=new Q;let u=Number.MAX_VALUE;const f=Math.abs(s[0].x),p=Math.abs(s[0].y),x=Math.abs(s[0].z);f<=u&&(u=f,n.set(1,0,0)),p<=u&&(u=p,n.set(0,1,0)),x<=u&&n.set(0,0,1),o.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],o),a[0].crossVectors(s[0],r[0]);for(let y=1;y<=e;y++){if(r[y]=r[y-1].clone(),a[y]=a[y-1].clone(),o.crossVectors(s[y-1],s[y]),o.length()>Number.EPSILON){o.normalize();const _=Math.acos(Pn(s[y-1].dot(s[y]),-1,1));r[y].applyMatrix4(l.makeRotationAxis(o,_))}a[y].crossVectors(s[y],r[y])}if(t===!0){let y=Math.acos(Pn(r[0].dot(r[e]),-1,1));y/=e,s[0].dot(o.crossVectors(r[0],r[e]))>0&&(y=-y);for(let _=1;_<=e;_++)r[_].applyMatrix4(l.makeRotationAxis(s[_],y*_)),a[_].crossVectors(s[_],r[_])}return{tangents:s,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class MT extends Tc{constructor(e=0,t=0,n=1,s=1,r=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new Ze){const n=t,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(a?r=0:r=s),this.aClockwise===!0&&!a&&(r===s?r=-s:r=r-s);const o=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const f=Math.cos(this.aRotation),p=Math.sin(this.aRotation),x=l-this.aX,y=u-this.aY;l=x*f-y*p+this.aX,u=x*p+y*f+this.aY}return n.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class QB extends MT{constructor(e,t,n,s,r,a){super(e,t,n,n,s,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function eD(){let i=0,e=0,t=0,n=0;function s(r,a,o,l){i=r,e=o,t=-3*r+3*a-2*o-l,n=2*r-2*a+o+l}return{initCatmullRom:function(r,a,o,l,u){s(a,o,u*(o-r),u*(l-a))},initNonuniformCatmullRom:function(r,a,o,l,u,f,p){let x=(a-r)/u-(o-r)/(u+f)+(o-a)/f,y=(o-a)/f-(l-a)/(f+p)+(l-o)/p;x*=f,y*=f,s(a,o,x,y)},calc:function(r){const a=r*r,o=a*r;return i+e*r+t*a+n*o}}}const aE=new Q,dw=new eD,fw=new eD,hw=new eD;class tD extends Tc{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new Q){const n=t,s=this.points,r=s.length,a=(r-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:l===0&&o===r-1&&(o=r-2,l=1);let u,f;this.closed||o>0?u=s[(o-1)%r]:(aE.subVectors(s[0],s[1]).add(s[0]),u=aE);const p=s[o%r],x=s[(o+1)%r];if(this.closed||o+2<r?f=s[(o+2)%r]:(aE.subVectors(s[r-1],s[r-2]).add(s[r-1]),f=aE),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let _=Math.pow(u.distanceToSquared(p),y),T=Math.pow(p.distanceToSquared(x),y),A=Math.pow(x.distanceToSquared(f),y);T<1e-4&&(T=1),_<1e-4&&(_=T),A<1e-4&&(A=T),dw.initNonuniformCatmullRom(u.x,p.x,x.x,f.x,_,T,A),fw.initNonuniformCatmullRom(u.y,p.y,x.y,f.y,_,T,A),hw.initNonuniformCatmullRom(u.z,p.z,x.z,f.z,_,T,A)}else this.curveType==="catmullrom"&&(dw.initCatmullRom(u.x,p.x,x.x,f.x,this.tension),fw.initCatmullRom(u.y,p.y,x.y,f.y,this.tension),hw.initCatmullRom(u.z,p.z,x.z,f.z,this.tension));return n.set(dw.calc(l),fw.calc(l),hw.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Q().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function $I(i,e,t,n,s){const r=(n-e)*.5,a=(s-t)*.5,o=i*i,l=i*o;return(2*t-2*n+r+a)*l+(-3*t+3*n-2*r-a)*o+r*i+t}function VY(i,e){const t=1-i;return t*t*e}function HY(i,e){return 2*(1-i)*i*e}function kY(i,e){return i*i*e}function iS(i,e,t,n){return VY(i,e)+HY(i,t)+kY(i,n)}function WY(i,e){const t=1-i;return t*t*t*e}function XY(i,e){const t=1-i;return 3*t*t*i*e}function qY(i,e){return 3*(1-i)*i*i*e}function YY(i,e){return i*i*i*e}function sS(i,e,t,n,s){return WY(i,e)+XY(i,t)+qY(i,n)+YY(i,s)}class RC extends Tc{constructor(e=new Ze,t=new Ze,n=new Ze,s=new Ze){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Ze){const n=t,s=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(sS(e,s.x,r.x,a.x,o.x),sS(e,s.y,r.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class nD extends Tc{constructor(e=new Q,t=new Q,n=new Q,s=new Q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Q){const n=t,s=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(sS(e,s.x,r.x,a.x,o.x),sS(e,s.y,r.y,a.y,o.y),sS(e,s.z,r.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class wC extends Tc{constructor(e=new Ze,t=new Ze){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ze){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ze){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iD extends Tc{constructor(e=new Q,t=new Q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Q){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class NC extends Tc{constructor(e=new Ze,t=new Ze,n=new Ze){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ze){const n=t,s=this.v0,r=this.v1,a=this.v2;return n.set(iS(e,s.x,r.x,a.x),iS(e,s.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class BC extends Tc{constructor(e=new Q,t=new Q,n=new Q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Q){const n=t,s=this.v0,r=this.v1,a=this.v2;return n.set(iS(e,s.x,r.x,a.x),iS(e,s.y,r.y,a.y),iS(e,s.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class DC extends Tc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ze){const n=t,s=this.points,r=(s.length-1)*e,a=Math.floor(r),o=r-a,l=s[a===0?a:a-1],u=s[a],f=s[a>s.length-2?s.length-1:a+1],p=s[a>s.length-3?s.length-1:a+2];return n.set($I(o,l.x,u.x,f.x,p.x),$I(o,l.y,u.y,f.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Ze().fromArray(s))}return this}}var yM=Object.freeze({__proto__:null,ArcCurve:QB,CatmullRomCurve3:tD,CubicBezierCurve:RC,CubicBezierCurve3:nD,EllipseCurve:MT,LineCurve:wC,LineCurve3:iD,QuadraticBezierCurve:NC,QuadraticBezierCurve3:BC,SplineCurve:DC});class sD extends Tc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new yM[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=n){const a=s[r]-n,o=this.curves[r],l=o.getLength(),u=l===0?0:1-a/l;return o.getPointAt(u,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,r=this.curves;s<r.length;s++){const a=r[s],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let u=0;u<l.length;u++){const f=l[u];n&&n.equals(f)||(t.push(f),n=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(new yM[s.type]().fromJSON(s))}return this}}class MS extends sD{constructor(e){super(),this.type="Path",this.currentPoint=new Ze,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new wC(this.currentPoint.clone(),new Ze(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const r=new NC(this.currentPoint.clone(),new Ze(e,t),new Ze(n,s));return this.curves.push(r),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,r,a){const o=new RC(this.currentPoint.clone(),new Ze(e,t),new Ze(n,s),new Ze(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new DC(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,r,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,n,s,r,a),this}absarc(e,t,n,s,r,a){return this.absellipse(e,t,n,n,s,r,a),this}ellipse(e,t,n,s,r,a,o,l){const u=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+u,t+f,n,s,r,a,o,l),this}absellipse(e,t,n,s,r,a,o,l){const u=new MT(e,t,n,s,r,a,o,l);if(this.curves.length>0){const p=u.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(u);const f=u.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class hp extends MS{constructor(e){super(e),this.uuid=El(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(new MS().fromJSON(s))}return this}}function jY(i,e,t=2){const n=e&&e.length,s=n?e[0]*t:i.length;let r=aV(i,0,s,t,!0);const a=[];if(!r||r.next===r.prev)return a;let o,l,u;if(n&&(r=QY(i,e,r,t)),i.length>80*t){o=i[0],l=i[1];let f=o,p=l;for(let x=t;x<s;x+=t){const y=i[x],_=i[x+1];y<o&&(o=y),_<l&&(l=_),y>f&&(f=y),_>p&&(p=_)}u=Math.max(f-o,p-l),u=u!==0?32767/u:0}return CS(r,a,t,o,l,u,0),a}function aV(i,e,t,n,s){let r;if(s===uj(i,e,t,n)>0)for(let a=e;a<t;a+=n)r=KI(a/n|0,i[a],i[a+1],r);else for(let a=t-n;a>=e;a-=n)r=KI(a/n|0,i[a],i[a+1],r);return r&&Vy(r,r.next)&&(wS(r),r=r.next),r}function a0(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(Vy(t,t.next)||qs(t.prev,t,t.next)===0)){if(wS(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function CS(i,e,t,n,s,r,a){if(!i)return;!a&&r&&sj(i,n,s,r);let o=i;for(;i.prev!==i.next;){const l=i.prev,u=i.next;if(r?KY(i,n,s,r):$Y(i)){e.push(l.i,i.i,u.i),wS(i),i=u.next,o=u.next;continue}if(i=u,i===o){a?a===1?(i=JY(a0(i),e),CS(i,e,t,n,s,r,2)):a===2&&ZY(i,e,t,n,s,r):CS(a0(i),e,t,n,s,r,1);break}}}function $Y(i){const e=i.prev,t=i,n=i.next;if(qs(e,t,n)>=0)return!1;const s=e.x,r=t.x,a=n.x,o=e.y,l=t.y,u=n.y,f=Math.min(s,r,a),p=Math.min(o,l,u),x=Math.max(s,r,a),y=Math.max(o,l,u);let _=n.next;for(;_!==e;){if(_.x>=f&&_.x<=x&&_.y>=p&&_.y<=y&&Kb(s,o,r,l,a,u,_.x,_.y)&&qs(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function KY(i,e,t,n){const s=i.prev,r=i,a=i.next;if(qs(s,r,a)>=0)return!1;const o=s.x,l=r.x,u=a.x,f=s.y,p=r.y,x=a.y,y=Math.min(o,l,u),_=Math.min(f,p,x),T=Math.max(o,l,u),A=Math.max(f,p,x),S=aN(y,_,e,t,n),C=aN(T,A,e,t,n);let w=i.prevZ,B=i.nextZ;for(;w&&w.z>=S&&B&&B.z<=C;){if(w.x>=y&&w.x<=T&&w.y>=_&&w.y<=A&&w!==s&&w!==a&&Kb(o,f,l,p,u,x,w.x,w.y)&&qs(w.prev,w,w.next)>=0||(w=w.prevZ,B.x>=y&&B.x<=T&&B.y>=_&&B.y<=A&&B!==s&&B!==a&&Kb(o,f,l,p,u,x,B.x,B.y)&&qs(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;w&&w.z>=S;){if(w.x>=y&&w.x<=T&&w.y>=_&&w.y<=A&&w!==s&&w!==a&&Kb(o,f,l,p,u,x,w.x,w.y)&&qs(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;B&&B.z<=C;){if(B.x>=y&&B.x<=T&&B.y>=_&&B.y<=A&&B!==s&&B!==a&&Kb(o,f,l,p,u,x,B.x,B.y)&&qs(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function JY(i,e){let t=i;do{const n=t.prev,s=t.next.next;!Vy(n,s)&&lV(n,t,t.next,s)&&RS(n,s)&&RS(s,n)&&(e.push(n.i,t.i,s.i),wS(t),wS(t.next),t=i=s),t=t.next}while(t!==i);return a0(t)}function ZY(i,e,t,n,s,r){let a=i;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&oj(a,o)){let l=cV(a,o);a=a0(a,a.next),l=a0(l,l.next),CS(a,e,t,n,s,r,0),CS(l,e,t,n,s,r,0);return}o=o.next}a=a.next}while(a!==i)}function QY(i,e,t,n){const s=[];for(let r=0,a=e.length;r<a;r++){const o=e[r]*n,l=r<a-1?e[r+1]*n:i.length,u=aV(i,o,l,n,!1);u===u.next&&(u.steiner=!0),s.push(aj(u))}s.sort(ej);for(let r=0;r<s.length;r++)t=tj(s[r],t);return t}function ej(i,e){let t=i.x-e.x;if(t===0&&(t=i.y-e.y,t===0)){const n=(i.next.y-i.y)/(i.next.x-i.x),s=(e.next.y-e.y)/(e.next.x-e.x);t=n-s}return t}function tj(i,e){const t=nj(i,e);if(!t)return e;const n=cV(t,i);return a0(n,n.next),a0(t,t.next)}function nj(i,e){let t=e;const n=i.x,s=i.y;let r=-1/0,a;if(Vy(i,t))return t;do{if(Vy(i,t.next))return t.next;if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const p=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=n&&p>r&&(r=p,a=t.x<t.next.x?t:t.next,p===n))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,u=a.y;let f=1/0;t=a;do{if(n>=t.x&&t.x>=l&&n!==t.x&&oV(s<u?n:r,s,l,u,s<u?r:n,s,t.x,t.y)){const p=Math.abs(s-t.y)/(n-t.x);RS(t,i)&&(p<f||p===f&&(t.x>a.x||t.x===a.x&&ij(a,t)))&&(a=t,f=p)}t=t.next}while(t!==o);return a}function ij(i,e){return qs(i.prev,i,e.prev)<0&&qs(e.next,i,i.next)<0}function sj(i,e,t,n){let s=i;do s.z===0&&(s.z=aN(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,rj(s)}function rj(i){let e,t=1;do{let n=i,s;i=null;let r=null;for(e=0;n;){e++;let a=n,o=0;for(let u=0;u<t&&(o++,a=a.nextZ,!!a);u++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||n.z<=a.z)?(s=n,n=n.nextZ,o--):(s=a,a=a.nextZ,l--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;n=a}r.nextZ=null,t*=2}while(e>1);return i}function aN(i,e,t,n,s){return i=(i-t)*s|0,e=(e-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function aj(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function oV(i,e,t,n,s,r,a,o){return(s-a)*(e-o)>=(i-a)*(r-o)&&(i-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(s-a)*(n-o)}function Kb(i,e,t,n,s,r,a,o){return!(i===a&&e===o)&&oV(i,e,t,n,s,r,a,o)}function oj(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!lj(i,e)&&(RS(i,e)&&RS(e,i)&&cj(i,e)&&(qs(i.prev,i,e.prev)||qs(i,e.prev,e))||Vy(i,e)&&qs(i.prev,i,i.next)>0&&qs(e.prev,e,e.next)>0)}function qs(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Vy(i,e){return i.x===e.x&&i.y===e.y}function lV(i,e,t,n){const s=lE(qs(i,e,t)),r=lE(qs(i,e,n)),a=lE(qs(t,n,i)),o=lE(qs(t,n,e));return!!(s!==r&&a!==o||s===0&&oE(i,t,e)||r===0&&oE(i,n,e)||a===0&&oE(t,i,n)||o===0&&oE(t,e,n))}function oE(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function lE(i){return i>0?1:i<0?-1:0}function lj(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&lV(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function RS(i,e){return qs(i.prev,i,i.next)<0?qs(i,e,i.next)>=0&&qs(i,i.prev,e)>=0:qs(i,e,i.prev)<0||qs(i,i.next,e)<0}function cj(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,r=(i.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function cV(i,e){const t=oN(i.i,i.x,i.y),n=oN(e.i,e.x,e.y),s=i.next,r=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function KI(i,e,t,n){const s=oN(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function wS(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function oN(i,e,t){return{i,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function uj(i,e,t,n){let s=0;for(let r=e,a=t-n;r<t;r+=n)s+=(i[a]-i[r])*(i[r+1]+i[a+1]),a=r;return s}class dj{static triangulate(e,t,n=2){return jY(e,t,n)}}class hc{static area(e){const t=e.length;let n=0;for(let s=t-1,r=0;r<t;s=r++)n+=e[s].x*e[r].y-e[r].x*e[s].y;return n*.5}static isClockWise(e){return hc.area(e)<0}static triangulateShape(e,t){const n=[],s=[],r=[];JI(e),ZI(n,e);let a=e.length;t.forEach(JI);for(let l=0;l<t.length;l++)s.push(a),a+=t[l].length,ZI(n,t[l]);const o=dj.triangulate(n,s);for(let l=0;l<o.length;l+=3)r.push(o.slice(l,l+3));return r}}function JI(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function ZI(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class CT extends Fn{constructor(e=new hp([new Ze(.5,.5),new Ze(-.5,.5),new Ze(-.5,-.5),new Ze(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],r=[];for(let o=0,l=e.length;o<l;o++){const u=e[o];a(u)}this.setAttribute("position",new an(s,3)),this.setAttribute("uv",new an(r,2)),this.computeVertexNormals();function a(o){const l=[],u=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1,p=t.depth!==void 0?t.depth:1;let x=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,_=t.bevelSize!==void 0?t.bevelSize:y-.1,T=t.bevelOffset!==void 0?t.bevelOffset:0,A=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,C=t.UVGenerator!==void 0?t.UVGenerator:fj;let w,B=!1,L,D,O,F;S&&(w=S.getSpacedPoints(f),B=!0,x=!1,L=S.computeFrenetFrames(f,!1),D=new Q,O=new Q,F=new Q),x||(A=0,y=0,_=0,T=0);const U=o.extractPoints(u);let P=U.shape;const X=U.holes;if(!hc.isClockWise(P)){P=P.reverse();for(let Qe=0,ie=X.length;Qe<ie;Qe++){const ot=X[Qe];hc.isClockWise(ot)&&(X[Qe]=ot.reverse())}}function ee(Qe){const ot=10000000000000001e-36;let dt=Qe[0];for(let Tt=1;Tt<=Qe.length;Tt++){const ht=Tt%Qe.length,Ut=Qe[ht],At=Ut.x-dt.x,Ht=Ut.y-dt.y,q=At*At+Ht*Ht,V=Math.max(Math.abs(Ut.x),Math.abs(Ut.y),Math.abs(dt.x),Math.abs(dt.y)),Te=ot*V*V;if(q<=Te){Qe.splice(ht,1),Tt--;continue}dt=Ut}}ee(P),X.forEach(ee);const te=X.length,re=P;for(let Qe=0;Qe<te;Qe++){const ie=X[Qe];P=P.concat(ie)}function W(Qe,ie,ot){return ie||nt("ExtrudeGeometry: vec does not exist"),Qe.clone().addScaledVector(ie,ot)}const ne=P.length;function se(Qe,ie,ot){let dt,Tt,ht;const Ut=Qe.x-ie.x,At=Qe.y-ie.y,Ht=ot.x-Qe.x,q=ot.y-Qe.y,V=Ut*Ut+At*At,Te=Ut*q-At*Ht;if(Math.abs(Te)>Number.EPSILON){const Ge=Math.sqrt(V),$e=Math.sqrt(Ht*Ht+q*q),Ve=ie.x-At/Ge,Xt=ie.y+Ut/Ge,Ot=ot.x-q/$e,cn=ot.y+Ht/$e,Qt=((Ot-Ve)*q-(cn-Xt)*Ht)/(Ut*q-At*Ht);dt=Ve+Ut*Qt-Qe.x,Tt=Xt+At*Qt-Qe.y;const et=dt*dt+Tt*Tt;if(et<=2)return new Ze(dt,Tt);ht=Math.sqrt(et/2)}else{let Ge=!1;Ut>Number.EPSILON?Ht>Number.EPSILON&&(Ge=!0):Ut<-Number.EPSILON?Ht<-Number.EPSILON&&(Ge=!0):Math.sign(At)===Math.sign(q)&&(Ge=!0),Ge?(dt=-At,Tt=Ut,ht=Math.sqrt(V)):(dt=Ut,Tt=At,ht=Math.sqrt(V/2))}return new Ze(dt/ht,Tt/ht)}const ge=[];for(let Qe=0,ie=re.length,ot=ie-1,dt=Qe+1;Qe<ie;Qe++,ot++,dt++)ot===ie&&(ot=0),dt===ie&&(dt=0),ge[Qe]=se(re[Qe],re[ot],re[dt]);const _e=[];let K,pe=ge.concat();for(let Qe=0,ie=te;Qe<ie;Qe++){const ot=X[Qe];K=[];for(let dt=0,Tt=ot.length,ht=Tt-1,Ut=dt+1;dt<Tt;dt++,ht++,Ut++)ht===Tt&&(ht=0),Ut===Tt&&(Ut=0),K[dt]=se(ot[dt],ot[ht],ot[Ut]);_e.push(K),pe=pe.concat(K)}let we;if(A===0)we=hc.triangulateShape(re,X);else{const Qe=[],ie=[];for(let ot=0;ot<A;ot++){const dt=ot/A,Tt=y*Math.cos(dt*Math.PI/2),ht=_*Math.sin(dt*Math.PI/2)+T;for(let Ut=0,At=re.length;Ut<At;Ut++){const Ht=W(re[Ut],ge[Ut],ht);Dt(Ht.x,Ht.y,-Tt),dt===0&&Qe.push(Ht)}for(let Ut=0,At=te;Ut<At;Ut++){const Ht=X[Ut];K=_e[Ut];const q=[];for(let V=0,Te=Ht.length;V<Te;V++){const Ge=W(Ht[V],K[V],ht);Dt(Ge.x,Ge.y,-Tt),dt===0&&q.push(Ge)}dt===0&&ie.push(q)}}we=hc.triangulateShape(Qe,ie)}const Ne=we.length,gt=_+T;for(let Qe=0;Qe<ne;Qe++){const ie=x?W(P[Qe],pe[Qe],gt):P[Qe];B?(O.copy(L.normals[0]).multiplyScalar(ie.x),D.copy(L.binormals[0]).multiplyScalar(ie.y),F.copy(w[0]).add(O).add(D),Dt(F.x,F.y,F.z)):Dt(ie.x,ie.y,0)}for(let Qe=1;Qe<=f;Qe++)for(let ie=0;ie<ne;ie++){const ot=x?W(P[ie],pe[ie],gt):P[ie];B?(O.copy(L.normals[Qe]).multiplyScalar(ot.x),D.copy(L.binormals[Qe]).multiplyScalar(ot.y),F.copy(w[Qe]).add(O).add(D),Dt(F.x,F.y,F.z)):Dt(ot.x,ot.y,p/f*Qe)}for(let Qe=A-1;Qe>=0;Qe--){const ie=Qe/A,ot=y*Math.cos(ie*Math.PI/2),dt=_*Math.sin(ie*Math.PI/2)+T;for(let Tt=0,ht=re.length;Tt<ht;Tt++){const Ut=W(re[Tt],ge[Tt],dt);Dt(Ut.x,Ut.y,p+ot)}for(let Tt=0,ht=X.length;Tt<ht;Tt++){const Ut=X[Tt];K=_e[Tt];for(let At=0,Ht=Ut.length;At<Ht;At++){const q=W(Ut[At],K[At],dt);B?Dt(q.x,q.y+w[f-1].y,w[f-1].x+ot):Dt(q.x,q.y,p+ot)}}}Se(),Be();function Se(){const Qe=s.length/3;if(x){let ie=0,ot=ne*ie;for(let dt=0;dt<Ne;dt++){const Tt=we[dt];Nt(Tt[2]+ot,Tt[1]+ot,Tt[0]+ot)}ie=f+A*2,ot=ne*ie;for(let dt=0;dt<Ne;dt++){const Tt=we[dt];Nt(Tt[0]+ot,Tt[1]+ot,Tt[2]+ot)}}else{for(let ie=0;ie<Ne;ie++){const ot=we[ie];Nt(ot[2],ot[1],ot[0])}for(let ie=0;ie<Ne;ie++){const ot=we[ie];Nt(ot[0]+ne*f,ot[1]+ne*f,ot[2]+ne*f)}}n.addGroup(Qe,s.length/3-Qe,0)}function Be(){const Qe=s.length/3;let ie=0;ct(re,ie),ie+=re.length;for(let ot=0,dt=X.length;ot<dt;ot++){const Tt=X[ot];ct(Tt,ie),ie+=Tt.length}n.addGroup(Qe,s.length/3-Qe,1)}function ct(Qe,ie){let ot=Qe.length;for(;--ot>=0;){const dt=ot;let Tt=ot-1;Tt<0&&(Tt=Qe.length-1);for(let ht=0,Ut=f+A*2;ht<Ut;ht++){const At=ne*ht,Ht=ne*(ht+1),q=ie+dt+At,V=ie+Tt+At,Te=ie+Tt+Ht,Ge=ie+dt+Ht;It(q,V,Te,Ge)}}}function Dt(Qe,ie,ot){l.push(Qe),l.push(ie),l.push(ot)}function Nt(Qe,ie,ot){Mn(Qe),Mn(ie),Mn(ot);const dt=s.length/3,Tt=C.generateTopUV(n,s,dt-3,dt-2,dt-1);Gt(Tt[0]),Gt(Tt[1]),Gt(Tt[2])}function It(Qe,ie,ot,dt){Mn(Qe),Mn(ie),Mn(dt),Mn(ie),Mn(ot),Mn(dt);const Tt=s.length/3,ht=C.generateSideWallUV(n,s,Tt-6,Tt-3,Tt-2,Tt-1);Gt(ht[0]),Gt(ht[1]),Gt(ht[3]),Gt(ht[1]),Gt(ht[2]),Gt(ht[3])}function Mn(Qe){s.push(l[Qe*3+0]),s.push(l[Qe*3+1]),s.push(l[Qe*3+2])}function Gt(Qe){r.push(Qe.x),r.push(Qe.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return hj(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,a=e.shapes.length;r<a;r++){const o=t[e.shapes[r]];n.push(o)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new yM[s.type]().fromJSON(s)),new CT(n,e.options)}}const fj={generateTopUV:function(i,e,t,n,s){const r=e[t*3],a=e[t*3+1],o=e[n*3],l=e[n*3+1],u=e[s*3],f=e[s*3+1];return[new Ze(r,a),new Ze(o,l),new Ze(u,f)]},generateSideWallUV:function(i,e,t,n,s,r){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],u=e[n*3],f=e[n*3+1],p=e[n*3+2],x=e[s*3],y=e[s*3+1],_=e[s*3+2],T=e[r*3],A=e[r*3+1],S=e[r*3+2];return Math.abs(o-f)<Math.abs(a-u)?[new Ze(a,1-l),new Ze(u,1-p),new Ze(x,1-_),new Ze(T,1-S)]:[new Ze(o,1-l),new Ze(f,1-p),new Ze(y,1-_),new Ze(A,1-S)]}};function hj(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class pv extends eh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pv(e.radius,e.detail)}}class RT extends Fn{constructor(e=[new Ze(0,-.5),new Ze(.5,0),new Ze(0,.5)],t=12,n=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=Pn(s,0,Math.PI*2);const r=[],a=[],o=[],l=[],u=[],f=1/t,p=new Q,x=new Ze,y=new Q,_=new Q,T=new Q;let A=0,S=0;for(let C=0;C<=e.length-1;C++)switch(C){case 0:A=e[C+1].x-e[C].x,S=e[C+1].y-e[C].y,y.x=S*1,y.y=-A,y.z=S*0,T.copy(y),y.normalize(),l.push(y.x,y.y,y.z);break;case e.length-1:l.push(T.x,T.y,T.z);break;default:A=e[C+1].x-e[C].x,S=e[C+1].y-e[C].y,y.x=S*1,y.y=-A,y.z=S*0,_.copy(y),y.x+=T.x,y.y+=T.y,y.z+=T.z,y.normalize(),l.push(y.x,y.y,y.z),T.copy(_)}for(let C=0;C<=t;C++){const w=n+C*f*s,B=Math.sin(w),L=Math.cos(w);for(let D=0;D<=e.length-1;D++){p.x=e[D].x*B,p.y=e[D].y,p.z=e[D].x*L,a.push(p.x,p.y,p.z),x.x=C/t,x.y=D/(e.length-1),o.push(x.x,x.y);const O=l[3*D+0]*B,F=l[3*D+1],U=l[3*D+0]*L;u.push(O,F,U)}}for(let C=0;C<t;C++)for(let w=0;w<e.length-1;w++){const B=w+C*e.length,L=B,D=B+e.length,O=B+e.length+1,F=B+1;r.push(L,D,F),r.push(O,F,D)}this.setIndex(r),this.setAttribute("position",new an(a,3)),this.setAttribute("uv",new an(o,2)),this.setAttribute("normal",new an(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RT(e.points,e.segments,e.phiStart,e.phiLength)}}class mv extends eh{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mv(e.radius,e.detail)}}class Bd extends Fn{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,a=t/2,o=Math.floor(n),l=Math.floor(s),u=o+1,f=l+1,p=e/o,x=t/l,y=[],_=[],T=[],A=[];for(let S=0;S<f;S++){const C=S*x-a;for(let w=0;w<u;w++){const B=w*p-r;_.push(B,-C,0),T.push(0,0,1),A.push(w/o),A.push(1-S/l)}}for(let S=0;S<l;S++)for(let C=0;C<o;C++){const w=C+u*S,B=C+u*(S+1),L=C+1+u*(S+1),D=C+1+u*S;y.push(w,B,D),y.push(B,L,D)}this.setIndex(y),this.setAttribute("position",new an(_,3)),this.setAttribute("normal",new an(T,3)),this.setAttribute("uv",new an(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bd(e.width,e.height,e.widthSegments,e.heightSegments)}}class wT extends Fn{constructor(e=.5,t=1,n=32,s=1,r=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:r,thetaLength:a},n=Math.max(3,n),s=Math.max(1,s);const o=[],l=[],u=[],f=[];let p=e;const x=(t-e)/s,y=new Q,_=new Ze;for(let T=0;T<=s;T++){for(let A=0;A<=n;A++){const S=r+A/n*a;y.x=p*Math.cos(S),y.y=p*Math.sin(S),l.push(y.x,y.y,y.z),u.push(0,0,1),_.x=(y.x/t+1)/2,_.y=(y.y/t+1)/2,f.push(_.x,_.y)}p+=x}for(let T=0;T<s;T++){const A=T*(n+1);for(let S=0;S<n;S++){const C=S+A,w=C,B=C+n+1,L=C+n+2,D=C+1;o.push(w,B,D),o.push(B,L,D)}}this.setIndex(o),this.setAttribute("position",new an(l,3)),this.setAttribute("normal",new an(u,3)),this.setAttribute("uv",new an(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wT(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class NT extends Fn{constructor(e=new hp([new Ze(0,.5),new Ze(-.5,-.5),new Ze(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],r=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)u(e);else for(let f=0;f<e.length;f++)u(e[f]),this.addGroup(o,l,f),o+=l,l=0;this.setIndex(n),this.setAttribute("position",new an(s,3)),this.setAttribute("normal",new an(r,3)),this.setAttribute("uv",new an(a,2));function u(f){const p=s.length/3,x=f.extractPoints(t);let y=x.shape;const _=x.holes;hc.isClockWise(y)===!1&&(y=y.reverse());for(let A=0,S=_.length;A<S;A++){const C=_[A];hc.isClockWise(C)===!0&&(_[A]=C.reverse())}const T=hc.triangulateShape(y,_);for(let A=0,S=_.length;A<S;A++){const C=_[A];y=y.concat(C)}for(let A=0,S=y.length;A<S;A++){const C=y[A];s.push(C.x,C.y,0),r.push(0,0,1),a.push(C.x,C.y)}for(let A=0,S=T.length;A<S;A++){const C=T[A],w=C[0]+p,B=C[1]+p,L=C[2]+p;n.push(w,B,L),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return pj(t,e)}static fromJSON(e,t){const n=[];for(let s=0,r=e.shapes.length;s<r;s++){const a=t[e.shapes[s]];n.push(a)}return new NT(n,e.curveSegments)}}function pj(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class v0 extends Fn{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(a+o,Math.PI);let u=0;const f=[],p=new Q,x=new Q,y=[],_=[],T=[],A=[];for(let S=0;S<=n;S++){const C=[],w=S/n;let B=0;S===0&&a===0?B=.5/t:S===n&&l===Math.PI&&(B=-.5/t);for(let L=0;L<=t;L++){const D=L/t;p.x=-e*Math.cos(s+D*r)*Math.sin(a+w*o),p.y=e*Math.cos(a+w*o),p.z=e*Math.sin(s+D*r)*Math.sin(a+w*o),_.push(p.x,p.y,p.z),x.copy(p).normalize(),T.push(x.x,x.y,x.z),A.push(D+B,1-w),C.push(u++)}f.push(C)}for(let S=0;S<n;S++)for(let C=0;C<t;C++){const w=f[S][C+1],B=f[S][C],L=f[S+1][C],D=f[S+1][C+1];(S!==0||a>0)&&y.push(w,B,D),(S!==n-1||l<Math.PI)&&y.push(B,L,D)}this.setIndex(y),this.setAttribute("position",new an(_,3)),this.setAttribute("normal",new an(T,3)),this.setAttribute("uv",new an(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new v0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class BT extends eh{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new BT(e.radius,e.detail)}}class DT extends Fn{constructor(e=1,t=.4,n=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},n=Math.floor(n),s=Math.floor(s);const a=[],o=[],l=[],u=[],f=new Q,p=new Q,x=new Q;for(let y=0;y<=n;y++)for(let _=0;_<=s;_++){const T=_/s*r,A=y/n*Math.PI*2;p.x=(e+t*Math.cos(A))*Math.cos(T),p.y=(e+t*Math.cos(A))*Math.sin(T),p.z=t*Math.sin(A),o.push(p.x,p.y,p.z),f.x=e*Math.cos(T),f.y=e*Math.sin(T),x.subVectors(p,f).normalize(),l.push(x.x,x.y,x.z),u.push(_/s),u.push(y/n)}for(let y=1;y<=n;y++)for(let _=1;_<=s;_++){const T=(s+1)*y+_-1,A=(s+1)*(y-1)+_-1,S=(s+1)*(y-1)+_,C=(s+1)*y+_;a.push(T,A,C),a.push(A,S,C)}this.setIndex(a),this.setAttribute("position",new an(o,3)),this.setAttribute("normal",new an(l,3)),this.setAttribute("uv",new an(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DT(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class OT extends Fn{constructor(e=1,t=.4,n=64,s=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:r,q:a},n=Math.floor(n),s=Math.floor(s);const o=[],l=[],u=[],f=[],p=new Q,x=new Q,y=new Q,_=new Q,T=new Q,A=new Q,S=new Q;for(let w=0;w<=n;++w){const B=w/n*r*Math.PI*2;C(B,r,a,e,y),C(B+.01,r,a,e,_),A.subVectors(_,y),S.addVectors(_,y),T.crossVectors(A,S),S.crossVectors(T,A),T.normalize(),S.normalize();for(let L=0;L<=s;++L){const D=L/s*Math.PI*2,O=-t*Math.cos(D),F=t*Math.sin(D);p.x=y.x+(O*S.x+F*T.x),p.y=y.y+(O*S.y+F*T.y),p.z=y.z+(O*S.z+F*T.z),l.push(p.x,p.y,p.z),x.subVectors(p,y).normalize(),u.push(x.x,x.y,x.z),f.push(w/n),f.push(L/s)}}for(let w=1;w<=n;w++)for(let B=1;B<=s;B++){const L=(s+1)*(w-1)+(B-1),D=(s+1)*w+(B-1),O=(s+1)*w+B,F=(s+1)*(w-1)+B;o.push(L,D,F),o.push(D,O,F)}this.setIndex(o),this.setAttribute("position",new an(l,3)),this.setAttribute("normal",new an(u,3)),this.setAttribute("uv",new an(f,2));function C(w,B,L,D,O){const F=Math.cos(w),U=Math.sin(w),P=L/B*w,X=Math.cos(P);O.x=D*(2+X)*.5*F,O.y=D*(2+X)*U*.5,O.z=D*Math.sin(P)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class UT extends Fn{constructor(e=new BC(new Q(-1,-1,0),new Q(-1,1,0),new Q(1,1,0)),t=64,n=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:r};const a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Q,l=new Q,u=new Ze;let f=new Q;const p=[],x=[],y=[],_=[];T(),this.setIndex(_),this.setAttribute("position",new an(p,3)),this.setAttribute("normal",new an(x,3)),this.setAttribute("uv",new an(y,2));function T(){for(let w=0;w<t;w++)A(w);A(r===!1?t:0),C(),S()}function A(w){f=e.getPointAt(w/t,f);const B=a.normals[w],L=a.binormals[w];for(let D=0;D<=s;D++){const O=D/s*Math.PI*2,F=Math.sin(O),U=-Math.cos(O);l.x=U*B.x+F*L.x,l.y=U*B.y+F*L.y,l.z=U*B.z+F*L.z,l.normalize(),x.push(l.x,l.y,l.z),o.x=f.x+n*l.x,o.y=f.y+n*l.y,o.z=f.z+n*l.z,p.push(o.x,o.y,o.z)}}function S(){for(let w=1;w<=t;w++)for(let B=1;B<=s;B++){const L=(s+1)*(w-1)+(B-1),D=(s+1)*w+(B-1),O=(s+1)*w+B,F=(s+1)*(w-1)+B;_.push(L,D,F),_.push(D,O,F)}}function C(){for(let w=0;w<=t;w++)for(let B=0;B<=s;B++)u.x=w/t,u.y=B/s,y.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new UT(new yM[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class rD extends Fn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,s=new Q,r=new Q;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let u=0,f=l.length;u<f;++u){const p=l[u],x=p.start,y=p.count;for(let _=x,T=x+y;_<T;_+=3)for(let A=0;A<3;A++){const S=o.getX(_+A),C=o.getX(_+(A+1)%3);s.fromBufferAttribute(a,S),r.fromBufferAttribute(a,C),QI(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let u=0;u<3;u++){const f=3*o+u,p=3*o+(u+1)%3;s.fromBufferAttribute(a,f),r.fromBufferAttribute(a,p),QI(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new an(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function QI(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(s)===!0?!1:(t.add(n),t.add(s),!0)}var eP=Object.freeze({__proto__:null,BoxGeometry:Nd,CapsuleGeometry:TT,CircleGeometry:AT,ConeGeometry:hv,CylinderGeometry:y0,DodecahedronGeometry:ET,EdgesGeometry:ZB,ExtrudeGeometry:CT,IcosahedronGeometry:pv,LatheGeometry:RT,OctahedronGeometry:mv,PlaneGeometry:Bd,PolyhedronGeometry:eh,RingGeometry:wT,ShapeGeometry:NT,SphereGeometry:v0,TetrahedronGeometry:BT,TorusGeometry:DT,TorusKnotGeometry:OT,TubeGeometry:UT,WireframeGeometry:rD});class OC extends ir{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Bt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class aD extends Xa{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class _0 extends ir{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Bt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Wa,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nl extends _0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ze(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Pn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Bt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Bt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Bt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class UC extends ir{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Bt(16777215),this.specular=new Bt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Wa,this.combine=h0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class LC extends ir{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Bt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class IC extends ir{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class PC extends ir{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Wa,this.combine=h0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class FC extends ir{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=wB,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class GC extends ir{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class zC extends ir{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Bt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cu,this.normalScale=new Ze(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class LT extends ua{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Eg(i,e){return!i||i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function uV(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function dV(i){function e(s,r){return i[s]-i[r]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}function lN(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,a=0;a!==n;++r){const o=t[r]*e;for(let l=0;l!==e;++l)s[a++]=i[o+l]}return s}function oD(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let a=r[n];if(a!==void 0)if(Array.isArray(a))do a=r[n],a!==void 0&&(e.push(r.time),t.push(...a)),r=i[s++];while(r!==void 0);else if(a.toArray!==void 0)do a=r[n],a!==void 0&&(e.push(r.time),a.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do a=r[n],a!==void 0&&(e.push(r.time),t.push(a)),r=i[s++];while(r!==void 0)}function mj(i,e,t,n,s=30){const r=i.clone();r.name=e;const a=[];for(let l=0;l<r.tracks.length;++l){const u=r.tracks[l],f=u.getValueSize(),p=[],x=[];for(let y=0;y<u.times.length;++y){const _=u.times[y]*s;if(!(_<t||_>=n)){p.push(u.times[y]);for(let T=0;T<f;++T)x.push(u.values[y*f+T])}}p.length!==0&&(u.times=Eg(p,u.times.constructor),u.values=Eg(x,u.values.constructor),a.push(u))}r.tracks=a;let o=1/0;for(let l=0;l<r.tracks.length;++l)o>r.tracks[l].times[0]&&(o=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*o);return r.resetDuration(),r}function gj(i,e=0,t=i,n=30){n<=0&&(n=30);const s=t.tracks.length,r=e/n;for(let a=0;a<s;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const u=i.tracks.find(function(S){return S.name===o.name&&S.ValueTypeName===l});if(u===void 0)continue;let f=0;const p=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);let x=0;const y=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=y/3);const _=o.times.length-1;let T;if(r<=o.times[0]){const S=f,C=p-f;T=o.values.slice(S,C)}else if(r>=o.times[_]){const S=_*p+f,C=S+p-f;T=o.values.slice(S,C)}else{const S=o.createInterpolant(),C=f,w=p-f;S.evaluate(r),T=S.resultBuffer.slice(C,w)}l==="quaternion"&&new wr().fromArray(T).normalize().conjugate().toArray(T);const A=u.times.length;for(let S=0;S<A;++S){const C=S*y+x;if(l==="quaternion")wr.multiplyQuaternionsFlat(u.values,C,T,0,u.values,C);else{const w=y-x*2;for(let B=0;B<w;++B)u.values[C+B]-=T[B]}}}return i.blendMode=xC,i}class fV{static convertArray(e,t){return Eg(e,t)}static isTypedArray(e){return uV(e)}static getKeyframeOrder(e){return dV(e)}static sortedArray(e,t,n){return lN(e,t,n)}static flattenJSON(e,t,n,s){oD(e,t,n,s)}static subclip(e,t,n,s,r=30){return mj(e,t,n,s,r)}static makeClipAdditive(e,t=0,n=e,s=30){return gj(e,t,n,s)}}class b0{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<s)){for(let o=n+2;;){if(s===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=s,s=t[++n],e<s)break t}a=t.length;break n}if(!(e>=r)){const o=t[1];e<o&&(n=2,r=o);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(s=r,r=t[--n-1],e>=r)break t}a=n,n=0;break n}break e}for(;n<a;){const o=n+a>>>1;e<t[o]?a=o:n=o+1}if(s=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s;for(let a=0;a!==s;++a)t[a]=n[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class lD extends b0{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:sp,endingEnd:sp}}intervalChanged_(e,t,n){const s=this.parameterPositions;let r=e-2,a=e+1,o=s[r],l=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case rp:r=e,o=2*t-n;break;case Gy:r=s.length-2,o=t+s[r]-s[r+1];break;default:r=e,o=n}if(l===void 0)switch(this.getSettings_().endingEnd){case rp:a=e,l=2*n-t;break;case Gy:a=1,l=n+s[1]-s[0];break;default:a=e-1,l=t}const u=(n-t)*.5,f=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(l-n),this._offsetPrev=r*f,this._offsetNext=a*f}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,f=this._offsetPrev,p=this._offsetNext,x=this._weightPrev,y=this._weightNext,_=(n-t)/(s-t),T=_*_,A=T*_,S=-x*A+2*x*T-x*_,C=(1+x)*A+(-1.5-2*x)*T+(-.5+x)*_+1,w=(-1-y)*A+(1.5+y)*T+.5*_,B=y*A-y*T;for(let L=0;L!==o;++L)r[L]=S*a[f+L]+C*a[u+L]+w*a[l+L]+B*a[p+L];return r}}class VC extends b0{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,f=(n-t)/(s-t),p=1-f;for(let x=0;x!==o;++x)r[x]=a[u+x]*p+a[l+x]*f;return r}}class cD extends b0{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ll{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Eg(t,this.TimeBufferType),this.values=Eg(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Eg(e.times,Array),values:Eg(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new cD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new VC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new lD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case e0:t=this.InterpolantFactoryMethodDiscrete;break;case t0:t=this.InterpolantFactoryMethodLinear;break;case tS:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return De("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return e0;case this.InterpolantFactoryMethodLinear:return t0;case this.InterpolantFactoryMethodSmooth:return tS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let r=0,a=s-1;for(;r!==s&&n[r]<e;)++r;for(;a!==-1&&n[a]>t;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(nt("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,r=n.length;r===0&&(nt("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==r;o++){const l=n[o];if(typeof l=="number"&&isNaN(l)){nt("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){nt("KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(s!==void 0&&uV(s))for(let o=0,l=s.length;o!==l;++o){const u=s[o];if(isNaN(u)){nt("KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===tS,r=e.length-1;let a=1;for(let o=1;o<r;++o){let l=!1;const u=e[o],f=e[o+1];if(u!==f&&(o!==1||u!==e[0]))if(s)l=!0;else{const p=o*n,x=p-n,y=p+n;for(let _=0;_!==n;++_){const T=t[p+_];if(T!==t[x+_]||T!==t[y+_]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const p=o*n,x=a*n;for(let y=0;y!==n;++y)t[x+y]=t[p+y]}++a}}if(r>0){e[a]=e[r];for(let o=r*n,l=a*n,u=0;u!==n;++u)t[l+u]=t[o+u];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Ll.prototype.ValueTypeName="";Ll.prototype.TimeBufferType=Float32Array;Ll.prototype.ValueBufferType=Float32Array;Ll.prototype.DefaultInterpolation=t0;class Qp extends Ll{constructor(e,t,n){super(e,t,n)}}Qp.prototype.ValueTypeName="bool";Qp.prototype.ValueBufferType=Array;Qp.prototype.DefaultInterpolation=e0;Qp.prototype.InterpolantFactoryMethodLinear=void 0;Qp.prototype.InterpolantFactoryMethodSmooth=void 0;class HC extends Ll{constructor(e,t,n,s){super(e,t,n,s)}}HC.prototype.ValueTypeName="color";class Hp extends Ll{constructor(e,t,n,s){super(e,t,n,s)}}Hp.prototype.ValueTypeName="number";class uD extends b0{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-t)/(s-t);let u=e*o;for(let f=u+o;u!==f;u+=4)wr.slerpFlat(r,0,a,u-o,a,u,l);return r}}class Vf extends Ll{constructor(e,t,n,s){super(e,t,n,s)}InterpolantFactoryMethodLinear(e){return new uD(this.times,this.values,this.getValueSize(),e)}}Vf.prototype.ValueTypeName="quaternion";Vf.prototype.InterpolantFactoryMethodSmooth=void 0;class em extends Ll{constructor(e,t,n){super(e,t,n)}}em.prototype.ValueTypeName="string";em.prototype.ValueBufferType=Array;em.prototype.DefaultInterpolation=e0;em.prototype.InterpolantFactoryMethodLinear=void 0;em.prototype.InterpolantFactoryMethodSmooth=void 0;class Hf extends Ll{constructor(e,t,n,s){super(e,t,n,s)}}Hf.prototype.ValueTypeName="vector";class kp{constructor(e="",t=-1,n=[],s=aT){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=El(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(yj(n[a]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r.userData=JSON.parse(e.userData||"{}"),r}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let r=0,a=n.length;r!==a;++r)t.push(Ll.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const r=t.length,a=[];for(let o=0;o<r;o++){let l=[],u=[];l.push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);const f=dV(l);l=lN(l,1,f),u=lN(u,1,f),!s&&l[0]===0&&(l.push(r),u.push(u[0])),a.push(new Hp(".morphTargetInfluences["+t[o].name+"]",l,u).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const u=e[o],f=u.name.match(r);if(f&&f.length>1){const p=f[1];let x=s[p];x||(s[p]=x=[]),x.push(u)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],t,n));return a}static parseAnimation(e,t){if(De("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return nt("AnimationClip: No animation in JSONLoader data."),null;const n=function(p,x,y,_,T){if(y.length!==0){const A=[],S=[];oD(y,A,S,_),A.length!==0&&T.push(new p(x,A,S))}},s=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const u=e.hierarchy||[];for(let p=0;p<u.length;p++){const x=u[p].keys;if(!(!x||x.length===0))if(x[0].morphTargets){const y={};let _;for(_=0;_<x.length;_++)if(x[_].morphTargets)for(let T=0;T<x[_].morphTargets.length;T++)y[x[_].morphTargets[T]]=-1;for(const T in y){const A=[],S=[];for(let C=0;C!==x[_].morphTargets.length;++C){const w=x[_];A.push(w.time),S.push(w.morphTarget===T?1:0)}s.push(new Hp(".morphTargetInfluence["+T+"]",A,S))}l=y.length*a}else{const y=".bones["+t[p].name+"]";n(Hf,y+".position",x,"pos",s),n(Vf,y+".quaternion",x,"rot",s),n(Hf,y+".scale",x,"scl",s)}}return s.length===0?null:new this(r,l,s,o)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function xj(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hp;case"vector":case"vector2":case"vector3":case"vector4":return Hf;case"color":return HC;case"quaternion":return Vf;case"bool":case"boolean":return Qp;case"string":return em}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function yj(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=xj(i.type);if(i.times===void 0){const t=[],n=[];oD(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const au={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class IT{constructor(e,t,n){const s=this;let r=!1,a=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(f){o++,r===!1&&s.onStart!==void 0&&s.onStart(f,a,o),r=!0},this.itemEnd=function(f){a++,s.onProgress!==void 0&&s.onProgress(f,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(f){s.onError!==void 0&&s.onError(f)},this.resolveURL=function(f){return l?l(f):f},this.setURLModifier=function(f){return l=f,this},this.addHandler=function(f,p){return u.push(f,p),this},this.removeHandler=function(f){const p=u.indexOf(f);return p!==-1&&u.splice(p,2),this},this.getHandler=function(f){for(let p=0,x=u.length;p<x;p+=2){const y=u[p],_=u[p+1];if(y.global&&(y.lastIndex=0),y.test(f))return _}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const Mg=new IT;let Xr=class{constructor(e){this.manager=e!==void 0?e:Mg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}};Xr.DEFAULT_MATERIAL_NAME="__DEFAULT";const gf={};class vj extends Error{constructor(e,t){super(e),this.response=t}}class Hr extends Xr{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=au.get(`file:${e}`);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(gf[e]!==void 0){gf[e].push({onLoad:t,onProgress:n,onError:s});return}gf[e]=[],gf[e].push({onLoad:t,onProgress:n,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&De("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const f=gf[e],p=u.body.getReader(),x=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),y=x?parseInt(x):0,_=y!==0;let T=0;const A=new ReadableStream({start(S){C();function C(){p.read().then(({done:w,value:B})=>{if(w)S.close();else{T+=B.byteLength;const L=new ProgressEvent("progress",{lengthComputable:_,loaded:T,total:y});for(let D=0,O=f.length;D<O;D++){const F=f[D];F.onProgress&&F.onProgress(L)}S.enqueue(B),C()}},w=>{S.error(w)})}}});return new Response(A)}else throw new vj(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(f=>new DOMParser().parseFromString(f,o));case"json":return u.json();default:if(o==="")return u.text();{const p=/charset="?([^;"\s]*)"?/i.exec(o),x=p&&p[1]?p[1].toLowerCase():void 0,y=new TextDecoder(x);return u.arrayBuffer().then(_=>y.decode(_))}}}).then(u=>{au.add(`file:${e}`,u);const f=gf[e];delete gf[e];for(let p=0,x=f.length;p<x;p++){const y=f[p];y.onLoad&&y.onLoad(u)}}).catch(u=>{const f=gf[e];if(f===void 0)throw this.manager.itemError(e),u;delete gf[e];for(let p=0,x=f.length;p<x;p++){const y=f[p];y.onError&&y.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class hV extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new Hr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):nt(l),r.manager.itemError(e)}},n,s)}parse(e){const t=[];for(let n=0;n<e.length;n++){const s=kp.parse(e[n]);t.push(s)}return t}}class pV extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=[],o=new ST,l=new Hr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let u=0;function f(p){l.load(e[p],function(x){const y=r.parse(x,!0);a[p]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},u+=1,u===6&&(y.mipmapCount===1&&(o.minFilter=Dn),o.image=a,o.format=y.format,o.needsUpdate=!0,t&&t(o))},n,s)}if(Array.isArray(e))for(let p=0,x=e.length;p<x;++p)f(p);else l.load(e,function(p){const x=r.parse(p,!0);if(x.isCubemap){const y=x.mipmaps.length/x.mipmapCount;for(let _=0;_<y;_++){a[_]={mipmaps:[]};for(let T=0;T<x.mipmapCount;T++)a[_].mipmaps.push(x.mipmaps[_*x.mipmapCount+T]),a[_].format=x.format,a[_].width=x.width,a[_].height=x.height}o.image=a}else o.image.width=x.width,o.image.height=x.height,o.mipmaps=x.mipmaps;x.mipmapCount===1&&(o.minFilter=Dn),o.format=x.format,o.needsUpdate=!0,t&&t(o)},n,s);return o}}const $x=new WeakMap;class Hy extends Xr{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=au.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0);else{let p=$x.get(a);p===void 0&&(p=[],$x.set(a,p)),p.push({onLoad:t,onError:s})}return a}const o=ES("img");function l(){f(),t&&t(this);const p=$x.get(this)||[];for(let x=0;x<p.length;x++){const y=p[x];y.onLoad&&y.onLoad(this)}$x.delete(this),r.manager.itemEnd(e)}function u(p){f(),s&&s(p),au.remove(`image:${e}`);const x=$x.get(this)||[];for(let y=0;y<x.length;y++){const _=x[y];_.onError&&_.onError(p)}$x.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function f(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),au.add(`image:${e}`,o),r.manager.itemStart(e),o.src=e,o}}class dD extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=new Zf;r.colorSpace=Mr;const a=new Hy(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(u){a.load(e[u],function(f){r.images[u]=f,o++,o===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let u=0;u<e.length;++u)l(u);return r}}class kC extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new No,o=new Hr(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,function(l){let u;try{u=r.parse(l)}catch(f){if(s!==void 0)s(f);else{f(f);return}}u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:ts,a.wrapT=u.wrapT!==void 0?u.wrapT:ts,a.magFilter=u.magFilter!==void 0?u.magFilter:Dn,a.minFilter=u.minFilter!==void 0?u.minFilter:Dn,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(a.colorSpace=u.colorSpace),u.flipY!==void 0&&(a.flipY=u.flipY),u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps,a.minFilter=Cr),u.mipmapCount===1&&(a.minFilter=Dn),u.generateMipmaps!==void 0&&(a.generateMipmaps=u.generateMipmaps),a.needsUpdate=!0,t&&t(a,u)},n,s),a}}class fD extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=new pi,a=new Hy(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){r.image=o,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}class th extends mi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Bt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class WC extends th{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(mi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Bt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const pw=new Yt,tP=new Q,nP=new Q;class hD{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ze(512,512),this.mapType=ss,this.map=null,this.mapPass=null,this.matrix=new Yt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zp,this._frameExtents=new Ze(1,1),this._viewportCount=1,this._viewports=[new mn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;tP.setFromMatrixPosition(e.matrixWorld),t.position.copy(tP),nP.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(nP),t.updateMatrixWorld(),pw.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pw,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(pw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class _j extends hD{constructor(){super(new bs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=s0*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class S0 extends th{constructor(e,t,n=0,s=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(mi.DEFAULT_UP),this.updateMatrix(),this.target=new mi,this.distance=n,this.angle=s,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new _j}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const iP=new Yt,vb=new Q,mw=new Q;class bj extends hD{constructor(){super(new bs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ze(4,2),this._viewportCount=6,this._viewports=[new mn(2,1,1,1),new mn(0,1,1,1),new mn(3,1,1,1),new mn(1,1,1,1),new mn(3,0,1,1),new mn(1,0,1,1)],this._cubeDirections=[new Q(1,0,0),new Q(-1,0,0),new Q(0,0,1),new Q(0,0,-1),new Q(0,1,0),new Q(0,-1,0)],this._cubeUps=[new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,0,1),new Q(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),vb.setFromMatrixPosition(e.matrixWorld),n.position.copy(vb),mw.copy(n.position),mw.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(mw),n.updateMatrixWorld(),s.makeTranslation(-vb.x,-vb.y,-vb.z),iP.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(iP,n.coordinateSystem,n.reversedDepth)}}class PT extends th{constructor(e,t,n=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new bj}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ac extends cv{constructor(e=-1,t=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=u*this.view.offsetX,a=r+u*this.view.width,o-=f*this.view.offsetY,l=o-f*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class Sj extends hD{constructor(){super(new Ac(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class FT extends th{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(mi.DEFAULT_UP),this.updateMatrix(),this.target=new mi,this.shadow=new Sj}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class XC extends th{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class qC extends th{constructor(e,t,n=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class pD{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*s),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*s)),t.addScaledVector(a[5],1.092548*(s*r)),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],1.092548*(n*r)),t.addScaledVector(a[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*s),t.addScaledVector(a[2],2*.511664*r),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*s),t.addScaledVector(a[5],2*.429043*s*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],2*.429043*n*r),t.addScaledVector(a[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const n=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-s*s)}}class YC extends th{constructor(e=new pD,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class gv extends Xr{constructor(e){super(e),this.textures={}}load(e,t,n,s){const r=this,a=new Hr(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):nt(l),r.manager.itemError(e)}},n,s)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&De("MaterialLoader: Undefined texture",r),t[r]}const s=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new Bt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const a=e.uniforms[r];switch(s.uniforms[r]={},a.type){case"t":s.uniforms[r].value=n(a.value);break;case"c":s.uniforms[r].value=new Bt().setHex(a.value);break;case"v2":s.uniforms[r].value=new Ze().fromArray(a.value);break;case"v3":s.uniforms[r].value=new Q().fromArray(a.value);break;case"v4":s.uniforms[r].value=new mn().fromArray(a.value);break;case"m3":s.uniforms[r].value=new Ln().fromArray(a.value);break;case"m4":s.uniforms[r].value=new Yt().fromArray(a.value);break;default:s.uniforms[r].value=a.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=n(e.map)),e.matcap!==void 0&&(s.matcap=n(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new Ze().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=n(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new Ze().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=n(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return gv.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:OC,SpriteMaterial:vT,RawShaderMaterial:aD,ShaderMaterial:Xa,PointsMaterial:fv,MeshPhysicalMaterial:nl,MeshStandardMaterial:_0,MeshPhongMaterial:UC,MeshToonMaterial:LC,MeshNormalMaterial:IC,MeshLambertMaterial:PC,MeshDepthMaterial:FC,MeshDistanceMaterial:GC,MeshBasicMaterial:er,MeshMatcapMaterial:zC,LineDashedMaterial:LT,LineBasicMaterial:ua,Material:ir};return new t[e]}}class Uf{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class mD extends Fn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class gD extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new Hr(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):nt(l),r.manager.itemError(e)}},n,s)}parse(e){const t={},n={};function s(y,_){if(t[_]!==void 0)return t[_];const A=y.interleavedBuffers[_],S=r(y,A.buffer),C=by(A.type,S),w=new x0(C,A.stride);return w.uuid=A.uuid,t[_]=w,w}function r(y,_){if(n[_]!==void 0)return n[_];const A=y.arrayBuffers[_],S=new Uint32Array(A).buffer;return n[_]=S,S}const a=e.isInstancedBufferGeometry?new mD:new Fn,o=e.data.index;if(o!==void 0){const y=by(o.type,o.array);a.setIndex(new li(y,1))}const l=e.data.attributes;for(const y in l){const _=l[y];let T;if(_.isInterleavedBufferAttribute){const A=s(e.data,_.data);T=new Md(A,_.itemSize,_.offset,_.normalized)}else{const A=by(_.type,_.array),S=_.isInstancedBufferAttribute?Jo:li;T=new S(A,_.itemSize,_.normalized)}_.name!==void 0&&(T.name=_.name),_.usage!==void 0&&T.setUsage(_.usage),a.setAttribute(y,T)}const u=e.data.morphAttributes;if(u)for(const y in u){const _=u[y],T=[];for(let A=0,S=_.length;A<S;A++){const C=_[A];let w;if(C.isInterleavedBufferAttribute){const B=s(e.data,C.data);w=new Md(B,C.itemSize,C.offset,C.normalized)}else{const B=by(C.type,C.array);w=new li(B,C.itemSize,C.normalized)}C.name!==void 0&&(w.name=C.name),T.push(w)}a.morphAttributes[y]=T}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let y=0,_=p.length;y!==_;++y){const T=p[y];a.addGroup(T.start,T.count,T.materialIndex)}const x=e.data.boundingSphere;return x!==void 0&&(a.boundingSphere=new mr().fromJSON(x)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class xD extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=this.path===""?Uf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Hr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let u=null;try{u=JSON.parse(l)}catch(p){s!==void 0&&s(p),p("ObjectLoader: Can't parse "+e+".",p.message);return}const f=u.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),nt("ObjectLoader: Can't load "+e);return}r.parse(u,t)},n,s)}async loadAsync(e,t){const n=this,s=this.path===""?Uf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new Hr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const a=await r.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),a=this.parseImages(e.images,function(){t!==void 0&&t(u)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,r,l,o,n),f=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,f),this.bindLightTargets(u),t!==void 0){let p=!1;for(const x in a)if(a[x].data instanceof HTMLImageElement){p=!0;break}p===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,s,o,a,t),u=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,u),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,s=e.length;n<s;n++){const r=new hp().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=new uv().fromJSON(e[r],s);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(e!==void 0){const s=new gD;for(let r=0,a=e.length;r<a;r++){let o;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=s.parse(l);break;default:l.type in eP?o=eP[l.type].fromJSON(l,t):De(`ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),n[l.uuid]=o}}return n}parseMaterials(e,t){const n={},s={};if(e!==void 0){const r=new gv;r.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),s[l.uuid]=n[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const s=e[n],r=kp.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const n=this,s={};let r;function a(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const u=l,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return a(f)}else return l.data?{data:by(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new IT(t);r=new Hy(l),r.setCrossOrigin(this.crossOrigin);for(let u=0,f=e.length;u<f;u++){const p=e[u],x=p.url;if(Array.isArray(x)){const y=[];for(let _=0,T=x.length;_<T;_++){const A=x[_],S=o(A);S!==null&&(S instanceof HTMLImageElement?y.push(S):y.push(new No(S.data,S.width,S.height)))}s[p.uuid]=new Bf(y)}else{const y=o(p.url);s[p.uuid]=new Bf(y)}}}return s}async parseImagesAsync(e){const t=this,n={};let s;async function r(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await s.loadAsync(l)}else return a.data?{data:by(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){s=new Hy(this.manager),s.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],u=l.url;if(Array.isArray(u)){const f=[];for(let p=0,x=u.length;p<x;p++){const y=u[p],_=await r(y);_!==null&&(_ instanceof HTMLImageElement?f.push(_):f.push(new No(_.data,_.width,_.height)))}n[l.uuid]=new Bf(f)}else{const f=await r(l.url);n[l.uuid]=new Bf(f)}}}return n}parseTextures(e,t){function n(r,a){return typeof r=="number"?r:(De("ObjectLoader.parseTexture: Constant should be in numeric form.",r),a[r])}const s={};if(e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=e[r];o.image===void 0&&De('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&De("ObjectLoader: Undefined image",o.image);const l=t[o.image],u=l.data;let f;Array.isArray(u)?(f=new Zf,u.length===6&&(f.needsUpdate=!0)):(u&&u.data?f=new No:f=new pi,u&&(f.needsUpdate=!0)),f.source=l,f.uuid=o.uuid,o.name!==void 0&&(f.name=o.name),o.mapping!==void 0&&(f.mapping=n(o.mapping,Tj)),o.channel!==void 0&&(f.channel=o.channel),o.offset!==void 0&&f.offset.fromArray(o.offset),o.repeat!==void 0&&f.repeat.fromArray(o.repeat),o.center!==void 0&&f.center.fromArray(o.center),o.rotation!==void 0&&(f.rotation=o.rotation),o.wrap!==void 0&&(f.wrapS=n(o.wrap[0],sP),f.wrapT=n(o.wrap[1],sP)),o.format!==void 0&&(f.format=o.format),o.internalFormat!==void 0&&(f.internalFormat=o.internalFormat),o.type!==void 0&&(f.type=o.type),o.colorSpace!==void 0&&(f.colorSpace=o.colorSpace),o.minFilter!==void 0&&(f.minFilter=n(o.minFilter,rP)),o.magFilter!==void 0&&(f.magFilter=n(o.magFilter,rP)),o.anisotropy!==void 0&&(f.anisotropy=o.anisotropy),o.flipY!==void 0&&(f.flipY=o.flipY),o.generateMipmaps!==void 0&&(f.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(f.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(f.compareFunction=o.compareFunction),o.userData!==void 0&&(f.userData=o.userData),s[o.uuid]=f}return s}parseObject(e,t,n,s,r){let a;function o(x){return t[x]===void 0&&De("ObjectLoader: Undefined geometry",x),t[x]}function l(x){if(x!==void 0){if(Array.isArray(x)){const y=[];for(let _=0,T=x.length;_<T;_++){const A=x[_];n[A]===void 0&&De("ObjectLoader: Undefined material",A),y.push(n[A])}return y}return n[x]===void 0&&De("ObjectLoader: Undefined material",x),n[x]}}function u(x){return s[x]===void 0&&De("ObjectLoader: Undefined texture",x),s[x]}let f,p;switch(e.type){case"Scene":a=new Qf,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Bt(e.background):a.background=u(e.background)),e.environment!==void 0&&(a.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new yT(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new xT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new bs(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Ac(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new XC(e.color,e.intensity);break;case"DirectionalLight":a=new FT(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new PT(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new qC(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new S0(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new WC(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new YC().fromJSON(e);break;case"SkinnedMesh":f=o(e.geometry),p=l(e.material),a=new TC(f,p),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":f=o(e.geometry),p=l(e.material),a=new Ui(f,p);break;case"InstancedMesh":f=o(e.geometry),p=l(e.material);const x=e.count,y=e.instanceMatrix,_=e.instanceColor;a=new AC(f,p,x),a.instanceMatrix=new Jo(new Float32Array(y.array),16),_!==void 0&&(a.instanceColor=new Jo(new Float32Array(_.array),_.itemSize));break;case"BatchedMesh":f=o(e.geometry),p=l(e.material),a=new KB(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,p),a.geometry=f,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(T=>{let A=null,S=null;return T.boundingBox!==void 0&&(A=new Vr().fromJSON(T.boundingBox)),T.boundingSphere!==void 0&&(S=new mr().fromJSON(T.boundingSphere)),{...T,boundingBox:A,boundingSphere:S}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=u(e.matricesTexture.uuid),a._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new mr().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Vr().fromJSON(e.boundingBox));break;case"LOD":a=new $B;break;case"Line":a=new Cd(o(e.geometry),l(e.material));break;case"LineLoop":a=new EC(o(e.geometry),l(e.material));break;case"LineSegments":a=new Sc(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new MC(o(e.geometry),l(e.material));break;case"Sprite":a=new jB(l(e.material));break;case"Group":a=new fc;break;case"Bone":a=new _T;break;default:a=new mi}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const x=e.children;for(let y=0;y<x.length;y++)a.add(this.parseObject(x[y],t,n,s,r))}if(e.animations!==void 0){const x=e.animations;for(let y=0;y<x.length;y++){const _=x[y];a.animations.push(r[_])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const x=e.levels;for(let y=0;y<x.length;y++){const _=x[y],T=a.getObjectByProperty("uuid",_.object);T!==void 0&&a.addLevel(T,_.distance,_.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const s=t[n.skeleton];s===void 0?De("ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(s,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,s=e.getObjectByProperty("uuid",n);s!==void 0?t.target=s:t.target=new mi}})}}const Tj={UVMapping:Td,CubeReflectionMapping:Do,CubeRefractionMapping:Rl,EquirectangularReflectionMapping:Ad,EquirectangularRefractionMapping:zf,CubeUVReflectionMapping:Ed},sP={RepeatWrapping:wl,ClampToEdgeWrapping:ts,MirroredRepeatWrapping:lu},rP={NearestFilter:es,NearestMipmapNearestFilter:p0,NearestMipmapLinearFilter:Sl,LinearFilter:Dn,LinearMipmapNearestFilter:ud,LinearMipmapLinearFilter:Cr},gw=new WeakMap;class yD extends Xr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&De("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&De("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=au.get(`image-bitmap:${e}`);if(a!==void 0){if(r.manager.itemStart(e),a.then){a.then(u=>{if(gw.has(a)===!0)s&&s(gw.get(a)),r.manager.itemError(e),r.manager.itemEnd(e);else return t&&t(u),r.manager.itemEnd(e),u});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(u){return au.add(`image-bitmap:${e}`,u),t&&t(u),r.manager.itemEnd(e),u}).catch(function(u){s&&s(u),gw.set(l,u),au.remove(`image-bitmap:${e}`),r.manager.itemError(e),r.manager.itemEnd(e)});au.add(`image-bitmap:${e}`,l),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let cE;class jC{static getContext(){return cE===void 0&&(cE=new(window.AudioContext||window.webkitAudioContext)),cE}static setContext(e){cE=e}}class mV extends Xr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new Hr(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const u=l.slice(0);jC.getContext().decodeAudioData(u,function(p){t(p)}).catch(o)}catch(u){o(u)}},n,s);function o(l){s?s(l):nt(l),r.manager.itemError(e)}}}const aP=new Yt,oP=new Yt,rg=new Yt;class gV{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,rg.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,a=t.near*Math.tan(Og*t.fov*.5)/t.zoom;let o,l;oP.elements[12]=-s,aP.elements[12]=s,o=-a*t.aspect+r,l=a*t.aspect+r,rg.elements[0]=2*t.near/(l-o),rg.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(rg),o=-a*t.aspect-r,l=a*t.aspect-r,rg.elements[0]=2*t.near/(l-o),rg.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(rg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(oP),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(aP)}}class $C extends bs{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class KC{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const ag=new Q,xw=new wr,Aj=new Q,og=new Q,lg=new Q;class xV extends mi{constructor(){super(),this.type="AudioListener",this.context=jC.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new KC}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ag,xw,Aj),og.set(0,0,-1).applyQuaternion(xw),lg.set(0,1,0).applyQuaternion(xw),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ag.x,n),t.positionY.linearRampToValueAtTime(ag.y,n),t.positionZ.linearRampToValueAtTime(ag.z,n),t.forwardX.linearRampToValueAtTime(og.x,n),t.forwardY.linearRampToValueAtTime(og.y,n),t.forwardZ.linearRampToValueAtTime(og.z,n),t.upX.linearRampToValueAtTime(lg.x,n),t.upY.linearRampToValueAtTime(lg.y,n),t.upZ.linearRampToValueAtTime(lg.z,n)}else t.setPosition(ag.x,ag.y,ag.z),t.setOrientation(og.x,og.y,og.z,lg.x,lg.y,lg.z)}}class vD extends mi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){De("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){De("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){De("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){De("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){De("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(De("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){De("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(De("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const cg=new Q,lP=new wr,Ej=new Q,ug=new Q;class yV extends vD{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(cg,lP,Ej),ug.set(0,0,1).applyQuaternion(lP);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(cg.x,n),t.positionY.linearRampToValueAtTime(cg.y,n),t.positionZ.linearRampToValueAtTime(cg.z,n),t.orientationX.linearRampToValueAtTime(ug.x,n),t.orientationY.linearRampToValueAtTime(ug.y,n),t.orientationZ.linearRampToValueAtTime(ug.z,n)}else t.setPosition(cg.x,cg.y,cg.z),t.setOrientation(ug.x,ug.y,ug.z)}}class vV{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class _D{constructor(e,t,n){this.binding=e,this.valueSize=n;let s,r,a;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,s=this.valueSize,r=e*s+s;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==s;++o)n[r+o]=n[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(n,r,0,o,s)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(n,s,l,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){o.setValue(n,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,s=n*this._origIndex;e.getValue(t,s);for(let r=n,a=s;r!==a;++r)t[r]=t[s+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,r){if(s>=.5)for(let a=0;a!==r;++a)e[t+a]=e[n+a]}_slerp(e,t,n,s){wr.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,r){const a=this._workIndex*r;wr.multiplyQuaternionsFlat(e,a,e,t,e,n),wr.slerpFlat(e,t,e,t,e,a,s)}_lerp(e,t,n,s,r){const a=1-s;for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]*a+e[n+o]*s}}_lerpAdditive(e,t,n,s,r){for(let a=0;a!==r;++a){const o=t+a;e[o]=e[o]+e[n+a]*s}}}const bD="\\[\\]\\.:\\/",Mj=new RegExp("["+bD+"]","g"),SD="[^"+bD+"]",Cj="[^"+bD.replace("\\.","")+"]",Rj=/((?:WC+[\/:])*)/.source.replace("WC",SD),wj=/(WCOD+)?/.source.replace("WCOD",Cj),Nj=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",SD),Bj=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",SD),Dj=new RegExp("^"+Rj+wj+Nj+Bj+"$"),Oj=["material","materials","bones","map"];class Uj{constructor(e,t,n){const s=n||Ni.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Ni{constructor(e,t,n){this.path=t,this.parsedPath=n||Ni.parseTrackName(t),this.node=Ni.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ni.Composite(e,t,n):new Ni(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Mj,"")}static parseTrackName(e){const t=Dj.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);Oj.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let a=0;a<r.length;a++){const o=r[a];if(o.name===t||o.uuid===t)return o;const l=n(o.children);if(l)return l}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=Ni.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){De("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){nt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){nt("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){nt("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===u){u=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){nt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){nt("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){nt("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){nt("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const a=e[s];if(a===void 0){const u=t.nodeName;nt("PropertyBinding: Trying to update property for track: "+u+"."+s+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){nt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){nt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ni.Composite=Uj;Ni.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ni.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ni.prototype.GetterByBindingType=[Ni.prototype._getValue_direct,Ni.prototype._getValue_array,Ni.prototype._getValue_arrayElement,Ni.prototype._getValue_toArray];Ni.prototype.SetterByBindingTypeAndVersioning=[[Ni.prototype._setValue_direct,Ni.prototype._setValue_direct_setNeedsUpdate,Ni.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_array,Ni.prototype._setValue_array_setNeedsUpdate,Ni.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_arrayElement,Ni.prototype._setValue_arrayElement_setNeedsUpdate,Ni.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_fromArray,Ni.prototype._setValue_fromArray_setNeedsUpdate,Ni.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class _V{constructor(){this.isAnimationObjectGroup=!0,this.uuid=El(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,s=arguments.length;n!==s;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,s=this._parsedPaths,r=this._bindings,a=r.length;let o,l=e.length,u=this.nCachedObjects_;for(let f=0,p=arguments.length;f!==p;++f){const x=arguments[f],y=x.uuid;let _=t[y];if(_===void 0){_=l++,t[y]=_,e.push(x);for(let T=0,A=a;T!==A;++T)r[T].push(new Ni(x,n[T],s[T]))}else if(_<u){o=e[_];const T=--u,A=e[T];t[A.uuid]=_,e[_]=A,t[y]=T,e[T]=x;for(let S=0,C=a;S!==C;++S){const w=r[S],B=w[T];let L=w[_];w[_]=B,L===void 0&&(L=new Ni(x,n[S],s[S])),w[T]=L}}else e[_]!==o&&nt("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],u=l.uuid,f=t[u];if(f!==void 0&&f>=r){const p=r++,x=e[p];t[x.uuid]=f,e[f]=x,t[u]=p,e[p]=l;for(let y=0,_=s;y!==_;++y){const T=n[y],A=T[p],S=T[f];T[f]=A,T[p]=S}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const u=arguments[o],f=u.uuid,p=t[f];if(p!==void 0)if(delete t[f],p<r){const x=--r,y=e[x],_=--a,T=e[_];t[y.uuid]=p,e[p]=y,t[T.uuid]=x,e[x]=T,e.pop();for(let A=0,S=s;A!==S;++A){const C=n[A],w=C[x],B=C[_];C[p]=w,C[x]=B,C.pop()}}else{const x=--a,y=e[x];x>0&&(t[y.uuid]=p),e[p]=y,e.pop();for(let _=0,T=s;_!==T;++_){const A=n[_];A[p]=A[x],A.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let s=n[e];const r=this._bindings;if(s!==void 0)return r[s];const a=this._paths,o=this._parsedPaths,l=this._objects,u=l.length,f=this.nCachedObjects_,p=new Array(u);s=r.length,n[e]=s,a.push(e),o.push(t),r.push(p);for(let x=f,y=l.length;x!==y;++x){const _=l[x];p[x]=new Ni(_,e,t)}return p}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const s=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],u=e[o];t[u]=n,a[n]=l,a.pop(),r[n]=r[o],r.pop(),s[n]=s[o],s.pop()}}}class TD{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const r=t.tracks,a=r.length,o=new Array(a),l={endingStart:sp,endingEnd:sp};for(let u=0;u!==a;++u){const f=r[u].createInterpolant(null);o[u]=f,f.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=MB,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const s=this._clip.duration,r=e._clip.duration,a=r/s,o=s/r;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,r=s.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,u=o.sampleValues;return l[0]=r,l[1]=r+n,u[0]=e/a,u[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case xC:for(let f=0,p=l.length;f!==p;++f)l[f].evaluate(a),u[f].accumulateAdditive(o);break;case aT:default:for(let f=0,p=l.length;f!==p;++f)l[f].evaluate(a),u[f].accumulate(s,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,r=this._loopCount;const a=n===CB;if(e===0)return r===-1?s:a&&(r&1)===1?t-s:s;if(n===EB){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),s>=t||s<0){const o=Math.floor(s/t);s-=t*o,r+=Math.abs(o);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(a&&(r&1)===1)return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=rp,s.endingEnd=rp):(e?s.endingStart=this.zeroSlopeAtStart?rp:sp:s.endingStart=Gy,t?s.endingEnd=this.zeroSlopeAtEnd?rp:sp:s.endingEnd=Gy)}_scheduleFading(e,t,n){const s=this._mixer,r=s.time;let a=this._weightInterpolant;a===null&&(a=s._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,l[0]=t,o[1]=r+e,l[1]=n,this}}const Lj=new Float32Array(1);class AD extends Oo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,s=e._clip.tracks,r=s.length,a=e._propertyBindings,o=e._interpolants,l=n.uuid,u=this._bindingsByRootAndName;let f=u[l];f===void 0&&(f={},u[l]=f);for(let p=0;p!==r;++p){const x=s[p],y=x.name;let _=f[y];if(_!==void 0)++_.referenceCount,a[p]=_;else{if(_=a[p],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,l,y));continue}const T=t&&t._propertyBindings[p].binding.parsedPath;_=new _D(Ni.create(n,y,T),x.ValueTypeName,x.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,l,y),a[p]=_}o[p].resultBuffer=_.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,n)}const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const s=this._actions,r=this._actionsByClip;let a=r[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,a=this._actionsByClip,o=a[r],l=o.knownActions,u=l[l.length-1],f=e._byClipCacheIndex;u._byClipCacheIndex=f,l[f]=u,l.pop(),e._byClipCacheIndex=null;const p=o.actionByRoot,x=(e._localRoot||this._root).uuid;delete p[x],l.length===0&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const s=this._bindingsByRootAndName,r=this._bindings;let a=s[t];a===void 0&&(a={},s[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[s],l=t[t.length-1],u=e._cacheIndex;l._cacheIndex=u,t[u]=l,t.pop(),delete o[r],Object.keys(o).length===0&&delete a[s]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new VC(new Float32Array(2),new Float32Array(2),1,Lj),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const s=t||this._root,r=s.uuid;let a=typeof e=="string"?kp.findByName(s,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let u=null;if(n===void 0&&(a!==null?n=a.blendMode:n=aT),l!==void 0){const p=l.actionByRoot[r];if(p!==void 0&&p.blendMode===n)return p;u=l.knownActions[0],a===null&&(a=u._clip)}if(a===null)return null;const f=new TD(this,a,t,n);return this._bindAction(f,u),this._addInactiveAction(f,o,r),f}existingAction(e,t){const n=t||this._root,s=n.uuid,r=typeof e=="string"?kp.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,s=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(s,e,r,a);const o=this._bindings,l=this._nActiveBindings;for(let u=0;u!==l;++u)o[u].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,r=s[n];if(r!==void 0){const a=r.knownActions;for(let o=0,l=a.length;o!==l;++o){const u=a[o];this._deactivateAction(u);const f=u._cacheIndex,p=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,p._cacheIndex=f,t[f]=p,t.pop(),this._removeInactiveBindingsForAction(u)}delete s[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const a in r){const o=r[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class bV extends bc{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isRenderTarget3D=!0,this.depth=n,this.texture=new hT(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}let SV=class TV{constructor(e){this.value=e}clone(){return new TV(this.value.clone===void 0?this.value:this.value.clone())}},Ij=0,AV=class extends Oo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ij++}),this.name="",this.usage=n0,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,s=t.length;n<s;n++){const r=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<r.length;a++)this.uniforms.push(r[a].clone())}return this}clone(){return new this.constructor().copy(this)}};class ED extends x0{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class EV{constructor(e,t,n,s,r,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=r,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const cP=new Yt;class GT{constructor(e,t,n=0,s=1/0){this.ray=new g0(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new r0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):nt("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return cP.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(cP),this}intersectObject(e,t=!0,n=[]){return cN(e,this,n,t),n.sort(uP),n}intersectObjects(e,t=!0,n=[]){for(let s=0,r=e.length;s<r;s++)cN(e[s],this,n,t);return n.sort(uP),n}}function uP(i,e){return i.distance-e.distance}function cN(i,e,t,n){let s=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(s=!1),s===!0&&n===!0){const r=i.children;for(let a=0,o=r.length;a<o;a++)cN(r[a],e,t,!0)}}class MV{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=Pj.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function Pj(){this._document.hidden===!1&&this.reset()}class MD{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Pn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Pn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class CV{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class xv{constructor(e,t,n,s){xv.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,s){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=s,this}}const dP=new Ze;class RV{constructor(e=new Ze(1/0,1/0),t=new Ze(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=dP.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,dP).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fP=new Q,uE=new Q,Kx=new Q,Jx=new Q,yw=new Q,Fj=new Q,Gj=new Q;class wV{constructor(e=new Q,t=new Q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){fP.subVectors(e,this.start),uE.subVectors(this.end,this.start);const n=uE.dot(uE);let r=uE.dot(fP)/n;return t&&(r=Pn(r,0,1)),r}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}distanceSqToLine3(e,t=Fj,n=Gj){const s=10000000000000001e-32;let r,a;const o=this.start,l=e.start,u=this.end,f=e.end;Kx.subVectors(u,o),Jx.subVectors(f,l),yw.subVectors(o,l);const p=Kx.dot(Kx),x=Jx.dot(Jx),y=Jx.dot(yw);if(p<=s&&x<=s)return t.copy(o),n.copy(l),t.sub(n),t.dot(t);if(p<=s)r=0,a=y/x,a=Pn(a,0,1);else{const _=Kx.dot(yw);if(x<=s)a=0,r=Pn(-_/p,0,1);else{const T=Kx.dot(Jx),A=p*x-T*T;A!==0?r=Pn((T*y-_*x)/A,0,1):r=0,a=(T*r+y)/x,a<0?(a=0,r=Pn(-_/p,0,1)):a>1&&(a=1,r=Pn((T-_)/p,0,1))}}return t.copy(o).add(Kx.multiplyScalar(r)),n.copy(l).add(Jx.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const hP=new Q;class NV extends mi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Fn,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const u=a/l*Math.PI*2,f=o/l*Math.PI*2;s.push(Math.cos(u),Math.sin(u),1,Math.cos(f),Math.sin(f),1)}n.setAttribute("position",new an(s,3));const r=new ua({fog:!1,toneMapped:!1});this.cone=new Sc(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hP.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hP),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const $h=new Q,dE=new Yt,vw=new Yt;class CD extends Sc{constructor(e){const t=BV(e),n=new Fn,s=[],r=[];for(let u=0;u<t.length;u++){const f=t[u];f.parent&&f.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new an(s,3)),n.setAttribute("color",new an(r,3));const a=new ua({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new Bt(255),l=new Bt(65280);this.setColors(o,l)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");vw.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<t.length;r++){const o=t[r];o.parent&&o.parent.isBone&&(dE.multiplyMatrices(vw,o.matrixWorld),$h.setFromMatrixPosition(dE),s.setXYZ(a,$h.x,$h.y,$h.z),dE.multiplyMatrices(vw,o.parent.matrixWorld),$h.setFromMatrixPosition(dE),s.setXYZ(a+1,$h.x,$h.y,$h.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const s=this.geometry.getAttribute("color");for(let r=0;r<s.count;r+=2)s.setXYZ(r,e.r,e.g,e.b),s.setXYZ(r+1,t.r,t.g,t.b);return s.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function BV(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push(...BV(i.children[t]));return e}class DV extends Ui{constructor(e,t,n){const s=new v0(t,4,2),r=new er({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const zj=new Q,pP=new Bt,mP=new Bt;class OV extends mi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const s=new mv(t);s.rotateY(Math.PI*.5),this.material=new er({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),a=new Float32Array(r.count*3);s.setAttribute("color",new li(a,3)),this.add(new Ui(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");pP.copy(this.light.color),mP.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const r=n<s/2?pP:mP;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(zj.setFromMatrixPosition(this.light.matrixWorld).negate())}}class UV extends Sc{constructor(e=10,t=10,n=4473924,s=8947848){n=new Bt(n),s=new Bt(s);const r=t/2,a=e/t,o=e/2,l=[],u=[];for(let x=0,y=0,_=-o;x<=t;x++,_+=a){l.push(-o,0,_,o,0,_),l.push(_,0,-o,_,0,o);const T=x===r?n:s;T.toArray(u,y),y+=3,T.toArray(u,y),y+=3,T.toArray(u,y),y+=3,T.toArray(u,y),y+=3}const f=new Fn;f.setAttribute("position",new an(l,3)),f.setAttribute("color",new an(u,3));const p=new ua({vertexColors:!0,toneMapped:!1});super(f,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class LV extends Sc{constructor(e=10,t=16,n=8,s=64,r=4473924,a=8947848){r=new Bt(r),a=new Bt(a);const o=[],l=[];if(t>1)for(let p=0;p<t;p++){const x=p/t*(Math.PI*2),y=Math.sin(x)*e,_=Math.cos(x)*e;o.push(0,0,0),o.push(y,0,_);const T=p&1?r:a;l.push(T.r,T.g,T.b),l.push(T.r,T.g,T.b)}for(let p=0;p<n;p++){const x=p&1?r:a,y=e-e/n*p;for(let _=0;_<s;_++){let T=_/s*(Math.PI*2),A=Math.sin(T)*y,S=Math.cos(T)*y;o.push(A,0,S),l.push(x.r,x.g,x.b),T=(_+1)/s*(Math.PI*2),A=Math.sin(T)*y,S=Math.cos(T)*y,o.push(A,0,S),l.push(x.r,x.g,x.b)}}const u=new Fn;u.setAttribute("position",new an(o,3)),u.setAttribute("color",new an(l,3));const f=new ua({vertexColors:!0,toneMapped:!1});super(u,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const gP=new Q,fE=new Q,xP=new Q;class IV extends mi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new Fn;s.setAttribute("position",new an([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new ua({fog:!1,toneMapped:!1});this.lightPlane=new Cd(s,r),this.add(this.lightPlane),s=new Fn,s.setAttribute("position",new an([0,0,0,0,0,1],3)),this.targetLine=new Cd(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),gP.setFromMatrixPosition(this.light.matrixWorld),fE.setFromMatrixPosition(this.light.target.matrixWorld),xP.subVectors(fE,gP),this.lightPlane.lookAt(fE),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fE),this.targetLine.scale.z=xP.length()}}const hE=new Q,Qs=new cv;class PV extends Sc{constructor(e){const t=new Fn,n=new ua({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(_,T){l(_),l(T)}function l(_){s.push(0,0,0),r.push(0,0,0),a[_]===void 0&&(a[_]=[]),a[_].push(s.length/3-1)}t.setAttribute("position",new an(s,3)),t.setAttribute("color",new an(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const u=new Bt(16755200),f=new Bt(16711680),p=new Bt(43775),x=new Bt(16777215),y=new Bt(3355443);this.setColors(u,f,p,x,y)}setColors(e,t,n,s,r){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,s.r,s.g,s.b),o.setXYZ(39,s.r,s.g,s.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;let r,a;if(Qs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)r=1,a=0;else if(this.camera.coordinateSystem===oa)r=-1,a=1;else if(this.camera.coordinateSystem===Nl)r=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);dr("c",t,e,Qs,0,0,r),dr("t",t,e,Qs,0,0,a),dr("n1",t,e,Qs,-n,-s,r),dr("n2",t,e,Qs,n,-s,r),dr("n3",t,e,Qs,-n,s,r),dr("n4",t,e,Qs,n,s,r),dr("f1",t,e,Qs,-n,-s,a),dr("f2",t,e,Qs,n,-s,a),dr("f3",t,e,Qs,-n,s,a),dr("f4",t,e,Qs,n,s,a),dr("u1",t,e,Qs,n*.7,s*1.1,r),dr("u2",t,e,Qs,-n*.7,s*1.1,r),dr("u3",t,e,Qs,0,s*2,r),dr("cf1",t,e,Qs,-n,0,a),dr("cf2",t,e,Qs,n,0,a),dr("cf3",t,e,Qs,0,-s,a),dr("cf4",t,e,Qs,0,s,a),dr("cn1",t,e,Qs,-n,0,r),dr("cn2",t,e,Qs,n,0,r),dr("cn3",t,e,Qs,0,-s,r),dr("cn4",t,e,Qs,0,s,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function dr(i,e,t,n,s,r,a){hE.set(s,r,a).unproject(n);const o=e[i];if(o!==void 0){const l=t.getAttribute("position");for(let u=0,f=o.length;u<f;u++)l.setXYZ(o[u],hE.x,hE.y,hE.z)}}const pE=new Vr;class FV extends Sc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(24),r=new Fn;r.setIndex(new li(n,1)),r.setAttribute("position",new li(s,3)),super(r,new ua({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&pE.setFromObject(this.object),pE.isEmpty())return;const e=pE.min,t=pE.max,n=this.geometry.attributes.position,s=n.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class GV extends Sc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Fn;r.setIndex(new li(n,1)),r.setAttribute("position",new an(s,3)),super(r,new ua({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class zV extends Cd{constructor(e,t=1,n=16776960){const s=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Fn;a.setAttribute("position",new an(r,3)),a.computeBoundingSphere(),super(a,new ua({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Fn;l.setAttribute("position",new an(o,3)),l.computeBoundingSphere(),this.add(new Ui(l,new er({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const yP=new Q;let mE,_w;class VV extends mi{constructor(e=new Q(0,0,1),t=new Q(0,0,0),n=1,s=16776960,r=n*.2,a=r*.2){super(),this.type="ArrowHelper",mE===void 0&&(mE=new Fn,mE.setAttribute("position",new an([0,0,0,0,1,0],3)),_w=new hv(.5,1,5,1),_w.translate(0,-.5,0)),this.position.copy(t),this.line=new Cd(mE,new ua({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ui(_w,new er({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{yP.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(yP,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class HV extends Sc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Fn;s.setAttribute("position",new an(t,3)),s.setAttribute("color",new an(n,3));const r=new ua({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,n){const s=new Bt,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(n),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class kV{constructor(){this.type="ShapePath",this.color=new Bt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new MS,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,r,a){return this.currentPath.bezierCurveTo(e,t,n,s,r,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const C=[];for(let w=0,B=S.length;w<B;w++){const L=S[w],D=new hp;D.curves=L.curves,C.push(D)}return C}function n(S,C){const w=C.length;let B=!1;for(let L=w-1,D=0;D<w;L=D++){let O=C[L],F=C[D],U=F.x-O.x,P=F.y-O.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(O=C[D],U=-U,F=C[L],P=-P),S.y<O.y||S.y>F.y)continue;if(S.y===O.y){if(S.x===O.x)return!0}else{const X=P*(S.x-O.x)-U*(S.y-O.y);if(X===0)return!0;if(X<0)continue;B=!B}}else{if(S.y!==O.y)continue;if(F.x<=S.x&&S.x<=O.x||O.x<=S.x&&S.x<=F.x)return!0}}return B}const s=hc.isClockWise,r=this.subPaths;if(r.length===0)return[];let a,o,l;const u=[];if(r.length===1)return o=r[0],l=new hp,l.curves=o.curves,u.push(l),u;let f=!s(r[0].getPoints());f=e?!f:f;const p=[],x=[];let y=[],_=0,T;x[_]=void 0,y[_]=[];for(let S=0,C=r.length;S<C;S++)o=r[S],T=o.getPoints(),a=s(T),a=e?!a:a,a?(!f&&x[_]&&_++,x[_]={s:new hp,p:T},x[_].s.curves=o.curves,f&&_++,y[_]=[]):y[_].push({h:o,p:T[0]});if(!x[0])return t(r);if(x.length>1){let S=!1,C=0;for(let w=0,B=x.length;w<B;w++)p[w]=[];for(let w=0,B=x.length;w<B;w++){const L=y[w];for(let D=0;D<L.length;D++){const O=L[D];let F=!0;for(let U=0;U<x.length;U++)n(O.p,x[U].p)&&(w!==U&&C++,F?(F=!1,p[U].push(O)):S=!0);F&&p[w].push(O)}}C>0&&S===!1&&(y=p)}let A;for(let S=0,C=x.length;S<C;S++){l=x[S].s,u.push(l),A=y[S];for(let w=0,B=A.length;w<B;w++)l.holes.push(A[w].h)}return u}}class WV extends Oo{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){De("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function Vj(i,e){const t=i.image&&i.image.width?i.image.width/i.image.height:1;return t>e?(i.repeat.x=1,i.repeat.y=t/e,i.offset.x=0,i.offset.y=(1-i.repeat.y)/2):(i.repeat.x=e/t,i.repeat.y=1,i.offset.x=(1-i.repeat.x)/2,i.offset.y=0),i}function Hj(i,e){const t=i.image&&i.image.width?i.image.width/i.image.height:1;return t>e?(i.repeat.x=e/t,i.repeat.y=1,i.offset.x=(1-i.repeat.x)/2,i.offset.y=0):(i.repeat.x=1,i.repeat.y=t/e,i.offset.x=0,i.offset.y=(1-i.repeat.y)/2),i}function kj(i){return i.repeat.x=1,i.repeat.y=1,i.offset.x=0,i.offset.y=0,i}function vM(i,e,t,n){const s=Wj(n);switch(t){case rT:return i*e;case Kf:return i*e/s.components*s.byteLength;case Jf:return i*e/s.components*s.byteLength;case Al:return i*e*2/s.components*s.byteLength;case Kp:return i*e*2/s.components*s.byteLength;case m0:return i*e*3/s.components*s.byteLength;case Oi:return i*e*4/s.components*s.byteLength;case Jp:return i*e*4/s.components*s.byteLength;case hd:case pd:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case md:case gd:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Jg:case Qg:return Math.max(i,16)*Math.max(e,8)/4;case Kg:case Zg:return Math.max(i,8)*Math.max(e,8)/2;case yp:case vp:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case _p:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case bp:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Sp:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case Tp:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case Ap:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case Ep:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case Mp:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case Cp:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Rp:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case wp:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Np:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Bp:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Dp:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Op:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Up:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Lp:case bS:case SS:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Ip:case Pp:return Math.ceil(i/4)*Math.ceil(e/4)*8;case Fp:case Gp:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Wj(i){switch(i){case ss:case dd:return{byteLength:1,components:1};case Tl:case fd:case Ai:return{byteLength:2,components:1};case tv:case nv:return{byteLength:2,components:4};case Xi:case fr:case Ti:return{byteLength:4,components:1};case iv:case sv:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}class XV{static contain(e,t){return Vj(e,t)}static cover(e,t){return Hj(e,t)}static fill(e){return kj(e)}static getByteLength(e,t,n,s){return vM(e,t,n,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:$f}}));typeof window<"u"&&(window.__THREE__?De("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=$f);const Xj=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],bw=new WeakMap;class qV{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Xj,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:s,object:r}=e;if(t={material:this.getMaterialData(s),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:r.matrixWorld.clone()},r.center&&(t.center=r.center.clone()),r.morphTargetInfluences&&(t.morphTargetInfluences=r.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:o}=e.context;t.bufferWidth=a,t.bufferHeight=o}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const s=e[n];t[n]={version:s.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const s=e[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?t[n]={id:s.id,version:s.version}:t[n]=s.clone():t[n]=s)}return t}equals(e,t){const{object:n,material:s,geometry:r}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(n.matrixWorld)!==!0)return a.worldMatrix.copy(n.matrixWorld),!1;const o=a.material;for(const A in o){const S=o[A],C=s[A];if(S.equals!==void 0){if(S.equals(C)===!1)return S.copy(C),!1}else if(C.isTexture===!0){if(S.id!==C.id||S.version!==C.version)return S.id=C.id,S.version=C.version,!1}else if(S!==C)return o[A]=C,!1}if(o.transmission>0){const{width:A,height:S}=e.context;if(a.bufferWidth!==A||a.bufferHeight!==S)return a.bufferWidth=A,a.bufferHeight=S,!1}const l=a.geometry,u=r.attributes,f=l.attributes,p=Object.keys(f),x=Object.keys(u);if(l.id!==r.id)return l.id=r.id,!1;if(p.length!==x.length)return a.geometry.attributes=this.getAttributesData(u),!1;for(const A of p){const S=f[A],C=u[A];if(C===void 0)return delete f[A],!1;if(S.version!==C.version)return S.version=C.version,!1}const y=r.index,_=l.indexVersion,T=y?y.version:null;if(_!==T)return l.indexVersion=T,!1;if(l.drawRange.start!==r.drawRange.start||l.drawRange.count!==r.drawRange.count)return l.drawRange.start=r.drawRange.start,l.drawRange.count=r.drawRange.count,!1;if(a.morphTargetInfluences){let A=!1;for(let S=0;S<a.morphTargetInfluences.length;S++)a.morphTargetInfluences[S]!==n.morphTargetInfluences[S]&&(a.morphTargetInfluences[S]=n.morphTargetInfluences[S],A=!0);if(A)return!1}if(a.lights){for(let A=0;A<t.length;A++)if(a.lights[A].map!==t[A].map)return!1}return a.center&&a.center.equals(n.center)===!1?(a.center.copy(n.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(bw.has(e)){const s=bw.get(e);if(s.renderId===t)return s.lightsData}const n=this.getLightsData(e.getLights());return bw.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const s=e.object.static===!0,r=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(s||r)return!1;const a=this.getLights(e.lightsNode,n);return this.equals(e,a)!==!0}}function RD(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let s=0,r;s<i.length;s++)r=i[s],t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);else for(let s=0,r;s<i.length;s++)r=i.charCodeAt(s),t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const yv=i=>RD(i),T0=i=>RD(i),wy=(...i)=>RD(i),qj=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),vP=new WeakMap;function wD(i){return qj.get(i)}function NS(i){if(/[iu]?vec\d/.test(i))return i.startsWith("ivec")?Int32Array:i.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(i)||/float/.test(i))return Float32Array;if(/uint/.test(i))return Uint32Array;if(/int/.test(i))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${i}`)}function ND(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 9;if(/mat4/.test(i))return 16;nt("TSL: Unsupported type:",i)}function YV(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 12;if(/mat4/.test(i))return 16;nt("TSL: Unsupported type:",i)}function jV(i){if(/float|int|uint/.test(i))return 4;if(/vec2/.test(i))return 8;if(/vec3/.test(i)||/vec4/.test(i))return 16;if(/mat2/.test(i))return 8;if(/mat3/.test(i))return 48;if(/mat4/.test(i))return 64;nt("TSL: Unsupported type:",i)}function Df(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function JC(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new Bt(...e):t==="vec2"?new Ze(...e):t==="vec3"?new Q(...e):t==="vec4"?new mn(...e):t==="mat2"?new xv(...e):t==="mat3"?new Ln(...e):t==="mat4"?new Yt(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?OD(e[0]):null}function BD(i){let e=vP.get(i);return e===void 0&&(e={},vP.set(i,e)),e}function DD(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function OD(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}var Yj=Object.freeze({__proto__:null,arrayBufferToBase64:DD,base64ToArrayBuffer:OD,getByteBoundaryFromType:jV,getDataFromObject:BD,getLengthFromType:ND,getMemoryLengthFromType:YV,getTypeFromLength:wD,getTypedArrayFromType:NS,getValueFromType:JC,getValueType:Df,hash:wy,hashArray:T0,hashString:yv});const Sy={VERTEX:"vertex",FRAGMENT:"fragment"},Bn={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},$V={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},la={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},UD=["fragment","vertex"],_M=["setup","analyze","generate"],bM=[...UD,"compute"],tm=["x","y","z","w"],jj={analyze:"setup",generate:"analyze"};let $j=0,jt=class extends Oo{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Bn.NONE,this.updateBeforeType=Bn.NONE,this.updateAfterType=Bn.NONE,this.uuid=ov.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:$j++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Bn.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Bn.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Bn.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const s=this[n];if(!(n.startsWith("_")===!0||e.has(s))){if(Array.isArray(s)===!0)for(let r=0;r<s.length;r++){const a=s[r];a&&a.isNode===!0&&t.push({property:n,index:r,childNode:a})}else if(s&&s.isNode===!0)t.push({property:n,childNode:s});else if(s&&Object.getPrototypeOf(s)===Object.prototype)for(const r in s){if(r.startsWith("_")===!0)continue;const a=s[r];a&&a.isNode===!0&&t.push({property:n,index:r,childNode:a})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:s,childNode:r}of this._getChildren(t))n.push(yv(s.slice(0,-4)),r.getCacheKey(e,t));this._cacheKey=wy(T0(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const s of this.getChildren())t["node"+n++]=s;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const s=e.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[e.shaderStage]=s.stages[e.shaderStage]||[],s.stages[e.shaderStage].push(t)}if(n===1){const s=e.getNodeProperties(this);for(const r of Object.values(s))r&&r.isNode===!0&&r.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){De("Abstract function.")}updateAfter(){De("Abstract function.")}update(){De("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const l=this._beforeNodes;this._beforeNodes=null;for(const u of l)u.build(e,t);this._beforeNodes=l}const s=e.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[e.buildStage]=!0;const r=jj[e.buildStage];if(r&&s.buildStages[r]!==!0){const l=e.getBuildStage();e.setBuildStage(r),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if(o==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const u of Object.values(l))if(u&&u.isNode===!0){if(u.parents===!0){const f=e.getNodeProperties(u);f.parents=f.parents||[],f.parents.push(this)}u.build(e)}}a=l.outputNode}else if(o==="analyze")this.analyze(e,t);else if(o==="generate"){if(this.generate.length<2){const u=this.getNodeType(e),f=e.getDataFromNode(this);a=f.snippet,a===void 0?f.generated===void 0?(f.generated=!0,a=this.generate(e)||"",f.snippet=a):(De("Node: Recursion detected.",this),a="/* Recursion detected. */"):f.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,u,t)}else a=this.generate(e,t)||"";a===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(nt(`TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:s,index:r,childNode:a}of t)r!==void 0?(n[s]===void 0&&(n[s]=Number.isInteger(r)?[]:{}),n[s][r]=a.toJSON(e.meta).uuid):n[s]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const s=[];for(const r of e.inputNodes[n])s.push(t[r]);this[n]=s}else if(typeof e.inputNodes[n]=="object"){const s={};for(const r in e.inputNodes[n]){const a=e.inputNodes[n][r];s[r]=t[a]}this[n]=s}else{const s=e.inputNodes[n];this[n]=t[s]}}}toJSON(e){const{uuid:t,type:n}=this,s=e===void 0||typeof e=="string";s&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function a(o){const l=[];for(const u in o){const f=o[u];delete f.metadata,l.push(f)}return l}if(s){const o=a(e.textures),l=a(e.images),u=a(e.nodes);o.length>0&&(r.textures=o),l.length>0&&(r.images=l),u.length>0&&(r.nodes=u)}return r}};class nm extends jt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),s=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${s} ]`}}class LD extends jt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const s of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(s))&&(n=s);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,s=this.getNodeType(e),r=n.build(e,s);return e.format(r,s,t)}}class js extends jt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,s,t);if(s!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,s),o=e.getVarFromNode(this,null,s),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${a}`,this),r.snippet=a,r.propertyName=l,e.format(r.propertyName,s,t)}}return super.build(e,t)}}class KV extends js{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),s=e.getTypeLength(n),r=this.nodes,a=e.getComponentType(n),o=[];let l=0;for(const f of r){if(l>=s){nt(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let p=f.getNodeType(e),x=e.getTypeLength(p),y;if(l+x>s&&(nt(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),x=s-l,p=e.getTypeFromLength(x)),l+=x,y=f.build(e,p),e.getComponentType(p)!==a){const T=e.getTypeFromLength(x,a);y=e.format(y,p,T)}o.push(y)}const u=`${e.getType(n)}( ${o.join(", ")} )`;return e.format(u,n,t)}}const Kj=tm.join("");class ID extends jt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(tm.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,s=e.getTypeLength(n.getNodeType(e));let r=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=n.build(e,a);this.components.length===s&&this.components===Kj.slice(0,this.components.length)?r=e.format(l,a,t):r=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else r=n.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class JV extends js{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:s}=this,r=this.getNodeType(e),a=e.getComponentType(s.getNodeType(e)),o=e.getTypeFromLength(n.length,a),l=s.build(e,o),u=t.build(e,r),f=e.getTypeLength(r),p=[];for(let x=0;x<f;x++){const y=tm[x];y===n[0]?(p.push(l),x+=n.length-1):p.push(u+"."+y)}return`${e.getType(r)}( ${p.join(", ")} )`}}class Jj extends js{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,s=this.getNodeType(e),r=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+r,this);const l=e.getTypeLength(s),u=[];let f=0;for(let p=0;p<l;p++){const x=tm[p];x===t[f]?(u.push("1.0 - "+(o+"."+x)),f++):u.push(o+"."+x)}return`${e.getType(s)}( ${u.join(", ")} )`}}class PD extends jt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Df(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Df(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=DD(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?JC(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){De("Abstract function.")}}const _P=/float|u?int/;class Il extends PD{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return _P.test(n)&&_P.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class ZV extends jt{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){De(`TSL: Member "${this.property}" does not exist in struct.`);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}}let Wp=null;const uN=new Map;function Xe(i,e){if(uN.has(i)){De(`TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);uN.set(i,e),i!=="assign"&&(jt.prototype[i]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},jt.prototype[i+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const Zj=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),bP=i=>Zj(i).split("").sort().join("");jt.prototype.assign=function(...i){if(this.isStackNode!==!0)return Wp!==null?Wp.assign(this,...i):nt("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=uN.get("assign");return this.addToStack(e(...i))}};jt.prototype.toVarIntent=function(){return this};jt.prototype.get=function(i){return new ZV(this,i)};const rS={};function gE(i,e,t){rS[i]=rS[e]=rS[t]={get(){this._cache=this._cache||{};let a=this._cache[i];return a===void 0&&(a=new ID(this,i),this._cache[i]=a),a},set(a){this[i].assign(Ke(a))}};const n=i.toUpperCase(),s=e.toUpperCase(),r=t.toUpperCase();jt.prototype["set"+n]=jt.prototype["set"+s]=jt.prototype["set"+r]=function(a){const o=bP(i);return new JV(this,o,Ke(a))},jt.prototype["flip"+n]=jt.prototype["flip"+s]=jt.prototype["flip"+r]=function(){const a=bP(i);return new Jj(this,a)}}const Zu=["x","y","z","w"],Qu=["r","g","b","a"],ed=["s","t","p","q"];for(let i=0;i<4;i++){let e=Zu[i],t=Qu[i],n=ed[i];gE(e,t,n);for(let s=0;s<4;s++){e=Zu[i]+Zu[s],t=Qu[i]+Qu[s],n=ed[i]+ed[s],gE(e,t,n);for(let r=0;r<4;r++){e=Zu[i]+Zu[s]+Zu[r],t=Qu[i]+Qu[s]+Qu[r],n=ed[i]+ed[s]+ed[r],gE(e,t,n);for(let a=0;a<4;a++)e=Zu[i]+Zu[s]+Zu[r]+Zu[a],t=Qu[i]+Qu[s]+Qu[r]+Qu[a],n=ed[i]+ed[s]+ed[r]+ed[a],gE(e,t,n)}}}for(let i=0;i<32;i++)rS[i]={get(){this._cache=this._cache||{};let e=this._cache[i];return e===void 0&&(e=new nm(this,new Il(i,"uint")),this._cache[i]=e),e},set(e){this[i].assign(Ke(e))}};Object.defineProperties(jt.prototype,rS);const SP=new WeakMap,Qj=function(i,e=null){const t=Df(i);return t==="node"?i:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Ke(dN(i,e)):t==="shader"?i.isFn?i:ye(i):i},e$=function(i,e=null){for(const t in i)i[t]=Ke(i[t],e);return i},t$=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=Ke(i[n],e);return i},QV=function(i,e=null,t=null,n=null){function s(f){return n!==null?(f=Ke(Object.assign(f,n)),n.intent===!0&&(f=f.toVarIntent())):f=Ke(f),f}let r,a=e,o,l;function u(f){let p;return a?p=/[a-z]/i.test(a)?a+"()":a:p=i.type,o!==void 0&&f.length<o?(nt(`TSL: "${p}" parameter length is less than minimum required.`),f.concat(new Array(o-f.length).fill(0))):l!==void 0&&f.length>l?(nt(`TSL: "${p}" parameter length exceeds limit.`),f.slice(0,l)):f}return e===null?r=(...f)=>s(new i(...Ug(u(f)))):t!==null?(t=Ke(t),r=(...f)=>s(new i(e,...Ug(u(f)),t))):r=(...f)=>s(new i(e,...Ug(u(f)))),r.setParameterLength=(...f)=>(f.length===1?o=l=f[0]:f.length===2&&([o,l]=f),r),r.setName=f=>(a=f,r),r},n$=function(i,...e){return Ke(new i(...Ug(e)))};class i$ extends jt{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,s=e.getNodeProperties(t),r=e.getClosestSubBuild(t.subBuilds)||"",a=r||"default";if(s[a])return s[a];const o=e.subBuildFn,l=e.fnCall;e.subBuildFn=r,e.fnCall=this;let u=null;if(t.layout){let f=SP.get(e.constructor);f===void 0&&(f=new WeakMap,SP.set(e.constructor,f));let p=f.get(t);p===void 0&&(p=Ke(e.buildFunctionNode(t)),f.set(t,p)),e.addInclude(p);const x=n?s$(n):null;u=Ke(p.call(x))}else{const f=new Proxy(e,{get:(T,A,S)=>{let C;return Symbol.iterator===A?C=function*(){yield void 0}:C=Reflect.get(T,A,S),C}}),p=n?r$(n):null,x=Array.isArray(n)?n.length>0:n!==null,y=t.jsFunc,_=x||y.length>1?y(p,f):y(f);u=Ke(_)}return e.subBuildFn=o,e.fnCall=l,t.once&&(s[a]=u),u}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const s=e.getBuildStage(),r=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e),l=e.fnCall;if(e.fnCall=this,s==="setup"){const u=e.getSubBuildProperty("initialized",this);if(r[u]!==!0&&(r[u]=!0,r[a]=this.getOutputNode(e),r[a].build(e),this.shaderNode.subBuilds))for(const f of e.chaining){const p=e.getDataFromNode(f,"any");p.subBuilds=p.subBuilds||new Set;for(const x of this.shaderNode.subBuilds)p.subBuilds.add(x)}n=r[a]}else s==="analyze"?o.build(e,t):s==="generate"&&(n=o.build(e,t)||"");return e.fnCall=l,n}}function s$(i){let e;return e3(i),i[0]&&(i[0].isNode||Object.getPrototypeOf(i[0])!==Object.prototype)?e=[...i]:e=i[0],e}function r$(i){let e=0;return e3(i),new Proxy(i,{get:(t,n,s)=>{let r;if(n==="length")return r=i.length,r;if(Symbol.iterator===n)r=function*(){for(const a of i)yield Ke(a)};else{if(i.length>0)if(Object.getPrototypeOf(i[0])===Object.prototype){const a=i[0];a[n]===void 0?r=a[e++]:r=Reflect.get(a,n,s)}else i[0]instanceof jt&&(i[n]===void 0?r=i[e++]:r=Reflect.get(i,n,s));else r=Reflect.get(t,n,s);r=Ke(r)}return r}})}class a$ extends jt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new i$(this,e)}setup(){return this.call()}}const o$=[!1,!0],l$=[0,1,2,3],c$=[-1,-2],e8=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],FD=new Map;for(const i of o$)FD.set(i,new Il(i));const GD=new Map;for(const i of l$)GD.set(i,new Il(i,"uint"));const zD=new Map([...GD].map(i=>new Il(i.value,"int")));for(const i of c$)zD.set(i,new Il(i,"int"));const ZC=new Map([...zD].map(i=>new Il(i.value)));for(const i of e8)ZC.set(i,new Il(i));for(const i of e8)ZC.set(-i,new Il(-i));const QC={bool:FD,uint:GD,ints:zD,float:ZC},TP=new Map([...FD,...ZC]),dN=(i,e)=>TP.has(i)?TP.get(i):i.isNode===!0?i:new Il(i,e),Nr=function(i,e=null){return(...t)=>{for(const s of t)if(s===void 0)return nt(`TSL: Invalid parameter for the type "${i}".`),Ke(new Il(0,i));if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(s=>{const r=typeof s;return r!=="object"&&r!=="function"}))&&(t=[JC(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Jb(e.get(t[0]));if(t.length===1){const s=dN(t[0],i);return s.nodeType===i?Jb(s):Jb(new LD(s,i))}const n=t.map(s=>dN(s));return Jb(new KV(n,i))}},BS=i=>typeof i=="object"&&i!==null?i.value:i,t8=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function Ty(i,e){return new a$(i,e)}const Ke=(i,e=null)=>Qj(i,e),Jb=(i,e=null)=>Ke(i,e).toVarIntent(),e3=(i,e=null)=>new e$(i,e),Ug=(i,e=null)=>new t$(i,e),En=(i,e=null,t=null,n=null)=>new QV(i,e,t,n),Rt=(i,...e)=>new n$(i,...e),St=(i,e=null,t=null,n={})=>new QV(i,e,t,{...n,intent:!0});let u$=0;class d$ extends jt{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:nt("TSL: Invalid layout type."),t=null)),this.shaderNode=new Ty(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+u$++,type:t,inputs:[]};for(const s in e)s!=="return"&&n.inputs.push({name:s,type:e[s]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return nt('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function ye(i,e=null){const t=new d$(i,e);return new Proxy(()=>{},{apply(n,s,r){return t.call(...r)},get(n,s,r){return Reflect.get(t,s,r)},set(n,s,r,a){return Reflect.set(t,s,r,a)}})}const DS=i=>{Wp=i},VD=()=>Wp,sn=(...i)=>Wp.If(...i),f$=(...i)=>Wp.Switch(...i);function t3(i){return Wp&&Wp.addToStack(i),i}Xe("toStack",t3);const n8=new Nr("color"),j=new Nr("float",QC.float),oe=new Nr("int",QC.ints),yt=new Nr("uint",QC.uint),vc=new Nr("bool",QC.bool),Je=new Nr("vec2"),Gr=new Nr("ivec2"),i8=new Nr("uvec2"),s8=new Nr("bvec2"),de=new Nr("vec3"),r8=new Nr("ivec3"),vv=new Nr("uvec3"),HD=new Nr("bvec3"),Vt=new Nr("vec4"),a8=new Nr("ivec4"),o8=new Nr("uvec4"),l8=new Nr("bvec4"),n3=new Nr("mat2"),qa=new Nr("mat3"),Lg=new Nr("mat4"),h$=(i="")=>Ke(new Il(i,"string")),p$=i=>Ke(new Il(i,"ArrayBuffer"));Xe("toColor",n8);Xe("toFloat",j);Xe("toInt",oe);Xe("toUint",yt);Xe("toBool",vc);Xe("toVec2",Je);Xe("toIVec2",Gr);Xe("toUVec2",i8);Xe("toBVec2",s8);Xe("toVec3",de);Xe("toIVec3",r8);Xe("toUVec3",vv);Xe("toBVec3",HD);Xe("toVec4",Vt);Xe("toIVec4",a8);Xe("toUVec4",o8);Xe("toBVec4",l8);Xe("toMat2",n3);Xe("toMat3",qa);Xe("toMat4",Lg);const c8=En(nm).setParameterLength(2),u8=(i,e)=>Ke(new LD(Ke(i),e)),m$=(i,e)=>Ke(new ID(Ke(i),e));Xe("element",c8);Xe("convert",u8);const g$=i=>(De("TSL: append() has been renamed to Stack()."),t3(i));Xe("append",i=>(De("TSL: .append() has been renamed to .toStack()."),t3(i)));class Hi extends jt{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return yv(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const ou=(i,e)=>Ke(new Hi(i,e)),vl=(i,e)=>Ke(new Hi(i,e,!0)),bi=Rt(Hi,"vec4","DiffuseColor"),fN=Rt(Hi,"vec3","EmissiveColor"),od=Rt(Hi,"float","Roughness"),OS=Rt(Hi,"float","Metalness"),SM=Rt(Hi,"float","Clearcoat"),US=Rt(Hi,"float","ClearcoatRoughness"),Cg=Rt(Hi,"vec3","Sheen"),i3=Rt(Hi,"float","SheenRoughness"),s3=Rt(Hi,"float","Iridescence"),kD=Rt(Hi,"float","IridescenceIOR"),WD=Rt(Hi,"float","IridescenceThickness"),TM=Rt(Hi,"float","AlphaT"),np=Rt(Hi,"float","Anisotropy"),aS=Rt(Hi,"vec3","AnisotropyT"),Ig=Rt(Hi,"vec3","AnisotropyB"),oc=Rt(Hi,"color","SpecularColor"),LS=Rt(Hi,"float","SpecularF90"),AM=Rt(Hi,"float","Shininess"),Ny=Rt(Hi,"vec4","Output"),Pg=Rt(Hi,"float","dashSize"),IS=Rt(Hi,"float","gapSize"),x$=Rt(Hi,"float","pointWidth"),oS=Rt(Hi,"float","IOR"),EM=Rt(Hi,"float","Transmission"),XD=Rt(Hi,"float","Thickness"),qD=Rt(Hi,"float","AttenuationDistance"),YD=Rt(Hi,"color","AttenuationColor"),jD=Rt(Hi,"float","Dispersion");class $D extends jt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const d8=i=>new $D(i),r3=(i,e=0)=>new $D(i,!0,e),f8=r3("frame"),ln=r3("render"),KD=d8("object");class _v extends PD{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=KD}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const s=e(n,this);s!==void 0&&(this.value=s)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),s=this.getUniformHash(e);let r=e.getNodeFromHash(s);r===void 0&&(e.setHashNode(this,s),r=this);const a=r.getInputType(e),o=e.getUniformFromNode(r,a,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(o);e.context.nodeName!==void 0&&delete e.context.nodeName;let u=l;if(n==="bool"){const f=e.getDataFromNode(this);let p=f.propertyName;if(p===void 0){const x=e.getVarFromNode(this,null,"bool");p=e.getPropertyName(x),f.propertyName=p,u=e.format(l,a,n),e.addLineFlowCode(`${p} = ${u}`,this)}u=p}return e.format(u,n,t)}}const rn=(i,e)=>{const t=t8(e||i);return t===i&&(i=JC(t)),i=i&&i.isNode===!0?i.node&&i.node.value||i.value:i,Ke(new _v(i,t))};class hN extends js{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const h8=(...i)=>{let e;if(i.length===1){const t=i[0];e=new hN(null,t.length,t)}else{const t=i[0],n=i[1];e=new hN(t,n)}return Ke(e)};Xe("toArray",(i,e)=>h8(Array(e).fill(i)));class p8 extends js{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return tm.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,s=t.getScope(),r=e.getNodeProperties(s);r.assign=!0;const a=e.getNodeProperties(this);a.sourceNode=n,a.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:s}=e.getNodeProperties(this),r=this.needsSplitAssign(e),a=n.build(e),o=n.getNodeType(e),l=s.build(e,o),u=s.getNodeType(e),f=e.getDataFromNode(this);let p;if(f.initialized===!0)t!=="void"&&(p=a);else if(r){const x=e.getVarFromNode(this,null,o),y=e.getPropertyName(x);e.addLineFlowCode(`${y} = ${l}`,this);const _=n.node,A=_.node.context({assign:!0}).build(e);for(let S=0;S<_.components.length;S++){const C=_.components[S];e.addLineFlowCode(`${A}.${C} = ${y}[ ${S} ]`,this)}t!=="void"&&(p=a)}else p=`${a} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(p,this),t!=="void"&&(p=a));return f.initialized=!0,e.format(p,o,t)}}const m8=En(p8).setParameterLength(2);Xe("assign",m8);class g8 extends js{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,s=n.getInputs(e),r=this.parameters,a=(l,u)=>{const f=u.type,p=f==="pointer";let x;return p?x="&"+l.build(e):x=l.build(e,f),x};if(Array.isArray(r)){if(r.length>s.length)nt("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),r.length=s.length;else if(r.length<s.length)for(nt("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");r.length<s.length;)r.push(j(0));for(let l=0;l<r.length;l++)t.push(a(r[l],s[l]))}else for(const l of s){const u=r[l.name];u!==void 0?t.push(a(u,l)):(nt(`TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(a(j(0),l)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const x8=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Ug(e):e3(e[0]),new g8(Ke(i),e));Xe("call",x8);const y$={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Ps extends js{static get type(){return"OperatorNode"}constructor(e,t,n,...s){if(super(),s.length>0){let r=new Ps(e,t,n);for(let a=0;a<s.length-1;a++)r=new Ps(e,r,s[a]);t=r,n=s[s.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(y$[this.op],t)}getNodeType(e,t=null){const n=this.op,s=this.aNode,r=this.bNode,a=s.getNodeType(e),o=r?r.getNodeType(e):null;if(a==="void"||o==="void")return t||"void";if(n==="%")return a;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(a);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const l=Math.max(e.getTypeLength(a),e.getTypeLength(o));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}}generate(e,t){const n=this.op,{aNode:s,bNode:r}=this,a=this.getNodeType(e,t);let o=null,l=null;a!=="void"?(o=s.getNodeType(e),l=r?r.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(o)?l=o:e.isVector(l)?o=l:o!==l&&(o=l="float"):n===">>"||n==="<<"?(o=a,l=e.changeComponentType(l,"uint")):n==="%"?(o=a,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=a):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=a:o=l=a):o=l=a;const u=s.build(e,o),f=r?r.build(e,l):null,p=e.getFunctionOperator(n);if(t!=="void"){const x=e.renderer.coordinateSystem===oa;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return x?e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${f} )`,a,t):e.format(`( ${u} ${n} ${f} )`,a,t):e.format(`( ${u} ${n} ${f} )`,a,t);if(n==="%")return e.isInteger(l)?e.format(`( ${u} % ${f} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${u}, ${f} )`,a,t);if(n==="!"||n==="~")return e.format(`(${n}${u})`,o,t);if(p)return e.format(`${p}( ${u}, ${f} )`,a,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${f} ${n} ${u} )`,a,t);if(o==="float"&&e.isMatrix(l))return e.format(`${u} ${n} ${f}`,a,t);{let y=`( ${u} ${n} ${f} )`;return!x&&a==="bool"&&e.isVector(o)&&e.isVector(l)&&(y=`all${y}`),e.format(y,a,t)}}else if(o!=="void")return p?e.format(`${p}( ${u}, ${f} )`,a,t):e.isMatrix(o)&&l==="float"?e.format(`${f} ${n} ${u}`,a,t):e.format(`${u} ${n} ${f}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const gr=St(Ps,"+").setParameterLength(2,1/0).setName("add"),ri=St(Ps,"-").setParameterLength(2,1/0).setName("sub"),Cn=St(Ps,"*").setParameterLength(2,1/0).setName("mul"),Dl=St(Ps,"/").setParameterLength(2,1/0).setName("div"),zT=St(Ps,"%").setParameterLength(2).setName("mod"),JD=St(Ps,"==").setParameterLength(2).setName("equal"),y8=St(Ps,"!=").setParameterLength(2).setName("notEqual"),v8=St(Ps,"<").setParameterLength(2).setName("lessThan"),ZD=St(Ps,">").setParameterLength(2).setName("greaterThan"),_8=St(Ps,"<=").setParameterLength(2).setName("lessThanEqual"),b8=St(Ps,">=").setParameterLength(2).setName("greaterThanEqual"),S8=St(Ps,"&&").setParameterLength(2,1/0).setName("and"),T8=St(Ps,"||").setParameterLength(2,1/0).setName("or"),A8=St(Ps,"!").setParameterLength(1).setName("not"),E8=St(Ps,"^^").setParameterLength(2).setName("xor"),M8=St(Ps,"&").setParameterLength(2).setName("bitAnd"),C8=St(Ps,"~").setParameterLength(1).setName("bitNot"),R8=St(Ps,"|").setParameterLength(2).setName("bitOr"),w8=St(Ps,"^").setParameterLength(2).setName("bitXor"),N8=St(Ps,"<<").setParameterLength(2).setName("shiftLeft"),B8=St(Ps,">>").setParameterLength(2).setName("shiftRight"),D8=ye(([i])=>(i.addAssign(1),i)),O8=ye(([i])=>(i.subAssign(1),i)),U8=ye(([i])=>{const e=oe(i).toConst();return i.addAssign(1),e}),L8=ye(([i])=>{const e=oe(i).toConst();return i.subAssign(1),e});Xe("add",gr);Xe("sub",ri);Xe("mul",Cn);Xe("div",Dl);Xe("mod",zT);Xe("equal",JD);Xe("notEqual",y8);Xe("lessThan",v8);Xe("greaterThan",ZD);Xe("lessThanEqual",_8);Xe("greaterThanEqual",b8);Xe("and",S8);Xe("or",T8);Xe("not",A8);Xe("xor",E8);Xe("bitAnd",M8);Xe("bitNot",C8);Xe("bitOr",R8);Xe("bitXor",w8);Xe("shiftLeft",N8);Xe("shiftRight",B8);Xe("incrementBefore",D8);Xe("decrementBefore",O8);Xe("increment",U8);Xe("decrement",L8);const I8=(i,e)=>(De('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),zT(oe(i),oe(e)));Xe("modInt",I8);class Re extends js{static get type(){return"MathNode"}constructor(e,t,n=null,s=null){if(super(),(e===Re.MAX||e===Re.MIN)&&arguments.length>3){let r=new Re(e,t,n);for(let a=2;a<arguments.length-1;a++)r=new Re(e,r,arguments[a]);t=r,n=arguments[arguments.length-1],s=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=s,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(s)?0:e.getTypeLength(s);return r>a&&r>o?t:a>o?n:o>r?s:t}getNodeType(e){const t=this.method;return t===Re.LENGTH||t===Re.DISTANCE||t===Re.DOT?"float":t===Re.CROSS?"vec3":t===Re.ALL||t===Re.ANY?"bool":t===Re.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:s}=this;let r=null;if(s===Re.ONE_MINUS)r=ri(1,t);else if(s===Re.RECIPROCAL)r=Dl(1,t);else if(s===Re.DIFFERENCE)r=ds(ri(t,n));else if(s===Re.TRANSFORM_DIRECTION){let a=t,o=n;e.isMatrix(a.getNodeType(e))?o=Vt(de(o),0):a=Vt(de(a),0);const l=Cn(a,o).xyz;r=Zo(l)}return r!==null?r:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let s=this.method;const r=this.getNodeType(e),a=this.getInputType(e),o=this.aNode,l=this.bNode,u=this.cNode,f=e.renderer.coordinateSystem;if(s===Re.NEGATE)return e.format("( - "+o.build(e,a)+" )",r,t);{const p=[];return s===Re.CROSS?p.push(o.build(e,r),l.build(e,r)):f===oa&&s===Re.STEP?p.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a),l.build(e,a)):f===oa&&(s===Re.MIN||s===Re.MAX)?p.push(o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):s===Re.REFRACT?p.push(o.build(e,a),l.build(e,a),u.build(e,"float")):s===Re.MIX?p.push(o.build(e,a),l.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):(f===Nl&&s===Re.ATAN&&l!==null&&(s="atan2"),e.shaderStage!=="fragment"&&(s===Re.DFDX||s===Re.DFDY)&&(De(`TSL: '${s}' is not supported in the ${e.shaderStage} stage.`),s="/*"+s+"*/"),p.push(o.build(e,a)),l!==null&&p.push(l.build(e,a)),u!==null&&p.push(u.build(e,a))),e.format(`${e.getMethod(s,r)}( ${p.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Re.ALL="all";Re.ANY="any";Re.RADIANS="radians";Re.DEGREES="degrees";Re.EXP="exp";Re.EXP2="exp2";Re.LOG="log";Re.LOG2="log2";Re.SQRT="sqrt";Re.INVERSE_SQRT="inversesqrt";Re.FLOOR="floor";Re.CEIL="ceil";Re.NORMALIZE="normalize";Re.FRACT="fract";Re.SIN="sin";Re.COS="cos";Re.TAN="tan";Re.ASIN="asin";Re.ACOS="acos";Re.ATAN="atan";Re.ABS="abs";Re.SIGN="sign";Re.LENGTH="length";Re.NEGATE="negate";Re.ONE_MINUS="oneMinus";Re.DFDX="dFdx";Re.DFDY="dFdy";Re.ROUND="round";Re.RECIPROCAL="reciprocal";Re.TRUNC="trunc";Re.FWIDTH="fwidth";Re.TRANSPOSE="transpose";Re.DETERMINANT="determinant";Re.INVERSE="inverse";Re.EQUALS="equals";Re.MIN="min";Re.MAX="max";Re.STEP="step";Re.REFLECT="reflect";Re.DISTANCE="distance";Re.DIFFERENCE="difference";Re.DOT="dot";Re.CROSS="cross";Re.POW="pow";Re.TRANSFORM_DIRECTION="transformDirection";Re.MIX="mix";Re.CLAMP="clamp";Re.REFRACT="refract";Re.SMOOTHSTEP="smoothstep";Re.FACEFORWARD="faceforward";const QD=j(1e-6),v$=j(1e6),MM=j(Math.PI),_$=j(Math.PI*2),b$=j(Math.PI*2),S$=j(Math.PI*.5),P8=St(Re,Re.ALL).setParameterLength(1),F8=St(Re,Re.ANY).setParameterLength(1),G8=St(Re,Re.RADIANS).setParameterLength(1),z8=St(Re,Re.DEGREES).setParameterLength(1),eO=St(Re,Re.EXP).setParameterLength(1),ky=St(Re,Re.EXP2).setParameterLength(1),a3=St(Re,Re.LOG).setParameterLength(1),xd=St(Re,Re.LOG2).setParameterLength(1),$o=St(Re,Re.SQRT).setParameterLength(1),tO=St(Re,Re.INVERSE_SQRT).setParameterLength(1),yd=St(Re,Re.FLOOR).setParameterLength(1),o3=St(Re,Re.CEIL).setParameterLength(1),Zo=St(Re,Re.NORMALIZE).setParameterLength(1),uu=St(Re,Re.FRACT).setParameterLength(1),jo=St(Re,Re.SIN).setParameterLength(1),ad=St(Re,Re.COS).setParameterLength(1),V8=St(Re,Re.TAN).setParameterLength(1),H8=St(Re,Re.ASIN).setParameterLength(1),nO=St(Re,Re.ACOS).setParameterLength(1),l3=St(Re,Re.ATAN).setParameterLength(1,2),ds=St(Re,Re.ABS).setParameterLength(1),PS=St(Re,Re.SIGN).setParameterLength(1),vd=St(Re,Re.LENGTH).setParameterLength(1),k8=St(Re,Re.NEGATE).setParameterLength(1),W8=St(Re,Re.ONE_MINUS).setParameterLength(1),iO=St(Re,Re.DFDX).setParameterLength(1),sO=St(Re,Re.DFDY).setParameterLength(1),X8=St(Re,Re.ROUND).setParameterLength(1),q8=St(Re,Re.RECIPROCAL).setParameterLength(1),rO=St(Re,Re.TRUNC).setParameterLength(1),aO=St(Re,Re.FWIDTH).setParameterLength(1),Y8=St(Re,Re.TRANSPOSE).setParameterLength(1),j8=St(Re,Re.DETERMINANT).setParameterLength(1),$8=St(Re,Re.INVERSE).setParameterLength(1),K8=(i,e)=>(De('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),JD(i,e)),el=St(Re,Re.MIN).setParameterLength(2,1/0),Ts=St(Re,Re.MAX).setParameterLength(2,1/0),c3=St(Re,Re.STEP).setParameterLength(2),J8=St(Re,Re.REFLECT).setParameterLength(2),Z8=St(Re,Re.DISTANCE).setParameterLength(2),Q8=St(Re,Re.DIFFERENCE).setParameterLength(2),du=St(Re,Re.DOT).setParameterLength(2),o0=St(Re,Re.CROSS).setParameterLength(2),pc=St(Re,Re.POW).setParameterLength(2),oO=i=>Cn(i,i),e5=i=>Cn(i,i,i),lO=i=>Cn(i,i,i,i),t5=St(Re,Re.TRANSFORM_DIRECTION).setParameterLength(2),n5=i=>Cn(PS(i),pc(ds(i),1/3)),cO=i=>du(i,i),Si=St(Re,Re.MIX).setParameterLength(3),_c=(i,e=0,t=1)=>Ke(new Re(Re.CLAMP,Ke(i),Ke(e),Ke(t))),uO=i=>_c(i),dO=St(Re,Re.REFRACT).setParameterLength(3),Ol=St(Re,Re.SMOOTHSTEP).setParameterLength(3),fO=St(Re,Re.FACEFORWARD).setParameterLength(3),i5=ye(([i])=>{const n=43758.5453,s=du(i.xy,Je(12.9898,78.233)),r=zT(s,MM);return uu(jo(r).mul(n))}),s5=(i,e,t)=>Si(e,t,i),r5=(i,e,t)=>Ol(e,t,i),a5=(i,e)=>c3(e,i),o5=(i,e)=>(De('TSL: "atan2" is overloaded. Use "atan" instead.'),l3(i,e)),T$=fO,A$=tO;Xe("all",P8);Xe("any",F8);Xe("equals",K8);Xe("radians",G8);Xe("degrees",z8);Xe("exp",eO);Xe("exp2",ky);Xe("log",a3);Xe("log2",xd);Xe("sqrt",$o);Xe("inverseSqrt",tO);Xe("floor",yd);Xe("ceil",o3);Xe("normalize",Zo);Xe("fract",uu);Xe("sin",jo);Xe("cos",ad);Xe("tan",V8);Xe("asin",H8);Xe("acos",nO);Xe("atan",l3);Xe("abs",ds);Xe("sign",PS);Xe("length",vd);Xe("lengthSq",cO);Xe("negate",k8);Xe("oneMinus",W8);Xe("dFdx",iO);Xe("dFdy",sO);Xe("round",X8);Xe("reciprocal",q8);Xe("trunc",rO);Xe("fwidth",aO);Xe("atan2",o5);Xe("min",el);Xe("max",Ts);Xe("step",a5);Xe("reflect",J8);Xe("distance",Z8);Xe("dot",du);Xe("cross",o0);Xe("pow",pc);Xe("pow2",oO);Xe("pow3",e5);Xe("pow4",lO);Xe("transformDirection",t5);Xe("mix",s5);Xe("clamp",_c);Xe("refract",dO);Xe("smoothstep",r5);Xe("faceForward",fO);Xe("difference",Q8);Xe("saturate",uO);Xe("cbrt",n5);Xe("transpose",Y8);Xe("determinant",j8);Xe("inverse",$8);Xe("rand",i5);class E$ extends jt{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const s=t.getNodeType(e);if(n!==null){const r=n.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(s))return r}return s}setup(e){const t=this.condNode,n=this.ifNode.isolate(),s=this.elseNode?this.elseNode.isolate():null,r=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=r,s!==null&&(e.getDataFromNode(s).parentNodeBlock=r);const a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?n:n.context({nodeBlock:n}),o.elseNode=s?a?s:s.context({nodeBlock:s}):null}generate(e,t){const n=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:r,ifNode:a,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,u=t!=="void",f=u?ou(n).build(e):"";s.nodeProperty=f;const p=r.build(e,"bool");if(e.context.uniformFlow&&o!==null){const _=a.build(e,n),T=o.build(e,n),A=e.getTernary(p,_,T);return e.format(A,n,t)}e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let y=a.build(e,n);if(y&&(u?y=f+" = "+y+";":(y="return "+y+";",l===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),y="// "+y))),e.removeFlowTab().addFlowCode(e.tab+"	"+y+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let _=o.build(e,n);_&&(u?_=f+" = "+_+";":(_="return "+_+";",l===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),_="// "+_))),e.removeFlowTab().addFlowCode(e.tab+"	"+_+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(f,n,t)}}const Rr=En(E$).setParameterLength(2,3);Xe("select",Rr);class hO extends jt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),s=this.node.build(e,t);return e.setContext(n),s}}const VT=En(hO).setParameterLength(1,2),l5=i=>VT(i,{uniformFlow:!0}),pO=(i,e)=>VT(i,{nodeName:e});function c5(i,e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),pO(i,e)}Xe("context",VT);Xe("label",c5);Xe("uniformFlow",l5);Xe("setName",pO);class lS extends jt{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){let n=e.getNodeProperties(this).assign;return n!==!0&&this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop&&(n=!0),n}build(...e){const t=e[0];return this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)&&t.getBaseStack().addToStack(this),this.intent===!0&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:s}=this,{renderer:r}=e,a=r.backend.isWebGPUBackend===!0;let o=!1,l=!1;s&&(o=e.isDeterministic(t),l=a?s:o);const u=this.getNodeType(e);if(u=="void")return this.intent!==!0&&nt('TSL: ".toVar()" can not be used with void type.'),t.build(e);const f=e.getVectorType(u),p=t.build(e,f),x=e.getVarFromNode(this,n,f,void 0,l),y=e.getPropertyName(x);let _=y;if(l)if(a)_=o?`const ${y}`:`let ${y}`;else{const T=t.getArrayCount(e);_=`const ${e.getVar(x.type,y,T)}`}return e.addLineFlowCode(`${_} = ${p}`,this),y}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const mO=En(lS),u5=(i,e=null)=>mO(i,e).toStack(),d5=(i,e=null)=>mO(i,e,!0).toStack(),f5=i=>mO(i).setIntent(!0).toStack();Xe("toVar",u5);Xe("toConst",d5);Xe("toVarIntent",f5);class h5 extends jt{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const By=(i,e,t=null)=>Ke(new h5(Ke(i),e,t));class p5 extends jt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const s=this.name,r=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,s,r,a,o),t.node=By(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Sy.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Sy.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),s=this.setupVarying(e);if(n[t]===void 0){const r=this.getNodeType(e),a=e.getPropertyName(s,Sy.VERTEX);e.flowNodeFromShaderStage(Sy.VERTEX,n.node,r,a),n[t]=a}return e.getPropertyName(s)}}const Dd=En(p5).setParameterLength(1,2),m5=i=>Dd(i);Xe("toVarying",Dd);Xe("toVertexStage",m5);Xe("varying",(...i)=>(De("TSL: .varying() has been renamed to .toVarying()."),Dd(...i)));Xe("vertexStage",(...i)=>(De("TSL: .vertexStage() has been renamed to .toVertexStage()."),Dd(...i)));const g5=ye(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return Si(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),x5=ye(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return Si(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),gO="WorkingColorSpace",M$="OutputColorSpace";class u3 extends js{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===gO?yn.workingColorSpace:t===M$?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let r=t;return yn.enabled===!1||n===s||!n||!s||(yn.getTransfer(n)===qt&&(r=Vt(g5(r.rgb),r.a)),yn.getPrimaries(n)!==yn.getPrimaries(s)&&(r=Vt(qa(yn._getMatrix(new Ln,n,s)).mul(r.rgb),r.a)),yn.getTransfer(s)===qt&&(r=Vt(x5(r.rgb),r.a))),r}}const y5=(i,e)=>Ke(new u3(Ke(i),gO,e)),d3=(i,e)=>Ke(new u3(Ke(i),e,gO)),C$=(i,e,t)=>Ke(new u3(Ke(i),e,t));Xe("workingToColorSpace",y5);Xe("colorSpaceToWorking",d3);let R$=class extends nm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,n,s)}};class v5 extends jt{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,s=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Bn.OBJECT}setGroup(e){return this.group=e,this}element(e){return Ke(new R$(this,Ke(e)))}setNodeType(e){const t=rn(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let s=1;s<t.length;s++)n=n[t[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const w$=(i,e,t)=>Ke(new v5(i,e,t));class _5 extends v5{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(ln)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const b5=(i,e,t=null)=>Ke(new _5(i,e,t));class S5 extends js{static get type(){return"ToneMappingNode"}constructor(e,t=A5,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return wy(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===zr)return t;let s=null;const r=e.renderer.library.getToneMappingFunction(n);return r!==null?s=Vt(r(t.rgb,this.exposureNode),t.a):(nt("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=t),s}}const T5=(i,e,t)=>Ke(new S5(i,Ke(e),Ke(t))),A5=b5("toneMappingExposure","float");Xe("toneMapping",(i,e,t)=>T5(e,t,i));class E5 extends PD{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=s,this.usage=n0,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,s=e.getTypeLength(t),r=this.bufferStride||s,a=this.bufferOffset,o=n.isInterleavedBuffer===!0?n:new x0(n,r),l=new Md(o,s,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),s=e.getPropertyName(n);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,r=s):r=Dd(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const HT=(i,e=null,t=0,n=0)=>Ke(new E5(i,e,t,n)),M5=(i,e=null,t=0,n=0)=>HT(i,e,t,n).setUsage(ap),CM=(i,e=null,t=0,n=0)=>HT(i,e,t,n).setInstanced(!0),pN=(i,e=null,t=0,n=0)=>M5(i,e,t,n).setInstanced(!0);Xe("toAttribute",i=>HT(i.value));class C5 extends jt{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Bn.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s,this)}else{const r=e.getNodeProperties(this).outputComputeNode;if(r)return r.build(e,t)}}}const xO=(i,e=[64])=>{(e.length===0||e.length>3)&&nt("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&nt(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Ke(new C5(Ke(i),e))},R5=(i,e,t)=>xO(i,t).setCount(e);Xe("compute",R5);Xe("computeKernel",xO);class w5 extends jt{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const s=this.node.getNodeType(e);return e.setCache(t),s}build(e,...t){const n=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const r=this.node.build(e,...t);return e.setCache(n),r}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Dy=i=>new w5(Ke(i));function N5(i,e=!0){return De('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Dy(i).setParent(e)}Xe("cache",N5);Xe("isolate",Dy);class B5 extends jt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const D5=En(B5).setParameterLength(2);Xe("bypass",D5);class yO extends jt{static get type(){return"RemapNode"}constructor(e,t,n,s=j(0),r=j(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=s,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:s,outHighNode:r,doClamp:a}=this;let o=e.sub(t).div(n.sub(t));return a===!0&&(o=o.clamp()),o.mul(r.sub(s)).add(s)}}const O5=En(yO,null,null,{doClamp:!1}).setParameterLength(3,5),U5=En(yO).setParameterLength(3,5);Xe("remap",O5);Xe("remapClamp",U5);class cS extends jt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),s=this.snippet;if(n==="void")e.addLineFlowCode(s,this);else return e.format(s,n,t)}}const kf=En(cS).setParameterLength(1,2),L5=i=>(i?Rr(i,kf("discard")):kf("discard")).toStack(),N$=()=>kf("return").toStack();Xe("discard",L5);class I5 extends js{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||zr,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Ga;return n!==zr&&(t=t.toneMapping(n)),s!==Ga&&s!==yn.workingColorSpace&&(t=t.workingToColorSpace(s)),t}}const vO=(i,e=null,t=null)=>Ke(new I5(Ke(i),e,t));Xe("renderOutput",vO);class P5 extends js{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),s="--- TSL debug - "+e.shaderStage+" shader ---",r="-".repeat(s.length);let a="";return a+="// #"+s+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+n+` /* ... */
`,a+="// #"+r+`#
`,t!==null?t(e,a):i0(a),n}}const F5=(i,e=null)=>Ke(new P5(Ke(i),e)).toStack();Xe("debug",F5);class _O{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class B$ extends jt{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Bn.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==_O&&qi('TSL: ".toInspector()" is only available with WebGPU.'),t}}function G5(i,e="",t=null){return i=Ke(i),i.before(new B$(i,e,t))}Xe("toInspector",G5);function D$(i){De("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",i)}class bO extends jt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const s=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(s)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const r=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(r),o=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(o.name,a,n):Dd(this).build(e,n)}else return De(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const vo=(i,e=null)=>Ke(new bO(i,e)),ji=(i=0)=>vo("uv"+(i>0?i:""),"vec2");class z5 extends jt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(e),t)}}const Lf=En(z5).setParameterLength(1,2);class V5 extends _v{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Bn.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:s,height:r}=n;this.value=Math.log2(Math.max(s,r))}}}const SO=En(V5).setParameterLength(1),TO=new pi;class fu extends _v{static get type(){return"TextureNode"}constructor(e=TO,t=null,n=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Bn.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Xi?"uvec4":this.value.type===fr?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return ji(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=rn(this.value.matrix)),this._matrixUniform.mul(de(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=rn(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(oe(Lf(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const s=ye(()=>{let a=this.uvNode;return(a===null||e.context.forceUVContext===!0)&&e.context.getUV&&(a=e.context.getUV(this,e)),a||(a=this.getDefaultUV()),this.updateMatrix===!0&&(a=this.getTransformedUV(a)),a=this.setupUV(e,a),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Bn.OBJECT:Bn.NONE,a})();let r=this.levelNode;r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=r,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,s,r,a,o,l,u){const f=this.value;let p;return r?p=e.generateTextureBias(f,t,n,r,a,u):l?p=e.generateTextureGrad(f,t,n,l,a,u):o?p=e.generateTextureCompare(f,t,n,o,a,u):this.sampler===!1?p=e.generateTextureLoad(f,t,n,s,a,u):s?p=e.generateTextureLevel(f,t,n,s,a,u):p=e.generateTexture(f,t,n,a,u),p}generate(e,t){const n=this.value,s=e.getNodeProperties(this),r=super.generate(e,"property");if(/^sampler/.test(t))return r+"_sampler";if(e.isReference(t))return r;{const a=e.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:f,levelNode:p,biasNode:x,compareNode:y,depthNode:_,gradNode:T,offsetNode:A}=s,S=this.generateUV(e,f),C=p?p.build(e,"float"):null,w=x?x.build(e,"float"):null,B=_?_.build(e,"int"):null,L=y?y.build(e,"float"):null,D=T?[T[0].build(e,"vec2"),T[1].build(e,"vec2")]:null,O=A?this.generateOffset(e,A):null,F=e.getVarFromNode(this);o=e.getPropertyName(F);const U=this.generateSnippet(e,r,S,C,w,B,L,D,O);e.addLineFlowCode(`${o} = ${U}`,this),a.snippet=U,a.propertyName=o}let l=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(l=d3(kf(l,u),n.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return De("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Ke(e).mul(SO(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===es||n.magFilter===es)&&(De("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Ke(t)}level(e){const t=this.clone();return t.levelNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}size(e){return Lf(this,e)}bias(e){const t=this.clone();return t.biasNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}grad(e,t){const n=this.clone();return n.gradNode=[Ke(e),Ke(t)],n.referenceNode=this.getBase(),Ke(n)}depth(e){const t=this.clone();return t.depthNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}offset(e){const t=this.clone();return t.offsetNode=Ke(e),t.referenceNode=this.getBase(),Ke(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const O$=En(fu).setParameterLength(1,4).setName("texture"),kn=(i=TO,e=null,t=null,n=null)=>{let s;return i&&i.isTextureNode===!0?(s=Ke(i.clone()),s.referenceNode=i.getBase(),e!==null&&(s.uvNode=Ke(e)),t!==null&&(s.levelNode=Ke(t)),n!==null&&(s.biasNode=Ke(n))):s=O$(i,e,t,n),s},U$=(i=TO)=>kn(i),Xs=(...i)=>kn(...i).setSampler(!1),L$=(i,e,t)=>kn(i,e).level(t),I$=i=>(i.isNode===!0?i:kn(i)).convert("sampler"),P$=i=>(i.isNode===!0?i:kn(i)).convert("samplerComparison");class f3 extends _v{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const kT=(i,e,t)=>Ke(new f3(i,e,t));class F$ extends nm{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),s=this.node.getPaddedType();return e.format(t,s,n)}}class H5 extends f3{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Df(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Bn.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let s=0;s<e.length;s++){const r=s*4;t[r]=e[s]}else if(n==="color")for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.r,t[r+1]=a.g,t[r+2]=a.b||0}else if(n==="mat2")for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.elements[0],t[r+1]=a.elements[1],t[r+2]=a.elements[2],t[r+3]=a.elements[3]}else if(n==="mat3")for(let s=0;s<e.length;s++){const r=s*16,a=e[s];t[r]=a.elements[0],t[r+1]=a.elements[1],t[r+2]=a.elements[2],t[r+4]=a.elements[3],t[r+5]=a.elements[4],t[r+6]=a.elements[5],t[r+8]=a.elements[6],t[r+9]=a.elements[7],t[r+10]=a.elements[8],t[r+15]=1}else if(n==="mat4")for(let s=0;s<e.length;s++){const r=s*16,a=e[s];for(let o=0;o<a.elements.length;o++)t[r+o]=a.elements[o]}else for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.x,t[r+1]=a.y,t[r+2]=a.z||0,t[r+3]=a.w||0}}setup(e){const t=this.array.length,n=this.elementType;let s=Float32Array;const r=this.paddedType,a=e.getTypeLength(r);return n.charAt(0)==="i"&&(s=Int32Array),n.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(t*a),this.bufferCount=t,this.bufferType=r,super.setup(e)}element(e){return Ke(new F$(this,Ke(e)))}}const za=(i,e)=>Ke(new H5(i,e));class G$ extends jt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const nh=En(G$).setParameterLength(1);let _b,bb;class us extends jt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===us.DPR?"float":this.scope===us.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Bn.NONE;return(this.scope===us.SIZE||this.scope===us.VIEWPORT||this.scope===us.DPR)&&(e=Bn.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===us.VIEWPORT?t!==null?bb.copy(t.viewport):(e.getViewport(bb),bb.multiplyScalar(e.getPixelRatio())):this.scope===us.DPR?this._output.value=e.getPixelRatio():t!==null?(_b.width=t.width,_b.height=t.height):e.getDrawingBufferSize(_b)}setup(){const e=this.scope;let t=null;return e===us.SIZE?t=rn(_b||(_b=new Ze)):e===us.VIEWPORT?t=rn(bb||(bb=new mn)):e===us.DPR?t=rn(1):t=Je(WT.div(l0)),this._output=t,t}generate(e){if(this.scope===us.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(l0).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}us.COORDINATE="coordinate";us.VIEWPORT="viewport";us.SIZE="size";us.UV="uv";us.DPR="dpr";const k5=Rt(us,us.DPR),If=Rt(us,us.UV),l0=Rt(us,us.SIZE),WT=Rt(us,us.COORDINATE),Oy=Rt(us,us.VIEWPORT),AO=Oy.zw,W5=WT.sub(Oy.xy),z$=W5.div(AO),V$=ye(()=>(De('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),l0),"vec2").once()(),im=rn(0,"uint").setName("u_cameraIndex").setGroup(r3("cameraIndex")).toVarying("v_cameraIndex"),Cf=rn("float").setName("cameraNear").setGroup(ln).onRenderUpdate(({camera:i})=>i.near),Rf=rn("float").setName("cameraFar").setGroup(ln).onRenderUpdate(({camera:i})=>i.far),lc=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrix);e=za(t).setGroup(ln).setName("cameraProjectionMatrices").element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraProjectionMatrix")}else e=rn("mat4").setName("cameraProjectionMatrix").setGroup(ln).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),H$=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrixInverse);e=za(t).setGroup(ln).setName("cameraProjectionMatricesInverse").element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraProjectionMatrixInverse")}else e=rn("mat4").setName("cameraProjectionMatrixInverse").setGroup(ln).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Pl=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorldInverse);e=za(t).setGroup(ln).setName("cameraViewMatrices").element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraViewMatrix")}else e=rn("mat4").setName("cameraViewMatrix").setGroup(ln).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),k$=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorld);e=za(t).setGroup(ln).setName("cameraWorldMatrices").element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraWorldMatrix")}else e=rn("mat4").setName("cameraWorldMatrix").setGroup(ln).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),W$=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.normalMatrix);e=za(t).setGroup(ln).setName("cameraNormalMatrices").element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraNormalMatrix")}else e=rn("mat3").setName("cameraNormalMatrix").setGroup(ln).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),uS=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(let s=0,r=i.cameras.length;s<r;s++)t.push(new Q);e=za(t).setGroup(ln).setName("cameraPositions").onRenderUpdate(({camera:s},r)=>{const a=s.cameras,o=r.array;for(let l=0,u=a.length;l<u;l++)o[l].setFromMatrixPosition(a[l].matrixWorld)}).element(i.isMultiViewCamera?nh("gl_ViewID_OVR"):im).toConst("cameraPosition")}else e=rn(new Q).setName("cameraPosition").setGroup(ln).onRenderUpdate(({camera:t},n)=>n.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),X$=ye(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.viewport);e=za(t,"vec4").setGroup(ln).setName("cameraViewports").element(im).toConst("cameraViewport")}else e=Vt(0,0,l0.x,l0.y).toConst("cameraViewport");return e}).once()(),AP=new mr;class si extends jt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Bn.OBJECT,this.uniformNode=new _v(null)}getNodeType(){const e=this.scope;if(e===si.WORLD_MATRIX)return"mat4";if(e===si.POSITION||e===si.VIEW_POSITION||e===si.DIRECTION||e===si.SCALE)return"vec3";if(e===si.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,s=this.scope;if(s===si.WORLD_MATRIX)n.value=t.matrixWorld;else if(s===si.POSITION)n.value=n.value||new Q,n.value.setFromMatrixPosition(t.matrixWorld);else if(s===si.SCALE)n.value=n.value||new Q,n.value.setFromMatrixScale(t.matrixWorld);else if(s===si.DIRECTION)n.value=n.value||new Q,t.getWorldDirection(n.value);else if(s===si.VIEW_POSITION){const r=e.camera;n.value=n.value||new Q,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(s===si.RADIUS){const r=e.object.geometry;r.boundingSphere===null&&r.computeBoundingSphere(),AP.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=AP.radius}}generate(e){const t=this.scope;return t===si.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===si.POSITION||t===si.VIEW_POSITION||t===si.DIRECTION||t===si.SCALE?this.uniformNode.nodeType="vec3":t===si.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}si.WORLD_MATRIX="worldMatrix";si.POSITION="position";si.SCALE="scale";si.VIEW_POSITION="viewPosition";si.DIRECTION="direction";si.RADIUS="radius";const q$=En(si,si.DIRECTION).setParameterLength(1),Y$=En(si,si.WORLD_MATRIX).setParameterLength(1),X5=En(si,si.POSITION).setParameterLength(1),j$=En(si,si.SCALE).setParameterLength(1),$$=En(si,si.VIEW_POSITION).setParameterLength(1),K$=En(si,si.RADIUS).setParameterLength(1);class Ul extends si{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const J$=Rt(Ul,Ul.DIRECTION),mc=Rt(Ul,Ul.WORLD_MATRIX),Z$=Rt(Ul,Ul.POSITION),Q$=Rt(Ul,Ul.SCALE),eK=Rt(Ul,Ul.VIEW_POSITION),q5=Rt(Ul,Ul.RADIUS),Y5=rn(new Ln).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),tK=rn(new Yt).onObjectUpdate(({object:i},e)=>e.value.copy(i.matrixWorld).invert()),Wf=ye(i=>i.renderer.overrideNodes.modelViewMatrix||j5).once()().toVar("modelViewMatrix"),j5=Pl.mul(mc),mN=ye(i=>(i.context.isHighPrecisionModelViewMatrix=!0,rn("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),gN=ye(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return rn("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),_a=vo("position","vec3"),tr=_a.toVarying("positionLocal"),RM=_a.toVarying("positionPrevious"),Ml=ye(i=>mc.mul(tr).xyz.toVarying(i.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),EO=ye(()=>tr.transformDirection(mc).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),nr=ye(i=>i.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),xs=ye(i=>{let e;return i.camera.isOrthographicCamera?e=de(0,0,1):e=nr.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class $5 extends jt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Yi?"false":e.getFrontFacing()}}const K5=Rt($5),MO=j(K5).mul(2).sub(1),bv=ye(([i],{material:e})=>{const t=e.side;return t===Yi?i=i.mul(-1):t===hr&&(i=i.mul(MO)),i}),h3=vo("normal","vec3"),tl=ye(i=>i.geometry.hasAttribute("normal")===!1?(De('TSL: Vertex attribute "normal" not found on geometry.'),de(0,1,0)):h3,"vec3").once()().toVar("normalLocal"),J5=nr.dFdx().cross(nr.dFdy()).normalize().toVar("normalFlat"),Wy=ye(i=>{let e;return i.material.flatShading===!0?e=J5:e=CO(tl).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),Z5=ye(i=>{let e=Wy.transformDirection(Pl);return i.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Di=ye(({subBuildFn:i,material:e,context:t})=>{let n;return i==="NORMAL"||i==="VERTEX"?(n=Wy,e.flatShading!==!0&&(n=bv(n))):n=t.setupNormal().context({getUV:null}),n},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),sm=Di.transformDirection(Pl).toVar("normalWorld"),Rg=ye(({subBuildFn:i,context:e})=>{let t;return i==="NORMAL"||i==="VERTEX"?t=Di:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),Q5=ye(([i,e=mc])=>{const t=qa(e),n=i.div(de(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),CO=ye(([i],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(i);const n=Y5.mul(i);return Pl.transformDirection(n)}),nK=ye(()=>(De('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Di)).once(["NORMAL","VERTEX"])(),iK=ye(()=>(De('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),sm)).once(["NORMAL","VERTEX"])(),sK=ye(()=>(De('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Rg)).once(["NORMAL","VERTEX"])(),EP=new Wa,Sw=new Yt,eH=rn(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),nM=rn(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),RO=rn(new Yt).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(EP.copy(t),Sw.makeRotationFromEuler(EP)):Sw.identity(),Sw}),tH=xs.negate().reflect(Di),nH=xs.negate().refract(Di,eH),iH=tH.transformDirection(Pl).toVar("reflectVector"),sH=nH.transformDirection(Pl).toVar("reflectVector"),rH=new Zf;class aH extends fu{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,s=null){super(e,t,n,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Do?iH:e.mapping===Rl?sH:(nt('CubeTextureNode: Mapping "%s" not supported.',e.mapping),de(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===Nl||!n.isRenderTargetTexture)&&(t=de(t.x.negate(),t.yz)),RO.mul(t)}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const wO=En(aH).setParameterLength(1,4).setName("cubeTexture"),Xy=(i=rH,e=null,t=null,n=null)=>{let s;return i&&i.isCubeTextureNode===!0?(s=Ke(i.clone()),s.referenceNode=i,e!==null&&(s.uvNode=Ke(e)),t!==null&&(s.levelNode=Ke(t)),n!==null&&(s.biasNode=Ke(n))):s=wO(i,e,t,n),s},rK=(i=rH)=>wO(i);class aK extends nm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,n,s)}}class XT extends jt{static get type(){return"ReferenceNode"}constructor(e,t,n=null,s=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Bn.OBJECT}element(e){return Ke(new aK(this,Ke(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=kT(null,e,this.count):Array.isArray(this.getValueFromReference())?t=za(null,e):e==="texture"?t=kn(null):e==="cubeTexture"?t=Xy(null):t=rn(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let s=1;s<t.length;s++)n=n[t[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const is=(i,e,t)=>Ke(new XT(i,e,t)),xN=(i,e,t,n)=>Ke(new XT(i,e,n,t));class oH extends XT{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const wf=(i,e,t=null)=>Ke(new oH(i,e,t)),lH=ji(),oK=nr.dFdx(),lK=nr.dFdy(),cH=lH.dFdx(),uH=lH.dFdy(),dH=Di,fH=lK.cross(dH),hH=dH.cross(oK),yN=fH.mul(cH.x).add(hH.mul(uH.x)),vN=fH.mul(cH.y).add(hH.mul(uH.y)),MP=yN.dot(yN).max(vN.dot(vN)),pH=MP.equal(0).select(0,MP.inverseSqrt()),cK=yN.mul(pH).toVar("tangentViewFrame"),uK=vN.mul(pH).toVar("bitangentViewFrame"),p3=ye(i=>(i.geometry.hasAttribute("tangent")===!1&&i.geometry.computeTangents(),vo("tangent","vec4")))(),qT=p3.xyz.toVar("tangentLocal"),m3=ye(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=Wf.mul(Vt(qT,0)).xyz.toVarying("v_tangentView").normalize():n=cK,t.flatShading!==!0&&(n=bv(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),mH=m3.transformDirection(Pl).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),g3=ye(([i,e],{subBuildFn:t,material:n})=>{let s=i.mul(p3.w).xyz;return t==="NORMAL"&&n.flatShading!==!0&&(s=s.toVarying(e)),s}).once(["NORMAL"]),dK=g3(h3.cross(p3),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),fK=g3(tl.cross(qT),"v_bitangentLocal").normalize().toVar("bitangentLocal"),gH=ye(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=g3(Di.cross(m3),"v_bitangentView").normalize():n=uK,t.flatShading!==!0&&(n=bv(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),hK=g3(sm.cross(mH),"v_bitangentWorld").normalize().toVar("bitangentWorld"),wg=qa(m3,gH,Di).toVar("TBNViewMatrix"),xH=xs.mul(wg),pK=(i,e)=>i.sub(xH.mul(e)),yH=ye(()=>{let i=Ig.cross(xs);return i=i.cross(Ig).normalize(),i=Si(i,Di,np.mul(od.oneMinus()).oneMinus().pow2().pow2()).normalize(),i}).once()();class vH extends js{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=cu}setup({material:e}){const{normalMapType:t,scaleNode:n}=this;let s=this.node.mul(2).sub(1);if(n!==null){let a=n;e.flatShading===!0&&(a=bv(a)),s=de(s.xy.mul(a),s.z)}let r=null;return t===vC?r=CO(s):t===cu?r=wg.mul(s).normalize():(nt(`NodeMaterial: Unsupported normal map type: ${t}`),r=Di),r}}const _N=En(vH).setParameterLength(1,2),mK=ye(({textureNode:i,bumpScale:e})=>{const t=s=>i.isolate().context({getUV:r=>s(r.uvNode||ji()),forceUVContext:!0}),n=j(t(s=>s));return Je(j(t(s=>s.add(s.dFdx()))).sub(n),j(t(s=>s.add(s.dFdy()))).sub(n)).mul(e)}),gK=ye(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,s=e.dFdx().normalize(),r=e.dFdy().normalize(),a=t,o=r.cross(a),l=a.cross(s),u=s.dot(o).mul(MO),f=u.sign().mul(n.x.mul(o).add(n.y.mul(l)));return u.abs().mul(t).sub(f).normalize()});class _H extends js{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=mK({textureNode:this.textureNode,bumpScale:e});return gK({surf_pos:nr,surf_norm:Di,dHdxy:t})}}const NO=En(_H).setParameterLength(1,2),CP=new Map;class je extends jt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=CP.get(e);return n===void 0&&(n=wf(e,t),CP.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let s=null;if(n===je.COLOR){const r=t.color!==void 0?this.getColor(n):de();t.map&&t.map.isTexture===!0?s=r.mul(this.getTexture("map")):s=r}else if(n===je.OPACITY){const r=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?s=r.mul(this.getTexture("alpha")):s=r}else if(n===je.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=j(1);else if(n===je.SPECULAR_INTENSITY){const r=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?s=r.mul(this.getTexture(n).a):s=r}else if(n===je.SPECULAR_COLOR){const r=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?s=r.mul(this.getTexture(n).rgb):s=r}else if(n===je.ROUGHNESS){const r=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).g):s=r}else if(n===je.METALNESS){const r=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?s=r.mul(this.getTexture(n).b):s=r}else if(n===je.EMISSIVE){const r=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(r);t.emissiveMap&&t.emissiveMap.isTexture===!0?s=a.mul(this.getTexture(n)):s=a}else if(n===je.NORMAL)t.normalMap?(s=_N(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=t.normalMapType):t.bumpMap?s=NO(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Di;else if(n===je.CLEARCOAT){const r=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?s=r.mul(this.getTexture(n).r):s=r}else if(n===je.CLEARCOAT_ROUGHNESS){const r=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).r):s=r}else if(n===je.CLEARCOAT_NORMAL)t.clearcoatNormalMap?s=_N(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=Di;else if(n===je.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?s=r.mul(this.getTexture("sheenColor").rgb):s=r}else if(n===je.SHEEN_ROUGHNESS){const r=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).a):s=r,s=s.clamp(.07,1)}else if(n===je.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const r=this.getTexture(n);s=n3(yy.x,yy.y,yy.y.negate(),yy.x).mul(r.rg.mul(2).sub(Je(1)).normalize().mul(r.b))}else s=yy;else if(n===je.IRIDESCENCE_THICKNESS){const r=is("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=is("0","float",t.iridescenceThicknessRange);s=r.sub(a).mul(this.getTexture(n).g).add(a)}else s=r}else if(n===je.TRANSMISSION){const r=this.getFloat(n);t.transmissionMap?s=r.mul(this.getTexture(n).r):s=r}else if(n===je.THICKNESS){const r=this.getFloat(n);t.thicknessMap?s=r.mul(this.getTexture(n).g):s=r}else if(n===je.IOR)s=this.getFloat(n);else if(n===je.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===je.AO)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===je.LINE_DASH_OFFSET)s=t.dashOffset?this.getFloat(n):j(0);else{const r=this.getNodeType(e);s=this.getCache(n,r)}return s}}je.ALPHA_TEST="alphaTest";je.COLOR="color";je.OPACITY="opacity";je.SHININESS="shininess";je.SPECULAR="specular";je.SPECULAR_STRENGTH="specularStrength";je.SPECULAR_INTENSITY="specularIntensity";je.SPECULAR_COLOR="specularColor";je.REFLECTIVITY="reflectivity";je.ROUGHNESS="roughness";je.METALNESS="metalness";je.NORMAL="normal";je.CLEARCOAT="clearcoat";je.CLEARCOAT_ROUGHNESS="clearcoatRoughness";je.CLEARCOAT_NORMAL="clearcoatNormal";je.EMISSIVE="emissive";je.ROTATION="rotation";je.SHEEN="sheen";je.SHEEN_ROUGHNESS="sheenRoughness";je.ANISOTROPY="anisotropy";je.IRIDESCENCE="iridescence";je.IRIDESCENCE_IOR="iridescenceIOR";je.IRIDESCENCE_THICKNESS="iridescenceThickness";je.IOR="ior";je.TRANSMISSION="transmission";je.THICKNESS="thickness";je.ATTENUATION_DISTANCE="attenuationDistance";je.ATTENUATION_COLOR="attenuationColor";je.LINE_SCALE="scale";je.LINE_DASH_SIZE="dashSize";je.LINE_GAP_SIZE="gapSize";je.LINE_WIDTH="linewidth";je.LINE_DASH_OFFSET="dashOffset";je.POINT_SIZE="size";je.DISPERSION="dispersion";je.LIGHT_MAP="light";je.AO="ao";const bH=Rt(je,je.ALPHA_TEST),wM=Rt(je,je.COLOR),SH=Rt(je,je.SHININESS),TH=Rt(je,je.EMISSIVE),x3=Rt(je,je.OPACITY),AH=Rt(je,je.SPECULAR),bN=Rt(je,je.SPECULAR_INTENSITY),EH=Rt(je,je.SPECULAR_COLOR),dS=Rt(je,je.SPECULAR_STRENGTH),iM=Rt(je,je.REFLECTIVITY),MH=Rt(je,je.ROUGHNESS),CH=Rt(je,je.METALNESS),RH=Rt(je,je.NORMAL),wH=Rt(je,je.CLEARCOAT),NH=Rt(je,je.CLEARCOAT_ROUGHNESS),BH=Rt(je,je.CLEARCOAT_NORMAL),DH=Rt(je,je.ROTATION),OH=Rt(je,je.SHEEN),UH=Rt(je,je.SHEEN_ROUGHNESS),LH=Rt(je,je.ANISOTROPY),IH=Rt(je,je.IRIDESCENCE),PH=Rt(je,je.IRIDESCENCE_IOR),FH=Rt(je,je.IRIDESCENCE_THICKNESS),GH=Rt(je,je.TRANSMISSION),zH=Rt(je,je.THICKNESS),VH=Rt(je,je.IOR),HH=Rt(je,je.ATTENUATION_DISTANCE),kH=Rt(je,je.ATTENUATION_COLOR),BO=Rt(je,je.LINE_SCALE),DO=Rt(je,je.LINE_DASH_SIZE),OO=Rt(je,je.LINE_GAP_SIZE),sM=Rt(je,je.LINE_WIDTH),UO=Rt(je,je.LINE_DASH_OFFSET),WH=Rt(je,je.POINT_SIZE),XH=Rt(je,je.DISPERSION),LO=Rt(je,je.LIGHT_MAP),qH=Rt(je,je.AO),yy=rn(new Ze).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),IO=ye(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Ss extends jt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let s;if(n===Ss.VERTEX)s=e.getVertexIndex();else if(n===Ss.INSTANCE)s=e.getInstanceIndex();else if(n===Ss.DRAW)s=e.getDrawIndex();else if(n===Ss.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(n===Ss.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(n===Ss.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let r;return e.shaderStage==="vertex"||e.shaderStage==="compute"?r=s:r=Dd(this).build(e,t),r}}Ss.VERTEX="vertex";Ss.INSTANCE="instance";Ss.SUBGROUP="subgroup";Ss.INVOCATION_LOCAL="invocationLocal";Ss.INVOCATION_SUBGROUP="invocationSubgroup";Ss.DRAW="draw";const YH=Rt(Ss,Ss.VERTEX),pp=Rt(Ss,Ss.INSTANCE),xK=Rt(Ss,Ss.SUBGROUP),yK=Rt(Ss,Ss.INVOCATION_SUBGROUP),vK=Rt(Ss,Ss.INVOCATION_LOCAL),jH=Rt(Ss,Ss.DRAW);class PO extends jt{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Bn.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{instanceMatrix:t,instanceColor:n}=this,{count:s}=t;let{instanceMatrixNode:r,instanceColorNode:a}=this;if(r===null){if(s<=1e3)r=kT(t.array,"mat4",Math.max(s,1)).element(pp);else{const l=new ED(t.array,16,1);this.buffer=l;const u=t.usage===ap?pN:CM,f=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];r=Lg(...f)}this.instanceMatrixNode=r}if(n&&a===null){const l=new Jo(n.array,3),u=n.usage===ap?pN:CM;this.bufferColor=l,a=de(u(l,"vec3",3,0)),this.instanceColorNode=a}const o=r.mul(tr).xyz;if(tr.assign(o),e.hasGeometryAttribute("normal")){const l=Q5(tl,r);tl.assign(l)}this.instanceColorNode!==null&&vl("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==ap&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==ap&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const _K=En(PO).setParameterLength(2,3);class $H extends PO{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:s}=e;super(t,n,s),this.instancedMesh=e}}const KH=En($H).setParameterLength(1);class JH extends jt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=pp:this.batchingIdNode=jH);const n=ye(([_])=>{const T=oe(Lf(Xs(this.batchMesh._indirectTexture),0).x),A=oe(_).mod(T),S=oe(_).div(T);return Xs(this.batchMesh._indirectTexture,Gr(A,S)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(oe(this.batchingIdNode)),s=this.batchMesh._matricesTexture,r=oe(Lf(Xs(s),0).x),a=j(n).mul(4).toInt().toVar(),o=a.mod(r),l=a.div(r),u=Lg(Xs(s,Gr(o,l)),Xs(s,Gr(o.add(1),l)),Xs(s,Gr(o.add(2),l)),Xs(s,Gr(o.add(3),l))),f=this.batchMesh._colorsTexture;if(f!==null){const T=ye(([A])=>{const S=oe(Lf(Xs(f),0).x),C=A,w=C.mod(S),B=C.div(S);return Xs(f,Gr(w,B)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);vl("vec3","vBatchColor").assign(T)}const p=qa(u);tr.assign(u.mul(tr));const x=tl.div(de(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),y=p.mul(x).xyz;tl.assign(y),e.hasGeometryAttribute("tangent")&&qT.mulAssign(p)}}const ZH=En(JH).setParameterLength(1);class QH extends nm{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const s=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&s!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),s!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}const bK=En(QH).setParameterLength(2);class e9 extends f3{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let s,r=null;t&&t.isStruct?(s="struct",r=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(s=wD(e.itemSize),n=e.count):s=t,super(e,s,n),this.isStorageBufferNode=!0,this.structTypeNode=r,this.access=la.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return bK(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(la.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=HT(this.value),this._varying=Dd(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),s=n.build(e);return e.registerTransform(s,t),s}}const Fg=(i,e=null,t=0)=>Ke(new e9(i,e,t)),SK=(i,e,t)=>(De('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Fg(i,e,t).setPBO(!0)),RP=new WeakMap;class FO extends jt{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Bn.OBJECT,this.skinIndexNode=vo("skinIndex","uvec4"),this.skinWeightNode=vo("skinWeight","vec4"),this.bindMatrixNode=is("bindMatrix","mat4"),this.bindMatrixInverseNode=is("bindMatrixInverse","mat4"),this.boneMatricesNode=xN("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=tr,this.toPositionNode=tr,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:r,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),u=e.element(n.z),f=e.element(n.w),p=r.mul(t),x=gr(o.mul(s.x).mul(p),l.mul(s.y).mul(p),u.mul(s.z).mul(p),f.mul(s.w).mul(p));return a.mul(x).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=tl){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:r,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),u=e.element(n.z),f=e.element(n.w);let p=gr(s.x.mul(o),s.y.mul(l),s.z.mul(u),s.w.mul(f));return p=a.mul(p).mul(r),p.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=xN("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,RM)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||BD(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&RM.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();tl.assign(n),e.hasGeometryAttribute("tangent")&&qT.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;RP.get(t)!==e.frameId&&(RP.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const t9=i=>Ke(new FO(i)),TK=(i,e=null)=>{const t=new FO(i);return t.positionNode=Fg(new Jo(i.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(pp).toVar(),t.skinIndexNode=Fg(new Jo(new Uint32Array(i.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(pp).toVar(),t.skinWeightNode=Fg(new Jo(i.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(pp).toVar(),t.bindMatrixNode=rn(i.bindMatrix,"mat4"),t.bindMatrixInverseNode=rn(i.bindMatrixInverse,"mat4"),t.boneMatricesNode=kT(i.skeleton.boneMatrices,"mat4",i.skeleton.bones.length),t.toPositionNode=e,Ke(t)};class n9 extends jt{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let o=0,l=this.params.length-1;o<l;o++){const u=this.params[o],f=u.isNode!==!0&&u.name||this.getVarName(o),p=u.isNode!==!0&&u.type||"int";n[f]=kf(f,p)}const s=e.addStack(),r=this.params[this.params.length-1](n);t.returnsNode=r.context({nodeLoop:r}),t.stackNode=s;const a=this.params[0];if(a.isNode!==!0&&typeof a.update=="function"){const o=ye(this.params[0].update)(n);t.updateNode=o.context({nodeLoop:o})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,s=t.stackNode;for(let a=0,o=n.length-1;a<o;a++){const l=n[a];let u=!1,f=null,p=null,x=null,y=null,_=null,T=null;l.isNode?l.getNodeType(e)==="bool"?(u=!0,y="bool",p=l.build(e,y)):(y="int",x=this.getVarName(a),f="0",p=l.build(e,y),_="<"):(y=l.type||"int",x=l.name||this.getVarName(a),f=l.start,p=l.end,_=l.condition,T=l.update,typeof f=="number"?f=e.generateConst(y,f):f&&f.isNode&&(f=f.build(e,y)),typeof p=="number"?p=e.generateConst(y,p):p&&p.isNode&&(p=p.build(e,y)),f!==void 0&&p===void 0?(f=f+" - 1",p="0",_=">="):p!==void 0&&f===void 0&&(f="0",_="<"),_===void 0&&(Number(f)>Number(p)?_=">=":_="<"));let A;if(u)A=`while ( ${p} )`;else{const S={start:f,end:p},C=S.start,w=S.end;let B;const L=()=>_.includes("<")?"+=":"-=";if(T!=null)switch(typeof T){case"function":B=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":B=x+" "+L()+" "+e.generateConst(y,T);break;case"string":B=x+" "+T;break;default:T.isNode?B=x+" "+L()+" "+T.build(e):(nt("TSL: 'Loop( { update: ... } )' is not a function, string or number."),B="break /* invalid update */")}else y==="int"||y==="uint"?T=_.includes("<")?"++":"--":T=L()+" 1.",B=x+" "+T;const D=e.getVar(y,x)+" = "+C,O=x+" "+_+" "+w;A=`for ( ${D}; ${O}; ${B} )`}e.addFlowCode((a===0?`
`:"")+e.tab+A+` {

`).addFlowTab()}const r=s.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let a=0,o=this.params.length-1;a<o;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const Vi=(...i)=>new n9(Ug(i,"int")).toStack(),AK=()=>kf("continue").toStack(),i9=()=>kf("break").toStack(),Tw=new WeakMap,xl=new mn,wP=ye(({bufferMap:i,influence:e,stride:t,width:n,depth:s,offset:r})=>{const a=oe(YH).mul(t).add(r),o=a.div(n),l=a.sub(o.mul(n));return Xs(i,Gr(l,o)).depth(s).xyz.mul(e)});function EK(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,s=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,r=s!==void 0?s.length:0;let a=Tw.get(i);if(a===void 0||a.count!==r){let C=function(){A.dispose(),Tw.delete(i),i.removeEventListener("dispose",C)};var o=C;a!==void 0&&a.texture.dispose();const l=i.morphAttributes.position||[],u=i.morphAttributes.normal||[],f=i.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),n===!0&&(p=3);let x=i.attributes.position.count*p,y=1;const _=4096;x>_&&(y=Math.ceil(x/_),x=_);const T=new Float32Array(x*y*4*r),A=new lv(T,x,y,r);A.type=Ti,A.needsUpdate=!0;const S=p*4;for(let w=0;w<r;w++){const B=l[w],L=u[w],D=f[w],O=x*y*4*w;for(let F=0;F<B.count;F++){const U=F*S;e===!0&&(xl.fromBufferAttribute(B,F),T[O+U+0]=xl.x,T[O+U+1]=xl.y,T[O+U+2]=xl.z,T[O+U+3]=0),t===!0&&(xl.fromBufferAttribute(L,F),T[O+U+4]=xl.x,T[O+U+5]=xl.y,T[O+U+6]=xl.z,T[O+U+7]=0),n===!0&&(xl.fromBufferAttribute(D,F),T[O+U+8]=xl.x,T[O+U+9]=xl.y,T[O+U+10]=xl.z,T[O+U+11]=D.itemSize===4?xl.w:1)}}a={count:r,texture:A,stride:p,size:new Ze(x,y)},Tw.set(i,a),i.addEventListener("dispose",C)}return a}class s9 extends jt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=rn(1),this.updateType=Bn.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,s=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=r!==void 0?r.length:0,{texture:o,stride:l,size:u}=EK(t);n===!0&&tr.mulAssign(this.morphBaseInfluence),s===!0&&tl.mulAssign(this.morphBaseInfluence);const f=oe(u.width);Vi(a,({i:p})=>{const x=j(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?x.assign(Xs(this.mesh.morphTexture,Gr(oe(p).add(1),oe(pp))).r):x.assign(is("morphTargetInfluences","float").element(p).toVar()),sn(x.notEqual(0),()=>{n===!0&&tr.addAssign(wP({bufferMap:o,influence:x,stride:l,width:f,depth:p,offset:oe(0)})),s===!0&&tl.addAssign(wP({bufferMap:o,influence:x,stride:l,width:f,depth:p,offset:oe(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const r9=En(s9).setParameterLength(1);class A0 extends jt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class a9 extends A0{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class o9 extends hO{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,s=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=de().toVar("directDiffuse"),s=de().toVar("directSpecular"),r=de().toVar("indirectDiffuse"),a=de().toVar("indirectSpecular"),o={directDiffuse:n,directSpecular:s,indirectDiffuse:r,indirectSpecular:a};return{radiance:de().toVar("radiance"),irradiance:de().toVar("irradiance"),iblIrradiance:de().toVar("iblIrradiance"),ambientOcclusion:j(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const l9=En(o9);class c9 extends A0{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const Zx=new Ze;class YT extends fu{static get type(){return"ViewportTextureNode"}constructor(e=If,t=null,n=null){let s=null;n===null?(s=new bT,s.minFilter=Cr,n=s):s=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=Bn.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const s=t.clone();n.set(e,s)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(Zx):Zx.set(n.width,n.height);const s=this.getTextureForReference(n);(s.image.width!==Zx.width||s.image.height!==Zx.height)&&(s.image.width=Zx.width,s.image.height=Zx.height,s.needsUpdate=!0);const r=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const MK=En(YT).setParameterLength(0,3),GO=En(YT,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let xE=null;class u9 extends YT{static get type(){return"ViewportDepthTextureNode"}constructor(e=If,t=null){xE===null&&(xE=new Bo),super(e,t,xE)}getTextureForReference(){return xE}}const zO=En(u9).setParameterLength(0,2);class So extends jt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===So.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let s=null;if(t===So.DEPTH_BASE)n!==null&&(s=d9().assign(n));else if(t===So.DEPTH)e.isPerspectiveCamera?s=VO(nr.z,Cf,Rf):s=Uy(nr.z,Cf,Rf);else if(t===So.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const r=HO(n,Cf,Rf);s=Uy(r,Cf,Rf)}else s=n;else s=Uy(nr.z,Cf,Rf);return s}}So.DEPTH_BASE="depthBase";So.DEPTH="depth";So.LINEAR_DEPTH="linearDepth";const Uy=(i,e,t)=>i.add(e).div(e.sub(t)),CK=(i,e,t)=>e.sub(t).mul(i).sub(e),VO=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),HO=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),kO=(i,e,t)=>{e=e.max(1e-6).toVar();const n=xd(i.negate().div(e)),s=xd(t.div(e));return n.div(s)},RK=(i,e,t)=>{const n=i.mul(a3(t.div(e)));return j(Math.E).pow(n).mul(e).negate()},d9=En(So,So.DEPTH_BASE),WO=Rt(So,So.DEPTH),qy=En(So,So.LINEAR_DEPTH).setParameterLength(0,1),wK=qy(zO());WO.assign=i=>d9(i);class yc extends jt{static get type(){return"ClippingNode"}constructor(e=yc.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:s}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===yc.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,s):this.scope===yc.HARDWARE?this.setupHardwareClipping(s,e):this.setupDefault(n,s)}setupAlphaToCoverage(e,t){return ye(()=>{const n=j().toVar("distanceToPlane"),s=j().toVar("distanceToGradient"),r=j(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const l=za(t).setGroup(ln);Vi(a,({i:u})=>{const f=l.element(u);n.assign(nr.dot(f.xyz).negate().add(f.w)),s.assign(n.fwidth().div(2)),r.mulAssign(Ol(s.negate(),s,n))})}const o=e.length;if(o>0){const l=za(e).setGroup(ln),u=j(1).toVar("intersectionClipOpacity");Vi(o,({i:f})=>{const p=l.element(f);n.assign(nr.dot(p.xyz).negate().add(p.w)),s.assign(n.fwidth().div(2)),u.mulAssign(Ol(s.negate(),s,n).oneMinus())}),r.mulAssign(u.oneMinus())}bi.a.mulAssign(r),bi.a.equal(0).discard()})()}setupDefault(e,t){return ye(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const r=za(t).setGroup(ln);Vi(n,({i:a})=>{const o=r.element(a);nr.dot(o.xyz).greaterThan(o.w).discard()})}const s=e.length;if(s>0){const r=za(e).setGroup(ln),a=vc(!0).toVar("clipped");Vi(s,({i:o})=>{const l=r.element(o);a.assign(nr.dot(l.xyz).greaterThan(l.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),ye(()=>{const s=za(e).setGroup(ln),r=nh(t.getClipDistance());Vi(n,({i:a})=>{const o=s.element(a),l=nr.dot(o.xyz).sub(o.w).negate();r.element(a).assign(l)})})()}}yc.ALPHA_TO_COVERAGE="alphaToCoverage";yc.DEFAULT="default";yc.HARDWARE="hardware";const NK=()=>Ke(new yc),BK=()=>Ke(new yc(yc.ALPHA_TO_COVERAGE)),DK=()=>Ke(new yc(yc.HARDWARE)),OK=.05,NP=ye(([i])=>uu(Cn(1e4,jo(Cn(17,i.x).add(Cn(.1,i.y)))).mul(gr(.1,ds(jo(Cn(13,i.y).add(i.x))))))),BP=ye(([i])=>NP(Je(NP(i.xy),i.z))),UK=ye(([i])=>{const e=Ts(vd(iO(i.xyz)),vd(sO(i.xyz))),t=j(1).div(j(OK).mul(e)).toVar("pixScale"),n=Je(ky(yd(xd(t))),ky(o3(xd(t)))),s=Je(BP(yd(n.x.mul(i.xyz))),BP(yd(n.y.mul(i.xyz)))),r=uu(xd(t)),a=gr(Cn(r.oneMinus(),s.x),Cn(r,s.y)),o=el(r,r.oneMinus()),l=de(a.mul(a).div(Cn(2,o).mul(ri(1,o))),a.sub(Cn(.5,o)).div(ri(1,o)),ri(1,ri(1,a).mul(ri(1,a)).div(Cn(2,o).mul(ri(1,o))))),u=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return _c(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class f9 extends bO{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let s;return n===!0?s=super.generate(e):s=e.generateConst(this.nodeType,new mn(1,1,1,1)),s}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const h9=(i=0)=>Ke(new f9(i)),p9=ye(([i,e])=>el(1,i.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),m9=ye(([i,e])=>el(i.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),g9=ye(([i,e])=>i.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),x9=ye(([i,e])=>Si(i.mul(2).mul(e),i.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),c3(.5,i))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),LK=ye(([i,e])=>{const t=e.a.add(i.a.mul(e.a.oneMinus()));return Vt(e.rgb.mul(e.a).add(i.rgb.mul(i.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),y9=ye(([i])=>Vt(i.rgb.mul(i.a),i.a),{color:"vec4",return:"vec4"}),IK=ye(([i])=>(sn(i.a.equal(0),()=>Vt(0)),Vt(i.rgb.div(i.a),i.a)),{color:"vec4",return:"vec4"}),PK=(...i)=>(De('TSL: "burn" has been renamed. Use "blendBurn" instead.'),p9(i)),FK=(...i)=>(De('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),m9(i)),GK=(...i)=>(De('TSL: "screen" has been renamed. Use "blendScreen" instead.'),g9(i)),zK=(...i)=>(De('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),x9(i));class ys extends ir{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{De('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(yv(t.slice(0,-4)),n.getCacheKey());return this.type+T0(e)}build(e){this.setup(e)}setupObserver(e){return new qV(e)}setup(e){e.context.setupNormal=()=>By(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const s=By(this.setupVertex(e),"VERTEX"),r=this.vertexNode||s;e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);o!==null&&e.stack.addToStack(o);const u=Vt(l,bi.a).max(0);a=this.setupOutput(e,u),Ny.assign(a);const f=this.outputNode!==null;if(f&&(a=this.outputNode),n!==null){const p=t.getMRT(),x=this.mrtNode;p!==null?(f&&Ny.assign(a),a=p,x!==null&&(a=p.merge(x))):x!==null&&(a=x)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=Vt(l)),a=this.setupOutput(e,l)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let s=null;if(t.length>0||n.length>0){const r=e.renderer.currentSamples;this.alphaToCoverage&&r>1?s=BK():e.stack.addToStack(NK())}return s}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(DK()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let s=this.depthNode;if(s===null){const r=t.getMRT();r&&r.has("depth")?s=r.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=kO(nr.z,Cf,Rf):s=Uy(nr.z,Cf,Rf))}s!==null&&WO.assign(s).toStack()}setupPositionView(){return Wf.mul(tr).xyz}setupModelViewProjection(){return lc.mul(nr)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),IO}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&r9(t).toStack(),t.isSkinnedMesh===!0&&t9(t).toStack(),this.displacementMap){const s=wf("displacementMap","texture"),r=wf("displacementScale","float"),a=wf("displacementBias","float");tr.addAssign(tl.normalize().mul(s.x.mul(r).add(a)))}return t.isBatchedMesh&&ZH(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&KH(t).toStack(),this.positionNode!==null&&tr.assign(By(this.positionNode,"POSITION","vec3")),tr}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&vc(this.maskNode).not().discard();let s=this.colorNode?Vt(this.colorNode):wM;this.vertexColors===!0&&n.hasAttribute("color")&&(s=s.mul(h9())),t.instanceColor&&(s=vl("vec3","vInstanceColor").mul(s)),t.isBatchedMesh&&t._colorsTexture&&(s=vl("vec3","vBatchColor").mul(s)),bi.assign(s);const r=this.opacityNode?j(this.opacityNode):x3;bi.a.assign(bi.a.mul(r));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode!==null?j(this.alphaTestNode):bH,this.alphaToCoverage===!0?(bi.a=Ol(a,a.add(aO(bi.a)),bi.a),bi.a.lessThanEqual(0).discard()):bi.a.lessThanEqual(a).discard()),this.alphaHash===!0&&bi.a.lessThan(UK(tr)).discard(),e.isOpaque()&&bi.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?de(0):bi.rgb}setupNormal(){return this.normalNode?de(this.normalNode):RH}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?wf("envMap","cubeTexture"):wf("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new c9(LO)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const s=this.setupLightMap(e);if(s&&s.isLightingNode&&t.push(s),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:qH;t.push(new a9(a))}let r=this.lightsNode||e.lightsNode;return t.length>0&&(r=e.renderer.lighting.createNode([...r.getLights(),...t])),r}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:s,emissiveNode:r}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const u=this.setupLightingModel(e)||null;l=l9(o,u,n,s)}else n!==null&&(l=de(s!==null?Si(l,n,s):n));return(r&&r.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(fN.assign(de(r||TH)),l=l.add(fN)),l}setupFog(e,t){const n=e.fogNode;return n&&(Ny.assign(t),t=Vt(n.toVar())),t}setupPremultipliedAlpha(e,t){return y9(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const s=e[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=ir.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:r,childNode:a}of this._getNodeChildren())n.inputNodes[r]=a.toJSON(e).uuid;function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images),o=s(e.nodes);r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.nodes=o)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const VK=new ua;class v9 extends ys{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(VK),this.setValues(e)}}const HK=new LT;class _9 extends ys{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(HK),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?j(this.offsetNode):UO,t=this.dashScaleNode?j(this.dashScaleNode):BO,n=this.dashSizeNode?j(this.dashSizeNode):DO,s=this.gapSizeNode?j(this.gapSizeNode):OO;Pg.assign(n),IS.assign(s);const r=Dd(vo("lineDistance").mul(t));(e?r.add(e):r).mod(Pg.add(IS)).greaterThan(Pg).discard()}}let yE=null;class b9 extends YT{static get type(){return"ViewportSharedTextureNode"}constructor(e=If,t=null){yE===null&&(yE=new bT),super(e,t,yE)}getTextureForReference(){return yE}updateReference(){return this}}const S9=En(b9).setParameterLength(0,2),kK=new LT;class WK extends ys{static get type(){return"Line2NodeMaterial"}constructor(e={}){super(),this.isLine2NodeMaterial=!0,this.setDefaultValues(kK),this.useColor=e.vertexColors,this.dashOffset=0,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.blending=ca,this._useDash=e.dashed,this._useAlphaToCoverage=!0,this._useWorldUnits=!1,this.setValues(e)}setup(e){const{renderer:t}=e,n=this._useAlphaToCoverage,s=this.useColor,r=this._useDash,a=this._useWorldUnits,o=ye(({start:u,end:f})=>{const p=lc.element(2).element(2),_=lc.element(3).element(2).mul(-.5).div(p).sub(u.z).div(f.z.sub(u.z));return Vt(Si(u.xyz,f.xyz,_),f.w)}).setLayout({name:"trimSegment",type:"vec4",inputs:[{name:"start",type:"vec4"},{name:"end",type:"vec4"}]});this.vertexNode=ye(()=>{const u=vo("instanceStart"),f=vo("instanceEnd"),p=Vt(Wf.mul(Vt(u,1))).toVar("start"),x=Vt(Wf.mul(Vt(f,1))).toVar("end");if(r){const L=this.dashScaleNode?j(this.dashScaleNode):BO,D=this.offsetNode?j(this.offsetNode):UO,O=vo("instanceDistanceStart"),F=vo("instanceDistanceEnd");let U=_a.y.lessThan(.5).select(L.mul(O),L.mul(F));U=U.add(D),vl("float","lineDistance").assign(U)}a&&(vl("vec3","worldStart").assign(p.xyz),vl("vec3","worldEnd").assign(x.xyz));const y=Oy.z.div(Oy.w),_=lc.element(2).element(3).equal(-1);sn(_,()=>{sn(p.z.lessThan(0).and(x.z.greaterThan(0)),()=>{x.assign(o({start:p,end:x}))}).ElseIf(x.z.lessThan(0).and(p.z.greaterThanEqual(0)),()=>{p.assign(o({start:x,end:p}))})});const T=lc.mul(p),A=lc.mul(x),S=T.xyz.div(T.w),C=A.xyz.div(A.w),w=C.xy.sub(S.xy).toVar();w.x.assign(w.x.mul(y)),w.assign(w.normalize());const B=Vt().toVar();if(a){const L=x.xyz.sub(p.xyz).normalize(),D=Si(p.xyz,x.xyz,.5).normalize(),O=L.cross(D).normalize(),F=L.cross(O),U=vl("vec4","worldPos");U.assign(_a.y.lessThan(.5).select(p,x));const P=sM.mul(.5);U.addAssign(Vt(_a.x.lessThan(0).select(O.mul(P),O.mul(P).negate()),0)),r||(U.addAssign(Vt(_a.y.lessThan(.5).select(L.mul(P).negate(),L.mul(P)),0)),U.addAssign(Vt(F.mul(P),0)),sn(_a.y.greaterThan(1).or(_a.y.lessThan(0)),()=>{U.subAssign(Vt(F.mul(2).mul(P),0))})),B.assign(lc.mul(U));const X=de().toVar();X.assign(_a.y.lessThan(.5).select(S,C)),B.z.assign(X.z.mul(B.w))}else{const L=Je(w.y,w.x.negate()).toVar("offset");w.x.assign(w.x.div(y)),L.x.assign(L.x.div(y)),L.assign(_a.x.lessThan(0).select(L.negate(),L)),sn(_a.y.lessThan(0),()=>{L.assign(L.sub(w))}).ElseIf(_a.y.greaterThan(1),()=>{L.assign(L.add(w))}),L.assign(L.mul(sM)),L.assign(L.div(Oy.w)),B.assign(_a.y.lessThan(.5).select(T,A)),L.assign(L.mul(B.w)),B.assign(B.add(Vt(L,0,0)))}return B})();const l=ye(({p1:u,p2:f,p3:p,p4:x})=>{const y=u.sub(p),_=x.sub(p),T=f.sub(u),A=y.dot(_),S=_.dot(T),C=y.dot(T),w=_.dot(_),L=T.dot(T).mul(w).sub(S.mul(S)),O=A.mul(S).sub(C.mul(w)).div(L).clamp(),F=A.add(S.mul(O)).div(w).clamp();return Je(O,F)});if(this.colorNode=ye(()=>{const u=ji();if(r){const x=this.dashSizeNode?j(this.dashSizeNode):DO,y=this.gapSizeNode?j(this.gapSizeNode):OO;Pg.assign(x),IS.assign(y);const _=vl("float","lineDistance");u.y.lessThan(-1).or(u.y.greaterThan(1)).discard(),_.mod(Pg.add(IS)).greaterThan(Pg).discard()}const f=j(1).toVar("alpha");if(a){const x=vl("vec3","worldStart"),y=vl("vec3","worldEnd"),_=vl("vec4","worldPos").xyz.normalize().mul(1e5),T=y.sub(x),A=l({p1:x,p2:y,p3:de(0,0,0),p4:_}),S=x.add(T.mul(A.x)),C=_.mul(A.y),L=S.sub(C).length().div(sM);if(!r)if(n&&t.currentSamples>0){const D=L.fwidth();f.assign(Ol(D.negate().add(.5),D.add(.5),L).oneMinus())}else L.greaterThan(.5).discard()}else if(n&&t.currentSamples>0){const x=u.x,y=u.y.greaterThan(0).select(u.y.sub(1),u.y.add(1)),_=x.mul(x).add(y.mul(y)),T=j(_.fwidth()).toVar("dlen");sn(u.y.abs().greaterThan(1),()=>{f.assign(Ol(T.oneMinus(),T.add(1),_).oneMinus())})}else sn(u.y.abs().greaterThan(1),()=>{const x=u.x,y=u.y.greaterThan(0).select(u.y.sub(1),u.y.add(1));x.mul(x).add(y.mul(y)).greaterThan(1).discard()});let p;if(this.lineColorNode)p=this.lineColorNode;else if(s){const x=vo("instanceColorStart"),y=vo("instanceColorEnd");p=_a.y.lessThan(.5).select(x,y).mul(wM)}else p=wM;return Vt(p,f)})(),this.transparent){const u=this.opacityNode?j(this.opacityNode):x3;this.outputNode=Vt(this.colorNode.rgb.mul(u).add(S9().rgb.mul(u.oneMinus())),this.colorNode.a)}super.setup(e)}get worldUnits(){return this._useWorldUnits}set worldUnits(e){this._useWorldUnits!==e&&(this._useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this._useDash}set dashed(e){this._useDash!==e&&(this._useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const T9=i=>Ke(i).mul(.5).add(.5),XK=i=>Ke(i).mul(2).sub(1),qK=new IC;class A9 extends ys{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(qK),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?j(this.opacityNode):x3;bi.assign(d3(Vt(T9(Di),e),Mr))}}const XO=ye(([i=EO])=>{const e=i.z.atan(i.x).mul(1/(Math.PI*2)).add(.5),t=i.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Je(e,t)});class E9 extends gT{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,s=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new Nd(5,5,5),a=XO(EO),o=new ys;o.colorNode=kn(t,a,0),o.side=Yi,o.blending=ca;const l=new Ui(r,o),u=new Qf;u.add(l),t.minFilter===Cr&&(t.minFilter=Dn);const f=new SC(1,10,this),p=e.getMRT();return e.setMRT(null),f.update(e,u),e.setMRT(p),t.minFilter=n,t.currentGenerateMipmaps=s,l.geometry.dispose(),l.material.dispose(),this}}const fS=new WeakMap;class YK extends js{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Xy(null);const t=new Zf;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Bn.RENDER}updateBefore(e){const{renderer:t,material:n}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const r=s.isTextureNode?s.value:n[s.property];if(r&&r.isTexture){const a=r.mapping;if(a===Ad||a===zf){if(fS.has(r)){const o=fS.get(r);DP(o,r.mapping),this._cubeTexture=o}else{const o=r.image;if(jK(o)){const l=new E9(o.height);l.fromEquirectangularTexture(t,r),DP(l.texture,r.mapping),this._cubeTexture=l.texture,fS.set(r,l.texture),r.addEventListener("dispose",M9)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function jK(i){return i==null?!1:i.height>0}function M9(i){const e=i.target;e.removeEventListener("dispose",M9);const t=fS.get(e);t!==void 0&&(fS.delete(e),t.dispose())}function DP(i,e){e===Ad?i.mapping=Do:e===zf&&(i.mapping=Rl)}const C9=En(YK).setParameterLength(1);class y3 extends A0{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=C9(this.envNode)}}class $K extends A0{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=j(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Sv{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class R9 extends Sv{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,s=e.irradianceLightMap;n.indirectDiffuse.assign(Vt(0)),s?n.indirectDiffuse.addAssign(s):n.indirectDiffuse.addAssign(Vt(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(bi.rgb)}finish(e){const{material:t,context:n}=e,s=n.outgoingLight,r=e.context.environment;if(r)switch(t.combine){case h0:s.rgb.assign(Si(s.rgb,s.rgb.mul(r.rgb),dS.mul(iM)));break;case uC:s.rgb.assign(Si(s.rgb,r.rgb,dS.mul(iM)));break;case dC:s.rgb.addAssign(r.rgb.mul(dS.mul(iM)));break;default:De("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const KK=new er;class w9 extends ys{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(KK),this.setValues(e)}setupNormal(){return bv(Wy)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new y3(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new $K(LO)),t}setupOutgoingLight(){return bi.rgb}setupLightingModel(){return new R9}}const Yy=ye(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),c0=ye(i=>i.diffuseColor.mul(1/Math.PI)),JK=()=>j(.25),ZK=ye(({dotNH:i})=>AM.mul(j(.5)).add(1).mul(j(1/Math.PI)).mul(i.pow(AM))),QK=ye(({lightDirection:i})=>{const e=i.add(xs).normalize(),t=Di.dot(e).clamp(),n=xs.dot(e).clamp(),s=Yy({f0:oc,f90:1,dotVH:n}),r=JK(),a=ZK({dotNH:t});return s.mul(r).mul(a)});class qO extends R9{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=Di.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(c0({diffuseColor:bi.rgb}))),this.specular===!0&&n.directSpecular.addAssign(r.mul(QK({lightDirection:e})).mul(dS))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(n.mul(c0({diffuseColor:bi}))),s.indirectDiffuse.mulAssign(t)}}const eJ=new PC;class N9 extends ys{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(eJ),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new y3(t):null}setupLightingModel(){return new qO(!1)}}const tJ=new UC;class B9 extends ys{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(tJ),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new y3(t):null}setupLightingModel(){return new qO}setupVariants(){const e=(this.shininessNode?j(this.shininessNode):SH).max(1e-4);AM.assign(e);const t=this.specularNode||AH;oc.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const D9=ye(i=>{if(i.geometry.hasAttribute("normal")===!1)return j(0);const e=Wy.dFdx().abs().max(Wy.dFdy().abs());return e.x.max(e.y).max(e.z)}),YO=ye(i=>{const{roughness:e}=i,t=D9();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),O9=ye(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),s=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),r=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return Dl(.5,s.add(r).max(QD))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),nJ=ye(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:s,dotBL:r,dotNV:a,dotNL:o})=>{const l=o.mul(de(i.mul(t),e.mul(n),a).length()),u=a.mul(de(i.mul(s),e.mul(r),o).length());return Dl(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),U9=ye(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),iJ=j(1/Math.PI),sJ=ye(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:s})=>{const r=i.mul(e),a=de(e.mul(n),i.mul(s),r.mul(t)),o=a.dot(a),l=r.div(o);return iJ.mul(r.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),jO=ye(({lightDirection:i,f0:e,f90:t,roughness:n,f:s,normalView:r=Di,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const l=n.pow2(),u=i.add(xs).normalize(),f=r.dot(i).clamp(),p=r.dot(xs).clamp(),x=r.dot(u).clamp(),y=xs.dot(u).clamp();let _=Yy({f0:e,f90:t,dotVH:y}),T,A;if(BS(a)&&(_=s3.mix(_,s)),BS(o)){const S=aS.dot(i),C=aS.dot(xs),w=aS.dot(u),B=Ig.dot(i),L=Ig.dot(xs),D=Ig.dot(u);T=nJ({alphaT:TM,alphaB:l,dotTV:C,dotBV:L,dotTL:S,dotBL:B,dotNV:p,dotNL:f}),A=sJ({alphaT:TM,alphaB:l,dotNH:x,dotTH:w,dotBH:D})}else T=O9({alpha:l,dotNL:f,dotNV:p}),A=U9({alpha:l,dotNH:x});return _.mul(T).mul(A)}),rJ=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let xf=null;const FS=ye(({roughness:i,dotNV:e})=>{xf===null&&(xf=new No(rJ,32,32,Al,Ai),xf.minFilter=Dn,xf.magFilter=Dn,xf.wrapS=ts,xf.wrapT=ts,xf.generateMipmaps=!1,xf.needsUpdate=!0);const t=Je(i,e);return kn(xf,t).rg}),aJ=ye(({lightDirection:i,f0:e,f90:t,roughness:n,f:s,USE_IRIDESCENCE:r,USE_ANISOTROPY:a})=>{const o=jO({lightDirection:i,f0:e,f90:t,roughness:n,f:s,USE_IRIDESCENCE:r,USE_ANISOTROPY:a}),l=Di.dot(i).clamp(),u=Di.dot(xs).clamp(),f=FS({roughness:n,dotNV:u}),p=FS({roughness:n,dotNV:l}),x=e.mul(f.x).add(t.mul(f.y)),y=e.mul(p.x).add(t.mul(p.y)),_=f.x.add(f.y),T=p.x.add(p.y),A=j(1).sub(_),S=j(1).sub(T),C=e.add(e.oneMinus().mul(.047619)),w=x.mul(y).mul(C).div(j(1).sub(A.mul(S).mul(C).mul(C)).add(QD)),B=A.mul(S),L=w.mul(B);return o.add(L)}),L9=ye(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:s}=i,r=FS({dotNV:e,roughness:s});return t.mul(r.x).add(n.mul(r.y))}),I9=ye(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),s=n.mul(n),r=n.mul(s,s).clamp(0,.9999);return i.sub(de(e).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),oJ=ye(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=j(1).div(t),r=e.pow2().oneMinus().max(.0078125);return j(2).add(n).mul(r.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),lJ=ye(({dotNV:i,dotNL:e})=>j(1).div(j(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),cJ=ye(({lightDirection:i})=>{const e=i.add(xs).normalize(),t=Di.dot(i).clamp(),n=Di.dot(xs).clamp(),s=Di.dot(e).clamp(),r=oJ({roughness:i3,dotNH:s}),a=lJ({dotNV:n,dotNL:t});return Cg.mul(r).mul(a)}),uJ=ye(({N:i,V:e,roughness:t})=>{const r=.0078125,a=i.dot(e).saturate(),o=Je(t,a.oneMinus().sqrt());return o.assign(o.mul(.984375).add(r)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),P9=ye(({f:i})=>{const e=i.length();return Ts(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),lp=ye(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),r=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=s.div(r),o=t.greaterThan(0).select(a,Ts(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return i.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),OP=ye(({N:i,V:e,P:t,mInv:n,p0:s,p1:r,p2:a,p3:o})=>{const l=r.sub(s).toVar(),u=o.sub(s).toVar(),f=l.cross(u),p=de().toVar();return sn(f.dot(t.sub(s)).greaterThanEqual(0),()=>{const x=e.sub(i.mul(e.dot(i))).normalize(),y=i.cross(x).negate(),_=n.mul(qa(x,y,i).transpose()).toVar(),T=_.mul(s.sub(t)).normalize().toVar(),A=_.mul(r.sub(t)).normalize().toVar(),S=_.mul(a.sub(t)).normalize().toVar(),C=_.mul(o.sub(t)).normalize().toVar(),w=de(0).toVar();w.addAssign(lp({v1:T,v2:A})),w.addAssign(lp({v1:A,v2:S})),w.addAssign(lp({v1:S,v2:C})),w.addAssign(lp({v1:C,v2:T})),p.assign(de(P9({f:w})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),dJ=ye(({P:i,p0:e,p1:t,p2:n,p3:s})=>{const r=t.sub(e).toVar(),a=s.sub(e).toVar(),o=r.cross(a),l=de().toVar();return sn(o.dot(i.sub(e)).greaterThanEqual(0),()=>{const u=e.sub(i).normalize().toVar(),f=t.sub(i).normalize().toVar(),p=n.sub(i).normalize().toVar(),x=s.sub(i).normalize().toVar(),y=de(0).toVar();y.addAssign(lp({v1:u,v2:f})),y.addAssign(lp({v1:f,v2:p})),y.addAssign(lp({v1:p,v2:x})),y.addAssign(lp({v1:x,v2:u})),l.assign(de(P9({f:y.abs()})))}),l}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"P",type:"vec3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),v3=1/6,F9=i=>Cn(v3,Cn(i,Cn(i,i.negate().add(3)).sub(3)).add(1)),SN=i=>Cn(v3,Cn(i,Cn(i,Cn(3,i).sub(6))).add(4)),G9=i=>Cn(v3,Cn(i,Cn(i,Cn(-3,i).add(3)).add(3)).add(1)),TN=i=>Cn(v3,pc(i,3)),UP=i=>F9(i).add(SN(i)),LP=i=>G9(i).add(TN(i)),IP=i=>gr(-1,SN(i).div(F9(i).add(SN(i)))),PP=i=>gr(1,TN(i).div(G9(i).add(TN(i)))),FP=(i,e,t)=>{const n=i.uvNode,s=Cn(n,e.zw).add(.5),r=yd(s),a=uu(s),o=UP(a.x),l=LP(a.x),u=IP(a.x),f=PP(a.x),p=IP(a.y),x=PP(a.y),y=Je(r.x.add(u),r.y.add(p)).sub(.5).mul(e.xy),_=Je(r.x.add(f),r.y.add(p)).sub(.5).mul(e.xy),T=Je(r.x.add(u),r.y.add(x)).sub(.5).mul(e.xy),A=Je(r.x.add(f),r.y.add(x)).sub(.5).mul(e.xy),S=UP(a.y).mul(gr(o.mul(i.sample(y).level(t)),l.mul(i.sample(_).level(t)))),C=LP(a.y).mul(gr(o.mul(i.sample(T).level(t)),l.mul(i.sample(A).level(t))));return S.add(C)},$O=ye(([i,e])=>{const t=Je(i.size(oe(e))),n=Je(i.size(oe(e.add(1)))),s=Dl(1,t),r=Dl(1,n),a=FP(i,Vt(s,t),yd(e)),o=FP(i,Vt(r,n),o3(e));return uu(e).mix(a,o)}),fJ=ye(([i,e])=>{const t=e.mul(SO(i));return $O(i,t)}),GP=ye(([i,e,t,n,s])=>{const r=de(dO(e.negate(),Zo(i),Dl(1,n))),a=de(vd(s[0].xyz),vd(s[1].xyz),vd(s[2].xyz));return Zo(r).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),hJ=ye(([i,e])=>i.mul(_c(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),pJ=GO(),mJ=GO(),zP=ye(([i,e,t],{material:n})=>{const r=(n.side===Yi?pJ:mJ).sample(i),a=xd(l0.x).mul(hJ(e,t));return $O(r,a)}),VP=ye(([i,e,t])=>(sn(t.notEqual(0),()=>{const n=a3(e).negate().div(t);return eO(n.negate().mul(i))}),de(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),gJ=ye(([i,e,t,n,s,r,a,o,l,u,f,p,x,y,_])=>{let T,A;if(_){T=Vt().toVar(),A=de().toVar();const L=f.sub(1).mul(_.mul(.025)),D=de(f.sub(L),f,f.add(L));Vi({start:0,end:3},({i:O})=>{const F=D.element(O),U=GP(i,e,p,F,o),P=a.add(U),X=u.mul(l.mul(Vt(P,1))),Z=Je(X.xy.div(X.w)).toVar();Z.addAssign(1),Z.divAssign(2),Z.assign(Je(Z.x,Z.y.oneMinus()));const ee=zP(Z,t,F);T.element(O).assign(ee.element(O)),T.a.addAssign(ee.a),A.element(O).assign(n.element(O).mul(VP(vd(U),x,y).element(O)))}),T.a.divAssign(3)}else{const L=GP(i,e,p,f,o),D=a.add(L),O=u.mul(l.mul(Vt(D,1))),F=Je(O.xy.div(O.w)).toVar();F.addAssign(1),F.divAssign(2),F.assign(Je(F.x,F.y.oneMinus())),T=zP(F,t,f),A=n.mul(VP(vd(L),x,y))}const S=A.rgb.mul(T.rgb),C=i.dot(e).clamp(),w=de(L9({dotNV:C,specularColor:s,specularF90:r,roughness:t})),B=A.r.add(A.g,A.b).div(3);return Vt(w.oneMinus().mul(S),T.a.oneMinus().mul(B).oneMinus())}),xJ=qa(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),yJ=i=>{const e=i.sqrt();return de(1).add(e).div(de(1).sub(e))},HP=(i,e)=>i.sub(e).div(i.add(e)).pow2(),vJ=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=de(54856e-17,44201e-17,52481e-17),s=de(1681e3,1795300,2208400),r=de(43278e5,93046e5,66121e5),a=j(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=n.mul(r.mul(2*Math.PI).sqrt()).mul(s.mul(t).add(e).cos()).mul(t.pow2().negate().mul(r).exp());return o=de(o.x.add(a),o.y,o.z).div(10685e-11),xJ.mul(o)},_J=ye(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:s})=>{const r=Si(i,e,Ol(0,.03,n)),o=i.div(r).pow2().mul(t.pow2().oneMinus()).oneMinus();sn(o.lessThan(0),()=>de(1));const l=o.sqrt(),u=HP(r,i),f=Yy({f0:u,f90:1,dotVH:t}),p=f.oneMinus(),x=r.lessThan(i).select(Math.PI,0),y=j(Math.PI).sub(x),_=yJ(s.clamp(0,.9999)),T=HP(_,r.toVec3()),A=Yy({f0:T,f90:1,dotVH:l}),S=de(_.x.lessThan(r).select(Math.PI,0),_.y.lessThan(r).select(Math.PI,0),_.z.lessThan(r).select(Math.PI,0)),C=r.mul(n,l,2),w=de(y).add(S),B=f.mul(A).clamp(1e-5,.9999),L=B.sqrt(),D=p.pow2().mul(A).div(de(1).sub(B)),F=f.add(D).toVar(),U=D.sub(p).toVar();return Vi({start:1,end:2,condition:"<=",name:"m"},({m:P})=>{U.mulAssign(L);const X=vJ(j(P).mul(C),j(P).mul(w)).mul(2);F.addAssign(U.mul(X))}),F.max(de(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),bJ=ye(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),s=t.pow2(),r=Rr(t.lessThan(.25),j(-339.2).mul(s).add(j(161.4).mul(t)).sub(25.9),j(-8.48).mul(s).add(j(14.3).mul(t)).sub(9.95)),a=Rr(t.lessThan(.25),j(44).mul(s).sub(j(23.7).mul(t)).add(3.26),j(1.97).mul(s).sub(j(3.27).mul(t)).add(.72));return Rr(t.lessThan(.25),0,j(.1).mul(t).sub(.025)).add(r.mul(n).add(a).exp()).mul(1/Math.PI).saturate()}),Aw=de(.04),Ew=j(1);class _3 extends Sv{constructor(e=!1,t=!1,n=!1,s=!1,r=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=s,this.transmission=r,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=de().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=de().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=de().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=de().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=de().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Di.dot(xs).clamp();this.iridescenceFresnel=_J({outsideIOR:j(1),eta2:kD,cosTheta1:t,thinFilmThickness:WD,baseF0:oc}),this.iridescenceF0=I9({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=Ml,n=uS.sub(Ml).normalize(),s=sm,r=e.context;r.backdrop=gJ(s,n,od,bi,oc,LS,t,mc,Pl,lc,oS,XD,YD,qD,this.dispersion?jD:null),r.backdropAlpha=EM,bi.a.mulAssign(Si(1,r.backdrop.a,EM))}super.start(e)}computeMultiscattering(e,t,n){const s=Di.dot(xs).clamp(),r=FS({roughness:od,dotNV:s}),a=this.iridescenceF0?s3.mix(oc,this.iridescenceF0):oc,o=a.mul(r.x).add(n.mul(r.y)),u=r.x.add(r.y).oneMinus(),f=a.add(a.oneMinus().mul(.047619)),p=o.mul(f).div(u.mul(f).oneMinus());e.addAssign(o),t.addAssign(p.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=Di.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(cJ({lightDirection:e}))),this.clearcoat===!0){const o=Rg.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(jO({lightDirection:e,f0:Aw,f90:Ew,roughness:US,normalView:Rg})))}n.directDiffuse.addAssign(r.mul(c0({diffuseColor:bi.rgb}))),n.directSpecular.addAssign(r.mul(aJ({lightDirection:e,f0:oc,f90:1,roughness:od,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:s,reflectedLight:r,ltc_1:a,ltc_2:o}){const l=t.add(n).sub(s),u=t.sub(n).sub(s),f=t.sub(n).add(s),p=t.add(n).add(s),x=Di,y=xs,_=nr.toVar(),T=uJ({N:x,V:y,roughness:od}),A=a.sample(T).toVar(),S=o.sample(T).toVar(),C=qa(de(A.x,0,A.y),de(0,1,0),de(A.z,0,A.w)).toVar(),w=oc.mul(S.x).add(oc.oneMinus().mul(S.y)).toVar();r.directSpecular.addAssign(e.mul(w).mul(OP({N:x,V:y,P:_,mInv:C,p0:l,p1:u,p2:f,p3:p}))),r.directDiffuse.addAssign(e.mul(bi).mul(OP({N:x,V:y,P:_,mInv:qa(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:f,p3:p})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(c0({diffuseColor:bi})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:s}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(Cg,bJ({normal:Di,viewDir:xs,roughness:i3}))),this.clearcoat===!0){const f=Rg.dot(xs).clamp(),p=L9({dotNV:f,specularColor:Aw,specularF90:Ew,roughness:US});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const r=de().toVar("singleScattering"),a=de().toVar("multiScattering"),o=n.mul(1/Math.PI);this.computeMultiscattering(r,a,LS);const l=r.add(a),u=bi.mul(l.r.max(l.g).max(l.b).oneMinus());s.indirectSpecular.addAssign(t.mul(r)),s.indirectSpecular.addAssign(a.mul(o)),s.indirectDiffuse.addAssign(u.mul(o))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=Di.dot(xs).clamp().add(t),a=od.mul(-16).oneMinus().negate().exp2(),o=t.sub(r.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=Rg.dot(xs).clamp(),s=Yy({dotVH:n,f0:Aw,f90:Ew}),r=t.mul(SM.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(SM));t.assign(r)}if(this.sheen===!0){const n=Cg.r.max(Cg.g).max(Cg.b).mul(.157).oneMinus(),s=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(s)}}}const kP=j(1),AN=j(-2),vE=j(.8),Mw=j(-1),_E=j(.4),Cw=j(2),bE=j(.305),Rw=j(3),WP=j(.21),SJ=j(4),XP=j(4),TJ=j(16),AJ=ye(([i])=>{const e=de(ds(i)).toVar(),t=j(-1).toVar();return sn(e.x.greaterThan(e.z),()=>{sn(e.x.greaterThan(e.y),()=>{t.assign(Rr(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Rr(i.y.greaterThan(0),1,4))})}).Else(()=>{sn(e.z.greaterThan(e.y),()=>{t.assign(Rr(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Rr(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),EJ=ye(([i,e])=>{const t=Je().toVar();return sn(e.equal(0),()=>{t.assign(Je(i.z,i.y).div(ds(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(Je(i.x.negate(),i.z.negate()).div(ds(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(Je(i.x.negate(),i.y).div(ds(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(Je(i.z.negate(),i.y).div(ds(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(Je(i.x.negate(),i.z).div(ds(i.y)))}).Else(()=>{t.assign(Je(i.x,i.y).div(ds(i.z)))}),Cn(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),MJ=ye(([i])=>{const e=j(0).toVar();return sn(i.greaterThanEqual(vE),()=>{e.assign(kP.sub(i).mul(Mw.sub(AN)).div(kP.sub(vE)).add(AN))}).ElseIf(i.greaterThanEqual(_E),()=>{e.assign(vE.sub(i).mul(Cw.sub(Mw)).div(vE.sub(_E)).add(Mw))}).ElseIf(i.greaterThanEqual(bE),()=>{e.assign(_E.sub(i).mul(Rw.sub(Cw)).div(_E.sub(bE)).add(Cw))}).ElseIf(i.greaterThanEqual(WP),()=>{e.assign(bE.sub(i).mul(SJ.sub(Rw)).div(bE.sub(WP)).add(Rw))}).Else(()=>{e.assign(j(-2).mul(xd(Cn(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),z9=ye(([i,e])=>{const t=i.toVar();t.assign(Cn(2,t).sub(1));const n=de(t,1).toVar();return sn(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),V9=ye(([i,e,t,n,s,r])=>{const a=j(t),o=de(e),l=_c(MJ(a),AN,r),u=uu(l),f=yd(l),p=de(GS(i,o,f,n,s,r)).toVar();return sn(u.notEqual(0),()=>{const x=de(GS(i,o,f.add(1),n,s,r)).toVar();p.assign(Si(p,x,u))}),p}),GS=ye(([i,e,t,n,s,r])=>{const a=j(t).toVar(),o=de(e),l=j(AJ(o)).toVar(),u=j(Ts(XP.sub(a),0)).toVar();a.assign(Ts(a,XP));const f=j(ky(a)).toVar(),p=Je(EJ(o,l).mul(f.sub(2)).add(1)).toVar();return sn(l.greaterThan(2),()=>{p.y.addAssign(f),l.subAssign(3)}),p.x.addAssign(l.mul(f)),p.x.addAssign(u.mul(Cn(3,TJ))),p.y.addAssign(Cn(4,ky(r).sub(f))),p.x.mulAssign(n),p.y.mulAssign(s),i.sample(p).grad(Je(),Je())}),ww=ye(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=ad(n),u=t.mul(l).add(s.cross(t).mul(jo(n))).add(s.mul(s.dot(t).mul(l.oneMinus())));return GS(i,u,e,r,a,o)}),H9=ye(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:s,samples:r,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})=>{const x=de(Rr(e,t,o0(t,n))).toVar();sn(x.equal(de(0)),()=>{x.assign(de(n.z,0,n.x.negate()))}),x.assign(Zo(x));const y=de().toVar();return y.addAssign(s.element(0).mul(ww({theta:0,axis:x,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),Vi({start:oe(1),end:i},({i:_})=>{sn(_.greaterThanEqual(r),()=>{i9()});const T=j(a.mul(j(_))).toVar();y.addAssign(s.element(_).mul(ww({theta:T.mul(-1),axis:x,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),y.addAssign(s.element(_).mul(ww({theta:T,axis:x,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})))}),Vt(y,1)}),CJ=ye(([i])=>{const e=yt(i).toVar();return e.assign(e.shiftLeft(yt(16)).bitOr(e.shiftRight(yt(16)))),e.assign(e.bitAnd(yt(1431655765)).shiftLeft(yt(1)).bitOr(e.bitAnd(yt(2863311530)).shiftRight(yt(1)))),e.assign(e.bitAnd(yt(858993459)).shiftLeft(yt(2)).bitOr(e.bitAnd(yt(3435973836)).shiftRight(yt(2)))),e.assign(e.bitAnd(yt(252645135)).shiftLeft(yt(4)).bitOr(e.bitAnd(yt(4042322160)).shiftRight(yt(4)))),e.assign(e.bitAnd(yt(16711935)).shiftLeft(yt(8)).bitOr(e.bitAnd(yt(4278255360)).shiftRight(yt(8)))),j(e).mul(23283064365386963e-26)}),RJ=ye(([i,e])=>Je(j(i).div(j(e)),CJ(i))),wJ=ye(([i,e,t])=>{const n=de(e).toVar(),s=j(t),r=s.mul(s).toVar(),a=Zo(de(r.mul(n.x),r.mul(n.y),n.z)).toVar(),o=a.x.mul(a.x).add(a.y.mul(a.y)),l=Rr(o.greaterThan(0),de(a.y.negate(),a.x,0).div($o(o)),de(1,0,0)).toVar(),u=o0(a,l).toVar(),f=$o(i.x),p=Cn(2,3.14159265359).mul(i.y),x=f.mul(ad(p)).toVar(),y=f.mul(jo(p)).toVar(),_=Cn(.5,a.z.add(1));y.assign(_.oneMinus().mul($o(x.mul(x).oneMinus())).add(_.mul(y)));const T=l.mul(x).add(u.mul(y)).add(a.mul($o(Ts(0,x.mul(x).add(y.mul(y)).oneMinus()))));return Zo(de(r.mul(T.x),r.mul(T.y),Ts(0,T.z)))}),k9=ye(({roughness:i,mipInt:e,envMap:t,N_immutable:n,GGX_SAMPLES:s,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=de(n).toVar(),u=de(0).toVar(),f=j(0).toVar();return sn(i.lessThan(.001),()=>{u.assign(GS(t,l,e,r,a,o))}).Else(()=>{const p=Rr(ds(l.z).lessThan(.999),de(0,0,1),de(1,0,0)),x=Zo(o0(p,l)).toVar(),y=o0(l,x).toVar();Vi({start:yt(0),end:s},({i:_})=>{const T=RJ(_,s),A=wJ(T,de(0,0,1),i),S=Zo(x.mul(A.x).add(y.mul(A.y)).add(l.mul(A.z))),C=Zo(S.mul(du(l,S).mul(2)).sub(l)),w=Ts(du(l,C),0);sn(w.greaterThan(0),()=>{const B=GS(t,C,e,r,a,o);u.addAssign(B.mul(w)),f.addAssign(w)})}),sn(f.greaterThan(0),()=>{u.assign(u.div(f))})}),Vt(u,1)}),cp=4,qP=[.125,.215,.35,.446,.526,.582],Sg=20,NJ=512,Sb=new Ac(-1,1,1,-1,0,1),BJ=new bs(90,1),YP=new Bt;let Nw=null,Bw=0,Dw=0;const DJ=new Q,NM=new WeakMap,OJ=[3,1,5,0,4,2],Ow=z9(ji(),vo("faceIndex")).normalize(),b3=de(Ow.x,Ow.y,Ow.z);let W9=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,s=100,r={}){const{size:a=256,position:o=DJ,renderTarget:l=null}=r;if(this._setSize(a),this._hasInitialized===!1){De('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const f=l||this._allocateTarget();return r.renderTarget=f,this.fromSceneAsync(e,t,n,s,r),f}Nw=this._renderer.getRenderTarget(),Bw=this._renderer.getActiveCubeFace(),Dw=this._renderer.getActiveMipmapLevel();const u=l||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,n,s,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,n=.1,s=100,r={}){return qi('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,s,r)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){De('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return qi('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){De("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return qi('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$P(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=KP(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Do||e.mapping===Rl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Nw,Bw,Dw),e.scissorTest=!1,Qx(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Nw=this._renderer.getRenderTarget(),Bw=this._renderer.getActiveCubeFace(),Dw=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return jP(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jP(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=UJ(t)),this._blurMaterial=LJ(t,e.width,e.height),this._ggxMaterial=IJ(t,e.width,e.height)}}async _compileMaterial(e){const t=new Ui(new Fn,e);await this._renderer.compile(t,Sb)}_sceneToCubeUV(e,t,n,s,r){const a=BJ;a.near=t,a.far=n;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],u=this._renderer,f=u.autoClear;u.getClearColor(YP),u.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new Ui(new Nd,new er({name:"PMREM.Background",side:Yi,depthWrite:!1,depthTest:!1})));const p=this._backgroundBox,x=p.material;let y=!1;const _=e.background;_?_.isColor&&(x.color.copy(_),e.background=null,y=!0):(x.color.copy(YP),y=!0),u.setRenderTarget(s),u.clear(),y&&u.render(p,a);for(let T=0;T<6;T++){const A=T%3;A===0?(a.up.set(0,o[T],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x+l[T],r.y,r.z)):A===1?(a.up.set(0,0,o[T]),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y+l[T],r.z)):(a.up.set(0,o[T],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y,r.z+l[T]));const S=this._cubeSize;Qx(s,A*S,T>2?S:0,S,S),u.render(e,a)}u.autoClear=f,e.background=_}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Do||e.mapping===Rl;s?this._cubemapMaterial===null&&(this._cubemapMaterial=$P(e)):this._equirectMaterial===null&&(this._equirectMaterial=KP(e));const r=s?this._cubemapMaterial:this._equirectMaterial;r.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=r;const o=this._cubeSize;Qx(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Sb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodMeshes.length;for(let r=1;r<s;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const s=this._renderer,r=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const l=NM.get(a),u=n/(this._lodMeshes.length-1),f=t/(this._lodMeshes.length-1),p=Math.sqrt(u*u-f*f),x=.05+u*.95,y=p*x,{_lodMax:_}=this,T=this._sizeLods[n],A=3*T*(n>_-cp?n-_+cp:0),S=4*(this._cubeSize-T);e.texture.frame=(e.texture.frame||0)+1,l.envMap.value=e.texture,l.roughness.value=y,l.mipInt.value=_-t,Qx(r,A,S,3*T,2*T),s.setRenderTarget(r),s.render(o,Sb),r.texture.frame=(r.texture.frame||0)+1,l.envMap.value=r.texture,l.roughness.value=0,l.mipInt.value=_-n,Qx(e,A,S,3*T,2*T),s.setRenderTarget(e),s.render(o,Sb)}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&nt("blur direction must be either latitudinal or longitudinal!");const f=3,p=this._lodMeshes[s];p.material=u;const x=NM.get(u),y=this._sizeLods[n]-1,_=isFinite(r)?Math.PI/(2*y):2*Math.PI/(2*Sg-1),T=r/_,A=isFinite(r)?1+Math.floor(f*T):Sg;A>Sg&&De(`sigmaRadians, ${r}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${Sg}`);const S=[];let C=0;for(let O=0;O<Sg;++O){const F=O/T,U=Math.exp(-F*F/2);S.push(U),O===0?C+=U:O<A&&(C+=2*U)}for(let O=0;O<S.length;O++)S[O]=S[O]/C;e.texture.frame=(e.texture.frame||0)+1,x.envMap.value=e.texture,x.samples.value=A,x.weights.array=S,x.latitudinal.value=a==="latitudinal"?1:0,o&&(x.poleAxis.value=o);const{_lodMax:w}=this;x.dTheta.value=_,x.mipInt.value=w-n;const B=this._sizeLods[s],L=3*B*(s>w-cp?s-w+cp:0),D=4*(this._cubeSize-B);Qx(t,L,D,3*B,2*B),l.setRenderTarget(t),l.render(p,Sb)}};function UJ(i){const e=[],t=[],n=[];let s=i;const r=i-cp+1+qP.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);e.push(o);let l=1/o;a>i-cp?l=qP[a-i+cp-1]:a===0&&(l=0),t.push(l);const u=1/(o-2),f=-u,p=1+u,x=[f,f,p,f,p,p,f,f,p,p,f,p],y=6,_=6,T=3,A=2,S=1,C=new Float32Array(T*_*y),w=new Float32Array(A*_*y),B=new Float32Array(S*_*y);for(let D=0;D<y;D++){const O=D%3*2/3-1,F=D>2?0:-1,U=[O,F,0,O+2/3,F,0,O+2/3,F+1,0,O,F,0,O+2/3,F+1,0,O,F+1,0],P=OJ[D];C.set(U,T*_*P),w.set(x,A*_*P);const X=[P,P,P,P,P,P];B.set(X,S*_*P)}const L=new Fn;L.setAttribute("position",new li(C,T)),L.setAttribute("uv",new li(w,A)),L.setAttribute("faceIndex",new li(B,S)),n.push(new Ui(L,null)),s>cp&&s--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function jP(i,e){const t={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:Ai,format:Oi,colorSpace:Qo},n=new bc(i,e,t);return n.texture.mapping=Ed,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Qx(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function S3(i){const e=new ys;return e.depthTest=!1,e.depthWrite=!1,e.blending=ca,e.name=`PMREM_${i}`,e}function LJ(i,e,t){const n=za(new Array(Sg).fill(0)),s=rn(new Q(0,1,0)),r=rn(0),a=j(Sg),o=rn(0),l=rn(1),u=kn(),f=rn(0),p=j(1/e),x=j(1/t),y=j(i),_={n:a,latitudinal:o,weights:n,poleAxis:s,outputDirection:b3,dTheta:r,samples:l,envMap:u,mipInt:f,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:x,CUBEUV_MAX_MIP:y},T=S3("blur");return T.fragmentNode=H9({..._,latitudinal:o.equal(1)}),NM.set(T,_),T}function IJ(i,e,t){const n=kn(),s=rn(0),r=rn(0),a=j(1/e),o=j(1/t),l=j(i),u={envMap:n,roughness:s,mipInt:r,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l},f=S3("ggx");return f.fragmentNode=k9({...u,N_immutable:b3,GGX_SAMPLES:yt(NJ)}),NM.set(f,u),f}function $P(i){const e=S3("cubemap");return e.fragmentNode=Xy(i,b3),e}function KP(i){const e=S3("equirect");return e.fragmentNode=kn(i,XO(b3),0),e}const JP=new WeakMap;function PJ(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function FJ(i,e,t){const n=GJ(e);let s=n.get(i);if((s!==void 0?s.pmremVersion:-1)!==i.pmremVersion){const a=i.image;if(i.isCubeTexture)if(zJ(a))s=t.fromCubemap(i,s);else return null;else if(VJ(a))s=t.fromEquirectangular(i,s);else return null;s.pmremVersion=i.pmremVersion,n.set(i,s)}return s.texture}function GJ(i){let e=JP.get(i);return e===void 0&&(e=new WeakMap,JP.set(i,e)),e}class X9 extends js{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const s=new pi;s.isRenderTargetTexture=!0,this._texture=kn(s),this._width=rn(0),this._height=rn(0),this._maxMip=rn(0),this.updateBeforeType=Bn.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=PJ(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,s=this._value;n!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=FJ(s,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new W9(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=RO.mul(de(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),V9(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function zJ(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function VJ(i){return i==null?!1:i.height>0}const KO=En(X9).setParameterLength(1,3),ZP=new WeakMap;class q9 extends A0{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:t[n.property];let x=ZP.get(p);x===void 0&&(x=KO(p),ZP.set(p,x)),n=x}const r=t.useAnisotropy===!0||t.anisotropy>0?yH:Di,a=n.context(QP(od,r)).mul(nM),o=n.context(HJ(sm)).mul(Math.PI).mul(nM),l=Dy(a),u=Dy(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(u);const f=e.context.lightingModel.clearcoatRadiance;if(f){const p=n.context(QP(US,Rg)).mul(nM),x=Dy(p);f.addAssign(x)}}}const QP=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=xs.negate().reflect(e),t=lO(i).mix(t,e).normalize(),t=t.transformDirection(Pl)),t),getTextureLevel:()=>i}},HJ=i=>({getUV:()=>i,getTextureLevel:()=>j(1)}),kJ=new _0;class JO extends ys{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(kJ),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new q9(t):null}setupLightingModel(){return new _3}setupSpecular(){const e=Si(de(.04),bi.rgb,OS);oc.assign(e),LS.assign(1)}setupVariants(){const e=this.metalnessNode?j(this.metalnessNode):CH;OS.assign(e);let t=this.roughnessNode?j(this.roughnessNode):MH;t=YO({roughness:t}),od.assign(t),this.setupSpecular(),bi.assign(Vt(bi.rgb.mul(e.oneMinus()),bi.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const WJ=new nl;class ZO extends JO{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(WJ),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?j(this.iorNode):VH;oS.assign(e),oc.assign(Si(el(oO(oS.sub(1).div(oS.add(1))).mul(EH),de(1)).mul(bN),bi.rgb,OS)),LS.assign(Si(bN,1,OS))}setupLightingModel(){return new _3(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?j(this.clearcoatNode):wH,n=this.clearcoatRoughnessNode?j(this.clearcoatRoughnessNode):NH;SM.assign(t),US.assign(YO({roughness:n}))}if(this.useSheen){const t=this.sheenNode?de(this.sheenNode):OH,n=this.sheenRoughnessNode?j(this.sheenRoughnessNode):UH;Cg.assign(t),i3.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?j(this.iridescenceNode):IH,n=this.iridescenceIORNode?j(this.iridescenceIORNode):PH,s=this.iridescenceThicknessNode?j(this.iridescenceThicknessNode):FH;s3.assign(t),kD.assign(n),WD.assign(s)}if(this.useAnisotropy){const t=(this.anisotropyNode?Je(this.anisotropyNode):LH).toVar();np.assign(t.length()),sn(np.equal(0),()=>{t.assign(Je(1,0))}).Else(()=>{t.divAssign(Je(np)),np.assign(np.saturate())}),TM.assign(np.pow2().mix(od.pow2(),1)),aS.assign(wg[0].mul(t.x).add(wg[1].mul(t.y))),Ig.assign(wg[1].mul(t.x).sub(wg[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?j(this.transmissionNode):GH,n=this.thicknessNode?j(this.thicknessNode):zH,s=this.attenuationDistanceNode?j(this.attenuationDistanceNode):HH,r=this.attenuationColorNode?de(this.attenuationColorNode):kH;if(EM.assign(t),XD.assign(n),qD.assign(s),YD.assign(r),this.useDispersion){const a=this.dispersionNode?j(this.dispersionNode):XH;jD.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?de(this.clearcoatNormalNode):BH}setup(e){e.context.setupClearcoatNormal=()=>By(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class XJ extends _3{constructor(e=!1,t=!1,n=!1,s=!1,r=!1,a=!1,o=!1){super(e,t,n,s,r,a),this.useSSS=o}direct({lightDirection:e,lightColor:t,reflectedLight:n},s){if(this.useSSS===!0){const r=s.material,{thicknessColorNode:a,thicknessDistortionNode:o,thicknessAmbientNode:l,thicknessAttenuationNode:u,thicknessPowerNode:f,thicknessScaleNode:p}=r,x=e.add(Di.mul(o)).normalize(),y=j(xs.dot(x.negate()).saturate().pow(f).mul(p)),_=de(y.add(l).mul(a));n.directDiffuse.addAssign(_.mul(u.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:n},s)}}class qJ extends ZO{static get type(){return"MeshSSSNodeMaterial"}constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=j(.1),this.thicknessAmbientNode=j(0),this.thicknessAttenuationNode=j(.1),this.thicknessPowerNode=j(2),this.thicknessScaleNode=j(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new XJ(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}const YJ=ye(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),s=Je(n.mul(.5).add(.5),0);if(t.material.gradientMap){const r=wf("gradientMap","texture").context({getUV:()=>s});return de(r.r)}else{const r=s.fwidth().mul(.5);return Si(de(.7),de(1),Ol(j(.7).sub(r.x),j(.7).add(r.x),s.x))}});class jJ extends Sv{direct({lightDirection:e,lightColor:t,reflectedLight:n},s){const r=YJ({normal:h3,lightDirection:e,builder:s}).mul(t);n.directDiffuse.addAssign(r.mul(c0({diffuseColor:bi.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(n.mul(c0({diffuseColor:bi}))),s.indirectDiffuse.mulAssign(t)}}const $J=new LC;class Y9 extends ys{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues($J),this.setValues(e)}setupLightingModel(){return new jJ}}const j9=ye(()=>{const i=de(xs.z,0,xs.x.negate()).normalize(),e=xs.cross(i);return Je(i.dot(Di),e.dot(Di)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),KJ=new zC;class $9 extends ys{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(KJ),this.setValues(e)}setupVariants(e){const t=j9;let n;e.material.matcap?n=wf("matcap","texture").context({getUV:()=>t}):n=de(Si(.2,.8,t.y)),bi.rgb.mulAssign(n.rgb)}}class K9 extends js{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const r=t.cos(),a=t.sin();return n3(r,a,a.negate(),r).mul(n)}else{const r=t,a=Lg(Vt(1,0,0,0),Vt(0,ad(r.x),jo(r.x).negate(),0),Vt(0,jo(r.x),ad(r.x),0),Vt(0,0,0,1)),o=Lg(Vt(ad(r.y),0,jo(r.y),0),Vt(0,1,0,0),Vt(jo(r.y).negate(),0,ad(r.y),0),Vt(0,0,0,1)),l=Lg(Vt(ad(r.z),jo(r.z).negate(),0,0),Vt(jo(r.z),ad(r.z),0,0),Vt(0,0,1,0),Vt(0,0,0,1));return a.mul(o).mul(l).mul(Vt(n,1)).xyz}}}const jT=En(K9).setParameterLength(2),JJ=new vT;class QO extends ys{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(JJ),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:s,rotationNode:r,scaleNode:a,sizeAttenuation:o}=this,l=Wf.mul(de(s||0));let u=Je(mc[0].xyz.length(),mc[1].xyz.length());a!==null&&(u=u.mul(Je(a))),n.isPerspectiveCamera&&o===!1&&(u=u.mul(l.z.negate()));let f=_a.xy;if(t.center&&t.center.isVector2===!0){const y=w$("center","vec2",t);f=f.sub(y.sub(.5))}f=f.mul(u);const p=j(r||DH),x=jT(f,p);return Vt(l.xy.add(x),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const ZJ=new fv,QJ=new Ze;class J9 extends QO{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(ZJ),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Wf.mul(de(e||tr)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:s,scaleNode:r,sizeNode:a,sizeAttenuation:o}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let u=a!==null?Je(a):WH;u=u.mul(k5),n.isPerspectiveCamera&&o===!0&&(u=u.mul(eZ.div(nr.z.negate()))),r&&r.isNode&&(u=u.mul(Je(r)));let f=_a.xy;if(s&&s.isNode){const p=j(s);f=jT(f,p)}return f=f.mul(u),f=f.div(AO.div(2)),f=f.mul(l.w),l=l.add(Vt(f,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const eZ=rn(1).onFrameUpdate(function({renderer:i}){const e=i.getSize(QJ);this.value=.5*e.y});class tZ extends Sv{constructor(){super(),this.shadowNode=j(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){bi.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(bi.rgb)}}const nZ=new OC;class Z9 extends ys{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(nZ),this.setValues(e)}setupLightingModel(){return new tZ}}const Tb=ou("vec3"),eF=ou("vec3"),tF=ou("vec3");class iZ extends Sv{constructor(){super()}start(e){const{material:t}=e,n=ou("vec3"),s=ou("vec3");sn(uS.sub(Ml).length().greaterThan(q5.mul(2)),()=>{n.assign(uS),s.assign(Ml)}).Else(()=>{n.assign(Ml),s.assign(uS)});const r=s.sub(n),a=rn("int").onRenderUpdate(({material:p})=>p.steps),o=r.length().div(a).toVar(),l=r.normalize().toVar(),u=j(0).toVar(),f=de(1).toVar();t.offsetNode&&u.addAssign(t.offsetNode.mul(o)),Vi(a,()=>{const p=n.add(l.mul(u)),x=Pl.mul(Vt(p,1)).xyz;t.depthNode!==null&&(eF.assign(qy(VO(x.z,Cf,Rf))),e.context.sceneDepthNode=qy(t.depthNode).toVar()),e.context.positionWorld=p,e.context.shadowPositionWorld=p,e.context.positionView=x,Tb.assign(0);let y;t.scatteringNode&&(y=t.scatteringNode({positionRay:p})),super.start(e),y&&Tb.mulAssign(y);const _=Tb.mul(.01).negate().mul(o).exp();f.mulAssign(_),u.addAssign(o)}),tF.addAssign(f.saturate().oneMinus())}scatteringLight(e,t){const n=t.context.sceneDepthNode;n?sn(n.greaterThanEqual(eF),()=>{Tb.addAssign(e)}):Tb.addAssign(e)}direct({lightNode:e,lightColor:t},n){if(e.light.distance===void 0)return;const s=t.xyz.toVar();s.mulAssign(e.shadowNode),this.scatteringLight(s,n)}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:s},r){const a=t.add(n).sub(s),o=t.sub(n).sub(s),l=t.sub(n).add(s),u=t.add(n).add(s),f=r.context.positionView,p=e.xyz.mul(dJ({P:f,p0:a,p1:o,p2:l,p3:u})).pow(1.5);this.scatteringLight(p,r)}finish(e){e.context.outgoingLight.assign(tF)}}class sZ extends ys{static get type(){return"VolumeNodeMaterial"}constructor(e){super(),this.isVolumeNodeMaterial=!0,this.steps=25,this.offsetNode=null,this.scatteringNode=null,this.lights=!0,this.transparent=!0,this.side=Yi,this.depthTest=!1,this.depthWrite=!1,this.setValues(e)}setupLightingModel(){return new iZ}}class rZ{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class hu{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let s=0;s<e.length-1;s++){const r=e[s];n.has(r)===!1&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let aZ=0;function oZ(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const s in n)if(n[s]!==void 0){const r=n[s];r&&typeof r.get=="function"&&e.push(s)}t=Object.getPrototypeOf(t)}return e}class lZ{constructor(e,t,n,s,r,a,o,l,u,f){this.id=aZ++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=s,this.material=r,this.scene=a,this.camera=o,this.lightsNode=l,this.context=u,this.geometry=s.geometry,this.version=r.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],s=new Set,r={};for(const a of e){let o;if(a.node&&a.node.attribute?o=a.node.attribute:(o=t.getAttribute(a.name),r[a.name]=o.version),o===void 0)continue;n.push(o);const l=o.isInterleavedBufferAttribute?o.data:o;s.add(l)}return this.attributes=n,this.attributesId=r,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:s,drawRange:r}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null;let u=1;if(n.isInstancedBufferGeometry===!0?u=n.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(a.instanceCount=u,e.isBatchedMesh===!0)return a;let f=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(f=2);let p=r.start*f,x=(r.start+r.count)*f;s!==null&&(p=Math.max(p,s.start*f),x=Math.min(x,(s.start+s.count)*f));const y=n.attributes.position;let _=1/0;l?_=o.count:y!=null&&(_=y.count),p=Math.max(p,0),x=Math.min(x,_);const T=x-p;return T<0||T===1/0?null:(a.vertexCount=T,a.firstVertex=p,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const s=e.attributes[n];t+=n+",",s.data&&(t+=s.data.stride+","),s.offset&&(t+=s.offset+","),s.itemSize&&(t+=s.itemSize+","),s.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const s=e.morphAttributes[n];t+="morph-"+n+",";for(let r=0,a=s.length;r<a;r++){const o=s[r];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let s=t.customProgramCacheKey();for(const r of oZ(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const a=t[r];let o;if(a!==null){const l=typeof a;l==="number"?o=a!==0?"1":"0":l==="object"?(o="{",a.isTexture&&(o+=a.mapping,n.backend.isWebGPUBackend===!0&&(o+=a.magFilter,o+=a.minFilter,o+=a.wrapS,o+=a.wrapT,o+=a.wrapR)),o+="}"):o=String(a)}else o=String(a);s+=o+","}return s+=this.clippingContextCacheKey+",",e.geometry&&(s+=this.getGeometryCacheKey()),e.skeleton&&(s+=e.skeleton.bones.length+","),e.isBatchedMesh&&(s+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(s+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(s+=e.uuid+","),s+=e.receiveShadow+",",yv(s)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=wy(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=wy(e,1)),e=wy(e,this.camera.id),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const dg=[];class cZ{constructor(e,t,n,s,r,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=s,this.bindings=r,this.info=a,this.chainMaps={}}get(e,t,n,s,r,a,o,l){const u=this.getChainMap(l);dg[0]=e,dg[1]=t,dg[2]=a,dg[3]=r;let f=u.get(dg);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,s,r,a,o,l),u.set(dg,f)):(f.updateClipping(o),f.needsGeometryUpdate&&f.setGeometry(e.geometry),(f.version!==t.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(e,t,n,s,r,a,o,l)):f.version=t.version)),dg.length=0,f}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new hu)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,s,r,a,o,l,u,f,p){const x=this.getChainMap(p),y=new lZ(e,t,n,s,r,a,o,l,u,f);return y.onDispose=()=>{this.pipelines.delete(y),this.bindings.deleteForRender(y),this.nodes.delete(y),x.delete(y.getChainArray())},y}}class rm{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const gc={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},ip=16,uZ=211,dZ=212;class fZ extends rm{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===gc.VERTEX?this.backend.createAttribute(e):t===gc.INDEX?this.backend.createIndexAttribute(e):t===gc.STORAGE?this.backend.createStorageAttribute(e):t===gc.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(n.version<s.version||s.usage===ap)&&(this.backend.updateAttribute(e),n.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Q9(i){return i.index!==null?i.index.version:i.attributes.position.version}function nF(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const r=t.array;for(let a=0,o=r.length;a<o;a+=3){const l=r[a+0],u=r[a+1],f=r[a+2];e.push(l,u,u,f,f,l)}}else{const r=n.array;for(let a=0,o=r.length/3-1;a<o;a+=3){const l=a+0,u=a+1,f=a+2;e.push(l,u,u,f,f,l)}}const s=new(XB(e)?mT:pT)(e,1);return s.version=Q9(i),s}class hZ extends rm{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const r=t.index,a=e.getAttributes();r!==null&&this.attributes.delete(r);for(const l of a)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",s),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",s),this._geometryDisposeListeners.set(t,s)}updateAttributes(e){const t=e.getAttributes();for(const r of t)r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute?this.updateAttribute(r,gc.STORAGE):this.updateAttribute(r,gc.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,gc.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,gc.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let s=t.index;if(n.wireframe===!0){const r=this.wireframes;let a=r.get(t);a===void 0?(a=nF(t),r.set(t,a)):a.version!==Q9(t)&&(this.attributes.delete(a),a=nF(t),r.set(t,a)),s=a}return s}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class pZ{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):nt("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class e6{constructor(e){this.cacheKey=e,this.usedTimes=0}}class mZ extends e6{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class gZ extends e6{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let xZ=0;class Uw{constructor(e,t,n,s=null,r=null){this.id=xZ++,this.code=e,this.stage=t,this.name=n,this.transforms=s,this.attributes=r,this.usedTimes=0}}class yZ extends rm{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const r=s.pipeline;r&&(r.usedTimes--,r.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);o===void 0&&(r&&r.computeProgram.usedTimes===0&&this._releaseProgram(r.computeProgram),o=new Uw(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));const l=this._getComputeCacheKey(e,o);let u=this.caches.get(l);u===void 0&&(r&&r.usedTimes===0&&this._releasePipeline(r),u=this._getComputePipeline(e,o,l,t)),u.usedTimes++,o.usedTimes++,s.version=e.version,s.pipeline=u}return s.pipeline}getForRender(e,t=null){const{backend:n}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const r=s.pipeline;r&&(r.usedTimes--,r.vertexProgram.usedTimes--,r.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(a.vertexShader);l===void 0&&(r&&r.vertexProgram.usedTimes===0&&this._releaseProgram(r.vertexProgram),l=new Uw(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),n.createProgram(l));let u=this.programs.fragment.get(a.fragmentShader);u===void 0&&(r&&r.fragmentProgram.usedTimes===0&&this._releaseProgram(r.fragmentProgram),u=new Uw(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,u),n.createProgram(u));const f=this._getRenderCacheKey(e,l,u);let p=this.caches.get(f);p===void 0?(r&&r.usedTimes===0&&this._releasePipeline(r),p=this._getRenderPipeline(e,l,u,f,t)):e.pipeline=p,p.usedTimes++,l.usedTimes++,u.usedTimes++,s.pipeline=p}return s.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,s){n=n||this._getComputeCacheKey(e,t);let r=this.caches.get(n);return r===void 0&&(r=new gZ(n,t),this.caches.set(n,r),this.backend.createComputePipeline(r,s)),r}_getRenderPipeline(e,t,n,s,r){s=s||this._getRenderCacheKey(e,t,n);let a=this.caches.get(s);return a===void 0&&(a=new mZ(s,t,n),this.caches.set(s,a),e.pipeline=a,this.backend.createRenderPipeline(e,r)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class vZ extends rm{constructor(e,t,n,s,r,a){super(),this.backend=e,this.textures=n,this.pipelines=r,this.attributes=s,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),s.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),s.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const n=t.attribute,s=n.isIndirectStorageBufferAttribute?gc.INDIRECT:gc.STORAGE;this.attributes.update(n,s)}}_update(e,t){const{backend:n}=this;let s=!1,r=!0,a=0,o=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const u=l.attribute,f=u.isIndirectStorageBufferAttribute?gc.INDIRECT:gc.STORAGE;this.attributes.update(u,f)}if(l.isUniformBuffer)l.update()&&n.updateBinding(l);else if(l.isSampledTexture){const u=l.update(),f=l.texture,p=this.textures.get(f);if(u&&(this.textures.updateTexture(f),l.generation!==p.generation&&(l.generation=p.generation,s=!0,r=!1)),n.get(f).externalTexture!==void 0||p.isDefaultTexture?r=!1:(a=a*10+f.id,o+=f.version),f.isStorageTexture===!0&&f.mipmapsAutoUpdate===!0){const y=this.get(f);l.store===!0?y.needsMipmap=!0:this.textures.needsMipmaps(f)&&y.needsMipmap===!0&&(this.backend.generateMipmaps(f),y.needsMipmap=!1)}}else if(l.isSampler&&l.update()){const f=this.textures.updateSampler(l.texture);l.samplerKey!==f&&(l.samplerKey=f,s=!0,r=!1)}}s===!0&&this.backend.updateBindings(e,t,r?a:0,o)}}function _Z(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function iF(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function sF(i){return(i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode)&&i.side===hr&&i.forceSinglePass===!1}class bZ{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,s,r,a,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:n,groupOrder:s,renderOrder:e.renderOrder,z:r,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=n,l.groupOrder=s,l.renderOrder=e.renderOrder,l.z=r,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,n,s,r,a,o){const l=this.getNextRenderItem(e,t,n,s,r,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(sF(n)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,n,s,r,a,o){const l=this.getNextRenderItem(e,t,n,s,r,a,o);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(sF(n)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||_Z),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||iF),this.transparent.length>1&&this.transparent.sort(t||iF)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const Ab=[];class SZ{constructor(e){this.lighting=e,this.lists=new hu}get(e,t){const n=this.lists;Ab[0]=e,Ab[1]=t;let s=n.get(Ab);return s===void 0&&(s=new bZ(this.lighting,e,t),n.set(Ab,s)),Ab.length=0,s}dispose(){this.lists=new hu}}let TZ=0;class AZ{constructor(){this.id=TZ++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new mn,this.scissor=!1,this.scissorValue=new mn,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return t6(this)}}function t6(i){const{textures:e,activeCubeFace:t,activeMipmapLevel:n}=i,s=[t,n];for(const r of e)s.push(r.id);return T0(s)}const Eb=[],EZ=new Qf,MZ=new cv;class CZ{constructor(){this.chainMaps={}}get(e,t,n=null){Eb[0]=e,Eb[1]=t;let s;if(n===null)s="default";else{const o=n.texture.format;s=`${n.textures.length}:${o}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const r=this._getChainMap(s);let a=r.get(Eb);return a===void 0&&(a=new AZ,r.set(Eb,a)),Eb.length=0,n!==null&&(a.sampleCount=n.samples===0?1:n.samples),a}getForClear(e=null){return this.get(EZ,MZ,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new hu)}dispose(){this.chainMaps={}}}const RZ=new Q;class wZ extends rm{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),s=e.samples===0?1:e.samples,r=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>t,u=o.height>>t;let f=e.depthTexture||r[t];const p=e.depthBuffer===!0||e.stencilBuffer===!0;let x=!1;f===void 0&&p&&(f=new Bo,f.format=e.stencilBuffer?wo:Ro,f.type=e.stencilBuffer?Co:Xi,f.image.width=l,f.image.height=u,f.image.depth=o.depth,f.renderTarget=e,f.isArrayTexture=e.multiview===!0&&o.depth>1,r[t]=f),(n.width!==o.width||o.height!==n.height)&&(x=!0,f&&(f.needsUpdate=!0,f.image.width=l,f.image.height=u,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=f||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==s&&(x=!0,f&&(f.needsUpdate=!0),n.sampleCount=s);const y={sampleCount:s};if(e.isXRRenderTarget!==!0){for(let _=0;_<a.length;_++){const T=a[_];x&&(T.needsUpdate=!0),this.updateTexture(T,y)}f&&this.updateTexture(f,y)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,r=this.backend;if(s&&n.initialized===!0&&r.destroyTexture(e),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=ss}const{width:a,height:o,depth:l}=this.getSize(e);if(t.width=a,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,s||e.isStorageTexture===!0||e.isExternalTexture===!0)r.createTexture(e,t),n.generation=e.version;else if(e.version>0){const u=e.image;if(u===void 0)De("Renderer: Texture marked for update but image is undefined.");else if(u.complete===!1)De("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const x of e.images)p.push(x);t.images=p}else t.image=u;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(r.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&r.updateTexture(e,t);const f=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!f&&r.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else r.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&yn.getTransfer(e.colorSpace)!==qt&&De("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=RZ){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let s;return e.mipmaps.length>0?s=e.mipmaps.length:e.isCompressedTexture===!0?s=1:s=Math.floor(Math.log2(Math.max(t,n)))+1,s}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),n=t.textures,s=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let r=0;r<n.length;r++)this._destroyTexture(n[r]);s&&this._destroyTexture(s),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}}class eU extends Bt{constructor(e,t,n,s=1){super(e,t,n),this.a=s}set(e,t,n,s=1){return this.a=s,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class tU extends Hi{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),s=e.getStructTypeNode(n);let r;return s!==null?r=s.getMemberType(e,t):(nt(`TSL: Member "${t}" not found in struct "${n}".`),r="float"),r}getHash(){return this.uuid}generate(){return this.name}}const NZ=(i,e)=>Ke(new tU(i,e));class n6 extends jt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e){return e.isNode!==!0?(nt("TSL: Invalid node added to stack."),this):(this.nodes.push(e),this)}If(e,t){const n=new Ty(t);return this._currentCond=Rr(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new Ty(t),s=Rr(e,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new Ty(e),this}Switch(e){return this._expressionNode=Ke(e),this}Case(...e){const t=[];if(e.length>=2)for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(Ke(e[o])));else nt("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],s=new Ty(n);let r=t[0];for(let o=1;o<t.length;o++)r=r.or(t[o]);const a=Rr(r,s);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const s of this.getChildren())s.isVarNode&&s.intent===!0&&s.isAssign(e)!==!0||(t["node"+n++]=s);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const n=VD();DS(this),e.setActiveStack(this);const s=e.buildStage;for(const a of this.nodes)if(!(a.isVarNode&&a.intent===!0&&a.isAssign(e)!==!0)){if(s==="setup")a.build(e);else if(s==="analyze")a.build(e,this);else if(s==="generate"){const o=e.getDataFromNode(a,"any").stages,l=o&&o[e.shaderStage];if(a.isVarNode&&l&&l.length===1&&l[0]&&l[0].isStackNode)continue;a.build(e,"void")}}let r;return this.hasOutput?r=this.outputNode.build(e,...t):r=super.build(e,...t),DS(n),e.removeActiveStack(this),r}}const rM=En(n6).setParameterLength(0,1);function BZ(i){return Object.entries(i).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class i6 extends jt{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=BZ(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const t=Float32Array.BYTES_PER_ELEMENT;let n=0;for(const s of this.membersLayout){const r=s.type,a=YV(r)*t,o=jV(r),l=n%8,u=l%o,f=l+u;n+=u,f!==0&&8-f<a&&(n+=8-f),n+=a}return Math.ceil(n/8)*8/t}getMemberType(e,t){const n=this.membersLayout.find(s=>s.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class s6 extends jt{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,s=e.getPropertyName(t);return e.addLineFlowCode(`${s} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const DZ=(i,e=null)=>{const t=new i6(i,e),n=(...s)=>{let r=null;if(s.length>0)if(s[0].isNode){r={};const a=Object.keys(i);for(let o=0;o<s.length;o++)r[a[o]]=s[o]}else r=s[0];return Ke(new s6(t,r))};return n.layout=t,n.isStruct=!0,n};class nU extends jt{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const n=this.members,s=[];for(let r=0;r<n.length;r++){const a="m"+r,o=n[r].getNodeType(e);s.push({name:a,type:o,index:r})}t.membersLayout=s,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,s=t!==""?t+".":"";for(let r=0;r<n.length;r++){const a=n[r].build(e);e.addLineFlowCode(`${s}m${r} = ${a}`,this)}return t}}const OZ=En(nU);function r6(i,e){for(let t=0;t<i.length;t++)if(i[t].name===e)return t;return-1}class a6 extends nU{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return o6(t)}setup(e){const t=this.outputNodes,n=e.renderer.getRenderTarget(),s=[],r=n.textures;for(const a in t){const o=r6(r,a);s[o]=Vt(t[a])}return this.members=s,super.setup(e)}}const o6=En(a6);class Tv extends js{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const s=this.valueNode.getNodeType(e);n=e.getTypeLength(s)===1?this.inputType:e.changeComponentType(s,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const UZ=St(Tv).setParameterLength(2),LZ=i=>new Tv(i,"int","float"),IZ=i=>new Tv(i,"uint","float"),PZ=i=>new Tv(i,"float","int"),FZ=i=>new Tv(i,"float","uint"),GZ=ye(([i])=>{const e=i.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),EN=(i,e)=>pc(Cn(4,i.mul(ri(1,i))),e),zZ=(i,e)=>i.lessThan(.5)?EN(i.mul(2),e).div(2):ri(1,EN(Cn(ri(1,i),2),e).div(2)),VZ=(i,e,t)=>pc(Dl(pc(i,e),gr(pc(i,e),pc(ri(1,i),t))),1/e),HZ=(i,e)=>jo(MM.mul(e.mul(i).sub(1))).div(MM.mul(e.mul(i).sub(1))),Af=ye(([i])=>i.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),kZ=ye(([i])=>de(Af(i.z.add(Af(i.y.mul(1)))),Af(i.z.add(Af(i.x.mul(1)))),Af(i.y.add(Af(i.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),WZ=ye(([i,e,t])=>{const n=de(i).toVar(),s=j(1.4).toVar(),r=j(0).toVar(),a=de(n).toVar();return Vi({start:j(0),end:j(3),type:"float",condition:"<="},()=>{const o=de(kZ(a.mul(2))).toVar();n.addAssign(o.add(t.mul(j(.1).mul(e)))),a.mulAssign(1.8),s.mulAssign(1.5),n.mulAssign(1.2);const l=j(Af(n.z.add(Af(n.x.add(Af(n.y)))))).toVar();r.addAssign(l.div(s)),a.addAssign(.14)}),r}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class l6 extends jt{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let n=this._candidateFn;if(n===null){let s=null,r=-1;for(const a of this.functionNodes){const l=a.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=l.inputs;if(t.length===u.length){let f=0;for(let p=0;p<t.length;p++){const x=t[p],y=u[p];x.getNodeType(e)===y.type&&f++}f>r&&(s=a,r=f)}}this._candidateFn=n=s}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const XZ=En(l6),ba=i=>(...e)=>XZ(i,...e),Av=rn(0).setGroup(ln).onRenderUpdate(i=>i.time),qZ=rn(0).setGroup(ln).onRenderUpdate(i=>i.deltaTime),c6=rn(0,"uint").setGroup(ln).onRenderUpdate(i=>i.frameId),YZ=(i=Av)=>i.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),jZ=(i=Av)=>i.fract().round(),$Z=(i=Av)=>i.add(.5).fract().mul(2).sub(1).abs(),KZ=(i=Av)=>i.fract(),JZ=ye(([i,e,t=Je(.5)])=>jT(i.sub(t),e).add(t)),ZZ=ye(([i,e,t=Je(.5)])=>{const n=i.sub(t),s=n.dot(n),a=s.mul(s).mul(e);return i.add(n.mul(a))}),QZ=ye(({position:i=null,horizontal:e=!0,vertical:t=!1})=>{let n;i!==null?(n=mc.toVar(),n[3][0]=i.x,n[3][1]=i.y,n[3][2]=i.z):n=mc;const s=Pl.mul(n);return BS(e)&&(s[0][0]=mc[0].length(),s[0][1]=0,s[0][2]=0),BS(t)&&(s[1][0]=0,s[1][1]=mc[1].length(),s[1][2]=0),s[2][0]=0,s[2][1]=0,s[2][2]=1,lc.mul(s).mul(tr)}),eQ=ye(([i=null])=>{const e=qy();return qy(zO(i)).sub(e).lessThan(0).select(If,i)});class u6 extends jt{static get type(){return"SpriteSheetUVNode"}constructor(e,t=ji(),n=j(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:s,height:r}=n,a=e.mod(s.mul(r)).floor(),o=a.mod(s),l=r.sub(a.add(1).div(s).ceil()),u=n.reciprocal(),f=Je(o,l);return t.add(f).mul(u)}}const tQ=En(u6).setParameterLength(3),d6=ye(([i,e=null,t=null,n=j(1),s=tr,r=tl])=>{let a=r.abs().normalize();a=a.div(a.dot(de(1)));const o=s.yz.mul(n),l=s.zx.mul(n),u=s.xy.mul(n),f=i.value,p=e!==null?e.value:f,x=t!==null?t.value:f,y=kn(f,o).mul(a.x),_=kn(p,l).mul(a.y),T=kn(x,u).mul(a.z);return gr(y,_,T)}),nQ=(...i)=>d6(...i),ey=new iu,fg=new Q,ty=new Q,Lw=new Q,Mb=new Yt,SE=new Q(0,0,-1),td=new mn,Cb=new Q,TE=new Q,Rb=new mn,AE=new Ze,BM=new bc,iQ=If.flipX();BM.depthTexture=new Bo(1,1);let EE=!1;class T3 extends fu{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||BM.texture,iQ),this._reflectorBaseNode=e.reflector||new sQ(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Ke(new T3({defaultTexture:BM.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class sQ extends jt{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new mi,resolutionScale:s=1,generateMipmaps:r=!1,bounces:a=!0,depth:o=!1,samples:l=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=s,t.resolution!==void 0&&(qi('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=r,this.bounces=a,this.depth=o,this.samples=l,this.updateBeforeType=a?Bn.RENDER:Bn.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const n=this.resolutionScale;t.getDrawingBufferSize(AE),e.setSize(Math.round(AE.width*n),Math.round(AE.height*n))}setup(e){return this._updateResolution(BM,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new bc(0,0,{type:Ai,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=_S,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new Bo),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&EE)return!1;EE=!0;const{scene:t,camera:n,renderer:s,material:r}=e,{target:a}=this,o=this.getVirtualCamera(n),l=this.getRenderTarget(o);s.getDrawingBufferSize(AE),this._updateResolution(l,s),ty.setFromMatrixPosition(a.matrixWorld),Lw.setFromMatrixPosition(n.matrixWorld),Mb.extractRotation(a.matrixWorld),fg.set(0,0,1),fg.applyMatrix4(Mb),Cb.subVectors(ty,Lw);const u=Cb.dot(fg)>0;let f=!1;if(u===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){EE=!1;return}f=!0}Cb.reflect(fg).negate(),Cb.add(ty),Mb.extractRotation(n.matrixWorld),SE.set(0,0,-1),SE.applyMatrix4(Mb),SE.add(Lw),TE.subVectors(ty,SE),TE.reflect(fg).negate(),TE.add(ty),o.coordinateSystem=n.coordinateSystem,o.position.copy(Cb),o.up.set(0,1,0),o.up.applyMatrix4(Mb),o.up.reflect(fg),o.lookAt(TE),o.near=n.near,o.far=n.far,o.updateMatrixWorld(),o.projectionMatrix.copy(n.projectionMatrix),ey.setFromNormalAndCoplanarPoint(fg,ty),ey.applyMatrix4(o.matrixWorldInverse),td.set(ey.normal.x,ey.normal.y,ey.normal.z,ey.constant);const p=o.projectionMatrix;Rb.x=(Math.sign(td.x)+p.elements[8])/p.elements[0],Rb.y=(Math.sign(td.y)+p.elements[9])/p.elements[5],Rb.z=-1,Rb.w=(1+p.elements[10])/p.elements[14],td.multiplyScalar(1/td.dot(Rb));const x=0;p.elements[2]=td.x,p.elements[6]=td.y,p.elements[10]=s.coordinateSystem===Nl?td.z-x:td.z+1-x,p.elements[14]=td.w,this.textureNode.value=l.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=l.depthTexture),r.visible=!1;const y=s.getRenderTarget(),_=s.getMRT(),T=s.autoClear;s.setMRT(null),s.setRenderTarget(l),s.autoClear=!0;const A=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",f?(s.clear(),this.hasOutput=!1):(s.render(t,o),this.hasOutput=!0),t.name=A,s.setMRT(_),s.setRenderTarget(y),s.autoClear=T,r.visible=!0,EE=!1,this.forceUpdate=!1}get resolution(){return qi('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){qi('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const rQ=i=>Ke(new T3(i)),Iw=new Ac(-1,1,1,-1,0,1);class aQ extends Fn{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new an([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new an(t,2))}}const oQ=new aQ;class Ev extends Ui{constructor(e=null){super(oQ,e),this.camera=Iw,this.isQuadMesh=!0}async renderAsync(e){qi('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,Iw)}render(e){e.render(this,Iw)}}const lQ=new Ze;class f6 extends fu{static get type(){return"RTTNode"}constructor(e,t=null,n=null,s={type:Ai}){const r=new bc(t,n,s);super(r.texture,ji()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=r,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Ev(new ys),this.updateBeforeType=Bn.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,s=t*this.pixelRatio;this.renderTarget.setSize(n,s),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const s=e.getPixelRatio(),r=e.getSize(lQ),a=Math.floor(r.width*s),o=Math.floor(r.height*s);(a!==this.renderTarget.width||o!==this.renderTarget.height)&&(this.renderTarget.setSize(a,o),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){const e=new fu(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const h6=(i,...e)=>Ke(new f6(Ke(i),...e)),cQ=(i,...e)=>i.isSampleNode||i.isTextureNode?i:i.isPassNode?i.getTextureNode():h6(i,...e),vy=ye(([i,e,t],n)=>{let s;n.renderer.coordinateSystem===Nl?(i=Je(i.x,i.y.oneMinus()).mul(2).sub(1),s=Vt(de(i,e),1)):s=Vt(de(i.x,i.y.oneMinus(),e).mul(2).sub(1),1);const r=Vt(t.mul(s));return r.xyz.div(r.w)}),uQ=ye(([i,e])=>{const t=e.mul(Vt(i,1)),n=t.xy.div(t.w).mul(.5).add(.5).toVar();return Je(n.x,n.y.oneMinus())}),dQ=ye(([i,e,t])=>{const n=Lf(Xs(e)),s=Gr(i.mul(n)).toVar(),r=Xs(e,s).toVar(),a=Xs(e,s.sub(Gr(2,0))).toVar(),o=Xs(e,s.sub(Gr(1,0))).toVar(),l=Xs(e,s.add(Gr(1,0))).toVar(),u=Xs(e,s.add(Gr(2,0))).toVar(),f=Xs(e,s.add(Gr(0,2))).toVar(),p=Xs(e,s.add(Gr(0,1))).toVar(),x=Xs(e,s.sub(Gr(0,1))).toVar(),y=Xs(e,s.sub(Gr(0,2))).toVar(),_=ds(ri(j(2).mul(o).sub(a),r)).toVar(),T=ds(ri(j(2).mul(l).sub(u),r)).toVar(),A=ds(ri(j(2).mul(p).sub(f),r)).toVar(),S=ds(ri(j(2).mul(x).sub(y),r)).toVar(),C=vy(i,r,t).toVar(),w=_.lessThan(T).select(C.sub(vy(i.sub(Je(j(1).div(n.x),0)),o,t)),C.negate().add(vy(i.add(Je(j(1).div(n.x),0)),l,t))),B=A.lessThan(S).select(C.sub(vy(i.add(Je(0,j(1).div(n.y))),p,t)),C.negate().add(vy(i.sub(Je(0,j(1).div(n.y))),x,t)));return Zo(o0(w,B))}),fQ=ye(([i])=>uu(j(52.9829189).mul(uu(du(i,Je(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});class hQ extends jt{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(ji())}sample(e){return this.callback(e)}}const pQ=(i,e=null)=>Ke(new hQ(i,Ke(e)));class To extends jt{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===To.OBJECT?this.updateType=Bn.OBJECT:e===To.MATERIAL?this.updateType=Bn.RENDER:e===To.BEFORE_OBJECT?this.updateBeforeType=Bn.OBJECT:e===To.BEFORE_MATERIAL&&(this.updateBeforeType=Bn.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}To.OBJECT="object";To.MATERIAL="material";To.BEFORE_OBJECT="beforeObject";To.BEFORE_MATERIAL="beforeMaterial";const A3=(i,e)=>Ke(new To(i,e)).toStack(),mQ=i=>A3(To.OBJECT,i),gQ=i=>A3(To.MATERIAL,i),xQ=i=>A3(To.BEFORE_OBJECT,i),yQ=i=>A3(To.BEFORE_MATERIAL,i);class p6 extends Jo{constructor(e,t,n=Float32Array){const s=ArrayBuffer.isView(e)?e:new n(e*t);super(s,t),this.isStorageInstancedBufferAttribute=!0}}class iU extends li{constructor(e,t,n=Float32Array){const s=ArrayBuffer.isView(e)?e:new n(e*t);super(s,t),this.isStorageBufferAttribute=!0}}const vQ=(i,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=NS("float")):(t=ND(e),n=NS(e));const s=new iU(i,t,n);return Fg(s,e,i)},_Q=(i,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=NS("float")):(t=ND(e),n=NS(e));const s=new p6(i,t,n);return Fg(s,e,i)};class m6 extends jt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const bQ=Rt(m6),wb=new Wa,Pw=new Yt;class Ao extends jt{static get type(){return"SceneNode"}constructor(e=Ao.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let s;return t===Ao.BACKGROUND_BLURRINESS?s=is("backgroundBlurriness","float",n):t===Ao.BACKGROUND_INTENSITY?s=is("backgroundIntensity","float",n):t===Ao.BACKGROUND_ROTATION?s=rn("mat4").setName("backgroundRotation").setGroup(ln).onRenderUpdate(()=>{const r=n.background;return r!==null&&r.isTexture&&r.mapping!==Td?(wb.copy(n.backgroundRotation),wb.x*=-1,wb.y*=-1,wb.z*=-1,Pw.makeRotationFromEuler(wb)):Pw.identity(),Pw}):nt("SceneNode: Unknown scope:",t),s}}Ao.BACKGROUND_BLURRINESS="backgroundBlurriness";Ao.BACKGROUND_INTENSITY="backgroundIntensity";Ao.BACKGROUND_ROTATION="backgroundRotation";const g6=Rt(Ao,Ao.BACKGROUND_BLURRINESS),MN=Rt(Ao,Ao.BACKGROUND_INTENSITY),x6=Rt(Ao,Ao.BACKGROUND_ROTATION);class y6 extends fu{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=la.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return this.storeNode!==null?n=this.generateStore(e):n=super.generate(e,t),n}toReadWrite(){return this.setAccess(la.READ_WRITE)}toReadOnly(){return this.setAccess(la.READ_ONLY)}toWriteOnly(){return this.setAccess(la.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:s,depthNode:r}=t,a=super.generate(e,"property"),o=n.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),l=s.build(e,"vec4"),u=r?r.build(e,"int"):null,f=e.generateTextureStore(e,a,o,u,l);e.addLineFlowCode(f,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const v6=En(y6).setParameterLength(1,3),SQ=(i,e,t)=>{const n=v6(i,e,t);return t!==null&&n.toStack(),n},TQ=ye(({texture:i,uv:e})=>{const n=de().toVar();return sn(e.x.lessThan(1e-4),()=>{n.assign(de(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(de(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(de(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(de(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(de(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(de(0,0,-1))}).Else(()=>{const r=i.sample(e.add(de(-.01,0,0))).r.sub(i.sample(e.add(de(.01,0,0))).r),a=i.sample(e.add(de(0,-.01,0))).r.sub(i.sample(e.add(de(0,.01,0))).r),o=i.sample(e.add(de(0,0,-.01))).r.sub(i.sample(e.add(de(0,0,.01))).r);n.assign(de(r,a,o))}),n.normalize()});class _6 extends fu{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return de(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(oe(Lf(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return TQ({texture:this,uv:e})}}const b6=En(_6).setParameterLength(1,3);class S6 extends XT{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const AQ=(i,e,t)=>Ke(new S6(i,e,t)),rF=new WeakMap;class EQ extends js{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Bn.OBJECT,this.updateAfterType=Bn.OBJECT,this.previousModelWorldMatrix=rn(new Yt),this.previousProjectionMatrix=rn(new Yt).setGroup(ln),this.previousCameraViewMatrix=rn(new Yt)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const s=aF(n);this.previousModelWorldMatrix.value.copy(s);const r=T6(t);r.frameId!==e&&(r.frameId=e,r.previousProjectionMatrix===void 0?(r.previousProjectionMatrix=new Yt,r.previousCameraViewMatrix=new Yt,r.currentProjectionMatrix=new Yt,r.currentCameraViewMatrix=new Yt,r.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(r.previousProjectionMatrix.copy(r.currentProjectionMatrix),r.previousCameraViewMatrix.copy(r.currentCameraViewMatrix)),r.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(r.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(r.previousCameraViewMatrix))}updateAfter({object:e}){aF(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?lc:rn(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(Wf).mul(tr),s=this.previousProjectionMatrix.mul(t).mul(RM),r=n.xy.div(n.w),a=s.xy.div(s.w);return ri(r,a)}}function T6(i){let e=rF.get(i);return e===void 0&&(e={},rF.set(i,e)),e}function aF(i,e=0){const t=T6(i);let n=t[e];return n===void 0&&(t[e]=n=new Yt,t[e].copy(i.matrixWorld)),n}const MQ=Rt(EQ),CQ=ye(([i])=>sU(i.rgb)),RQ=ye(([i,e=j(1)])=>e.mix(sU(i.rgb),i.rgb)),wQ=ye(([i,e=j(1)])=>{const t=gr(i.r,i.g,i.b).div(3),n=i.r.max(i.g.max(i.b)),s=n.sub(t).mul(e).mul(-3);return Si(i.rgb,n,s)}),NQ=ye(([i,e=j(1)])=>{const t=de(.57735,.57735,.57735),n=e.cos();return de(i.rgb.mul(n).add(t.cross(i.rgb).mul(e.sin()).add(t.mul(du(t,i.rgb).mul(n.oneMinus())))))}),sU=(i,e=de(yn.getLuminanceCoefficients(new Q)))=>du(i,e),BQ=ye(([i,e=de(1),t=de(0),n=de(1),s=j(1),r=de(yn.getLuminanceCoefficients(new Q,Qo))])=>{const a=i.rgb.dot(de(r)),o=Ts(i.rgb.mul(e).add(t),0).toVar(),l=o.pow(n).toVar();return sn(o.r.greaterThan(0),()=>{o.r.assign(l.r)}),sn(o.g.greaterThan(0),()=>{o.g.assign(l.g)}),sn(o.b.greaterThan(0),()=>{o.b.assign(l.b)}),o.assign(a.add(o.sub(a).mul(s))),Vt(o.rgb,i.a)});class A6 extends js{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const DQ=En(A6).setParameterLength(2),ME=new Ze;class E6 extends fu{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class oF extends E6{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class pu extends js{static get type(){return"PassNode"}constructor(e,t,n,s={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const r=new Bo;r.isRenderTargetTexture=!0,r.name="depth";const a=new bc(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ai,...s});a.texture.name="output",a.depthTexture=r,this.renderTarget=a,this._textures={output:a.texture,depth:r},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=rn(0),this._cameraFar=rn(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Bn.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return De("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return De("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=Ke(new oF(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=Ke(new oF(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=t=HO(this.getTextureNode(e),n,s)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,s=this._cameraFar,r=this.getViewZNode(e);this._linearDepthNodes[e]=t=Uy(r,n,s)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===pu.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let s,r;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(r=1,s=t.xr.getCamera(),t.xr.updateCamera(s),ME.set(a.width,a.height)):(s=this.camera,r=t.getPixelRatio(),t.getSize(ME)),this._pixelRatio=r,this.setSize(ME.width,ME.height);const o=t.getRenderTarget(),l=t.getMRT(),u=t.autoClear,f=s.layers.mask;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const x in this._previousTextures)this.toggleTexture(x);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0;const p=n.name;n.name=this.name?this.name:n.name,t.render(n,s),n.name=p,t.setRenderTarget(o),t.setMRT(l),t.autoClear=u,s.layers.mask=f}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),s=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,s){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new mn),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,s){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new mn),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}pu.COLOR="color";pu.DEPTH="depth";const OQ=(i,e,t)=>Ke(new pu(pu.COLOR,i,e,t)),UQ=(i,e)=>Ke(new E6(i,e)),LQ=(i,e,t)=>Ke(new pu(pu.DEPTH,i,e,t));class M6 extends pu{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,s,r){super(pu.COLOR,e,t),this.colorNode=n,this.thicknessNode=s,this.alphaNode=r,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((s,r,a,o,l,u,f,p)=>{if((l.isMeshToonMaterial||l.isMeshToonNodeMaterial)&&l.wireframe===!1){const x=this._getOutlineMaterial(l);t.renderObject(s,r,a,o,x,u,f,p)}t.renderObject(s,r,a,o,l,u,f,p)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new ys;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=Yi;const t=tl.negate(),n=lc.mul(Wf),s=j(1),r=n.mul(Vt(tr,1)),a=n.mul(Vt(tr.add(t),1)),o=Zo(r.sub(a));return e.vertexNode=r.add(o.mul(this.thicknessNode).mul(r.w).mul(s)),e.colorNode=Vt(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const IQ=(i,e,t=new Bt(0,0,0),n=.003,s=1)=>Ke(new M6(i,e,Ke(t),Ke(n),Ke(s))),C6=ye(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),R6=ye(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),w6=ye(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),PQ=ye(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),N6=ye(([i,e])=>{const t=qa(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=qa(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=PQ(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),FQ=qa(de(1.6605,-.1246,-.0182),de(-.5876,1.1329,-.1006),de(-.0728,-.0083,1.1187)),GQ=qa(de(.6274,.0691,.0164),de(.3293,.9195,.088),de(.0433,.0113,.8956)),zQ=ye(([i])=>{const e=de(i).toVar(),t=de(e.mul(e)).toVar(),n=de(t.mul(t)).toVar();return j(15.5).mul(n.mul(t)).sub(Cn(40.14,n.mul(e))).add(Cn(31.96,n).sub(Cn(6.868,t.mul(e))).add(Cn(.4298,t).add(Cn(.1191,e).sub(.00232))))}),B6=ye(([i,e])=>{const t=de(i).toVar(),n=qa(de(.856627153315983,.137318972929847,.11189821299995),de(.0951212405381588,.761241990602591,.0767994186031903),de(.0482516061458583,.101439036467562,.811302368396859)),s=qa(de(1.1271005818144368,-.1413297634984383,-.14132976349843826),de(-.11060664309660323,1.157823702216272,-.11060664309660294),de(-.016493938717834573,-.016493938717834257,1.2519364065950405)),r=j(-12.47393),a=j(4.026069);return t.mulAssign(e),t.assign(GQ.mul(t)),t.assign(n.mul(t)),t.assign(Ts(t,1e-10)),t.assign(xd(t)),t.assign(t.sub(r).div(a.sub(r))),t.assign(_c(t,0,1)),t.assign(zQ(t)),t.assign(s.mul(t)),t.assign(pc(Ts(de(0),t),de(2.2))),t.assign(FQ.mul(t)),t.assign(_c(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),D6=ye(([i,e])=>{const t=j(.76),n=j(.15);i=i.mul(e);const s=el(i.r,el(i.g,i.b)),r=Rr(s.lessThan(.08),s.sub(Cn(6.25,s.mul(s))),.04);i.subAssign(r);const a=Ts(i.r,Ts(i.g,i.b));sn(a.lessThan(t),()=>i);const o=ri(1,t),l=ri(1,o.mul(o).div(a.add(o.sub(t))));i.mulAssign(l.div(a));const u=ri(1,Dl(1,n.mul(a.sub(l)).add(1)));return Si(i,de(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Fr extends jt{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const s of t)s.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const E3=En(Fr).setParameterLength(1,3),VQ=(i,e)=>E3(i,e,"js"),HQ=(i,e)=>E3(i,e,"wgsl"),kQ=(i,e)=>E3(i,e,"glsl");class rU extends Fr{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),s=n.name,r=n.type,a=e.getCodeFromNode(this,r);s!==""&&(a.name=s);const o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return a.code=l+`
`,t==="property"?o:e.format(`${o}()`,r,t)}}const O6=(i,e=[],t="")=>{for(let r=0;r<e.length;r++){const a=e[r];typeof a=="function"&&(e[r]=a.functionNode)}const n=Ke(new rU(i,e,t)),s=(...r)=>n.call(...r);return s.functionNode=n,s},WQ=(i,e)=>O6(i,e,"glsl"),XQ=(i,e)=>O6(i,e,"wgsl");class U6 extends jt{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new Oo,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:j()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=DD(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=OD(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const aM=En(U6).setParameterLength(1);class L6 extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(t!==null){const s=t(...n);return this.set(e,s),s}}}class qQ{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const oM=new L6;class I6 extends jt{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new L6,this._output=aM(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return n[e]===void 0?n[e]=aM(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):n[e]===void 0?(n[e]=aM(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const s=this.getObject()[e];if(typeof s=="function")return s(...t)}async callAsync(e,...t){const s=this.getObject()[e];if(typeof s=="function")return s.constructor.name==="AsyncFunction"?await s(...t):s(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,f)=>this.setOutput(u,f),n=new qQ(this),s=oM.get("THREE"),r=oM.get("TSL"),a=this.getMethod(),o=[n,this._local,oM,e,t,s,r];this._object=a(...o);const l=this._object.layout;if(l&&(l.cache===!1&&this._local.clear(),this._output.outputType=l.outputType||null,Array.isArray(l.elements)))for(const u of l.elements){const f=u.id||u.name;u.inputType&&(this.getParameter(f)===void 0&&this.setParameter(f,null),this.getParameter(f).inputType=u.inputType),u.outputType&&(this.getOutput(f)===void 0&&this.setOutput(f,null),this.getOutput(f).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let n=this.parameters[t];n.isScriptableNode&&(n=n.getDefaultOutput()),n.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:j()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],n=["layout","init","main","dispose"].join(", "),s="var "+n+`; var output = {};
`,r=`
return { ...output, `+n+" };",a=s+this.codeNode.code+r;return this._method=new Function(...e,a),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[yv(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return T0(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const YQ=En(I6).setParameterLength(1,2);function P6(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||nr.z).negate()}const aU=ye(([i,e],t)=>{const n=P6(t);return Ol(i,e,n)}),oU=ye(([i],e)=>{const t=P6(e);return i.mul(i,t,t).negate().exp().oneMinus()}),zS=ye(([i,e])=>Vt(e.toFloat().mix(Ny.rgb,i.toVec3()),Ny.a));function jQ(i,e,t){return De('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),zS(i,aU(e,t))}function $Q(i,e){return De('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),zS(i,oU(e))}let hg=null,pg=null;class F6 extends jt{static get type(){return"RangeNode"}constructor(e=j(),t=j()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),s=e.getTypeLength(Df(t.value)),r=e.getTypeLength(Df(n.value));return s>r?s:r}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(n=>{n.isConstNode===!0&&(t=n)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let n=null;if(t.count>1){const s=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),a=s.value,o=r.value,l=e.getTypeLength(Df(a)),u=e.getTypeLength(Df(o));hg=hg||new mn,pg=pg||new mn,hg.setScalar(0),pg.setScalar(0),l===1?hg.setScalar(a):a.isColor?hg.set(a.r,a.g,a.b,1):hg.set(a.x,a.y,a.z||0,a.w||0),u===1?pg.setScalar(o):o.isColor?pg.set(o.r,o.g,o.b,1):pg.set(o.x,o.y,o.z||0,o.w||0);const f=4,p=f*t.count,x=new Float32Array(p);for(let _=0;_<p;_++){const T=_%f,A=hg.getComponent(T),S=pg.getComponent(T);x[_]=ov.lerp(A,S,Math.random())}const y=this.getNodeType(e);if(t.count<=4096)n=kT(x,"vec4",t.count).element(pp).convert(y);else{const _=new Jo(x,4);e.geometry.setAttribute("__range"+this.id,_),n=CM(_).convert(y)}}else n=j(0);return n}}const KQ=En(F6).setParameterLength(2);class JQ extends jt{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),s=this.getNodeType(e);return e.shaderStage==="compute"?e.format(n,s,t):(De(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(s))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const $T=(i,e)=>Ke(new JQ(i,e)),ZQ=$T("numWorkgroups","uvec3"),QQ=$T("workgroupId","uvec3"),eee=$T("globalId","uvec3"),tee=$T("localId","uvec3"),nee=$T("subgroupSize","uint");class iee extends jt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const lU=En(iee),see=()=>lU("workgroup").toStack(),ree=()=>lU("storage").toStack(),aee=()=>lU("texture").toStack();class oee extends nm{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const s=e.context.assign;if(n=super.generate(e),s!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}class lee extends jt{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return Ke(new oee(this,e))}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const cee=(i,e)=>Ke(new lee("Workgroup",i,e));class qr extends jt{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,s=this.method,r=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,a)}`),l!==null&&u.push(l.build(e,a));const f=`${e.getMethod(s,r)}( ${u.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(f,this);else return t.constNode===void 0&&(t.constNode=kf(f,r).toConst()),t.constNode.build(e)}}qr.ATOMIC_LOAD="atomicLoad";qr.ATOMIC_STORE="atomicStore";qr.ATOMIC_ADD="atomicAdd";qr.ATOMIC_SUB="atomicSub";qr.ATOMIC_MAX="atomicMax";qr.ATOMIC_MIN="atomicMin";qr.ATOMIC_AND="atomicAnd";qr.ATOMIC_OR="atomicOr";qr.ATOMIC_XOR="atomicXor";const uee=En(qr),Od=(i,e,t)=>uee(i,e,t).toStack(),dee=i=>Od(qr.ATOMIC_LOAD,i,null),fee=(i,e)=>Od(qr.ATOMIC_STORE,i,e),hee=(i,e)=>Od(qr.ATOMIC_ADD,i,e),pee=(i,e)=>Od(qr.ATOMIC_SUB,i,e),mee=(i,e)=>Od(qr.ATOMIC_MAX,i,e),gee=(i,e)=>Od(qr.ATOMIC_MIN,i,e),xee=(i,e)=>Od(qr.ATOMIC_AND,i,e),yee=(i,e)=>Od(qr.ATOMIC_OR,i,e),vee=(i,e)=>Od(qr.ATOMIC_XOR,i,e);class Lt extends js{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(n)?0:e.getTypeLength(n);return s>r?t:n}getNodeType(e){const t=this.method;return t===Lt.SUBGROUP_ELECT?"bool":t===Lt.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,s=this.getNodeType(e),r=this.getInputType(e),a=this.aNode,o=this.bNode,l=[];if(n===Lt.SUBGROUP_BROADCAST||n===Lt.SUBGROUP_SHUFFLE||n===Lt.QUAD_BROADCAST){const f=o.getNodeType(e);l.push(a.build(e,s),o.build(e,f==="float"?"int":s))}else n===Lt.SUBGROUP_SHUFFLE_XOR||n===Lt.SUBGROUP_SHUFFLE_DOWN||n===Lt.SUBGROUP_SHUFFLE_UP?l.push(a.build(e,s),o.build(e,"uint")):(a!==null&&l.push(a.build(e,r)),o!==null&&l.push(o.build(e,r)));const u=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(n,s)}${u}`,s,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Lt.SUBGROUP_ELECT="subgroupElect";Lt.SUBGROUP_BALLOT="subgroupBallot";Lt.SUBGROUP_ADD="subgroupAdd";Lt.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Lt.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Lt.SUBGROUP_MUL="subgroupMul";Lt.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Lt.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Lt.SUBGROUP_AND="subgroupAnd";Lt.SUBGROUP_OR="subgroupOr";Lt.SUBGROUP_XOR="subgroupXor";Lt.SUBGROUP_MIN="subgroupMin";Lt.SUBGROUP_MAX="subgroupMax";Lt.SUBGROUP_ALL="subgroupAll";Lt.SUBGROUP_ANY="subgroupAny";Lt.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Lt.QUAD_SWAP_X="quadSwapX";Lt.QUAD_SWAP_Y="quadSwapY";Lt.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Lt.SUBGROUP_BROADCAST="subgroupBroadcast";Lt.SUBGROUP_SHUFFLE="subgroupShuffle";Lt.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Lt.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Lt.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Lt.QUAD_BROADCAST="quadBroadcast";const _ee=St(Lt,Lt.SUBGROUP_ELECT).setParameterLength(0),bee=St(Lt,Lt.SUBGROUP_BALLOT).setParameterLength(1),See=St(Lt,Lt.SUBGROUP_ADD).setParameterLength(1),Tee=St(Lt,Lt.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),Aee=St(Lt,Lt.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),Eee=St(Lt,Lt.SUBGROUP_MUL).setParameterLength(1),Mee=St(Lt,Lt.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),Cee=St(Lt,Lt.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),Ree=St(Lt,Lt.SUBGROUP_AND).setParameterLength(1),wee=St(Lt,Lt.SUBGROUP_OR).setParameterLength(1),Nee=St(Lt,Lt.SUBGROUP_XOR).setParameterLength(1),Bee=St(Lt,Lt.SUBGROUP_MIN).setParameterLength(1),Dee=St(Lt,Lt.SUBGROUP_MAX).setParameterLength(1),Oee=St(Lt,Lt.SUBGROUP_ALL).setParameterLength(0),Uee=St(Lt,Lt.SUBGROUP_ANY).setParameterLength(0),Lee=St(Lt,Lt.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),Iee=St(Lt,Lt.QUAD_SWAP_X).setParameterLength(1),Pee=St(Lt,Lt.QUAD_SWAP_Y).setParameterLength(1),Fee=St(Lt,Lt.QUAD_SWAP_DIAGONAL).setParameterLength(1),Gee=St(Lt,Lt.SUBGROUP_BROADCAST).setParameterLength(2),zee=St(Lt,Lt.SUBGROUP_SHUFFLE).setParameterLength(2),Vee=St(Lt,Lt.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),Hee=St(Lt,Lt.SUBGROUP_SHUFFLE_UP).setParameterLength(2),kee=St(Lt,Lt.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),Wee=St(Lt,Lt.QUAD_BROADCAST).setParameterLength(1);let CE;function M3(i){CE=CE||new WeakMap;let e=CE.get(i);return e===void 0&&CE.set(i,e={}),e}function C3(i){const e=M3(i);return e.shadowMatrix||(e.shadowMatrix=rn("mat4").setGroup(ln).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(i.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(i.shadow.camera.coordinateSystem=t.camera.coordinateSystem,i.shadow.camera.updateProjectionMatrix()),i.shadow.updateMatrices(i)),i.shadow.matrix)))}function G6(i,e=Ml){const t=C3(i).mul(e);return t.xyz.div(t.w)}function cU(i){const e=M3(i);return e.position||(e.position=rn(new Q).setGroup(ln).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function z6(i){const e=M3(i);return e.targetPosition||(e.targetPosition=rn(new Q).setGroup(ln).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function uU(i){const e=M3(i);return e.viewPosition||(e.viewPosition=rn(new Q).setGroup(ln).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new Q,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const dU=i=>Pl.transformDirection(cU(i).sub(z6(i))),Xee=i=>i.sort((e,t)=>e.id-t.id),qee=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},Fw=new WeakMap,Nb=[];class R3 extends jt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ou("vec3","totalDiffuse"),this.totalSpecularNode=ou("vec3","totalSpecular"),this.outgoingLightNode=ou("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const s=e[n];if(Nb.push(s.id),Nb.push(s.castShadow?1:0),s.isSpotLight===!0){const r=s.map!==null?s.map.id:-1,a=s.colorNode?s.colorNode.getCacheKey():-1;Nb.push(r,a)}}const t=T0(Nb);return Nb.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,s=Xee(this._lights),r=e.renderer.library;for(const a of s)if(a.isNode)t.push(Ke(a));else{let o=null;if(n!==null&&(o=qee(a.id,n)),o===null){const l=r.getLightNodeClass(a.constructor);if(l===null){De(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let u=null;Fw.has(a)?u=Fw.get(a):(u=Ke(new l(a)),Fw.set(a,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:s,reflectedLight:r}=e.context;s.direct({...n,lightNode:t,reflectedLight:r},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:s,reflectedLight:r}=e.context;s.directRectArea({...n,lightNode:t,reflectedLight:r},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const s=e.context,r=s.lightingModel,a=e.getNodeProperties(this);if(r){const{totalDiffuseNode:o,totalSpecularNode:l}=this;s.outgoingLight=n;const u=e.addStack();a.nodes=u.nodes,r.start(e);const{backdrop:f,backdropAlpha:p}=s,{directDiffuse:x,directSpecular:y,indirectDiffuse:_,indirectSpecular:T}=s.reflectedLight;let A=x.add(_);f!==null&&(p!==null?A=de(p.mix(A,f)):A=de(f)),o.assign(A),l.assign(y.add(T)),n.assign(o.add(l)),r.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const Yee=(i=[])=>Ke(new R3).setLights(i);class V6 extends jt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Bn.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){fU.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Ml)}}const fU=ou("vec3","shadowPositionWorld");function hU(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new Bt),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function H6(i,e){return e=hU(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function k6(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function pU(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function W6(i,e){return e=pU(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function X6(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function jee(i,e,t={}){return t=hU(i,t),t=pU(e,t),t}function q6(i,e,t){return t=H6(i,t),t=W6(e,t),t}function Y6(i,e,t){k6(i,t),X6(e,t)}var $ee=Object.freeze({__proto__:null,resetRendererAndSceneState:q6,resetRendererState:H6,resetSceneState:W6,restoreRendererAndSceneState:Y6,restoreRendererState:k6,restoreSceneState:X6,saveRendererAndSceneState:jee,saveRendererState:hU,saveSceneState:pU});const lF=new WeakMap,j6=ye(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=kn(i,e.xy).setName("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),$6=ye(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const s=(A,S)=>{let C=kn(i,A);return i.isArrayTexture&&(C=C.depth(n)),C.compare(S)},r=is("mapSize","vec2",t).setGroup(ln),a=is("radius","float",t).setGroup(ln),o=Je(1).div(r),l=o.x.negate().mul(a),u=o.y.negate().mul(a),f=o.x.mul(a),p=o.y.mul(a),x=l.div(2),y=u.div(2),_=f.div(2),T=p.div(2);return gr(s(e.xy.add(Je(l,u)),e.z),s(e.xy.add(Je(0,u)),e.z),s(e.xy.add(Je(f,u)),e.z),s(e.xy.add(Je(x,y)),e.z),s(e.xy.add(Je(0,y)),e.z),s(e.xy.add(Je(_,y)),e.z),s(e.xy.add(Je(l,0)),e.z),s(e.xy.add(Je(x,0)),e.z),s(e.xy,e.z),s(e.xy.add(Je(_,0)),e.z),s(e.xy.add(Je(f,0)),e.z),s(e.xy.add(Je(x,T)),e.z),s(e.xy.add(Je(0,T)),e.z),s(e.xy.add(Je(_,T)),e.z),s(e.xy.add(Je(l,p)),e.z),s(e.xy.add(Je(0,p)),e.z),s(e.xy.add(Je(f,p)),e.z)).mul(1/17)}),K6=ye(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const s=(p,x)=>{let y=kn(i,p);return i.isArrayTexture&&(y=y.depth(n)),y.compare(x)},r=is("mapSize","vec2",t).setGroup(ln),a=Je(1).div(r),o=a.x,l=a.y,u=e.xy,f=uu(u.mul(r).add(.5));return u.subAssign(f.mul(a)),gr(s(u,e.z),s(u.add(Je(o,0)),e.z),s(u.add(Je(0,l)),e.z),s(u.add(a),e.z),Si(s(u.add(Je(o.negate(),0)),e.z),s(u.add(Je(o.mul(2),0)),e.z),f.x),Si(s(u.add(Je(o.negate(),l)),e.z),s(u.add(Je(o.mul(2),l)),e.z),f.x),Si(s(u.add(Je(0,l.negate())),e.z),s(u.add(Je(0,l.mul(2))),e.z),f.y),Si(s(u.add(Je(o,l.negate())),e.z),s(u.add(Je(o,l.mul(2))),e.z),f.y),Si(Si(s(u.add(Je(o.negate(),l.negate())),e.z),s(u.add(Je(o.mul(2),l.negate())),e.z),f.x),Si(s(u.add(Je(o.negate(),l.mul(2))),e.z),s(u.add(Je(o.mul(2),l.mul(2))),e.z),f.x),f.y)).mul(1/9)}),J6=ye(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{const n=j(1).toVar();let s=kn(i).sample(e.xy);i.isArrayTexture&&(s=s.depth(t)),s=s.rg;const r=c3(e.z,s.x);return sn(r.notEqual(j(1)),()=>{const a=e.z.sub(s.x),o=Ts(0,s.y.mul(s.y));let l=o.div(o.add(a.mul(a)));l=_c(ri(l,.3).div(.95-.3)),n.assign(_c(Ts(r,l)))}),n}),Kee=ye(([i,e,t])=>{let n=Ml.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),Jee=i=>{const e=i.shadow.camera,t=is("near","float",e).setGroup(ln),n=is("far","float",e).setGroup(ln),s=X5(i);return Kee(s,t,n)},Z6=i=>{let e=lF.get(i);if(e===void 0){const t=i.isPointLight?Jee(i):null;e=new ys,e.colorNode=Vt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,lF.set(i,e)}return e},cF=new hu,ny=[],Q6=(i,e,t,n)=>{ny[0]=i,ny[1]=e;let s=cF.get(ny);return(s===void 0||s.shadowType!==t||s.useVelocity!==n)&&(s=(r,a,o,l,u,f,...p)=>{(r.castShadow===!0||r.receiveShadow&&t===Fa)&&(n&&(BD(r).useVelocity=!0),r.onBeforeShadow(i,r,o,e.camera,l,a.overrideMaterial,f),i.renderObject(r,a,o,l,u,f,...p),r.onAfterShadow(i,r,o,e.camera,l,a.overrideMaterial,f))},s.shadowType=t,s.useVelocity=n,cF.set(ny,s)),ny[0]=null,ny[1]=null,s},Zee=ye(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:s})=>{const r=j(0).toVar("meanVertical"),a=j(0).toVar("squareMeanVertical"),o=i.lessThanEqual(j(1)).select(j(0),j(2).div(i.sub(1))),l=i.lessThanEqual(j(1)).select(j(0),j(-1));Vi({start:oe(0),end:oe(i),type:"int",condition:"<"},({i:f})=>{const p=l.add(j(f).mul(o));let x=n.sample(gr(WT.xy,Je(0,p).mul(e)).div(t));n.value.isArrayTexture&&(x=x.depth(s)),x=x.x,r.addAssign(x),a.addAssign(x.mul(x))}),r.divAssign(i),a.divAssign(i);const u=$o(a.sub(r.mul(r)));return Je(r,u)}),Qee=ye(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:s})=>{const r=j(0).toVar("meanHorizontal"),a=j(0).toVar("squareMeanHorizontal"),o=i.lessThanEqual(j(1)).select(j(0),j(2).div(i.sub(1))),l=i.lessThanEqual(j(1)).select(j(0),j(-1));Vi({start:oe(0),end:oe(i),type:"int",condition:"<"},({i:f})=>{const p=l.add(j(f).mul(o));let x=n.sample(gr(WT.xy,Je(p,0).mul(e)).div(t));n.value.isArrayTexture&&(x=x.depth(s)),r.addAssign(x.x),a.addAssign(gr(x.y.mul(x.y),x.x.mul(x.x)))}),r.divAssign(i),a.divAssign(i);const u=$o(a.sub(r.mul(r)));return Je(r,u)}),ete=[j6,$6,K6,J6];let Gw;const RE=new Ev;class mU extends V6{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:s,shadow:r,depthLayer:a}){const o=s.x.greaterThanEqual(0).and(s.x.lessThanEqual(1)).and(s.y.greaterThanEqual(0)).and(s.y.lessThanEqual(1)).and(s.z.lessThanEqual(1)),l=t({depthTexture:n,shadowCoord:s,shadow:r,depthLayer:a});return o.select(l,j(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:s}=e,r=is("bias","float",n).setGroup(ln);let a=t,o;if(n.camera.isOrthographicCamera||s.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,s.coordinateSystem===Nl&&(o=o.mul(2).sub(1));else{const l=a.w;a=a.xy.div(l);const u=is("near","float",n.camera).setGroup(ln),f=is("far","float",n.camera).setGroup(ln);o=kO(l.negate(),u,f)}return a=de(a.x,a.y.oneMinus(),o.add(r)),a}getShadowFilterFn(e){return ete[e]}setupRenderTarget(e,t){const n=new Bo(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=rv;const s=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return s.texture.name="ShadowMap",s.texture.type=e.mapType,s.depthTexture=n,{shadowMap:s,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:s,shadow:r}=this,a=t.shadowMap.type,{depthTexture:o,shadowMap:l}=this.setupRenderTarget(r,e);if(r.camera.coordinateSystem=n.coordinateSystem,r.camera.updateProjectionMatrix(),a===Fa&&r.isPointLightShadow!==!0){o.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Al,type:Ai,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Al,type:Ai,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Al,type:Ai,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Al,type:Ai,depthBuffer:!1}));let w=kn(o);o.isArrayTexture&&(w=w.depth(this.depthLayer));let B=kn(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(B=B.depth(this.depthLayer));const L=is("blurSamples","float",r).setGroup(ln),D=is("radius","float",r).setGroup(ln),O=is("mapSize","vec2",r).setGroup(ln);let F=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ys);F.fragmentNode=Zee({samples:L,radius:D,size:O,shadowPass:w,depthLayer:this.depthLayer}).context(e.getSharedContext()),F.name="VSMVertical",F=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ys),F.fragmentNode=Qee({samples:L,radius:D,size:O,shadowPass:B,depthLayer:this.depthLayer}).context(e.getSharedContext()),F.name="VSMHorizontal"}const u=is("intensity","float",r).setGroup(ln),f=is("normalBias","float",r).setGroup(ln),p=C3(s).mul(fU.add(sm.mul(f))),x=this.setupShadowCoord(e,p),y=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(y===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const _=a===Fa&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,T=this.setupShadowFilter(e,{filterFn:y,shadowTexture:l.texture,depthTexture:_,shadowCoord:x,shadow:r,depthLayer:this.depthLayer});let A=kn(l.texture,x);o.isArrayTexture&&(A=A.depth(this.depthLayer));const S=Si(1,T.rgb.mix(A,1),u.mul(A.a)).toVar();this.shadowMap=l,this.shadow.map=l;const C=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return S.toInspector(`${C} / Color`,()=>kn(this.shadowMap.texture)).toInspector(`${C} / Depth`,()=>Xs(this.shadowMap.depthTexture,ji().mul(Lf(kn(this.shadowMap.depthTexture)))).x.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return ye(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&De('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:s}=this,{renderer:r,scene:a}=e;t.updateMatrices(s),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const o=a.name;a.name=`Shadow Map [ ${s.name||"ID: "+s.id} ]`,r.render(a,t.camera),a.name=o}updateShadow(e){const{shadowMap:t,light:n,shadow:s}=this,{renderer:r,scene:a,camera:o}=e,l=r.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const f=s.camera.layers.mask;(s.camera.layers.mask&4294967294)===0&&(s.camera.layers.mask=o.layers.mask);const p=r.getRenderObjectFunction(),x=r.getMRT(),y=x?x.has("velocity"):!1;Gw=q6(r,a,Gw),a.overrideMaterial=Z6(n),r.setRenderObjectFunction(Q6(r,s,l,y)),r.setClearColor(0,0),r.setRenderTarget(t),this.renderShadow(e),r.setRenderObjectFunction(p),l===Fa&&s.isPointLightShadow!==!0&&this.vsmPass(r),s.camera.layers.mask=f,Y6(r,a,Gw)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),RE.material=this.vsmMaterialVertical,RE.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),RE.material=this.vsmMaterialHorizontal,RE.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const ek=(i,e)=>Ke(new mU(i,e)),tte=new Bt,tu=ye(([i,e])=>{const t=i.toVar(),n=ds(t),s=Dl(1,Ts(n.x,Ts(n.y,n.z)));n.mulAssign(s),t.mulAssign(s.mul(e.mul(2).oneMinus()));const r=Je(t.xy).toVar(),o=e.mul(1.5).oneMinus();return sn(n.z.greaterThanEqual(o),()=>{sn(t.z.greaterThan(0),()=>{r.x.assign(ri(4,t.x))})}).ElseIf(n.x.greaterThanEqual(o),()=>{const l=PS(t.x);r.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(n.y.greaterThanEqual(o),()=>{const l=PS(t.y);r.x.assign(t.x.add(l.mul(2)).add(2)),r.y.assign(t.z.mul(l).sub(2))}),Je(.125,.25).mul(r).add(Je(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),tk=ye(({depthTexture:i,bd3D:e,dp:t,texelSize:n})=>kn(i,tu(e,n.y)).compare(t)),nk=ye(({depthTexture:i,bd3D:e,dp:t,texelSize:n,shadow:s})=>{const r=is("radius","float",s).setGroup(ln),a=Je(-1,1).mul(r).mul(n.y);return kn(i,tu(e.add(a.xyy),n.y)).compare(t).add(kn(i,tu(e.add(a.yyy),n.y)).compare(t)).add(kn(i,tu(e.add(a.xyx),n.y)).compare(t)).add(kn(i,tu(e.add(a.yyx),n.y)).compare(t)).add(kn(i,tu(e,n.y)).compare(t)).add(kn(i,tu(e.add(a.xxy),n.y)).compare(t)).add(kn(i,tu(e.add(a.yxy),n.y)).compare(t)).add(kn(i,tu(e.add(a.xxx),n.y)).compare(t)).add(kn(i,tu(e.add(a.yxx),n.y)).compare(t)).mul(1/9)}),nte=ye(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const s=t.xyz.toVar(),r=s.length(),a=rn("float").setGroup(ln).onRenderUpdate(()=>n.camera.near),o=rn("float").setGroup(ln).onRenderUpdate(()=>n.camera.far),l=is("bias","float",n).setGroup(ln),u=rn(n.mapSize).setGroup(ln),f=j(1).toVar();return sn(r.sub(o).lessThanEqual(0).and(r.sub(a).greaterThanEqual(0)),()=>{const p=r.sub(a).div(o.sub(a)).toVar();p.addAssign(l);const x=s.normalize(),y=Je(1).div(u.mul(Je(4,2)));f.assign(i({depthTexture:e,bd3D:x,dp:p,texelSize:y,shadow:n}))}),f}),uF=new mn,iy=new Ze,Bb=new Ze;class ite extends mU{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===oC?tk:nk}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:s,shadowCoord:r,shadow:a}){return nte({filterFn:t,shadowTexture:n,depthTexture:s,shadowCoord:r,shadow:a})}renderShadow(e){const{shadow:t,shadowMap:n,light:s}=this,{renderer:r,scene:a}=e,o=t.getFrameExtents();Bb.copy(t.mapSize),Bb.multiply(o),n.setSize(Bb.width,Bb.height),iy.copy(t.mapSize);const l=r.autoClear,u=r.getClearColor(tte),f=r.getClearAlpha();r.autoClear=!1,r.setClearColor(t.clearColor,t.clearAlpha),r.clear();const p=t.getViewportCount();for(let x=0;x<p;x++){const y=t.getViewport(x),_=iy.x*y.x,T=Bb.y-iy.y-iy.y*y.y;uF.set(_,T,iy.x*y.z,iy.y*y.w),n.viewport.copy(uF),t.updateMatrices(s,x);const A=a.name;a.name=`Point Light Shadow [ ${s.name||"ID: "+s.id} ] - Face ${x+1}`,r.render(a,t.camera),a.name=A}r.autoClear=l,r.setClearColor(u,f)}}const ik=(i,e)=>Ke(new ite(i,e));class am extends A0{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Bt,this.colorNode=e&&e.colorNode||rn(this.color).setGroup(ln),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Bn.FRAME}getHash(){return this.light.uuid}getLightVector(e){return uU(this.light).sub(e.context.positionView||nr)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return ek(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let r;s!==void 0?r=Ke(s):r=this.setupShadowNode(),this.shadowNode=r,this.shadowColorNode=n=this.colorNode.mul(r),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const gU=ye(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),sk=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const s=e.normalize(),r=e.length(),a=gU({lightDistance:r,cutoffDistance:t,decayExponent:n}),o=i.mul(a);return{lightDirection:s,lightColor:o}};class rk extends am{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=rn(0).setGroup(ln),this.decayExponentNode=rn(2).setGroup(ln)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return ik(this.light)}setupDirect(e){return sk({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const ste=ye(([i=ji()])=>{const e=i.mul(2),t=e.x.floor(),n=e.y.floor();return t.add(n).mod(2).sign()}),rte=ye(([i=ji()],{renderer:e,material:t})=>{const n=cO(i.mul(2).sub(1));let s;if(t.alphaToCoverage&&e.currentSamples>0){const r=j(n.fwidth()).toVar();s=Ol(r.oneMinus(),r.add(1),n).oneMinus()}else s=Rr(n.greaterThan(1),0,1);return s}),hS=ye(([i,e,t])=>{const n=j(t).toVar(),s=j(e).toVar(),r=vc(i).toVar();return Rr(r,s,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),DM=ye(([i,e])=>{const t=vc(e).toVar(),n=j(i).toVar();return Rr(t,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),pr=ye(([i])=>{const e=j(i).toVar();return oe(yd(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Rs=ye(([i,e])=>{const t=j(i).toVar();return e.assign(pr(t)),t.sub(j(e))}),ate=ye(([i,e,t,n,s,r])=>{const a=j(r).toVar(),o=j(s).toVar(),l=j(n).toVar(),u=j(t).toVar(),f=j(e).toVar(),p=j(i).toVar(),x=j(ri(1,o)).toVar();return ri(1,a).mul(p.mul(x).add(f.mul(o))).add(a.mul(u.mul(x).add(l.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),ote=ye(([i,e,t,n,s,r])=>{const a=j(r).toVar(),o=j(s).toVar(),l=de(n).toVar(),u=de(t).toVar(),f=de(e).toVar(),p=de(i).toVar(),x=j(ri(1,o)).toVar();return ri(1,a).mul(p.mul(x).add(f.mul(o))).add(a.mul(u.mul(x).add(l.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),ak=ba([ate,ote]),lte=ye(([i,e,t,n,s,r,a,o,l,u,f])=>{const p=j(f).toVar(),x=j(u).toVar(),y=j(l).toVar(),_=j(o).toVar(),T=j(a).toVar(),A=j(r).toVar(),S=j(s).toVar(),C=j(n).toVar(),w=j(t).toVar(),B=j(e).toVar(),L=j(i).toVar(),D=j(ri(1,y)).toVar(),O=j(ri(1,x)).toVar();return j(ri(1,p)).toVar().mul(O.mul(L.mul(D).add(B.mul(y))).add(x.mul(w.mul(D).add(C.mul(y))))).add(p.mul(O.mul(S.mul(D).add(A.mul(y))).add(x.mul(T.mul(D).add(_.mul(y))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),cte=ye(([i,e,t,n,s,r,a,o,l,u,f])=>{const p=j(f).toVar(),x=j(u).toVar(),y=j(l).toVar(),_=de(o).toVar(),T=de(a).toVar(),A=de(r).toVar(),S=de(s).toVar(),C=de(n).toVar(),w=de(t).toVar(),B=de(e).toVar(),L=de(i).toVar(),D=j(ri(1,y)).toVar(),O=j(ri(1,x)).toVar();return j(ri(1,p)).toVar().mul(O.mul(L.mul(D).add(B.mul(y))).add(x.mul(w.mul(D).add(C.mul(y))))).add(p.mul(O.mul(S.mul(D).add(A.mul(y))).add(x.mul(T.mul(D).add(_.mul(y))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),ok=ba([lte,cte]),ute=ye(([i,e,t])=>{const n=j(t).toVar(),s=j(e).toVar(),r=yt(i).toVar(),a=yt(r.bitAnd(yt(7))).toVar(),o=j(hS(a.lessThan(yt(4)),s,n)).toVar(),l=j(Cn(2,hS(a.lessThan(yt(4)),n,s))).toVar();return DM(o,vc(a.bitAnd(yt(1)))).add(DM(l,vc(a.bitAnd(yt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),dte=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=j(e).toVar(),o=yt(i).toVar(),l=yt(o.bitAnd(yt(15))).toVar(),u=j(hS(l.lessThan(yt(8)),a,r)).toVar(),f=j(hS(l.lessThan(yt(4)),r,hS(l.equal(yt(12)).or(l.equal(yt(14))),a,s))).toVar();return DM(u,vc(l.bitAnd(yt(1)))).add(DM(f,vc(l.bitAnd(yt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),sa=ba([ute,dte]),fte=ye(([i,e,t])=>{const n=j(t).toVar(),s=j(e).toVar(),r=vv(i).toVar();return de(sa(r.x,s,n),sa(r.y,s,n),sa(r.z,s,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),hte=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=j(e).toVar(),o=vv(i).toVar();return de(sa(o.x,a,r,s),sa(o.y,a,r,s),sa(o.z,a,r,s))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),rc=ba([fte,hte]),pte=ye(([i])=>{const e=j(i).toVar();return Cn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),mte=ye(([i])=>{const e=j(i).toVar();return Cn(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),gte=ye(([i])=>{const e=de(i).toVar();return Cn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),lk=ba([pte,gte]),xte=ye(([i])=>{const e=de(i).toVar();return Cn(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),ck=ba([mte,xte]),_l=ye(([i,e])=>{const t=oe(e).toVar(),n=yt(i).toVar();return n.shiftLeft(t).bitOr(n.shiftRight(oe(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),uk=ye(([i,e,t])=>{i.subAssign(t),i.bitXorAssign(_l(t,oe(4))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(_l(i,oe(6))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(_l(e,oe(8))),e.addAssign(i),i.subAssign(t),i.bitXorAssign(_l(t,oe(16))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(_l(i,oe(19))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(_l(e,oe(4))),e.addAssign(i)}),KT=ye(([i,e,t])=>{const n=yt(t).toVar(),s=yt(e).toVar(),r=yt(i).toVar();return n.bitXorAssign(s),n.subAssign(_l(s,oe(14))),r.bitXorAssign(n),r.subAssign(_l(n,oe(11))),s.bitXorAssign(r),s.subAssign(_l(r,oe(25))),n.bitXorAssign(s),n.subAssign(_l(s,oe(16))),r.bitXorAssign(n),r.subAssign(_l(n,oe(4))),s.bitXorAssign(r),s.subAssign(_l(r,oe(14))),n.bitXorAssign(s),n.subAssign(_l(s,oe(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),ka=ye(([i])=>{const e=yt(i).toVar();return j(e).div(j(yt(oe(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),_d=ye(([i])=>{const e=j(i).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),yte=ye(([i])=>{const e=oe(i).toVar(),t=yt(yt(1)).toVar(),n=yt(yt(oe(3735928559)).add(t.shiftLeft(yt(2))).add(yt(13))).toVar();return KT(n.add(yt(e)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),vte=ye(([i,e])=>{const t=oe(e).toVar(),n=oe(i).toVar(),s=yt(yt(2)).toVar(),r=yt().toVar(),a=yt().toVar(),o=yt().toVar();return r.assign(a.assign(o.assign(yt(oe(3735928559)).add(s.shiftLeft(yt(2))).add(yt(13))))),r.addAssign(yt(n)),a.addAssign(yt(t)),KT(r,a,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),_te=ye(([i,e,t])=>{const n=oe(t).toVar(),s=oe(e).toVar(),r=oe(i).toVar(),a=yt(yt(3)).toVar(),o=yt().toVar(),l=yt().toVar(),u=yt().toVar();return o.assign(l.assign(u.assign(yt(oe(3735928559)).add(a.shiftLeft(yt(2))).add(yt(13))))),o.addAssign(yt(r)),l.addAssign(yt(s)),u.addAssign(yt(n)),KT(o,l,u)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),bte=ye(([i,e,t,n])=>{const s=oe(n).toVar(),r=oe(t).toVar(),a=oe(e).toVar(),o=oe(i).toVar(),l=yt(yt(4)).toVar(),u=yt().toVar(),f=yt().toVar(),p=yt().toVar();return u.assign(f.assign(p.assign(yt(oe(3735928559)).add(l.shiftLeft(yt(2))).add(yt(13))))),u.addAssign(yt(o)),f.addAssign(yt(a)),p.addAssign(yt(r)),uk(u,f,p),u.addAssign(yt(s)),KT(u,f,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Ste=ye(([i,e,t,n,s])=>{const r=oe(s).toVar(),a=oe(n).toVar(),o=oe(t).toVar(),l=oe(e).toVar(),u=oe(i).toVar(),f=yt(yt(5)).toVar(),p=yt().toVar(),x=yt().toVar(),y=yt().toVar();return p.assign(x.assign(y.assign(yt(oe(3735928559)).add(f.shiftLeft(yt(2))).add(yt(13))))),p.addAssign(yt(u)),x.addAssign(yt(l)),y.addAssign(yt(o)),uk(p,x,y),p.addAssign(yt(a)),x.addAssign(yt(r)),KT(p,x,y)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),Qi=ba([yte,vte,_te,bte,Ste]),Tte=ye(([i,e])=>{const t=oe(e).toVar(),n=oe(i).toVar(),s=yt(Qi(n,t)).toVar(),r=vv().toVar();return r.x.assign(s.bitAnd(oe(255))),r.y.assign(s.shiftRight(oe(8)).bitAnd(oe(255))),r.z.assign(s.shiftRight(oe(16)).bitAnd(oe(255))),r}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Ate=ye(([i,e,t])=>{const n=oe(t).toVar(),s=oe(e).toVar(),r=oe(i).toVar(),a=yt(Qi(r,s,n)).toVar(),o=vv().toVar();return o.x.assign(a.bitAnd(oe(255))),o.y.assign(a.shiftRight(oe(8)).bitAnd(oe(255))),o.z.assign(a.shiftRight(oe(16)).bitAnd(oe(255))),o}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),ac=ba([Tte,Ate]),Ete=ye(([i])=>{const e=Je(i).toVar(),t=oe().toVar(),n=oe().toVar(),s=j(Rs(e.x,t)).toVar(),r=j(Rs(e.y,n)).toVar(),a=j(_d(s)).toVar(),o=j(_d(r)).toVar(),l=j(ak(sa(Qi(t,n),s,r),sa(Qi(t.add(oe(1)),n),s.sub(1),r),sa(Qi(t,n.add(oe(1))),s,r.sub(1)),sa(Qi(t.add(oe(1)),n.add(oe(1))),s.sub(1),r.sub(1)),a,o)).toVar();return lk(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Mte=ye(([i])=>{const e=de(i).toVar(),t=oe().toVar(),n=oe().toVar(),s=oe().toVar(),r=j(Rs(e.x,t)).toVar(),a=j(Rs(e.y,n)).toVar(),o=j(Rs(e.z,s)).toVar(),l=j(_d(r)).toVar(),u=j(_d(a)).toVar(),f=j(_d(o)).toVar(),p=j(ok(sa(Qi(t,n,s),r,a,o),sa(Qi(t.add(oe(1)),n,s),r.sub(1),a,o),sa(Qi(t,n.add(oe(1)),s),r,a.sub(1),o),sa(Qi(t.add(oe(1)),n.add(oe(1)),s),r.sub(1),a.sub(1),o),sa(Qi(t,n,s.add(oe(1))),r,a,o.sub(1)),sa(Qi(t.add(oe(1)),n,s.add(oe(1))),r.sub(1),a,o.sub(1)),sa(Qi(t,n.add(oe(1)),s.add(oe(1))),r,a.sub(1),o.sub(1)),sa(Qi(t.add(oe(1)),n.add(oe(1)),s.add(oe(1))),r.sub(1),a.sub(1),o.sub(1)),l,u,f)).toVar();return ck(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),xU=ba([Ete,Mte]),Cte=ye(([i])=>{const e=Je(i).toVar(),t=oe().toVar(),n=oe().toVar(),s=j(Rs(e.x,t)).toVar(),r=j(Rs(e.y,n)).toVar(),a=j(_d(s)).toVar(),o=j(_d(r)).toVar(),l=de(ak(rc(ac(t,n),s,r),rc(ac(t.add(oe(1)),n),s.sub(1),r),rc(ac(t,n.add(oe(1))),s,r.sub(1)),rc(ac(t.add(oe(1)),n.add(oe(1))),s.sub(1),r.sub(1)),a,o)).toVar();return lk(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Rte=ye(([i])=>{const e=de(i).toVar(),t=oe().toVar(),n=oe().toVar(),s=oe().toVar(),r=j(Rs(e.x,t)).toVar(),a=j(Rs(e.y,n)).toVar(),o=j(Rs(e.z,s)).toVar(),l=j(_d(r)).toVar(),u=j(_d(a)).toVar(),f=j(_d(o)).toVar(),p=de(ok(rc(ac(t,n,s),r,a,o),rc(ac(t.add(oe(1)),n,s),r.sub(1),a,o),rc(ac(t,n.add(oe(1)),s),r,a.sub(1),o),rc(ac(t.add(oe(1)),n.add(oe(1)),s),r.sub(1),a.sub(1),o),rc(ac(t,n,s.add(oe(1))),r,a,o.sub(1)),rc(ac(t.add(oe(1)),n,s.add(oe(1))),r.sub(1),a,o.sub(1)),rc(ac(t,n.add(oe(1)),s.add(oe(1))),r,a.sub(1),o.sub(1)),rc(ac(t.add(oe(1)),n.add(oe(1)),s.add(oe(1))),r.sub(1),a.sub(1),o.sub(1)),l,u,f)).toVar();return ck(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),JT=ba([Cte,Rte]),wte=ye(([i])=>{const e=j(i).toVar(),t=oe(pr(e)).toVar();return ka(Qi(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Nte=ye(([i])=>{const e=Je(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar();return ka(Qi(t,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Bte=ye(([i])=>{const e=de(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar(),s=oe(pr(e.z)).toVar();return ka(Qi(t,n,s))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Dte=ye(([i])=>{const e=Vt(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar(),s=oe(pr(e.z)).toVar(),r=oe(pr(e.w)).toVar();return ka(Qi(t,n,s,r))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Ote=ba([wte,Nte,Bte,Dte]),Ute=ye(([i])=>{const e=j(i).toVar(),t=oe(pr(e)).toVar();return de(ka(Qi(t,oe(0))),ka(Qi(t,oe(1))),ka(Qi(t,oe(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Lte=ye(([i])=>{const e=Je(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar();return de(ka(Qi(t,n,oe(0))),ka(Qi(t,n,oe(1))),ka(Qi(t,n,oe(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Ite=ye(([i])=>{const e=de(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar(),s=oe(pr(e.z)).toVar();return de(ka(Qi(t,n,s,oe(0))),ka(Qi(t,n,s,oe(1))),ka(Qi(t,n,s,oe(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Pte=ye(([i])=>{const e=Vt(i).toVar(),t=oe(pr(e.x)).toVar(),n=oe(pr(e.y)).toVar(),s=oe(pr(e.z)).toVar(),r=oe(pr(e.w)).toVar();return de(ka(Qi(t,n,s,r,oe(0))),ka(Qi(t,n,s,r,oe(1))),ka(Qi(t,n,s,r,oe(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),w3=ba([Ute,Lte,Ite,Pte]),OM=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=oe(e).toVar(),o=de(i).toVar(),l=j(0).toVar(),u=j(1).toVar();return Vi(a,()=>{l.addAssign(u.mul(xU(o))),u.mulAssign(s),o.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),N3=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=oe(e).toVar(),o=de(i).toVar(),l=de(0).toVar(),u=j(1).toVar();return Vi(a,()=>{l.addAssign(u.mul(JT(o))),u.mulAssign(s),o.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Fte=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=oe(e).toVar(),o=de(i).toVar();return Je(OM(o,a,r,s),OM(o.add(de(oe(19),oe(193),oe(17))),a,r,s))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Gte=ye(([i,e,t,n])=>{const s=j(n).toVar(),r=j(t).toVar(),a=oe(e).toVar(),o=de(i).toVar(),l=de(N3(o,a,r,s)).toVar(),u=j(OM(o.add(de(oe(19),oe(193),oe(17))),a,r,s)).toVar();return Vt(l,u)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),zte=ye(([i,e,t,n,s,r,a])=>{const o=oe(a).toVar(),l=j(r).toVar(),u=oe(s).toVar(),f=oe(n).toVar(),p=oe(t).toVar(),x=oe(e).toVar(),y=Je(i).toVar(),_=de(w3(Je(x.add(f),p.add(u)))).toVar(),T=Je(_.x,_.y).toVar();T.subAssign(.5),T.mulAssign(l),T.addAssign(.5);const A=Je(Je(j(x),j(p)).add(T)).toVar(),S=Je(A.sub(y)).toVar();return sn(o.equal(oe(2)),()=>ds(S.x).add(ds(S.y))),sn(o.equal(oe(3)),()=>Ts(ds(S.x),ds(S.y))),du(S,S)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Vte=ye(([i,e,t,n,s,r,a,o,l])=>{const u=oe(l).toVar(),f=j(o).toVar(),p=oe(a).toVar(),x=oe(r).toVar(),y=oe(s).toVar(),_=oe(n).toVar(),T=oe(t).toVar(),A=oe(e).toVar(),S=de(i).toVar(),C=de(w3(de(A.add(y),T.add(x),_.add(p)))).toVar();C.subAssign(.5),C.mulAssign(f),C.addAssign(.5);const w=de(de(j(A),j(T),j(_)).add(C)).toVar(),B=de(w.sub(S)).toVar();return sn(u.equal(oe(2)),()=>ds(B.x).add(ds(B.y)).add(ds(B.z))),sn(u.equal(oe(3)),()=>Ts(ds(B.x),ds(B.y),ds(B.z))),du(B,B)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Mv=ba([zte,Vte]),Hte=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=Je(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=Je(Rs(r.x,a),Rs(r.y,o)).toVar(),u=j(1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:f})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:p})=>{const x=j(Mv(l,f,p,a,o,s,n)).toVar();u.assign(el(u,x))})}),sn(n.equal(oe(0)),()=>{u.assign($o(u))}),u}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),kte=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=Je(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=Je(Rs(r.x,a),Rs(r.y,o)).toVar(),u=Je(1e6,1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:f})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:p})=>{const x=j(Mv(l,f,p,a,o,s,n)).toVar();sn(x.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(x)}).ElseIf(x.lessThan(u.y),()=>{u.y.assign(x)})})}),sn(n.equal(oe(0)),()=>{u.assign($o(u))}),u}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Wte=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=Je(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=Je(Rs(r.x,a),Rs(r.y,o)).toVar(),u=de(1e6,1e6,1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:f})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:p})=>{const x=j(Mv(l,f,p,a,o,s,n)).toVar();sn(x.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(x)}).ElseIf(x.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(x)}).ElseIf(x.lessThan(u.z),()=>{u.z.assign(x)})})}),sn(n.equal(oe(0)),()=>{u.assign($o(u))}),u}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Xte=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=de(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=oe().toVar(),u=de(Rs(r.x,a),Rs(r.y,o),Rs(r.z,l)).toVar(),f=j(1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:p})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:x})=>{Vi({start:-1,end:oe(1),name:"z",condition:"<="},({z:y})=>{const _=j(Mv(u,p,x,y,a,o,l,s,n)).toVar();f.assign(el(f,_))})})}),sn(n.equal(oe(0)),()=>{f.assign($o(f))}),f}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),qte=ba([Hte,Xte]),Yte=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=de(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=oe().toVar(),u=de(Rs(r.x,a),Rs(r.y,o),Rs(r.z,l)).toVar(),f=Je(1e6,1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:p})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:x})=>{Vi({start:-1,end:oe(1),name:"z",condition:"<="},({z:y})=>{const _=j(Mv(u,p,x,y,a,o,l,s,n)).toVar();sn(_.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(_)}).ElseIf(_.lessThan(f.y),()=>{f.y.assign(_)})})})}),sn(n.equal(oe(0)),()=>{f.assign($o(f))}),f}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),jte=ba([kte,Yte]),$te=ye(([i,e,t])=>{const n=oe(t).toVar(),s=j(e).toVar(),r=de(i).toVar(),a=oe().toVar(),o=oe().toVar(),l=oe().toVar(),u=de(Rs(r.x,a),Rs(r.y,o),Rs(r.z,l)).toVar(),f=de(1e6,1e6,1e6).toVar();return Vi({start:-1,end:oe(1),name:"x",condition:"<="},({x:p})=>{Vi({start:-1,end:oe(1),name:"y",condition:"<="},({y:x})=>{Vi({start:-1,end:oe(1),name:"z",condition:"<="},({z:y})=>{const _=j(Mv(u,p,x,y,a,o,l,s,n)).toVar();sn(_.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(_)}).ElseIf(_.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(_)}).ElseIf(_.lessThan(f.z),()=>{f.z.assign(_)})})})}),sn(n.equal(oe(0)),()=>{f.assign($o(f))}),f}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),yU=ba([Wte,$te]),Kte=ye(([i,e,t,n,s,r,a,o,l,u,f])=>{const p=oe(i).toVar(),x=Je(e).toVar(),y=Je(t).toVar(),_=Je(n).toVar(),T=j(s).toVar(),A=j(r).toVar(),S=j(a).toVar(),C=vc(o).toVar(),w=oe(l).toVar(),B=j(u).toVar(),L=j(f).toVar(),D=x.mul(y).add(_),O=j(0).toVar();return sn(p.equal(oe(0)),()=>{O.assign(JT(D))}),sn(p.equal(oe(1)),()=>{O.assign(w3(D))}),sn(p.equal(oe(2)),()=>{O.assign(yU(D,T,oe(0)))}),sn(p.equal(oe(3)),()=>{O.assign(N3(de(D,0),w,B,L))}),O.assign(O.mul(S.sub(A)).add(A)),sn(C,()=>{O.assign(_c(O,A,S))}),O}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Jte=ye(([i,e,t,n,s,r,a,o,l,u,f])=>{const p=oe(i).toVar(),x=de(e).toVar(),y=de(t).toVar(),_=de(n).toVar(),T=j(s).toVar(),A=j(r).toVar(),S=j(a).toVar(),C=vc(o).toVar(),w=oe(l).toVar(),B=j(u).toVar(),L=j(f).toVar(),D=x.mul(y).add(_),O=j(0).toVar();return sn(p.equal(oe(0)),()=>{O.assign(JT(D))}),sn(p.equal(oe(1)),()=>{O.assign(w3(D))}),sn(p.equal(oe(2)),()=>{O.assign(yU(D,T,oe(0)))}),sn(p.equal(oe(3)),()=>{O.assign(N3(D,w,B,L))}),O.assign(O.mul(S.sub(A)).add(A)),sn(C,()=>{O.assign(_c(O,A,S))}),O}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Zte=ye(([i])=>{const e=i.y,t=i.z,n=de().toVar();return sn(e.lessThan(1e-4),()=>{n.assign(de(t,t,t))}).Else(()=>{let s=i.x;s=s.sub(yd(s)).mul(6).toVar();const r=oe(rO(s)),a=s.sub(j(r)),o=t.mul(e.oneMinus()),l=t.mul(e.mul(a).oneMinus()),u=t.mul(e.mul(a.oneMinus()).oneMinus());sn(r.equal(oe(0)),()=>{n.assign(de(t,u,o))}).ElseIf(r.equal(oe(1)),()=>{n.assign(de(l,t,o))}).ElseIf(r.equal(oe(2)),()=>{n.assign(de(o,t,u))}).ElseIf(r.equal(oe(3)),()=>{n.assign(de(o,l,t))}).ElseIf(r.equal(oe(4)),()=>{n.assign(de(u,o,t))}).Else(()=>{n.assign(de(t,o,l))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),Qte=ye(([i])=>{const e=de(i).toVar(),t=j(e.x).toVar(),n=j(e.y).toVar(),s=j(e.z).toVar(),r=j(el(t,el(n,s))).toVar(),a=j(Ts(t,Ts(n,s))).toVar(),o=j(a.sub(r)).toVar(),l=j().toVar(),u=j().toVar(),f=j().toVar();return f.assign(a),sn(a.greaterThan(0),()=>{u.assign(o.div(a))}).Else(()=>{u.assign(0)}),sn(u.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{sn(t.greaterThanEqual(a),()=>{l.assign(n.sub(s).div(o))}).ElseIf(n.greaterThanEqual(a),()=>{l.assign(gr(2,s.sub(t).div(o)))}).Else(()=>{l.assign(gr(4,t.sub(n).div(o)))}),l.mulAssign(1/6),sn(l.lessThan(0),()=>{l.addAssign(1)})}),de(l,u,f)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),ene=ye(([i])=>{const e=de(i).toVar(),t=HD(ZD(e,de(.04045))).toVar(),n=de(e.div(12.92)).toVar(),s=de(pc(Ts(e.add(de(.055)),de(0)).div(1.055),de(2.4))).toVar();return Si(n,s,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),dk=(i,e)=>{i=j(i),e=j(e);const t=Je(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Ol(i.sub(t),i.add(t),e)},fk=(i,e,t,n)=>Si(i,e,t[n].clamp()),tne=(i,e,t=ji())=>fk(i,e,t,"x"),nne=(i,e,t=ji())=>fk(i,e,t,"y"),ine=(i,e,t,n,s=ji())=>{const r=s.x.clamp(),a=s.y.clamp(),o=Si(i,e,r),l=Si(t,n,r);return Si(o,l,a)},hk=(i,e,t,n,s)=>Si(i,e,dk(t,n[s])),sne=(i,e,t,n=ji())=>hk(i,e,t,n,"x"),rne=(i,e,t,n=ji())=>hk(i,e,t,n,"y"),ane=(i=1,e=0,t=ji())=>t.mul(i).add(e),one=(i,e=1)=>(i=j(i),i.abs().pow(e).mul(i.sign())),lne=(i,e=1,t=.5)=>j(i).sub(t).mul(e).add(t),cne=(i=ji(),e=1,t=0)=>xU(i.convert("vec2|vec3")).mul(e).add(t),une=(i=ji(),e=1,t=0)=>JT(i.convert("vec2|vec3")).mul(e).add(t),dne=(i=ji(),e=1,t=0)=>(i=i.convert("vec2|vec3"),Vt(JT(i),xU(i.add(Je(19,73)))).mul(e).add(t)),fne=(i,e=ji(),t=Je(1,1),n=Je(0,0),s=1,r=0,a=1,o=!1,l=1,u=2,f=.5)=>Kte(i,e.convert("vec2|vec3"),t,n,s,r,a,o,l,u,f),hne=(i,e=ji(),t=Je(1,1),n=Je(0,0),s=1,r=0,a=1,o=!1,l=1,u=2,f=.5)=>Jte(i,e.convert("vec2|vec3"),t,n,s,r,a,o,l,u,f),pne=(i=ji(),e=1)=>qte(i.convert("vec2|vec3"),e,oe(1)),mne=(i=ji(),e=1)=>jte(i.convert("vec2|vec3"),e,oe(1)),gne=(i=ji(),e=1)=>yU(i.convert("vec2|vec3"),e,oe(1)),xne=(i=ji())=>Ote(i.convert("vec2|vec3")),yne=(i=ji(),e=3,t=2,n=.5,s=1)=>OM(i,oe(e),t,n).mul(s),vne=(i=ji(),e=3,t=2,n=.5,s=1)=>Fte(i,oe(e),t,n).mul(s),_ne=(i=ji(),e=3,t=2,n=.5,s=1)=>N3(i,oe(e),t,n).mul(s),bne=(i=ji(),e=3,t=2,n=.5,s=1)=>Gte(i,oe(e),t,n).mul(s),Sne=(i,e=j(0))=>gr(i,e),Tne=(i,e=j(0))=>ri(i,e),Ane=(i,e=j(1))=>Cn(i,e),Ene=(i,e=j(1))=>Dl(i,e),Mne=(i,e=j(1))=>zT(i,e),Cne=(i,e=j(1))=>pc(i,e),Rne=(i=j(0),e=j(1))=>l3(i,e),wne=()=>Av,Nne=()=>c6,Bne=(i,e=j(1))=>ri(e,i),Dne=(i,e,t,n)=>i.greaterThan(e).mix(t,n),One=(i,e,t,n)=>i.greaterThanEqual(e).mix(t,n),Une=(i,e,t,n)=>i.equal(e).mix(t,n),Lne=(i,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=e.replace(/^out/,"").toLowerCase();if(t[n]!==void 0)return i.element(t[n])}if(typeof e=="number")return i.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return i.element(t[e])}return i},Ine=(i,e=Je(.5,.5),t=Je(1,1),n=j(0),s=Je(0,0))=>{let r=i;if(e&&(r=r.sub(e)),t&&(r=r.mul(t)),n){const a=n.mul(Math.PI/180),o=a.cos(),l=a.sin();r=Je(r.x.mul(o).sub(r.y.mul(l)),r.x.mul(l).add(r.y.mul(o)))}return e&&(r=r.add(e)),s&&(r=r.add(s)),r},Pne=(i,e)=>{i=Je(i),e=j(e);const t=e.mul(Math.PI/180);return jT(i,t)},Fne=(i,e,t)=>{i=de(i),e=j(e),t=de(t);const n=e.mul(Math.PI/180),s=t.normalize(),r=n.cos(),a=n.sin(),o=j(1).sub(r);return i.mul(r).add(s.cross(i).mul(a)).add(s.mul(s.dot(i)).mul(o))},Gne=(i,e)=>(i=de(i),e=j(e),NO(i,e)),zne=ye(([i,e,t])=>{const n=Zo(i).toVar(),s=ri(j(.5).mul(e.sub(t)),Ml).div(n).toVar(),r=ri(j(-.5).mul(e.sub(t)),Ml).div(n).toVar(),a=de().toVar();a.x=n.x.greaterThan(j(0)).select(s.x,r.x),a.y=n.y.greaterThan(j(0)).select(s.y,r.y),a.z=n.z.greaterThan(j(0)).select(s.z,r.z);const o=el(a.x,a.y,a.z).toVar();return Ml.add(n.mul(o)).toVar().sub(t)}),pk=ye(([i,e])=>{const t=i.x,n=i.y,s=i.z;let r=e.element(0).mul(.886227);return r=r.add(e.element(1).mul(2*.511664).mul(n)),r=r.add(e.element(2).mul(2*.511664).mul(s)),r=r.add(e.element(3).mul(2*.511664).mul(t)),r=r.add(e.element(4).mul(2*.429043).mul(t).mul(n)),r=r.add(e.element(5).mul(2*.429043).mul(n).mul(s)),r=r.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),r=r.add(e.element(7).mul(2*.429043).mul(t).mul(s)),r=r.add(e.element(8).mul(.429043).mul(Cn(t,t).sub(Cn(n,n)))),r});var Vne=Object.freeze({__proto__:null,BRDF_GGX:jO,BRDF_Lambert:c0,BasicPointShadowFilter:tk,BasicShadowFilter:j6,Break:i9,Const:d5,Continue:AK,DFGApprox:FS,D_GGX:U9,Discard:L5,EPSILON:QD,F_Schlick:Yy,Fn:ye,HALF_PI:S$,INFINITY:v$,If:sn,Loop:Vi,NodeAccess:la,NodeShaderStage:Sy,NodeType:$V,NodeUpdateType:Bn,OnBeforeMaterialUpdate:yQ,OnBeforeObjectUpdate:xQ,OnMaterialUpdate:gQ,OnObjectUpdate:mQ,PCFShadowFilter:$6,PCFSoftShadowFilter:K6,PI:MM,PI2:_$,PointShadowFilter:nk,Return:N$,Schlick_to_F0:I9,ScriptableNodeResources:oM,ShaderNode:Ty,Stack:t3,Switch:f$,TBNViewMatrix:wg,TWO_PI:b$,VSMShadowFilter:J6,V_GGX_SmithCorrelated:O9,Var:u5,VarIntent:f5,abs:ds,acesFilmicToneMapping:N6,acos:nO,add:gr,addMethodChaining:Xe,addNodeElement:D$,agxToneMapping:B6,all:P8,alphaT:TM,and:S8,anisotropy:np,anisotropyB:Ig,anisotropyT:aS,any:F8,append:g$,array:h8,arrayBuffer:p$,asin:H8,assign:m8,atan:l3,atan2:o5,atomicAdd:hee,atomicAnd:xee,atomicFunc:Od,atomicLoad:dee,atomicMax:mee,atomicMin:gee,atomicOr:yee,atomicStore:fee,atomicSub:pee,atomicXor:vee,attenuationColor:YD,attenuationDistance:qD,attribute:vo,attributeArray:vQ,backgroundBlurriness:g6,backgroundIntensity:MN,backgroundRotation:x6,batch:ZH,bentNormalView:yH,billboarding:QZ,bitAnd:M8,bitNot:C8,bitOr:R8,bitXor:w8,bitangentGeometry:dK,bitangentLocal:fK,bitangentView:gH,bitangentWorld:hK,bitcast:UZ,blendBurn:p9,blendColor:LK,blendDodge:m9,blendOverlay:x9,blendScreen:g9,blur:H9,bool:vc,buffer:kT,bufferAttribute:HT,builtin:nh,bumpMap:NO,burn:PK,bvec2:s8,bvec3:HD,bvec4:l8,bypass:D5,cache:N5,call:x8,cameraFar:Rf,cameraIndex:im,cameraNear:Cf,cameraNormalMatrix:W$,cameraPosition:uS,cameraProjectionMatrix:lc,cameraProjectionMatrixInverse:H$,cameraViewMatrix:Pl,cameraViewport:X$,cameraWorldMatrix:k$,cbrt:n5,cdl:BQ,ceil:o3,checker:ste,cineonToneMapping:w6,clamp:_c,clearcoat:SM,clearcoatNormalView:Rg,clearcoatRoughness:US,code:E3,color:n8,colorSpaceToWorking:d3,colorToDirection:XK,compute:R5,computeKernel:xO,computeSkinning:TK,context:VT,convert:u8,convertColorSpace:C$,convertToTexture:cQ,cos:ad,cross:o0,cubeTexture:Xy,cubeTextureBase:wO,cubeToUV:tu,dFdx:iO,dFdy:sO,dashSize:Pg,debug:F5,decrement:L8,decrementBefore:O8,defaultBuildStages:_M,defaultShaderStages:UD,defined:BS,degrees:z8,deltaTime:qZ,densityFog:$Q,densityFogFactor:oU,depth:WO,depthPass:LQ,determinant:j8,difference:Q8,diffuseColor:bi,directPointLight:sk,directionToColor:T9,directionToFaceDirection:bv,dispersion:jD,distance:Z8,div:Dl,dodge:FK,dot:du,drawIndex:jH,dynamicBufferAttribute:M5,element:c8,emissive:fN,equal:JD,equals:K8,equirectUV:XO,exp:eO,exp2:ky,expression:kf,faceDirection:MO,faceForward:fO,faceforward:T$,float:j,floatBitsToInt:LZ,floatBitsToUint:IZ,floor:yd,fog:zS,fract:uu,frameGroup:f8,frameId:c6,frontFacing:K5,fwidth:aO,gain:zZ,gapSize:IS,getConstNodeType:t8,getCurrentStack:VD,getDirection:z9,getDistanceAttenuation:gU,getGeometryRoughness:D9,getNormalFromDepth:dQ,getParallaxCorrectNormal:zne,getRoughness:YO,getScreenPosition:uQ,getShIrradianceAt:pk,getShadowMaterial:Z6,getShadowRenderObjectFunction:Q6,getTextureIndex:r6,getViewPosition:vy,ggxConvolution:k9,globalId:eee,glsl:kQ,glslFn:WQ,grayscale:CQ,greaterThan:ZD,greaterThanEqual:b8,hash:GZ,highpModelNormalViewMatrix:gN,highpModelViewMatrix:mN,hue:NQ,increment:U8,incrementBefore:D8,inspector:G5,instance:_K,instanceIndex:pp,instancedArray:_Q,instancedBufferAttribute:CM,instancedDynamicBufferAttribute:pN,instancedMesh:KH,int:oe,intBitsToFloat:PZ,interleavedGradientNoise:fQ,inverse:$8,inverseSqrt:tO,inversesqrt:A$,invocationLocalIndex:vK,invocationSubgroupIndex:yK,ior:oS,iridescence:s3,iridescenceIOR:kD,iridescenceThickness:WD,isolate:Dy,ivec2:Gr,ivec3:r8,ivec4:a8,js:VQ,label:c5,length:vd,lengthSq:cO,lessThan:v8,lessThanEqual:_8,lightPosition:cU,lightProjectionUV:G6,lightShadowMatrix:C3,lightTargetDirection:dU,lightTargetPosition:z6,lightViewPosition:uU,lightingContext:l9,lights:Yee,linearDepth:qy,linearToneMapping:C6,localId:tee,log:a3,log2:xd,logarithmicDepthToViewZ:RK,luminance:sU,mat2:n3,mat3:qa,mat4:Lg,matcapUV:j9,materialAO:qH,materialAlphaTest:bH,materialAnisotropy:LH,materialAnisotropyVector:yy,materialAttenuationColor:kH,materialAttenuationDistance:HH,materialClearcoat:wH,materialClearcoatNormal:BH,materialClearcoatRoughness:NH,materialColor:wM,materialDispersion:XH,materialEmissive:TH,materialEnvIntensity:nM,materialEnvRotation:RO,materialIOR:VH,materialIridescence:IH,materialIridescenceIOR:PH,materialIridescenceThickness:FH,materialLightMap:LO,materialLineDashOffset:UO,materialLineDashSize:DO,materialLineGapSize:OO,materialLineScale:BO,materialLineWidth:sM,materialMetalness:CH,materialNormal:RH,materialOpacity:x3,materialPointSize:WH,materialReference:wf,materialReflectivity:iM,materialRefractionRatio:eH,materialRotation:DH,materialRoughness:MH,materialSheen:OH,materialSheenRoughness:UH,materialShininess:SH,materialSpecular:AH,materialSpecularColor:EH,materialSpecularIntensity:bN,materialSpecularStrength:dS,materialThickness:zH,materialTransmission:GH,max:Ts,maxMipLevel:SO,mediumpModelViewMatrix:j5,metalness:OS,min:el,mix:Si,mixElement:s5,mod:zT,modInt:I8,modelDirection:J$,modelNormalMatrix:Y5,modelPosition:Z$,modelRadius:q5,modelScale:Q$,modelViewMatrix:Wf,modelViewPosition:eK,modelViewProjection:IO,modelWorldMatrix:mc,modelWorldMatrixInverse:tK,morphReference:r9,mrt:o6,mul:Cn,mx_aastep:dk,mx_add:Sne,mx_atan2:Rne,mx_cell_noise_float:xne,mx_contrast:lne,mx_divide:Ene,mx_fractal_noise_float:yne,mx_fractal_noise_vec2:vne,mx_fractal_noise_vec3:_ne,mx_fractal_noise_vec4:bne,mx_frame:Nne,mx_heighttonormal:Gne,mx_hsvtorgb:Zte,mx_ifequal:Une,mx_ifgreater:Dne,mx_ifgreatereq:One,mx_invert:Bne,mx_modulo:Mne,mx_multiply:Ane,mx_noise_float:cne,mx_noise_vec3:une,mx_noise_vec4:dne,mx_place2d:Ine,mx_power:Cne,mx_ramp4:ine,mx_ramplr:tne,mx_ramptb:nne,mx_rgbtohsv:Qte,mx_rotate2d:Pne,mx_rotate3d:Fne,mx_safepower:one,mx_separate:Lne,mx_splitlr:sne,mx_splittb:rne,mx_srgb_texture_to_lin_rec709:ene,mx_subtract:Tne,mx_timer:wne,mx_transform_uv:ane,mx_unifiednoise2d:fne,mx_unifiednoise3d:hne,mx_worley_noise_float:pne,mx_worley_noise_vec2:mne,mx_worley_noise_vec3:gne,negate:k8,neutralToneMapping:D6,nodeArray:Ug,nodeImmutable:Rt,nodeObject:Ke,nodeObjectIntent:Jb,nodeObjects:e3,nodeProxy:En,nodeProxyIntent:St,normalFlat:J5,normalGeometry:h3,normalLocal:tl,normalMap:_N,normalView:Di,normalViewGeometry:Wy,normalWorld:sm,normalWorldGeometry:Z5,normalize:Zo,not:A8,notEqual:y8,numWorkgroups:ZQ,objectDirection:q$,objectGroup:KD,objectPosition:X5,objectRadius:K$,objectScale:j$,objectViewPosition:$$,objectWorldMatrix:Y$,oneMinus:W8,or:T8,orthographicDepthToViewZ:CK,oscSawtooth:KZ,oscSine:YZ,oscSquare:jZ,oscTriangle:$Z,output:Ny,outputStruct:OZ,overlay:zK,overloadingFn:ba,parabola:EN,parallaxDirection:xH,parallaxUV:pK,parameter:NZ,pass:OQ,passTexture:UQ,pcurve:VZ,perspectiveDepthToViewZ:HO,pmremTexture:KO,pointShadow:ik,pointUV:bQ,pointWidth:x$,positionGeometry:_a,positionLocal:tr,positionPrevious:RM,positionView:nr,positionViewDirection:xs,positionWorld:Ml,positionWorldDirection:EO,posterize:DQ,pow:pc,pow2:oO,pow3:e5,pow4:lO,premultiplyAlpha:y9,property:ou,quadBroadcast:Wee,quadSwapDiagonal:Fee,quadSwapX:Iee,quadSwapY:Pee,radians:G8,rand:i5,range:KQ,rangeFog:jQ,rangeFogFactor:aU,reciprocal:q8,reference:is,referenceBuffer:xN,reflect:J8,reflectVector:iH,reflectView:tH,reflector:rQ,refract:dO,refractVector:sH,refractView:nH,reinhardToneMapping:R6,remap:O5,remapClamp:U5,renderGroup:ln,renderOutput:vO,rendererReference:b5,rotate:jT,rotateUV:JZ,roughness:od,round:X8,rtt:h6,sRGBTransferEOTF:g5,sRGBTransferOETF:x5,sample:pQ,sampler:I$,samplerComparison:P$,saturate:uO,saturation:RQ,screen:GK,screenCoordinate:WT,screenDPR:k5,screenSize:l0,screenUV:If,scriptable:YQ,scriptableValue:aM,select:Rr,setCurrentStack:DS,setName:pO,shaderStages:bM,shadow:ek,shadowPositionWorld:fU,shapeCircle:rte,sharedUniformGroup:r3,sheen:Cg,sheenRoughness:i3,shiftLeft:N8,shiftRight:B8,shininess:AM,sign:PS,sin:jo,sinc:HZ,skinning:t9,smoothstep:Ol,smoothstepElement:r5,specularColor:oc,specularF90:LS,spherizeUV:ZZ,split:m$,spritesheetUV:tQ,sqrt:$o,stack:rM,step:c3,stepElement:a5,storage:Fg,storageBarrier:ree,storageObject:SK,storageTexture:v6,string:h$,struct:DZ,sub:ri,subBuild:By,subgroupAdd:See,subgroupAll:Oee,subgroupAnd:Ree,subgroupAny:Uee,subgroupBallot:bee,subgroupBroadcast:Gee,subgroupBroadcastFirst:Lee,subgroupElect:_ee,subgroupExclusiveAdd:Aee,subgroupExclusiveMul:Cee,subgroupInclusiveAdd:Tee,subgroupInclusiveMul:Mee,subgroupIndex:xK,subgroupMax:Dee,subgroupMin:Bee,subgroupMul:Eee,subgroupOr:wee,subgroupShuffle:zee,subgroupShuffleDown:kee,subgroupShuffleUp:Hee,subgroupShuffleXor:Vee,subgroupSize:nee,subgroupXor:Nee,tan:V8,tangentGeometry:p3,tangentLocal:qT,tangentView:m3,tangentWorld:mH,texture:kn,texture3D:b6,textureBarrier:aee,textureBicubic:fJ,textureBicubicLevel:$O,textureCubeUV:V9,textureLevel:L$,textureLoad:Xs,textureSize:Lf,textureStore:SQ,thickness:XD,time:Av,toneMapping:T5,toneMappingExposure:A5,toonOutlinePass:IQ,transformDirection:t5,transformNormal:Q5,transformNormalToView:CO,transformedClearcoatNormalView:sK,transformedNormalView:nK,transformedNormalWorld:iK,transmission:EM,transpose:Y8,triNoise3D:WZ,triplanarTexture:nQ,triplanarTextures:d6,trunc:rO,uint:yt,uintBitsToFloat:FZ,uniform:rn,uniformArray:za,uniformCubeTexture:rK,uniformFlow:l5,uniformGroup:d8,uniformTexture:U$,unpremultiplyAlpha:IK,userData:AQ,uv:ji,uvec2:i8,uvec3:vv,uvec4:o8,varying:Dd,varyingProperty:vl,vec2:Je,vec3:de,vec4:Vt,vectorComponents:tm,velocity:MQ,vertexColor:h9,vertexIndex:YH,vertexStage:m5,vibrance:wQ,viewZToLogarithmicDepth:kO,viewZToOrthographicDepth:Uy,viewZToPerspectiveDepth:VO,viewport:Oy,viewportCoordinate:W5,viewportDepthTexture:zO,viewportLinearDepth:wK,viewportMipTexture:GO,viewportResolution:V$,viewportSafeUV:eQ,viewportSharedTexture:S9,viewportSize:AO,viewportTexture:MK,viewportUV:z$,wgsl:HQ,wgslFn:XQ,workgroupArray:cee,workgroupBarrier:see,workgroupId:QQ,workingToColorSpace:y5,xor:E8});const Zc=new eU;class Hne extends rm{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const s=this.renderer,r=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(r===null)s._clearColor.getRGB(Zc),Zc.a=s._clearColor.a;else if(r.isColor===!0)r.getRGB(Zc),Zc.a=1,a=!0;else if(r.isNode===!0){const u=this.get(e),f=r;Zc.copy(s._clearColor);let p=u.backgroundMesh;if(p===void 0){let A=function(){r.removeEventListener("dispose",A),p.material.dispose(),p.geometry.dispose()};var l=A;const y=VT(Vt(f).mul(MN),{getUV:()=>x6.mul(Z5),getTextureLevel:()=>g6});let _=IO;_=_.setZ(_.w);const T=new ys;T.name="Background.material",T.side=Yi,T.depthTest=!1,T.depthWrite=!1,T.allowOverride=!1,T.fog=!1,T.lights=!1,T.vertexNode=_,T.colorNode=y,u.backgroundMeshNode=y,u.backgroundMesh=p=new Ui(new v0(1,32,32),T),p.frustumCulled=!1,p.name="Background.mesh",p.onBeforeRender=function(S,C,w){this.matrixWorld.copyPosition(w.matrixWorld)},r.addEventListener("dispose",A)}const x=f.getCacheKey();u.backgroundCacheKey!==x&&(u.backgroundMeshNode.node=Vt(f).mul(MN),u.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,u.backgroundCacheKey=x),t.unshift(p,p.geometry,p.material,0,0,null,null)}else nt("Renderer: Unsupported background configuration.",r);const o=s.xr.getEnvironmentBlendMode();if(o==="additive"?Zc.set(0,0,0,1):o==="alpha-blend"&&Zc.set(0,0,0,0),s.autoClear===!0||a===!0){const u=n.clearColorValue;u.r=Zc.r,u.g=Zc.g,u.b=Zc.b,u.a=Zc.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=s._clearDepth,n.stencilClearValue=s._clearStencil,n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let kne=0;class CN{constructor(e="",t=[],n=0,s=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=s,this.id=kne++}}class Wne{constructor(e,t,n,s,r,a,o,l,u,f=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=f,this.nodeAttributes=s,this.bindings=r,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const s=new CN(t.name,[],t.index,t.bindingsReference);e.push(s);for(const r of t.bindings)s.bindings.push(r.clone())}else e.push(t);return e}}class RN{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class mk{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class vU{constructor(e,t,n=!1,s=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=s}}class gk extends vU{constructor(e,t,n=null,s=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=s}}class xk{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Xne=0;class lM{constructor(e=null){this.id=Xne++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class qne{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class om{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Yne extends om{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class jne extends om{constructor(e,t=new Ze){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class $ne extends om{constructor(e,t=new Q){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class Kne extends om{constructor(e,t=new mn){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Jne extends om{constructor(e,t=new Bt){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class Zne extends om{constructor(e,t=new xv){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class Qne extends om{constructor(e,t=new Ln){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class eie extends om{constructor(e,t=new Yt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class tie extends Yne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class nie extends jne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class iie extends $ne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class sie extends Kne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class rie extends Jne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class aie extends Zne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class oie extends Qne{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class lie extends eie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let cie=0;const dF=new WeakMap,uie=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),wE=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class _U{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=rM(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new lM,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:cie++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Mo&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=dF.get(this.renderer);return e===void 0&&(e=new hu,dF.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new bc(e,t,n)}createCubeRenderTarget(e,t){return new E9(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),s=[];let r=!0;for(const o of t)s.push(o),r=r&&o.groupNode.shared!==!0;let a;return r?(a=n.get(s),a===void 0&&(a=new CN(e,s,this.bindingsIndexes[e].group,s),n.set(s,a))):a=new CN(e,s,this.bindingsIndexes[e].group,s),a}getBindGroupArray(e,t){const n=this.bindings[t];let s=n[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const s of bM)for(const r in n[s]){const a=n[s][r];(t[r]||(t[r]=[])).push(...a)}e=[];for(const s in t){const r=t[s],a=this._getBindGroup(s,r);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Bn.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Bn.NONE&&this.updateBeforeNodes.push(e),n!==Bn.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Dn||e.magFilter===ud||e.magFilter===Sl||e.magFilter===Cr||e.minFilter===Dn||e.minFilter===ud||e.minFilter===Sl||e.minFilter===Cr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new lM(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){De("Abstract function.")}getInstanceIndex(){De("Abstract function.")}getDrawIndex(){De("Abstract function.")}getFrontFacing(){De("Abstract function.")}getFragCoord(){De("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){De("Abstract function.")}generateTextureLod(){De("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let s=this.generateArrayDeclaration(e,t)+"( ";for(let r=0;r<t;r++){const a=n?n[r]:null;a!==null?s+=a.build(this,e):s+=this.generateConst(e),r<t-1&&(s+=", ")}return s+=" )",s}generateStruct(e,t,n=null){const s=[];for(const r of t){const{name:a,type:o}=r;n&&n[a]&&n[a].isNode?s.push(n[a].build(this,o)):s.push(this.generateConst(o))}return e+"( "+s.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Bt:e==="vec2"?t=new Ze:e==="vec3"?t=new Q:e==="vec4"&&(t=new mn)),e==="float")return wE(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${wE(t.r)}, ${wE(t.g)}, ${wE(t.b)} )`;const n=this.getTypeLength(e),s=this.getComponentType(e),r=a=>this.generateConst(s,a);if(n===2)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(n===3)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(r).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const r of n)if(r.name===e)return r;const s=new RN(e,t);return this.registerDeclaration(s),n.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===fr)return"int";if(t===Xi)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=wD(e);const s=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),s+n}getTypeFromArray(e){return uie.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,s=e.itemSize,r=e.normalized;let a;return!(e instanceof bC)&&r!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(s,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=rM(this.stack);const e=VD();return this.stacks.push(e),DS(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,DS(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(e);s===void 0&&(s={},n.setData(e,s)),s[t]===void 0&&(s[t]={});let r=s[t];const a=s.any?s.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(r.subBuildsCache===void 0&&(r.subBuildsCache={}),r=r.subBuildsCache[o]||(r.subBuildsCache[o]={}),r.subBuilds=a),r}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let s=n.bufferAttribute;if(s===void 0){const r=this.uniforms.index++;s=new RN("nodeAttribute"+r,t,e),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,s=this.shaderStage){const r=this.getDataFromNode(e,s,this.globalCache);let a=r.structType;if(a===void 0){const o=this.structs.index++;n===null&&(n="StructType"+o),a=new qne(n,t),this.structs[s].push(a),this.types[s][n]=e,r.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,s=null){const r=this.getDataFromNode(e,n,this.globalCache);let a=r.uniform;if(a===void 0){const o=this.uniforms.index++;a=new mk(s||"nodeUniform"+o,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),r.uniform=a}return a}getVarFromNode(e,t=null,n=e.getNodeType(this),s=this.shaderStage,r=!1){const a=this.getDataFromNode(e,s),o=this.getSubBuildProperty("variable",a.subBuilds);let l=a[o];if(l===void 0){const u=r?"_const":"_var",f=this.vars[s]||(this.vars[s]=[]),p=this.vars[u]||(this.vars[u]=0);t===null&&(t=(r?"nodeConst":"nodeVar")+p,this.vars[u]++),o!=="variable"&&(t=this.getSubBuildProperty(t,a.subBuilds));const x=e.getArrayCount(this);l=new vU(t,n,r,x),r||f.push(l),this.registerDeclaration(l),a[o]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),s=null,r=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let l=a[o];if(l===void 0){const u=this.varyings,f=u.length;t===null&&(t="nodeVarying"+f),o!=="varying"&&(t=this.getSubBuildProperty(t,a.subBuilds)),l=new gk(t,n,s,r),u.push(l),this.registerDeclaration(l),a[o]=l}return l}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),s=this.getPropertyName(e);let r=1,a=s;for(;n[a]!==void 0;)a=s+"_"+r++;r>1&&(e.name=a,De(`TSL: Declaration name '${s}' of '${e.type}' already in use. Renamed to '${a}'.`)),n[a]=e}getCodeFromNode(e,t,n=this.shaderStage){const s=this.getDataFromNode(e);let r=s.code;if(r===void 0){const a=this.codes[n]||(this.codes[n]=[]),o=a.length;r=new xk("nodeCode"+o,t),a.push(r),s.code=r}return r}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(e);let r=!0,a=t;for(;a;){if(s.get(a)===!0){r=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(r)for(const o of n)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,n){const s=this.getDataFromNode(e),r=s.flowCodes||(s.flowCodes=[]),a=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);r.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new rU,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let a=0;const o=Object.values(this);return{next:()=>({value:o[a],done:a++>=o.length})}}};for(const a of t.inputs)n[a.name]=new tU(a.type,a.name);e.layout=null;const s=e.call(n),r=this.flowStagesNode(s,t.type);return e.layout=t,r}flowBuildStage(e,t,n=null){const s=this.getBuildStage();this.setBuildStage(t);const r=e.build(this,n);return this.setBuildStage(s),r}flowStagesNode(e,t=null){const n=this.flow,s=this.vars,r=this.declarations,a=this.cache,o=this.buildStage,l=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new lM,this.stack=rM();for(const f of _M)this.setBuildStage(f),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.declarations=r,this.cache=a,this.stack=l,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){De("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,t),this.flow=n,s}flowNodeFromShaderStage(e,t,n=null,s=null){const r=this.tab,a=this.cache,o=this.shaderStage,l=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let f=null;if(this.buildStage==="generate"){const p=this.flowChildNode(t,n);s!==null&&(p.code+=`${this.tab+s} = ${p.result};
`),this.flowCode[e]=this.flowCode[e]+p.code,f=p}else f=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=r,this.context=l,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){De("Abstract function.")}getVaryings(){De("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const s of n)t+=`${this.getVar(s.type,s.name)}; `;return t}getUniforms(){De("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const s of t)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){De("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const n=this.subBuildLayers;for(let s=t.length-1;s>=0;s--){const r=t[s];if(n.includes(r))return r}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n;t!==null?n=this.getClosestSubBuild(t):n=this.subBuildFn;let s;return n?s=e?n+"_"+e:n:s=e,s}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let s=n.library.fromMaterial(t);s===null&&(nt(`NodeMaterial: Material "${t.type}" is not compatible.`),s=new ys),s.build(this)}else this.addFlow("compute",e);for(const s of _M){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const r of bM){this.setShaderStage(r);const a=this.flowNodes[r];for(const o of a)s==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new tie(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new nie(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new iie(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new sie(e);if(t==="color")return new rie(e);if(t==="mat2")return new aie(e);if(t==="mat3")return new oie(e);if(t==="mat4")return new lie(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const s=this.getTypeLength(t),r=this.getTypeLength(n);return s===16&&r===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:s===9&&r===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:s>4||r>4||r===0?e:s===r?`${this.getType(n)}( ${e} )`:s>r?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,r)}`,this.format(e,this.getTypeFromLength(r,this.getComponentType(t)),n)):r===4&&s>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(s===1&&r>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${$f} - Node System
`}}class wN{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Bn.FRAME){const s=this._getMaps(this.updateBeforeMap,n);s.frameId!==this.frameId&&e.updateBefore(this)!==!1&&(s.frameId=this.frameId)}else if(t===Bn.RENDER){const s=this._getMaps(this.updateBeforeMap,n);s.renderId!==this.renderId&&e.updateBefore(this)!==!1&&(s.renderId=this.renderId)}else t===Bn.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Bn.FRAME){const s=this._getMaps(this.updateAfterMap,n);s.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(s.frameId=this.frameId)}else if(t===Bn.RENDER){const s=this._getMaps(this.updateAfterMap,n);s.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(s.renderId=this.renderId)}else t===Bn.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Bn.FRAME){const s=this._getMaps(this.updateMap,n);s.frameId!==this.frameId&&e.update(this)!==!1&&(s.frameId=this.frameId)}else if(t===Bn.RENDER){const s=this._getMaps(this.updateMap,n);s.renderId!==this.renderId&&e.update(this)!==!1&&(s.renderId=this.renderId)}else t===Bn.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class B3{constructor(e,t,n=null,s="",r=!1){this.type=e,this.name=t,this.count=n,this.qualifier=s,this.isConst=r}}B3.isNodeFunctionInput=!0;class yk extends am{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:dU(this.light),lightColor:e}}}const zw=new Yt,NE=new Yt;let Db=null;class vk extends am{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=rn(new Q).setGroup(ln),this.halfWidth=rn(new Q).setGroup(ln),this.updateType=Bn.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;NE.identity(),zw.copy(t.matrixWorld),zw.premultiply(n),NE.extractRotation(zw),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(NE),this.halfHeight.value.applyMatrix4(NE)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=kn(Db.LTC_FLOAT_1),n=kn(Db.LTC_FLOAT_2)):(t=kn(Db.LTC_HALF_1),n=kn(Db.LTC_HALF_2));const{colorNode:s,light:r}=this,a=uU(r);return{lightColor:s,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Db=e}}class D3 extends am{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=rn(0).setGroup(ln),this.penumbraCosNode=rn(0).setGroup(ln),this.cutoffDistanceNode=rn(0).setGroup(ln),this.decayExponentNode=rn(0).setGroup(ln),this.colorNode=rn(this.color).setGroup(ln)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:s}=this;return Ol(n,s,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=G6(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:s,light:r}=this,a=this.getLightVector(e),o=a.normalize(),l=o.dot(dU(r)),u=this.getSpotAttenuation(e,l),f=a.length(),p=gU({lightDistance:f,cutoffDistance:n,decayExponent:s});let x=t.mul(u).mul(p),y,_;return r.colorNode?(_=this.getLightCoord(e),y=r.colorNode(_)):r.map&&(_=this.getLightCoord(e),y=kn(r.map,_.xy).onRenderUpdate(()=>r.map)),y&&(x=_.mul(2).sub(1).abs().lessThan(1).all().select(x.mul(y),x)),{lightColor:x,lightDirection:o}}}class _k extends D3{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let s=null;if(n&&n.isTexture===!0){const r=t.acos().mul(1/Math.PI);s=kn(n,Je(r,0),0).r}else s=super.getSpotAttenuation(t);return s}}const die=ye(([i,e])=>{const t=i.abs().sub(e);return vd(Ts(t,0)).add(el(Ts(t.x,t.y),0))});class bk extends D3{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=j(0),n=this.penumbraCosNode,s=C3(this.light).mul(e.context.positionWorld||Ml);return sn(s.w.greaterThan(0),()=>{const r=s.xyz.div(s.w),a=die(r.xy.sub(Je(.5)),Je(.5)),o=Dl(-1,ri(1,nO(n)).sub(1));t.assign(uO(a.mul(-2).mul(o)))}),t}}class Sk extends am{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Tk extends am{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=cU(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=rn(new Bt).setGroup(ln)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:s}=this,a=sm.dot(s).mul(.5).add(.5),o=Si(n,t,a);e.context.irradiance.addAssign(o)}}class Ak extends am{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new Q);this.lightProbe=za(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=pk(sm,this.lightProbe);e.context.irradiance.addAssign(t)}}class Ek{parseFunction(){De("Abstract function.")}}class bU{constructor(e,t,n="",s=""){this.type=e,this.inputs=t,this.name=n,this.precision=s}getCode(){De("Abstract function.")}}bU.isNodeFunction=!0;const fie=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,hie=/[a-z_0-9]+/ig,fF="#pragma main",pie=i=>{i=i.trim();const e=i.indexOf(fF),t=e!==-1?i.slice(e+fF.length):i,n=t.match(fie);if(n!==null&&n.length===5){const s=n[4],r=[];let a=null;for(;(a=hie.exec(s))!==null;)r.push(a);const o=[];let l=0;for(;l<r.length;){const _=r[l][0]==="const";_===!0&&l++;let T=r[l][0];T==="in"||T==="out"||T==="inout"?l++:T="";const A=r[l++][0];let S=Number.parseInt(r[l][0]);Number.isNaN(S)===!1?l++:S=null;const C=r[l++][0];o.push(new B3(A,C,S,T,_))}const u=t.substring(n[0].length),f=n[3]!==void 0?n[3]:"",p=n[2],x=n[1]!==void 0?n[1]:"",y=e!==-1?i.slice(0,e):"";return{type:p,inputs:o,name:f,precision:x,inputsCode:s,blockCode:u,headerCode:y}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class mie extends bU{constructor(e){const{type:t,inputs:n,name:s,precision:r,inputsCode:a,blockCode:o,headerCode:l}=pie(e);super(t,n,s,r),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:r,headerCode:a,precision:o}=this;let l=`${s} ${e} ( ${r.trim()} )`;o!==""&&(l=`${o} ${l}`),t=a+l+n}else t="";return t}}class Mk extends Ek{parseFunction(e){return new mie(e)}}const hF=new WeakMap,nd=[],Kh=[];class gie extends rm{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new wN,this.nodeBuilderCache=new Map,this.callHashCache=new hu,this.groupsData=new hu,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===KD.name)return!0;if(n===ln.name){const r=this.get(e),a=this.nodeFrame.renderId;return r.renderId!==a?(r.renderId=a,!0):!1}if(n===f8.name){const r=this.get(e),a=this.nodeFrame.frameId;return r.frameId!==a?(r.frameId=a,!0):!1}nd[0]=t,nd[1]=e;let s=this.groupsData.get(nd);return s===void 0&&this.groupsData.set(nd,s={}),nd.length=0,s.version!==t.version?(s.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,r=this.getForRenderCacheKey(e);if(n=s.get(r),n===void 0){const a=l=>{const u=this.backend.createNodeBuilder(e.object,this.renderer);return u.scene=e.scene,u.material=l,u.camera=e.camera,u.context.material=l,u.lightsNode=e.lightsNode,u.environmentNode=this.getEnvironmentNode(e.scene),u.fogNode=this.getFogNode(e.scene),u.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&u.enableMultiview(),u};let o=a(e.material);try{o.build()}catch(l){o=a(new ys),o.build(),nt("TSL: "+l)}n=this._createNodeBuilderState(o),s.set(r,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),n=this._createNodeBuilderState(s),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Wne(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){nd[0]=e,nd[1]=t;const n=this.renderer.info.calls,s=this.callHashCache.get(nd)||{};if(s.callId!==n){const r=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&Kh.push(t.getCacheKey(!0)),r&&Kh.push(r.getCacheKey()),a&&Kh.push(a.getCacheKey()),Kh.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Kh.push(this.renderer.shadowMap.enabled?1:0),Kh.push(this.renderer.shadowMap.type),s.callId=n,s.cacheKey=T0(Kh),this.callHashCache.set(nd,s),Kh.length=0}return nd.length=0,s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const s=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||s){const r=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Ad||n.mapping===zf||n.mapping===Ed){if(e.backgroundBlurriness>0||n.mapping===Ed)return KO(n);{let a;return n.isCubeTexture===!0?a=Xy(n):a=kn(n),C9(a)}}else{if(n.isTexture===!0)return kn(n,If.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&nt("WebGPUNodes: Unsupported background configuration.",n)}},s);t.backgroundNode=r,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,s=!1){const r=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=r.get(t);return(a===void 0||s)&&(a=n(),r.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const s=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const r=is("color","color",n).setGroup(ln),a=is("density","float",n).setGroup(ln);return zS(r,oU(a))}else if(n.isFog){const r=is("color","color",n).setGroup(ln),a=is("near","float",n).setGroup(ln),o=is("far","float",n).setGroup(ln);return zS(r,aU(a,o))}else nt("Renderer: Unsupported fog configuration.",n)});t.fogNode=s,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const s=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return Xy(n);if(n.isTexture===!0)return kn(n);nt("Nodes: Unsupported environment configuration.",n)});t.environmentNode=s,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,s=null,r=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=s,a.material=r,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return hF.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),s=e.isArrayTexture?b6(e,de(If,nh("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):kn(e,If).renderOutput(t.toneMapping,t.currentColorSpace);return hF.set(e,n),s}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const s of n.updateNodes)t.updateNode(s)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const s of n.updateNodes)t.updateNode(s)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new wN,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Vw=new iu;class UM{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Ln,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const s=e.length;for(let r=0;r<s;r++){Vw.copy(e[r]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[n+r],o=Vw.normal;a.x=-o.x,a.y=-o.y,a.z=-o.z,a.w=Vw.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const s=t.clippingPlanes,r=s.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+r){a.length=o+r;for(let l=0;l<r;l++)a[o+l]=new mn;n=!0}this.projectPlanes(s,a,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new UM(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class xie{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Ob=[];class yie{constructor(){this.bundles=new hu}get(e,t){const n=this.bundles;Ob[0]=e,Ob[1]=t;let s=n.get(Ob);return s===void 0&&(s=new xie(e,t),n.set(Ob,s)),Ob.length=0,s}dispose(){this.bundles=new hu}}class Ck{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const s in e)t[s]=e[s]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){De(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){De(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const vie=new R3,Ub=[];class Rk extends hu{constructor(){super()}createNode(e=[]){return new R3().setLights(e)}getNode(e,t){if(e.isQuadMesh)return vie;Ub[0]=e,Ub[1]=t;let n=this.get(Ub);return n===void 0&&(n=this.createNode(),this.set(Ub,n)),Ub.length=0,n}}class Zb extends bc{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const pF=new Q,mF=new Q;class _ie extends Oo{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new bs,this._cameraL.viewport=new mn,this._cameraR=new bs,this._cameraR.viewport=new mn,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new $C,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Mie.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ze,this._onSessionEvent=Tie.bind(this),this._onSessionEnd=Aie.bind(this),this._onInputSourcesChange=Eie.bind(this),this._onAnimationFrame=Cie.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&De("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&De("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,s,r,a,o,l={}){const u=new Bd(e,t),f=new Zb(r,a,{format:Oi,type:ss,depthTexture:new Bo(r,a,l.stencil?Co:Xi,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?wo:Ro),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f._autoAllocateDepthBuffer=!0;const p=new er({color:16777215,side:Ha});p.map=f.texture,p.map.offset.y=1,p.map.repeat.y=-1;const x=new Ui(u,p);x.position.copy(n),x.quaternion.copy(s);const y={type:"quad",width:e,height:t,translation:n,quaternion:s,pixelwidth:r,pixelheight:a,plane:x,material:p,rendercall:o,renderTarget:f};if(this._layers.push(y),this._session!==null){y.plane.material=new er({color:16777215,side:Ha}),y.plane.material.blending=fp,y.plane.material.blendEquation=aa,y.plane.material.blendSrc=nu,y.plane.material.blendDst=nu,y.xrlayer=this._createXRLayer(y);const _=this._session.renderState.layers;_.unshift(y.xrlayer),this._session.updateRenderState({layers:_})}else f.isXRRenderTarget=!1;return x}createCylinderLayer(e,t,n,s,r,a,o,l,u={}){const f=new y0(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),p=new Zb(a,o,{format:Oi,type:ss,depthTexture:new Bo(a,o,u.stencil?Co:Xi,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?wo:Ro),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const x=new er({color:16777215,side:Yi});x.map=p.texture,x.map.offset.y=1,x.map.repeat.y=-1;const y=new Ui(f,x);y.position.copy(s),y.quaternion.copy(r);const _={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:s,quaternion:r,pixelwidth:a,pixelheight:o,plane:y,material:x,rendercall:l,renderTarget:p};if(this._layers.push(_),this._session!==null){_.plane.material=new er({color:16777215,side:Yi}),_.plane.material.blending=fp,_.plane.material.blendEquation=aa,_.plane.material.blendSrc=nu,_.plane.material.blendDst=nu,_.xrlayer=this._createXRLayer(_);const T=this._session.renderState.layers;T.unshift(_.xrlayer),this._session.updateRenderState({layers:T})}else p.isXRRenderTarget=!1;return y}renderLayers(){const e=new Q,t=new wr,n=this._renderer,s=this.isPresenting,r=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const o=new Ze;n.getSize(o);const l=n._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget._hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const f=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(u.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),n.setOutputRenderTarget(u.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:x}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=x):(n._quad=new Ev(new ys),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),u.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(u.renderTarget),u.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(r),n._frameBufferTarget=a,n._setXRLayerSize(o.x,o.y),n._quad=l,this.isPresenting=s}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const s=this._gl,r=s.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let a=null,o=null,l=null;t.depth&&(l=t.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,a=t.stencil?wo:Ro,o=t.stencil?Co:Xi);const u={colorFormat:s.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const f=this._glBinding.createProjectionLayer(u),p=[f];this._glProjLayer=f,t.setPixelRatio(1),t._setXRLayerSize(f.textureWidth,f.textureHeight);const x=this._useMultiview?2:1,y=new Bo(f.textureWidth,f.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,a,x);if(this._xrRenderTarget=new Zb(f.textureWidth,f.textureHeight,{format:Oi,type:ss,colorSpace:t.outputColorSpace,depthTexture:y,stencilBuffer:t.stencil,samples:r.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const _ of this._layers)_.plane.material=new er({color:16777215,side:_.type==="cylinder"?Yi:Ha}),_.plane.material.blending=fp,_.plane.material.blendEquation=aa,_.plane.material.blendSrc=nu,_.plane.material.blendDst=nu,_.xrlayer=this._createXRLayer(_),p.unshift(_.xrlayer);e.updateRenderState({layers:p})}else{const a={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,s,a);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t._setXRLayerSize(o.framebufferWidth,o.framebufferHeight),this._xrRenderTarget=new Zb(o.framebufferWidth,o.framebufferHeight,{format:Oi,type:ss,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,s=e.far,r=this._cameraXR,a=this._cameraL,o=this._cameraR;r.near=o.near=a.near=n,r.far=o.far=a.far=s,r.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==r.near||this._currentDepthFar!==r.far)&&(t.updateRenderState({depthNear:r.near,depthFar:r.far}),this._currentDepthNear=r.near,this._currentDepthFar=r.far),r.layers.mask=e.layers.mask|6,a.layers.mask=r.layers.mask&3,o.layers.mask=r.layers.mask&5;const l=e.parent,u=r.cameras;gF(r,l);for(let f=0;f<u.length;f++)gF(u[f],l);u.length===2?bie(r,a,o):r.projectionMatrix.copy(a.projectionMatrix),Sie(e,r,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new Ry,this._controllers[e]=t),t}}function bie(i,e,t){pF.setFromMatrixPosition(e.matrixWorld),mF.setFromMatrixPosition(t.matrixWorld);const n=pF.distanceTo(mF),s=e.projectionMatrix.elements,r=t.projectionMatrix.elements,a=s[14]/(s[10]-1),o=s[14]/(s[10]+1),l=(s[9]+1)/s[5],u=(s[9]-1)/s[5],f=(s[8]-1)/s[0],p=(r[8]+1)/r[0],x=a*f,y=a*p,_=n/(-f+p),T=_*-f;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(T),i.translateZ(_),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),s[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const A=a+_,S=o+_,C=x-T,w=y+(n-T),B=l*o/S*A,L=u*o/S*A;i.projectionMatrix.makePerspective(C,w,B,L,A,S),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function gF(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function Sie(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=s0*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function Tie(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function Aie(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new Zb(t.pixelwidth,t.pixelheight,{format:Oi,type:ss,depthTexture:new Bo(t.pixelwidth,t.pixelheight,t.stencilBuffer?Co:Xi,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?wo:Ro),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Eie(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const s=i.removed[n],r=t.indexOf(s);r>=0&&(t[r]=null,e[r].disconnect(s))}for(let n=0;n<i.added.length;n++){const s=i.added[n];let r=t.indexOf(s);if(r===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(s),r=o;break}else if(t[o]===null){t[o]=s,r=o;break}if(r===-1)break}const a=e[r];a&&a.connect(s)}}function Mie(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function Cie(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,s=n.backend,r=this._glBaseLayer,a=this.getReferenceSpace(),o=e.getViewerPose(a);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&s.setXRTarget(r.framebuffer);let u=!1;l.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let f=0;f<l.length;f++){const p=l[f];let x;if(this._supportsLayers===!0){const _=this._glBinding.getViewSubImage(this._glProjLayer,p);x=_.viewport,f===0&&s.setXRRenderTargetTextures(this._xrRenderTarget,_.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:_.depthStencilTexture)}else x=r.getViewport(p);let y=this._cameras[f];y===void 0&&(y=new bs,y.layers.enable(f),y.viewport=new mn,this._cameras[f]=y),y.matrix.fromArray(p.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(p.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(x.x,x.y,x.width,x.height),f===0&&(t.matrix.copy(y.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(y)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const u=this._controllerInputSources[l],f=this._controllers[l];u!==null&&f!==void 0&&f.update(u,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class wk extends Oo{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new mn(0,0,this._width,this._height),this._scissor=new mn(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new bT,this.depthTexture=new Bo}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,s){const r=this._scissor;e.isVector4?r.copy(e):r.set(e,t,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,s,r=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,s),o.minDepth=r,o.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const xF=new Qf,sy=new Ze,Hw=new mn,kw=new Zp,Ww=new dv,BE=new Yt,yf=new mn;class Rie{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:s=!0,depth:r=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:u=null,colorBufferType:f=Ai,multiview:p=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=n,this.outputColorSpace=Mr,this.toneMapping=zr,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=r,this.stencil=a,this.info=new pZ,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new Ck,this.lighting=new Rk,this._samples=l||o===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new wk(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new _O,this._inspector.setRenderer(this),this._getFallback=u,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Ev(new ys),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const x=this.alpha===!0?0:1;this._clearColor=new eU(0,0,0,x),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=f,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:ev},this.xr=new _ie(this,p),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(y,_,T)=>{await this.compileAsync(y,_);const A=this._renderLists.get(y,_),S=this._renderContexts.get(y,_,this._renderTarget),C=y.overrideMaterial||T.material,w=this._objects.get(T,C,y,_,A.lightsNode,S,S.clippingContext),{fragmentShader:B,vertexShader:L}=w.getNodeBuilderState();return{fragmentShader:B,vertexShader:L}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(r){t(r);return}else{t(s);return}}this._nodes=new gie(this,n),this._animation=new rZ(this,this._nodes,this.info),this._attributes=new fZ(n),this._background=new Hne(this,this._nodes),this._geometries=new hZ(this._attributes,this.info),this._textures=new wZ(this,n,this.info),this._pipelines=new yZ(n,this._nodes),this._bindings=new vZ(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new cZ(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new SZ(this.lighting),this._bundles=new yie,this._renderContexts=new CZ,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,r=s.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:xF;n===null&&(n=e);const f=this._renderTarget,p=this._renderContexts.get(n,t,f),x=this._activeMipmapLevel,y=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=y,s.renderId++,s.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new UM),p.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f);const _=this._renderLists.get(e,t);if(_.begin(),this._projectObject(e,t,0,_,p.clippingContext),n!==e&&n.traverseVisible(function(w){w.isLight&&w.layers.test(t.layers)&&_.pushLight(w)}),_.finish(),f!==null){this._textures.updateRenderTarget(f,x);const w=this._textures.get(f);p.textures=w.textures,p.depthTexture=w.depthTexture}else p.textures=null,p.depthTexture=null;this._background.update(u,_,p);const T=_.opaque,A=_.transparent,S=_.transparentDoublePass,C=_.lightsNode;this.opaque===!0&&T.length>0&&this._renderObjects(T,t,u,C),this.transparent===!0&&A.length>0&&this._renderTransparents(A,S,t,u,C),s.renderId=r,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(y)}async renderAsync(e,t){qi('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){nt("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=mN,this.overrideNodes.modelNormalViewMatrix=gN):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===mN&&this.overrideNodes.modelNormalViewMatrix===gN}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),nt(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:s,camera:r,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(s,r),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const f=s.version!==u.version,p=u.renderContexts.has(o)===!1||f;if(u.renderContexts.add(o),p){this.backend.beginBundle(o),(u.renderObjects===void 0||f)&&(u.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:x,transparent:y,opaque:_}=a;this.opaque===!0&&_.length>0&&this._renderObjects(_,r,t,n),this.transparent===!0&&y.length>0&&this._renderTransparents(y,x,r,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,l),u.version=s.version}else{const{renderObjects:x}=u;for(let y=0,_=x.length;y<_;y++){const T=x[y];this._nodes.needsRefresh(T)&&(this._nodes.updateBefore(T),this._nodes.updateForRender(T),this._bindings.updateForRender(T),this._nodes.updateAfter(T))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==zr,s=t!==yn.workingColorSpace;if(n===!1&&s===!1)return null;const{width:r,height:a}=this.getDrawingBufferSize(sy),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;u===null&&(u=new bc(r,a,{depthBuffer:o,stencilBuffer:l,type:this._colorBufferType,format:Oi,colorSpace:yn.workingColorSpace,generateMipmaps:!1,minFilter:Dn,magFilter:Dn,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const f=this.getOutputRenderTarget();u.depthBuffer=o,u.stencilBuffer=l,f!==null?u.setSize(f.width,f.height,f.depth):u.setSize(r,a,1);const p=this._canvasTarget;return u.viewport.copy(p._viewport),u.scissor.copy(p._scissor),u.viewport.multiplyScalar(p._pixelRatio),u.scissor.multiplyScalar(p._pixelRatio),u.scissorTest=p._scissorTest,u.multiview=f!==null?f.multiview:!1,u.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,u._autoAllocateDepthBuffer=f!==null?f._autoAllocateDepthBuffer:!1,u}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,r=this._nodes.nodeFrame,a=r.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:xF,f=this._renderTarget||this._outputRenderTarget,p=this._activeCubeFace,x=this._activeMipmapLevel;let y;s!==null?(y=s,this.setRenderTarget(y)):y=f;const _=this._renderContexts.get(e,t,y);this._currentRenderContext=_,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(_),this.inspector.beginRender(this.backend.getTimestampUID(_),e,t,y);const T=this.coordinateSystem,A=this.xr;if(t.coordinateSystem!==T&&A.isPresenting===!1&&(t.coordinateSystem=T,t.updateProjectionMatrix(),t.isArrayCamera))for(const te of t.cameras)te.coordinateSystem=T,te.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),A.enabled===!0&&A.isPresenting===!0&&(A.cameraAutoUpdate===!0&&A.updateCamera(t),t=A.getCamera());const S=this._canvasTarget;let C=S._viewport,w=S._scissor,B=S._pixelRatio;y!==null&&(C=y.viewport,w=y.scissor,B=1),this.getDrawingBufferSize(sy),Hw.set(0,0,sy.width,sy.height);const L=C.minDepth===void 0?0:C.minDepth,D=C.maxDepth===void 0?1:C.maxDepth;_.viewportValue.copy(C).multiplyScalar(B).floor(),_.viewportValue.width>>=x,_.viewportValue.height>>=x,_.viewportValue.minDepth=L,_.viewportValue.maxDepth=D,_.viewport=_.viewportValue.equals(Hw)===!1,_.scissorValue.copy(w).multiplyScalar(B).floor(),_.scissor=S._scissorTest&&_.scissorValue.equals(Hw)===!1,_.scissorValue.width>>=x,_.scissorValue.height>>=x,_.clippingContext||(_.clippingContext=new UM),_.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,y);const O=t.isArrayCamera?Ww:kw;t.isArrayCamera||(BE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(BE,t.coordinateSystem,t.reversedDepth));const F=this._renderLists.get(e,t);if(F.begin(),this._projectObject(e,t,0,F,_.clippingContext),F.finish(),this.sortObjects===!0&&F.sort(this._opaqueSort,this._transparentSort),y!==null){this._textures.updateRenderTarget(y,x);const te=this._textures.get(y);_.textures=te.textures,_.depthTexture=te.depthTexture,_.width=te.width,_.height=te.height,_.renderTarget=y,_.depth=y.depthBuffer,_.stencil=y.stencilBuffer}else _.textures=null,_.depthTexture=null,_.width=sy.width,_.height=sy.height,_.depth=this.depth,_.stencil=this.stencil;_.width>>=x,_.height>>=x,_.activeCubeFace=p,_.activeMipmapLevel=x,_.occlusionQueryCount=F.occlusionQueryCount,_.scissorValue.max(yf.set(0,0,0,0)),_.scissorValue.x+_.scissorValue.width>_.width&&(_.scissorValue.width=Math.max(_.width-_.scissorValue.x,0)),_.scissorValue.y+_.scissorValue.height>_.height&&(_.scissorValue.height=Math.max(_.height-_.scissorValue.y,0)),this._background.update(u,F,_),_.camera=t,this.backend.beginRender(_);const{bundles:U,lightsNode:P,transparentDoublePass:X,transparent:Z,opaque:ee}=F;return U.length>0&&this._renderBundles(U,u,P),this.opaque===!0&&ee.length>0&&this._renderObjects(ee,t,u,P),this.transparent===!0&&Z.length>0&&this._renderTransparents(Z,X,t,u,P),this.backend.finishRender(_),r.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=l,s!==null&&(this.setRenderTarget(f,p,x),this._renderOutput(y)),u.onAfterRender(this,e,t,y),this.inspector.finishRender(this.backend.getTimestampUID(_)),_}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,s=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=s}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,s){this._canvasTarget.setScissor(e,t,n,s)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,s,r=0,a=1){this._canvasTarget.setViewport(e,t,n,s,r,a)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const s=this._renderTarget||this._getFrameBufferTarget();let r=null;if(s!==null){this._textures.updateRenderTarget(s);const a=this._textures.get(s);r=this._renderContexts.getForClear(s),r.textures=a.textures,r.depthTexture=a.depthTexture,r.width=a.width,r.height=a.height,r.renderTarget=s,r.depth=s.depthBuffer,r.stencil=s.stencilBuffer,r.clearColorValue=this.backend.getClearColor(),r.activeCubeFace=this.getActiveCubeFace(),r.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,r),s!==null&&this._renderTarget===null&&this._renderOutput(s)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){qi('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){qi('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){qi('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){qi('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==zr,t=this.currentColorSpace!==yn.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:zr}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:yn.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return De("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,s=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const r=this.backend,a=this._pipelines,o=this._bindings,l=this._nodes,u=Array.isArray(e)?e:[e];if(u[0]===void 0||u[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const f of u){if(a.has(f)===!1){const y=()=>{f.removeEventListener("dispose",y),a.delete(f),o.deleteForCompute(f),l.delete(f)};f.addEventListener("dispose",y);const _=f.onInitFunction;_!==null&&_.call(f,{renderer:this})}l.updateForCompute(f),o.updateForCompute(f);const p=o.getForCompute(f),x=a.getForCompute(f,p);r.compute(e,f,p,x,t)}r.finishCompute(e),n.renderId=s,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return qi('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){qi('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=yf.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=yf.copy(t).floor();else{nt("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=yf.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,s,r,a),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,s,r,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,s,r,o)}_projectObject(e,t,n,s,r){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(r=r.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)s.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?Ww:kw;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&yf.setFromMatrixPosition(e.matrixWorld).applyMatrix4(BE);const{geometry:u,material:f}=e;f.visible&&s.push(e,u,f,n,yf.z,null,r)}}else if(e.isLineLoop)nt("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?Ww:kw;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:u,material:f}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),yf.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(BE)),Array.isArray(f)){const p=u.groups;for(let x=0,y=p.length;x<y;x++){const _=p[x],T=f[_.materialIndex];T&&T.visible&&s.push(e,u,T,n,yf.z,_,r)}}else f.visible&&s.push(e,u,f,n,yf.z,null,r)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,t),s.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:s}),s.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],t,n,s,r)}_renderBundles(e,t,n){for(const s of e)this._renderBundle(s,t,n)}_renderTransparents(e,t,n,s,r){if(t.length>0){for(const{material:a}of t)a.side=Yi;this._renderObjects(t,n,s,r,"backSide");for(const{material:a}of t)a.side=Ha;this._renderObjects(e,n,s,r);for(const{material:a}of t)a.side=hr}else this._renderObjects(e,n,s,r)}_renderObjects(e,t,n,s,r=null){for(let a=0,o=e.length;a<o;a++){const{object:l,geometry:u,material:f,group:p,clippingContext:x}=e[a];this._currentRenderObjectFunction(l,n,t,u,f,p,s,x,r)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){const s=e.map!==null,r=e.colorNode&&e.colorNode.isNode,a=e.castShadowNode&&e.castShadowNode.isNode;let o=null,l=null,u=null;if(s||r||a){let f,p;a?(f=e.castShadowNode.rgb,p=e.castShadowNode.a):(f=de(0),p=j(1)),s&&(p=p.mul(is("map","texture",e).a)),r&&(p=p.mul(e.colorNode.a)),l=Vt(f,p)}e.depthNode&&e.depthNode.isNode&&(u=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?o=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(o=e.positionNode),n={version:t,colorNode:l,depthNode:u,positionNode:o},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,s,r,a,o,l=null,u=null){let f=!1,p,x,y,_;if(e.onBeforeRender(this,t,n,s,r,a),r.allowOverride===!0&&t.overrideMaterial!==null){const T=t.overrideMaterial;if(f=!0,p=t.overrideMaterial.colorNode,x=t.overrideMaterial.depthNode,y=t.overrideMaterial.positionNode,_=t.overrideMaterial.side,r.positionNode&&r.positionNode.isNode&&(T.positionNode=r.positionNode),T.alphaTest=r.alphaTest,T.alphaMap=r.alphaMap,T.transparent=r.transparent||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode,T.isShadowPassMaterial){const{colorNode:A,depthNode:S,positionNode:C}=this._getShadowNodes(r);T.side=r.shadowSide===null?r.side:r.shadowSide,A!==null&&(T.colorNode=A),S!==null&&(T.depthNode=S),C!==null&&(T.positionNode=C)}r=T}r.transparent===!0&&r.side===hr&&r.forceSinglePass===!1?(r.side=Yi,this._handleObjectFunction(e,r,t,n,o,a,l,"backSide"),r.side=Ha,this._handleObjectFunction(e,r,t,n,o,a,l,u),r.side=hr):this._handleObjectFunction(e,r,t,n,o,a,l,u),f&&(t.overrideMaterial.colorNode=p,t.overrideMaterial.depthNode=x,t.overrideMaterial.positionNode=y,t.overrideMaterial.side=_),e.onAfterRender(this,t,n,s,r,a)}_renderObjectDirect(e,t,n,s,r,a,o,l){const u=this._objects.get(e,t,n,s,r,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a;const f=this._nodes.needsRefresh(u);f&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),f&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,n,s,r,a,o,l){const u=this._objects.get(e,t,n,s,r,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class Nk{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function wie(i){return i+(ip-i%ip)%ip}class Bk extends Nk{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return wie(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class Dk extends Bk{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Nie=0;class Ok extends Dk{constructor(e,t){super("UniformBuffer_"+Nie++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Bie extends Dk{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,s=this.uniforms.length;n<s;n++){const r=this.uniforms[n],a=r.boundary,o=r.itemSize*e,l=t%ip,u=l%a,f=l+u;t+=u,f!==0&&ip-f<o&&(t+=ip-f),r.offset=t/e,t+=o}return Math.ceil(t/ip)*ip}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);nt("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r]!==s){const o=this._getBufferForType(a);o[r]=n[r]=s,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y||n[r+2]!==s.z){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,o[r+2]=n[r+2]=s.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y||n[r+2]!==s.z||n[r+4]!==s.w){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,o[r+2]=n[r+2]=s.z,o[r+3]=n[r+3]=s.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset;if(n[r+0]!==s.r||n[r+1]!==s.g||n[r+2]!==s.b){const a=this.buffer;a[r+0]=n[r+0]=s.r,a[r+1]=n[r+1]=s.g,a[r+2]=n[r+2]=s.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,s=e.getValue().elements,r=e.offset;if(n[r+0]!==s[0]||n[r+1]!==s[1]||n[r+2]!==s[2]||n[r+4]!==s[3]||n[r+5]!==s[4]||n[r+6]!==s[5]||n[r+8]!==s[6]||n[r+9]!==s[7]||n[r+10]!==s[8]){const a=this.buffer;a[r+0]=n[r+0]=s[0],a[r+1]=n[r+1]=s[1],a[r+2]=n[r+2]=s[2],a[r+4]=n[r+4]=s[3],a[r+5]=n[r+5]=s[4],a[r+6]=n[r+6]=s[5],a[r+8]=n[r+8]=s[6],a[r+9]=n[r+9]=s[7],a[r+10]=n[r+10]=s[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,s=e.getValue().elements,r=e.offset;return Oie(n,s,r)===!1&&(this.buffer.set(s,r),Die(n,s,r),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Die(i,e,t){for(let n=0,s=e.length;n<s;n++)i[t+n]=e[n]}function Oie(i,e,t){for(let n=0,s=e.length;n<s;n++)if(i[t+n]!==e[n])return!1;return!0}let Uie=0;class Uk extends Bie{constructor(e,t){super(e),this.id=Uie++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class Lk extends Nk{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let Lie=0;class Iie extends Lk{constructor(e,t){super(e,t),this.id=Lie++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class O3 extends Iie{constructor(e,t,n,s=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=s}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Ik extends O3{constructor(e,t,n,s=null){super(e,t,n,s),this.isSampledCubeTexture=!0}}class NN extends O3{constructor(e,t,n,s=null){super(e,t,n,s),this.isSampledTexture3D=!0}}const yF={bitcast_int_uint:new Fr("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),bitcast_uint_int:new Fr("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }")},Pie={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint"},Fie={low:"lowp",medium:"mediump",high:"highp"},vF={swizzleAssign:!0,storageBuffer:!1},_F={perspective:"smooth",linear:"noperspective"},bF={centroid:"centroid"},SF=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class Gie extends _U{constructor(e,t){super(e,t,new Mk),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Ga}_include(e){const t=yF[e];return t.build(this),this.addInclude(t),t}getMethod(e){return yF[e]!==void 0&&this._include(e),Pie[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),s=[];for(const a of t.inputs)s.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,s=t.count*t.itemSize,{itemSize:r}=t,a=t.array.constructor.name.toLowerCase().includes("int");let o=a?Jf:Kf;r===2?o=a?Kp:Al:r===3?o=a?AB:m0:r===4&&(o=a?Jp:Oi);const l={Float32Array:Ti,Uint8Array:ss,Uint16Array:Tl,Uint32Array:Xi,Int8Array:dd,Int16Array:fd,Int32Array:fr,Uint8ClampedArray:ss},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/r))));let f=Math.ceil(s/r/u);u*f*r<s&&f++;const p=u*f*r,x=new n.constructor(p);x.set(n,0),t.array=x;const y=new No(t.array,u,f,o,l[t.array.constructor.name]||Ti);y.needsUpdate=!0,y.isPBOTexture=!0;const _=new fu(y,null,null);_.setPrecision("high"),t.pboNode=_,t.pbo=_.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,s=t.value;if(this.renderer.backend.has(s)){const f=this.renderer.backend.get(s);f.pbo=s.pbo}const r=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(r);this.increaseUsage(n);const o=n.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const f=this.getVarFromNode(e);u=this.getPropertyName(f);const p=this.getDataFromNode(t);let x=p.propertySizeName;x===void 0&&(x=u+"Size",this.getVarFromNode(t,x,"uint"),this.addLineFlowCode(`${x} = uint( textureSize( ${a}, 0 ).x )`,e),p.propertySizeName=x);const{itemSize:y}=s,_="."+tm.join("").slice(0,y),T=`ivec2(${o} % ${x}, ${o} / ${x})`,A=this.generateTextureLoad(null,a,T,"0",null,null);let S="vec4";s.pbo.type===Xi?S="uvec4":s.pbo.type===fr&&(S="ivec4"),this.addLineFlowCode(`${u} = ${S}(${A})${_}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,n,s,r,a){s===null&&(s="0");let o;return r?a?o=`texelFetchOffset( ${t}, ivec3( ${n}, ${r} ), ${s}, ${a} )`:o=`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:a?o=`texelFetchOffset( ${t}, ${n}, ${s}, ${a} )`:o=`texelFetch( ${t}, ${n}, ${s} )`,e!==null&&e.isDepthTexture&&(o+=".x"),o}generateTexture(e,t,n,s,r){return s&&(n=`vec3( ${n}, ${s} )`),e.isDepthTexture?r?`textureOffset( ${t}, ${n}, ${r} ).x`:`texture( ${t}, ${n} ).x`:r?`textureOffset( ${t}, ${n}, ${r} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,s,r){return r?`textureLodOffset( ${t}, ${n}, ${s}, ${r} )`:`textureLod( ${t}, ${n}, ${s} )`}generateTextureBias(e,t,n,s,r){return r?`textureOffset( ${t}, ${n}, ${r}, ${s} )`:`texture( ${t}, ${n}, ${s} )`}generateTextureGrad(e,t,n,s,r){return r?`textureGradOffset( ${t}, ${n}, ${s[0]}, ${s[1]}, ${r} )`:`textureGrad( ${t}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return r?a?`textureOffset( ${t}, vec4( ${n}, ${r}, ${s} ), ${a} )`:`texture( ${t}, vec4( ${n}, ${r}, ${s} ) )`:a?`textureOffset( ${t}, vec3( ${n}, ${s} ), ${a} )`:`texture( ${t}, vec3( ${n}, ${s} ) )`;nt(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const s of n)t.push(`${this.getVar(s.type,s.name,s.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],s={};for(const a of t){let o=null,l=!1;if(a.type==="texture"||a.type==="texture3D"){const f=a.node.value;let p="";(f.isDataTexture===!0||f.isData3DTexture===!0)&&(f.type===Xi?p="u":f.type===fr&&(p="i")),a.type==="texture3D"&&f.isArrayTexture===!1?o=`${p}sampler3D ${a.name};`:f.compareFunction?f.isArrayTexture===!0?o=`sampler2DArrayShadow ${a.name};`:o=`sampler2DShadow ${a.name};`:f.isArrayTexture===!0||f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0?o=`${p}sampler2DArray ${a.name};`:o=`${p}sampler2D ${a.name};`}else if(a.type==="cubeTexture")o=`samplerCube ${a.name};`;else if(a.type==="buffer"){const f=a.node,p=this.getType(f.bufferType),x=f.bufferCount,y=x>0?x:"";o=`${f.name} {
	${p} ${a.name}[${y}];
};
`}else o=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,l=!0;const u=a.node.precision;if(u!==null&&(o=Fie[u]+" "+o),l){o="	"+o;const f=a.groupNode.name;(s[f]||(s[f]=[])).push(o)}else o="uniform "+o,n.push(o)}let r="";for(const a in s){const o=s[a];r+=this._getGLSLUniformStruct(e+"_"+a,o.join(`
`))+`
`}return r+=n.join(`
`),r}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==fr){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let s=0;for(const r of n)t+=`layout( location = ${s++} ) in ${r.type} ${r.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],s=[];for(const r of n)if(r.output)for(const a of r.members)s.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+r.name+` {
`;a+=this.getStructMembers(r),a+=`
};
`,t.push(a)}return s.length===0&&s.push("layout( location = 0 ) out vec4 fragColor;"),`
`+s.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const s of n){e==="compute"&&(s.needsInterpolation=!0);const r=this.getType(s.type);if(s.needsInterpolation)if(s.interpolationType){const a=_F[s.interpolationType]||s.interpolationType,o=bF[s.interpolationSampling]||"";t+=`${a} ${o} out ${r} ${s.name};
`}else{const a=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${a}out ${r} ${s.name};
`}else t+=`${r} ${s.name};
`}else if(e==="fragment"){for(const s of n)if(s.needsInterpolation){const r=this.getType(s.type);if(s.interpolationType){const a=_F[s.interpolationType]||s.interpolationType,o=bF[s.interpolationSampling]||"";t+=`${a} ${o} in ${r} ${s.name};
`}else{const a=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${a}in ${r} ${s.name};
`}}}for(const s of this.builtins[e])t+=`${s};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,s)=>n*s,1)}u`}getSubgroupSize(){nt("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){nt("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){nt("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:s,behavior:r}of n.values())t.push(`#extension ${s} : ${r}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=vF[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const s=this.renderer.backend.extensions;s.has(n)&&(s.get(n),t=!0)}vF[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const s=e[n],r=this.getPropertyName(s.attributeNode);r&&(t+=`${s.varyingName} = ${r};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${SF}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${SF}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const s=this.flowNodes[t],r=s[s.length-1];for(const o of s){const l=this.getFlowData(o),u=o.name;u&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${u}
	`),n+=`${l.code}
	`,o===r&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${l.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,s=null){const r=super.getUniformFromNode(e,t,n,s),a=this.getDataFromNode(e,n,this.globalCache);let o=a.uniformGPU;if(o===void 0){const l=e.groupNode,u=l.name,f=this.getBindGroupArray(u,n);if(t==="texture")o=new O3(r.name,r.node,l),f.push(o);else if(t==="cubeTexture")o=new Ik(r.name,r.node,l),f.push(o);else if(t==="texture3D")o=new NN(r.name,r.node,l),f.push(o);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,r.name=`buffer${e.id}`;const p=new Ok(e,l);p.name=e.name,f.push(p),o=p}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let x=p[u];x===void 0&&(x=new Uk(n+"_"+u,l),p[u]=x,f.push(x)),o=this.getNodeUniform(r,t),x.addUniform(o)}a.uniformGPU=o}return r}}let Xw=null,ry=null;class Pk{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[dc.RENDER]:null,[dc.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let s;e.isComputeNode===!0?s="c:"+this.renderer.info.compute.frameCalls:s="r:"+this.renderer.info.render.frameCalls,t.timestampUID=s+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?dc.COMPUTE:dc.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){qi("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return Xw=Xw||new Ze,this.renderer.getDrawingBufferSize(Xw)}setScissorTest(){}getClearColor(){const e=this.renderer;return ry=ry||new eU,e.getClearColor(ry),ry.getRGB(ry),ry}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:_C(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${$f} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let zie=0;class Vie{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class Hie{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:s}=n,r=e.array,a=e.usage||s.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=n.get(o);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(s,t,r,a),l.bufferGPU=u,l.bufferType=t,l.version=o.version);let f;if(r instanceof Float32Array)f=s.FLOAT;else if(typeof Float16Array<"u"&&r instanceof Float16Array)f=s.HALF_FLOAT;else if(r instanceof Uint16Array)e.isFloat16BufferAttribute?f=s.HALF_FLOAT:f=s.UNSIGNED_SHORT;else if(r instanceof Int16Array)f=s.SHORT;else if(r instanceof Uint32Array)f=s.UNSIGNED_INT;else if(r instanceof Int32Array)f=s.INT;else if(r instanceof Int8Array)f=s.BYTE;else if(r instanceof Uint8Array)f=s.UNSIGNED_BYTE;else if(r instanceof Uint8ClampedArray)f=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+r);let p={bufferGPU:u,bufferType:t,type:f,byteLength:r.byteLength,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:f===s.INT||f===s.UNSIGNED_INT||e.gpuType===fr,id:zie++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const x=this._createBuffer(s,t,r,a);p=new Vie(p,x)}n.set(e,p)}updateAttribute(e){const t=this.backend,{gl:n}=t,s=e.array,r=e.isInterleavedBufferAttribute?e.data:e,a=t.get(r),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),l.length===0)n.bufferSubData(o,0,s);else{for(let u=0,f=l.length;u<f;u++){const p=l[u];n.bufferSubData(o,p.start*s.BYTES_PER_ELEMENT,s,p.start,p.count)}r.clearUpdateRanges()}n.bindBuffer(o,null),a.version=r.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const s=t.get(e);n.deleteBuffer(s.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:r}=t.get(s),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,r);const l=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,u),n.deleteBuffer(l),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,n,s){const r=e.createBuffer();return e.bindBuffer(t,r),e.bufferData(t,n,s),e.bindBuffer(t,null),r}}let qw,Lb,kie=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;qw={[aa]:e.FUNC_ADD,[jS]:e.FUNC_SUBTRACT,[$S]:e.FUNC_REVERSE_SUBTRACT},Lb={[nu]:e.ZERO,[KS]:e.ONE,[JS]:e.SRC_COLOR,[Vg]:e.SRC_ALPHA,[iT]:e.SRC_ALPHA_SATURATE,[tT]:e.DST_COLOR,[QS]:e.DST_ALPHA,[ZS]:e.ONE_MINUS_SRC_COLOR,[Hg]:e.ONE_MINUS_SRC_ALPHA,[nT]:e.ONE_MINUS_DST_COLOR,[eT]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new mn().fromArray(t),this.currentViewport=new mn().fromArray(n),this._tempVec4=new mn}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==rC?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===vS?t.cullFace(t.BACK):e===aC?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,s,r,a,o,l){const{gl:u}=this;if(e===ca){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==fp){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==aa||this.currentBlendEquationAlpha!==aa)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=aa,this.currentBlendEquationAlpha=aa),l)switch(e){case Mo:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case mp:u.blendFunc(u.ONE,u.ONE);break;case gp:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case xp:u.blendFuncSeparate(u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE);break;default:nt("WebGLState: Invalid blending: ",e);break}else switch(e){case Mo:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case mp:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE,u.ONE,u.ONE);break;case gp:nt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case xp:nt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:nt("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}r=r||t,a=a||n,o=o||s,(t!==this.currentBlendEquation||r!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(qw[t],qw[r]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=r),(n!==this.currentBlendSrc||s!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(Lb[n],Lb[s],Lb[a],Lb[o]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case kg:t.depthFunc(t.NEVER);break;case Wg:t.depthFunc(t.ALWAYS);break;case Xg:t.depthFunc(t.LESS);break;case Sd:t.depthFunc(t.LEQUAL);break;case qg:t.depthFunc(t.EQUAL);break;case Yg:t.depthFunc(t.GEQUAL);break;case jg:t.depthFunc(t.GREATER);break;case $g:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,s){const r=this._tempVec4.set(e,t,n,s);if(this.currentScissor.equals(r)===!1){const{gl:a}=this;a.scissor(r.x,r.y,r.z,r.w),this.currentScissor.copy(r)}}viewport(e,t,n,s){const r=this._tempVec4.set(e,t,n,s);if(this.currentViewport.equals(r)===!1){const{gl:a}=this;a.viewport(r.x,r.y,r.z,r.w),this.currentViewport.copy(r)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:s}=this;e.side===hr?this.disable(s.CULL_FACE):this.enable(s.CULL_FACE);let r=e.side===Yi;t&&(r=!r),this.setFlipSided(r),e.blending===Mo&&e.transparent===!1?this.setBlending(ca):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(s.SAMPLE_ALPHA_TO_COVERAGE):this.disable(s.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let l=0;l<8;l++)l<n?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,n){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:s}=this;return s[e]!==t?(n.bindFramebuffer(e,t),s[e]=t,e===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let s=[],r=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(t),s===void 0&&(s=[],this.currentDrawbuffers.set(t,s));const a=e.textures;if(s.length!==a.length||s[0]!==n.COLOR_ATTACHMENT0){for(let o=0,l=a.length;o<l;o++)s[o]=n.COLOR_ATTACHMENT0+o;s.length=a.length,r=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,r=!0);r&&n.drawBuffers(s)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:s}=this;e===void 0&&(e=t.TEXTURE0+s-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:s,currentTextureSlot:r,currentBoundTextures:a,maxTextures:o}=this;n===void 0&&(r===null?n=s.TEXTURE0+o-1:n=r);let l=a[n];l===void 0&&(l={type:void 0,texture:void 0},a[n]=l),(l.type!==e||l.texture!==t)&&(r!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,n){const{gl:s}=this,r=`${e}-${t}`;return this.currentBoundBufferBases[r]!==n?(s.bindBufferBase(e,t,n),this.currentBoundBufferBases[r]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,s=n[t];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}},Wie=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Ga){const{gl:n,extensions:s}=this;let r;const a=yn.getTransfer(t);if(e===ss)return n.UNSIGNED_BYTE;if(e===tv)return n.UNSIGNED_SHORT_4_4_4_4;if(e===nv)return n.UNSIGNED_SHORT_5_5_5_1;if(e===iv)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===sv)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===dd)return n.BYTE;if(e===fd)return n.SHORT;if(e===Tl)return n.UNSIGNED_SHORT;if(e===fr)return n.INT;if(e===Xi)return n.UNSIGNED_INT;if(e===Ti)return n.FLOAT;if(e===Ai)return n.HALF_FLOAT;if(e===rT)return n.ALPHA;if(e===m0)return n.RGB;if(e===Oi)return n.RGBA;if(e===Ro)return n.DEPTH_COMPONENT;if(e===wo)return n.DEPTH_STENCIL;if(e===Kf)return n.RED;if(e===Jf)return n.RED_INTEGER;if(e===Al)return n.RG;if(e===Kp)return n.RG_INTEGER;if(e===Jp)return n.RGBA_INTEGER;if(e===hd||e===pd||e===md||e===gd)if(a===qt)if(r=s.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(e===hd)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===pd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===md)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===gd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=s.get("WEBGL_compressed_texture_s3tc"),r!==null){if(e===hd)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===pd)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===md)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===gd)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===Kg||e===Jg||e===Zg||e===Qg)if(r=s.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(e===Kg)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Jg)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Zg)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Qg)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===yp||e===vp||e===_p)if(r=s.get("WEBGL_compressed_texture_etc"),r!==null){if(e===yp||e===vp)return a===qt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===_p)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===bp||e===Sp||e===Tp||e===Ap||e===Ep||e===Mp||e===Cp||e===Rp||e===wp||e===Np||e===Bp||e===Dp||e===Op||e===Up)if(r=s.get("WEBGL_compressed_texture_astc"),r!==null){if(e===bp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Sp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Tp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Ap)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Ep)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Mp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Cp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Rp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===wp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Np)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Bp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Dp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Op)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Up)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Lp)if(r=s.get("EXT_texture_compression_bptc"),r!==null){if(e===Lp)return a===qt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Ip||e===Pp||e===Fp||e===Gp)if(r=s.get("EXT_texture_compression_rgtc"),r!==null){if(e===Ip)return r.COMPRESSED_RED_RGTC1_EXT;if(e===Pp)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Fp)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Gp)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Co?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,s)=>{function r(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),s();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(r);return}e.deleteSync(t),n()}r()})}},TF=!1,DE,Yw,AF;class Xie{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,TF===!1&&(this._init(),TF=!0)}_init(){const e=this.gl;DE={[wl]:e.REPEAT,[ts]:e.CLAMP_TO_EDGE,[lu]:e.MIRRORED_REPEAT},Yw={[es]:e.NEAREST,[p0]:e.NEAREST_MIPMAP_NEAREST,[Sl]:e.NEAREST_MIPMAP_LINEAR,[Dn]:e.LINEAR,[ud]:e.LINEAR_MIPMAP_NEAREST,[Cr]:e.LINEAR_MIPMAP_LINEAR},AF={[oT]:e.NEVER,[fT]:e.ALWAYS,[rv]:e.LESS,[av]:e.LEQUAL,[lT]:e.EQUAL,[dT]:e.GEQUAL,[cT]:e.GREATER,[uT]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,s,r=!1){const{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];De("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===a.RED&&(n===a.FLOAT&&(l=a.R32F),n===a.HALF_FLOAT&&(l=a.R16F),n===a.UNSIGNED_BYTE&&(l=a.R8),n===a.UNSIGNED_SHORT&&(l=a.R16),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.R8UI),n===a.UNSIGNED_SHORT&&(l=a.R16UI),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),t===a.RG&&(n===a.FLOAT&&(l=a.RG32F),n===a.HALF_FLOAT&&(l=a.RG16F),n===a.UNSIGNED_BYTE&&(l=a.RG8),n===a.UNSIGNED_SHORT&&(l=a.RG16),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RG8UI),n===a.UNSIGNED_SHORT&&(l=a.RG16UI),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),t===a.RGB){const u=r?zp:yn.getTransfer(s);n===a.FLOAT&&(l=a.RGB32F),n===a.HALF_FLOAT&&(l=a.RGB16F),n===a.UNSIGNED_BYTE&&(l=a.RGB8),n===a.UNSIGNED_SHORT&&(l=a.RGB16),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I),n===a.UNSIGNED_BYTE&&(l=u===qt?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(l=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGB8UI),n===a.UNSIGNED_SHORT&&(l=a.RGB16UI),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I)),t===a.RGBA){const u=r?zp:yn.getTransfer(s);n===a.FLOAT&&(l=a.RGBA32F),n===a.HALF_FLOAT&&(l=a.RGBA16F),n===a.UNSIGNED_BYTE&&(l=a.RGBA8),n===a.UNSIGNED_SHORT&&(l=a.RGBA16),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I),n===a.UNSIGNED_BYTE&&(l=u===qt?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(l=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(l=a.DEPTH_COMPONENT24),n===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:n,extensions:s,backend:r}=this,a=yn.getPrimaries(yn.workingColorSpace),o=t.colorSpace===Ga?null:yn.getPrimaries(t.colorSpace),l=t.colorSpace===Ga||a===o?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),n.texParameteri(e,n.TEXTURE_WRAP_S,DE[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,DE[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,DE[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,Yw[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,f=t.minFilter===Dn&&u?Cr:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,Yw[f]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,AF[t.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===es||t.minFilter!==Sl&&t.minFilter!==Cr||t.type===Ti&&s.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const p=s.get("EXT_texture_filter_anisotropic");n.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,r.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:s}=this,r=this.getGLTextureType(e);let a=s[r];a===void 0&&(a=t.createTexture(),n.state.bindTexture(r,a),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST),s[r]=a),n.set(e,{textureGPU:a,glTextureType:r})}createTexture(e,t){const{gl:n,backend:s}=this,{levels:r,width:a,height:o,depth:l}=t,u=s.utils.convert(e.format,e.colorSpace),f=s.utils.convert(e.type),p=this.getInternalFormat(e.internalFormat,u,f,e.colorSpace,e.isVideoTexture),x=n.createTexture(),y=this.getGLTextureType(e);s.state.bindTexture(y,x),this.setTextureParameters(y,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,r,p,a,o,l):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,r,p,a,o,l):e.isVideoTexture||n.texStorage2D(y,r,p,a,o),s.set(e,{textureGPU:x,glTextureType:y,glFormat:u,glType:f,glInternalFormat:p})}copyBufferToTexture(e,t){const{gl:n,backend:s}=this,{textureGPU:r,glTextureType:a,glFormat:o,glType:l}=s.get(t),{width:u,height:f}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(a,r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,u,f,o,l,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:s,height:r}=t,{textureGPU:a,glTextureType:o,glFormat:l,glType:u,glInternalFormat:f}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const p=e.mipmaps,x=t.image;for(let y=0;y<p.length;y++){const _=p[y];e.isCompressedArrayTexture?e.format!==n.RGBA?l!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,_.width,_.height,x.depth,l,_.data):De("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,_.width,_.height,x.depth,l,u,_.data):l!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,_.width,_.height,l,_.data):De("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=t.images,x=e.mipmaps;for(let y=0;y<6;y++){const _=OE(p[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,0,0,s,r,l,u,_);for(let T=0;T<x.length;T++){const A=x[T],S=OE(A.images[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,T+1,0,0,S.width,S.height,l,u,S)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const p=t.image;if(e.layerUpdates.size>0){const x=vM(p.width,p.height,e.format,e.type);for(const y of e.layerUpdates){const _=p.data.subarray(y*x/p.data.BYTES_PER_ELEMENT,(y+1)*x/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,y,p.width,p.height,1,l,u,_)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,l,u,p.data)}else if(e.isData3DTexture){const p=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,l,u,p.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,f,l,u,t.image);else{const p=e.mipmaps;if(p.length>0)for(let x=0,y=p.length;x<y;x++){const _=p[x],T=OE(_);n.texSubImage2D(o,x,0,0,_.width,_.height,l,u,T)}else{const x=OE(t.image);n.texSubImage2D(o,0,0,0,s,r,l,u,x)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:s,glTextureType:r}=n.get(e);n.state.bindTexture(r,s),t.generateMipmap(r)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const s=n.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const r in s.framebuffers)t.deleteFramebuffer(s.framebuffers[r]);delete s.framebuffers}if(s.depthRenderbuffer&&(t.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(t.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(t.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let r=0;r<s.msaaRenderbuffers.length;r++)t.deleteRenderbuffer(s.msaaRenderbuffers[r]);delete s.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:s}=this,{textureGPU:r,renderTarget:a}=s.get(e);this.deallocateRenderBuffers(a),t===!1&&n.deleteTexture(r),s.delete(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){const{gl:o,backend:l}=this,{state:u}=this.backend,{textureGPU:f,glTextureType:p,glType:x,glFormat:y}=l.get(t);u.bindTexture(p,f);let _,T,A,S,C,w,B,L,D;const O=e.isCompressedTexture?e.mipmaps[a]:e.image;if(n!==null)_=n.max.x-n.min.x,T=n.max.y-n.min.y,A=n.isBox3?n.max.z-n.min.z:1,S=n.min.x,C=n.min.y,w=n.isBox3?n.min.z:0;else{const re=Math.pow(2,-r);_=Math.floor(O.width*re),T=Math.floor(O.height*re),e.isDataArrayTexture||e.isArrayTexture?A=O.depth:e.isData3DTexture?A=Math.floor(O.depth*re):A=1,S=0,C=0,w=0}s!==null?(B=s.x,L=s.y,D=s.z):(B=0,L=0,D=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const F=o.getParameter(o.UNPACK_ROW_LENGTH),U=o.getParameter(o.UNPACK_IMAGE_HEIGHT),P=o.getParameter(o.UNPACK_SKIP_PIXELS),X=o.getParameter(o.UNPACK_SKIP_ROWS),Z=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,O.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,O.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,S),o.pixelStorei(o.UNPACK_SKIP_ROWS,C),o.pixelStorei(o.UNPACK_SKIP_IMAGES,w);const ee=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,te=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const re=l.get(e),W=l.get(t),ne=l.get(re.renderTarget),se=l.get(W.renderTarget),ge=ne.framebuffers[re.cacheKey],_e=se.framebuffers[W.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,ge),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,_e);for(let K=0;K<A;K++)ee&&(o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,re.textureGPU,r,w+K),o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,f,a,D+K)),o.blitFramebuffer(S,C,_,T,B,L,_,T,o.DEPTH_BUFFER_BIT,o.NEAREST);u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else if(r!==0||e.isRenderTargetTexture||l.has(e)){const re=l.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=o.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=o.createFramebuffer()),u.bindFramebuffer(o.READ_FRAMEBUFFER,this._srcFramebuffer),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let W=0;W<A;W++)ee?o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,re.textureGPU,r,w+W):o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,re.textureGPU,r),te?o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,f,a,D+W):o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,f,a),r!==0?o.blitFramebuffer(S,C,_,T,B,L,_,T,o.COLOR_BUFFER_BIT,o.NEAREST):te?o.copyTexSubImage3D(p,a,B,L,D+W,S,C,_,T):o.copyTexSubImage2D(p,a,B,L,S,C,_,T);u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else te?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(p,a,B,L,D,_,T,A,y,x,O.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(p,a,B,L,D,_,T,A,y,O.data):o.texSubImage3D(p,a,B,L,D,_,T,A,y,x,O):e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,a,B,L,_,T,y,x,O.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,a,B,L,O.width,O.height,y,O.data):o.texSubImage2D(o.TEXTURE_2D,a,B,L,_,T,y,x,O);o.pixelStorei(o.UNPACK_ROW_LENGTH,F),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,U),o.pixelStorei(o.UNPACK_SKIP_PIXELS,P),o.pixelStorei(o.UNPACK_SKIP_ROWS,X),o.pixelStorei(o.UNPACK_SKIP_IMAGES,Z),a===0&&t.generateMipmaps&&o.generateMipmap(p),u.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:s}=this,{state:r}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:u,w:f}=n,p=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,x=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const y=o!==0||l!==0;let _,T;if(e.isDepthTexture===!0?(_=s.DEPTH_BUFFER_BIT,T=s.DEPTH_ATTACHMENT,t.stencil&&(_|=s.STENCIL_BUFFER_BIT)):(_=s.COLOR_BUFFER_BIT,T=s.COLOR_ATTACHMENT0),y){const A=this.backend.get(t.renderTarget),S=A.framebuffers[t.getCacheKey()],C=A.msaaFrameBuffer;r.bindFramebuffer(s.DRAW_FRAMEBUFFER,S),r.bindFramebuffer(s.READ_FRAMEBUFFER,C);const w=x-l-f;s.blitFramebuffer(o,w,o+u,w+f,o,w,o+u,w+f,_,s.NEAREST),r.bindFramebuffer(s.READ_FRAMEBUFFER,S),r.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,o,w,u,f),r.unbindTexture()}else{const A=s.createFramebuffer();r.bindFramebuffer(s.DRAW_FRAMEBUFFER,A),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,T,s.TEXTURE_2D,a,0),s.blitFramebuffer(0,0,u,f,0,0,u,f,_,s.NEAREST),s.deleteFramebuffer(A)}}else r.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,o,x-f-l,u,f),r.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,s=!1){const{gl:r}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:u,width:f,height:p}=a;if(r.bindRenderbuffer(r.RENDERBUFFER,e),l&&!u){let x=r.DEPTH_COMPONENT24;s===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(r.RENDERBUFFER,a.samples,x,f,p):n>0?(o&&o.isDepthTexture&&o.type===r.FLOAT&&(x=r.DEPTH_COMPONENT32F),r.renderbufferStorageMultisample(r.RENDERBUFFER,n,x,f,p)):r.renderbufferStorage(r.RENDERBUFFER,x,f,p),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e)}else l&&u&&(n>0?r.renderbufferStorageMultisample(r.RENDERBUFFER,n,r.DEPTH24_STENCIL8,f,p):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,f,p),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e));r.bindRenderbuffer(r.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,s,r,a){const{backend:o,gl:l}=this,{textureGPU:u,glFormat:f,glType:p}=this.backend.get(e),x=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,x);const y=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,y,u,0);const _=this._getTypedArrayType(p),T=this._getBytesPerTexel(p,f),S=s*r*T,C=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,C),l.bufferData(l.PIXEL_PACK_BUFFER,S,l.STREAM_READ),l.readPixels(t,n,s,r,f,p,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const w=new _(S/_.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,C),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,w),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(x),w}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let s=0;if(e===n.UNSIGNED_BYTE&&(s=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(s=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(s=4),t===n.RGBA)return s*4;if(t===n.RGB)return s*3;if(t===n.ALPHA)return s}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function OE(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}let qie=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}},Yie=class{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}};const EF={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};let jie=class{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:s,object:r,type:a,info:o,index:l}=this;l!==0?n.drawElements(s,t,a,e):n.drawArrays(s,e,t),o.update(r,t,1)}renderInstances(e,t,n){const{gl:s,mode:r,type:a,index:o,object:l,info:u}=this;n!==0&&(o!==0?s.drawElementsInstanced(r,t,a,e,n):s.drawArraysInstanced(r,e,t,n),u.update(l,t,n))}renderMultiDraw(e,t,n){const{extensions:s,mode:r,object:a,info:o}=this;if(n===0)return;const l=s.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<n;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(r,t,0,this.type,e,0,n):l.multiDrawArraysWEBGL(r,e,0,t,0,n);let u=0;for(let f=0;f<n;f++)u+=t[f];o.update(a,u,1)}}renderMultiDrawInstances(e,t,n,s){const{extensions:r,mode:a,object:o,info:l}=this;if(n===0)return;const u=r.get("WEBGL_multi_draw");if(u===null)for(let f=0;f<n;f++)this.renderInstances(e[f],t[f],s[f]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,s,0,n):u.multiDrawArraysInstancedWEBGL(a,e,0,t,0,s,0,n);let f=0;for(let p=0;p<n;p++)f+=t[p]*s[p];l.update(o,f,1)}}};class Fk{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(De(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class $ie extends Fk{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){De("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let s=0;s<this.maxQueries;s++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return qi(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(s){s("Error in beginQuery:",s),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){n("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[r,a]of this.queryOffsets)if(this.queryStates.get(a)==="ended"){const l=this.queries[a];e.set(r,this.resolveQuery(l))}if(e.size===0)return this.lastValue;const t={},n=[];for(const[r,a]of e){const o=r.match(/^(.*):f(\d+)$/),l=parseInt(o[2]);n.includes(l)===!1&&n.push(l),t[l]===void 0&&(t[l]=0);const u=await a;this.timestamps.set(r,u),t[l]+=u}const s=t[n[n.length-1]];return this.lastValue=s,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,s}catch(e){return e("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,s=!1;const r=()=>{n&&(clearTimeout(n),n=null)},a=l=>{s||(s=!0,r(),t(l))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(o,1);return}const f=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(f)/1e6)}catch(l){l("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class MF extends Pk{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},s=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function r(a){a.preventDefault();const o={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(o)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=s,this.extensions=new qie(this),this.capabilities=new Yie(this),this.attributeUtils=new Hie(this),this.textureUtils=new Xie(this),this.bufferRenderer=new jie(this),this.state=new kie(this),this.utils=new Wie(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return oa}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const s=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:s.RGBA8}),n!==null){const r=e.stencilBuffer?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:r}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&De("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new $ie(this.gl,e,2048));const n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:r,height:a}=this.getDrawingBufferSize();t.viewport(0,0,r,a)}if(e.scissor){const{x:r,y:a,width:o,height:l}=e.scissorValue;t.scissor(r,e.height-l-a,o,l)}this.initTimestampQuery(dc.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const s=e.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,s=this.get(e),r=s.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>s.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const u=o[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=r,this._resolveRenderTarget(e),r!==null)if(this._setFramebuffer(r),r.viewport)this.updateViewport(r);else{const{width:l,height:u}=this.getDrawingBufferSize();n.viewport(0,0,l,u)}this.prepareTimestampBuffer(dc.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=t;if(n&&s){const r=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let u=0;u<n.length;u++){const f=n[u];f!==null&&a.getQueryParameter(f,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(f,a.QUERY_RESULT)===0&&r.add(s[u]),n[u]=null,a.deleteQuery(f),l++)}l<n.length?requestAnimationFrame(o):t.occluded=r};o()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:s,width:r,height:a}=e.viewportValue;t.viewport(n,e.height-a-s,r,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,s=null,r=!0,a=!0){const{gl:o,renderer:l}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let u=0;if(e&&(u|=o.COLOR_BUFFER_BIT),t&&(u|=o.DEPTH_BUFFER_BIT),n&&(u|=o.STENCIL_BUFFER_BIT),u!==0){let f;s.clearColorValue?f=s.clearColorValue:f=this.getClearColor();const p=l.getClearDepth(),x=l.getClearStencil();if(t&&this.state.setDepthMask(!0),s.textures===null)o.clearColor(f.r,f.g,f.b,f.a),o.clear(u);else{if(r&&this._setFramebuffer(s),e)for(let y=0;y<s.textures.length;y++)y===0?o.clearBufferfv(o.COLOR,y,[f.r,f.g,f.b,f.a]):o.clearBufferfv(o.COLOR,y,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,p,x):t?o.clearBufferfv(o.DEPTH,0,[p]):n&&o.clearBufferiv(o.STENCIL,0,[x]),r&&a&&this._resolveRenderTarget(s)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(dc.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,s,r=null){const{state:a,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:u,attributes:f}=this.get(s),p=this._getVaoKey(f),x=this.vaoCache[p];x===void 0?this.vaoCache[p]=this._createVao(f):a.setVertexState(x),a.useProgram(l),this._bindUniforms(n);const y=this._getTransformFeedback(u);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,y),o.beginTransformFeedback(o.POINTS),r=r!==null?r:t.count,Array.isArray(r)?(qi("WebGLBackend.compute(): The count parameter must be a single number, not an array."),r=r[0]):r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute&&(qi("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),r=t.count),f[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,r):o.drawArrays(o.POINTS,0,r),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let _=0;_<u.length;_++){const T=u[_];T.pbo&&this.has(T.pbo)&&this.textureUtils.copyBufferToTexture(T.transformBuffer,T.pbo),T.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(dc.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:s,context:r,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:l,state:u}=this,f=this.get(r),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const x=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(s,x,a),u.useProgram(o);const y=e.getAttributes(),_=this.get(y);let T=_.vaoGPU;if(T===void 0){const F=this._getVaoKey(y);T=this.vaoCache[F],T===void 0&&(T=this._createVao(y),this.vaoCache[F]=T,_.vaoGPU=T)}const A=e.getIndex(),S=A!==null?this.get(A).bufferGPU:null;u.setVertexState(T,S);const C=f.lastOcclusionObject;if(C!==t&&C!==void 0){if(C!==null&&C.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),t.occlusionTest===!0){const F=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,F),f.occlusionQueries[f.occlusionQueryIndex]=F,f.occlusionQueryObjects[f.occlusionQueryIndex]=t}f.lastOcclusionObject=t}const w=this.bufferRenderer;t.isPoints?w.mode=l.POINTS:t.isLineSegments?w.mode=l.LINES:t.isLine?w.mode=l.LINE_STRIP:t.isLineLoop?w.mode=l.LINE_LOOP:s.wireframe===!0?(u.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),w.mode=l.LINES):w.mode=l.TRIANGLES;const{vertexCount:B,instanceCount:L}=p;let{firstVertex:D}=p;if(w.object=t,A!==null){D*=A.array.BYTES_PER_ELEMENT;const F=this.get(A);w.index=A.count,w.type=F.type}else w.index=0;const O=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(qi("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),w.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?w.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):qi("WebGLBackend: WEBGL_multi_draw not supported."):L>1?w.renderInstances(D,B,L):w.render(D,B)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const F=this.get(e.camera),U=e.camera.cameras,P=e.getBindingGroup("cameraIndex").bindings[0];if(F.indexesGPU===void 0||F.indexesGPU.length!==U.length){const W=new Uint32Array([0,0,0,0]),ne=[];for(let se=0,ge=U.length;se<ge;se++){const _e=l.createBuffer();W[0]=se,l.bindBuffer(l.UNIFORM_BUFFER,_e),l.bufferData(l.UNIFORM_BUFFER,W,l.STATIC_DRAW),ne.push(_e)}F.indexesGPU=ne}const X=this.get(P),Z=this.renderer.getPixelRatio(),ee=this._currentContext.renderTarget,te=this._isRenderCameraDepthArray(this._currentContext),re=this._currentContext.activeCubeFace;if(te){const W=this.get(ee.depthTexture);if(W.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){W.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:ne}=ee;for(let se=0,ge=U.length;se<ge;se++)this.renderer._activeCubeFace=se,this._currentContext.activeCubeFace=se,this._setFramebuffer(this._currentContext),this.clear(!1,!0,ne,this._currentContext,!1,!1);this.renderer._activeCubeFace=re,this._currentContext.activeCubeFace=re}}for(let W=0,ne=U.length;W<ne;W++){const se=U[W];if(t.layers.test(se.layers)){te&&(this.renderer._activeCubeFace=W,this._currentContext.activeCubeFace=W,this._setFramebuffer(this._currentContext));const ge=se.viewport;if(ge!==void 0){const _e=ge.x*Z,K=ge.y*Z,pe=ge.width*Z,we=ge.height*Z;u.viewport(Math.floor(_e),Math.floor(e.context.height-we-K),Math.floor(pe),Math.floor(we))}u.bindBufferBase(l.UNIFORM_BUFFER,X.index,F.indexesGPU[W]),O()}this._currentContext.activeCubeFace=re,this.renderer._activeCubeFace=re}}else O()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,s,r,a){return this.textureUtils.copyTextureToBuffer(e,t,n,s,r,a)}updateSampler(){return""}createNodeBuilder(e,t){return new Gie(e,t)}createProgram(e){const t=this.gl,{stage:n,code:s}=e,r=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(r,s),t.compileShader(r),this.set(e,{shaderGPU:r})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,s=e.pipeline,{fragmentProgram:r,vertexProgram:a}=s,o=n.createProgram(),l=this.get(r).shaderGPU,u=this.get(a).shaderGPU;if(n.attachShader(o,l),n.attachShader(o,u),n.linkProgram(o),this.set(s,{programGPU:o,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const f=new Promise(p=>{const x=this.parallel,y=()=>{n.getProgramParameter(o,x.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),p()):requestAnimationFrame(y)};y()});t.push(f);return}this._completeCompile(e,s)}_handleSource(e,t){const n=e.split(`
`),s=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=r;o<a;o++){const l=o+1;s.push(`${l===t?">":" "} ${l}: ${n[o]}`)}return s.join(`
`)}_getShaderErrors(e,t,n){const s=e.getShaderParameter(t,e.COMPILE_STATUS),a=(e.getShaderInfoLog(t)||"").trim();if(s&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const l=parseInt(o[1]);return n.toUpperCase()+`

`+a+`

`+this._handleSource(e.getShaderSource(t),l)}else return a}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,a=(s.getProgramInfoLog(e)||"").trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,n,t);else{const o=this._getShaderErrors(s,n,"vertex"),l=this._getShaderErrors(s,t,"fragment");nt("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+o+`
`+l)}else a!==""&&De("WebGLProgram: Program Info Log:",a)}}_completeCompile(e,t){const{state:n,gl:s}=this,r=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:l}=r;s.getProgramParameter(a,s.LINK_STATUS)===!1&&this._logProgramError(a,o,l),n.useProgram(a);const u=e.getBindings();this._setupBindings(u,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:s}=this,r={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(r);const{computeProgram:a}=e,o=s.createProgram(),l=this.get(r).shaderGPU,u=this.get(a).shaderGPU,f=a.transforms,p=[],x=[];for(let A=0;A<f.length;A++){const S=f[A];p.push(S.varyingName),x.push(S.attributeNode)}s.attachShader(o,l),s.attachShader(o,u),s.transformFeedbackVaryings(o,p,s.SEPARATE_ATTRIBS),s.linkProgram(o),s.getProgramParameter(o,s.LINK_STATUS)===!1&&this._logProgramError(o,l,u),n.useProgram(o),this._setupBindings(t,o);const y=a.attributes,_=[],T=[];for(let A=0;A<y.length;A++){const S=y[A].node.attribute;_.push(S),this.has(S)||this.attributeUtils.createAttribute(S,s.ARRAY_BUFFER)}for(let A=0;A<x.length;A++){const S=x[A].attribute;this.has(S)||this.attributeUtils.createAttribute(S,s.ARRAY_BUFFER);const C=this.get(S);T.push(C)}this.set(e,{programGPU:o,transformBuffers:T,attributes:_})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,s=0;for(const r of t){this.set(r,{textures:s,uniformBuffers:n});for(const a of r.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&s++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let s=n.uniformBuffers,r=n.textures;for(const a of e.bindings){const o=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer;let{bufferGPU:u}=this.get(l);u===void 0?(u=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:u})):(t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferSubData(t.UNIFORM_BUFFER,0,l)),o.index=s++,o.bufferGPU=u,this.set(a,o)}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:u}=this.get(a.texture);o.index=r++,o.textureGPU=l,o.glTextureType=u,this.set(a,o)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const s=this.get(e).bufferGPU,r=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,s),t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(EF).filter(s=>EF[s]===e),n=this.extensions;for(let s=0;s<t.length;s++)if(n.has(t[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,s,r,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let s=null;if(e.textures!==null){const r=e.renderTarget,a=this.get(r),{samples:o,depthBuffer:l,stencilBuffer:u}=r,f=r.isWebGLCubeRenderTarget===!0,p=r.isRenderTarget3D===!0,x=r.depth>1,y=r.isXRRenderTarget===!0,_=y===!0&&r._hasExternalTextures===!0;let T=a.msaaFrameBuffer,A=a.depthRenderbuffer;const S=this.extensions.get("WEBGL_multisampled_render_to_texture"),C=this.extensions.get("OVR_multiview2"),w=this._useMultisampledExtension(r),B=t6(e);let L;if(f?(a.cubeFramebuffers||(a.cubeFramebuffers={}),L=a.cubeFramebuffers[B]):y&&_===!1?L=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),L=a.framebuffers[B]),L===void 0){L=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,L);const D=e.textures,O=[];if(f){a.cubeFramebuffers[B]=L;const{textureGPU:U}=this.get(D[0]),P=this.renderer._activeCubeFace,X=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+P,U,X)}else{a.framebuffers[B]=L;for(let U=0;U<D.length;U++){const P=D[U],X=this.get(P);X.renderTarget=e.renderTarget,X.cacheKey=B;const Z=t.COLOR_ATTACHMENT0+U;if(r.multiview)C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,Z,X.textureGPU,0,o,0,2);else if(p||x){const ee=this.renderer._activeCubeFace,te=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,Z,X.textureGPU,te,ee)}else if(w)S.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Z,t.TEXTURE_2D,X.textureGPU,0,o);else{const ee=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,Z,t.TEXTURE_2D,X.textureGPU,ee)}}}const F=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const U=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(U,e,0,w),a.xrDepthRenderbuffer=U,O.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,U),t.framebufferRenderbuffer(t.FRAMEBUFFER,F,t.RENDERBUFFER,U)}else if(e.depthTexture!==null){O.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const U=this.get(e.depthTexture);if(U.renderTarget=e.renderTarget,U.cacheKey=B,r.multiview)C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,F,U.textureGPU,0,o,0,2);else if(_&&w)S.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,F,t.TEXTURE_2D,U.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const P=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,F,U.textureGPU,0,P)}else t.framebufferTexture2D(t.FRAMEBUFFER,F,t.TEXTURE_2D,U.textureGPU,0)}a.depthInvalidationArray=O}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,L);const O=this.renderer._activeCubeFace,F=this.get(e.depthTexture),U=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,U,F.textureGPU,0,O)}if((y||w||r.multiview)&&r._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,L);const O=this.get(e.textures[0]);r.multiview?C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,O.textureGPU,0,o,0,2):w?S.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,O.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,O.textureGPU,0);const F=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const U=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,U),t.framebufferRenderbuffer(t.FRAMEBUFFER,F,t.RENDERBUFFER,U)}else{const U=this.get(e.depthTexture);r.multiview?C.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,F,U.textureGPU,0,o,0,2):w?S.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,F,t.TEXTURE_2D,U.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,F,t.TEXTURE_2D,U.textureGPU,0)}}}if(o>0&&w===!1&&!r.multiview){if(T===void 0){const D=[];T=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,T);const O=[],F=e.textures;for(let U=0;U<F.length;U++){O[U]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,O[U]),D.push(t.COLOR_ATTACHMENT0+U);const P=e.textures[U],X=this.get(P);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,X.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+U,t.RENDERBUFFER,O[U])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=T,a.msaaRenderbuffers=O,l&&A===void 0){A=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(A,e,o),a.depthRenderbuffer=A;const U=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;D.push(U)}a.invalidationArray=D}s=a.msaaFrameBuffer}else s=L;n.drawBuffers(e,L)}n.bindFramebuffer(t.FRAMEBUFFER,s)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const s=this.get(e[n]);t+=":"+s.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let s=0;s<e.length;s++){const r=e[s],a=this.get(r);t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(s);let o,l;r.isInterleavedBufferAttribute===!0?(o=r.data.stride*a.bytesPerElement,l=r.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(s,r.itemSize,a.type,o,l):t.vertexAttribPointer(s,r.itemSize,a.type,r.normalized,o,l),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?t.vertexAttribDivisor(s,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(s,r.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let r=0;r<e.length;r++)t+=":"+e[r].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let r=0;r<e.length;r++){const a=e[r];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,r,a.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const s of e)for(const r of s.bindings){const o=this.get(r).index;if(r.isUniformsGroup||r.isUniformBuffer){const l=n.getUniformBlockIndex(t,r.name);n.uniformBlockBinding(t,l,o)}else if(r.isSampledTexture){const l=n.getUniformLocation(t,r.name);n.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const s of e)for(const r of s.bindings){const a=this.get(r),o=a.index;r.isUniformsGroup||r.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,o,a.bufferGPU):r.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+o)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,s=e.renderTarget;if(e.textures!==null&&s){const r=this.get(s);if(s.samples>0&&this._useMultisampledExtension(s)===!1){const a=r.framebuffers[e.getCacheKey()];let o=t.COLOR_BUFFER_BIT;s.resolveDepthBuffer&&(s.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),s.stencilBuffer&&s.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));const l=r.msaaFrameBuffer,u=r.msaaRenderbuffers,f=e.textures,p=f.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,l),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),p)for(let x=0;x<f.length;x++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.TEXTURE_2D,null,0);for(let x=0;x<f.length;x++){if(p){const{textureGPU:y}=this.get(f[x]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u[x]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,y,0)}if(e.scissor){const{x:y,y:_,width:T,height:A}=e.scissorValue,S=e.height-A-_;t.blitFramebuffer(y,S,y+T,S+A,y,S,y+T,S+A,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(p)for(let x=0;x<f.length;x++){const{textureGPU:y}=this.get(f[x]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.RENDERBUFFER,u[x]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+x,t.TEXTURE_2D,y,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray)}else if(s.resolveDepthBuffer===!1&&r.framebuffers){const a=r.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,r.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Ay={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},va={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},mo={Store:"store"},Wi={Load:"load",Clear:"clear"},CF={CCW:"ccw",CW:"cw"},RF={None:"none",Back:"back"},jy={Uint16:"uint16",Uint32:"uint32"},me={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},jw={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Tg={Linear:"linear",Nearest:"nearest"},fi={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},mg={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},wF={None:0,All:15},Jh={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},$w={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Kw={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},NF={NonFiltering:"non-filtering",Comparison:"comparison"},gg={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},BF={TwoD:"2d",ThreeD:"3d"},Er={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},Kie={All:"all"},UE={Vertex:"vertex",Instance:"instance"},BN={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},DF={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class Jie extends Lk{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Zie extends Bk{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Qie=0;class ese extends Zie{constructor(e,t){super("StorageBuffer_"+Qie++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:la.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class tse extends rm{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Tg.Linear}),this.flipYSampler=e.createSampler({minFilter:Tg.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ay.TriangleStrip,stripIndexFormat:jy.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ay.TriangleStrip,stripIndexFormat:jy.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const s=t.format,{width:r,height:a}=t.size,o=this.getTransferPipeline(s),l=this.getFlipYPipeline(s),u=this.device.createTexture({size:{width:r,height:a,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),f=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Er.TwoD,baseArrayLayer:n}),p=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:Er.TwoD,baseArrayLayer:0}),x=this.device.createCommandEncoder({}),y=(_,T,A)=>{const S=_.getBindGroupLayout(0),C=this.device.createBindGroup({layout:S,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:T}]}),w=x.beginRenderPass({colorAttachments:[{view:A,loadOp:Wi.Clear,storeOp:mo.Store,clearValue:[0,0,0,0]}]});w.setPipeline(_),w.setBindGroup(0,C),w.draw(4,1,0,0),w.end()};y(o,f,p),y(l,p,f),this.device.queue.submit([x.finish()]),u.destroy()}generateMipmaps(e,t,n=0,s=null){const r=this.get(e);r.layers===void 0&&(r.layers=[]);const a=r.layers[n]||this._mipmapCreateBundles(e,t,n),o=s||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(o,a),s===null&&this.device.queue.submit([o.finish()]),r.layers[n]=a}_mipmapCreateBundles(e,t,n){const s=this.getTransferPipeline(t.format),r=s.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Er.TwoD,baseArrayLayer:n});const o=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),f=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:Er.TwoD,baseArrayLayer:n}),p={colorAttachments:[{view:f,loadOp:Wi.Clear,storeOp:mo.Store,clearValue:[0,0,0,0]}]},x=this.device.createRenderBundleEncoder({colorFormats:[t.format]});x.setPipeline(s),x.setBindGroup(0,u),x.draw(4,1,0,0),o.push({renderBundles:[x.finish()],passDescriptor:p}),a=f}return o}_mipmapRunBundles(e,t){const n=t.length;for(let s=0;s<n;s++){const r=t[s],a=e.beginRenderPass(r.passDescriptor);a.executeBundles(r.renderBundles),a.end()}}}const nse={[oT]:"never",[rv]:"less",[lT]:"equal",[av]:"less-equal",[cT]:"greater",[dT]:"greater-equal",[fT]:"always",[uT]:"not-equal"},ise=[0,1,3,2,4,5];class sse{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let s=this._samplerCache.get(n);if(s===void 0){const a={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};a.magFilter===Tg.Linear&&a.minFilter===Tg.Linear&&a.mipmapFilter===Tg.Linear&&(a.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(a.compare=nse[e.compareFunction]),s={sampler:t.device.createSampler(a),usedTimes:0},this._samplerCache.set(n,s)}const r=t.get(e);if(r.sampler!==s.sampler){if(r.sampler!==void 0){const a=this._samplerCache.get(r.samplerKey);a.usedTimes--,a.usedTimes===0&&this._samplerCache.delete(r.samplerKey)}r.samplerKey=n,r.sampler=s.sampler,s.usedTimes++}return n}createDefaultTexture(e){let t;const n=DN(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,s=n.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){s.texture=e.sourceTexture,s.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:r,height:a,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),f=e.internalFormat||t.format||DN(e,n.device);s.format=f;const{samples:p,primarySamples:x,isMSAA:y}=n.utils.getTextureSampleData(e);let _=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(_|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&f!==me.RGB9E5UFloat&&(_|=GPUTextureUsage.RENDER_ATTACHMENT);const T={label:e.name,size:{width:r,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:x,dimension:u,format:f,usage:_};if(f===void 0){De("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(T.textureBindingViewDimension=Er.Cube),s.texture=n.device.createTexture(T),y){const A=Object.assign({},T);A.label=A.label+"-msaa",A.sampleCount=p,A.mipLevelCount=1,s.msaaTexture=n.device.createTexture(A)}s.initialized=!0,s.textureDescriptorGPU=T}destroyTexture(e,t=!1){const n=this.backend,s=n.get(e);s.texture!==void 0&&t===!1&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);if(e.isCubeTexture)for(let s=0;s<6;s++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,s,t);else{const s=e.image.depth||1;for(let r=0;r<s;r++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,r,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:s}=e.getDrawingBufferSize(),r=e.renderer.currentSamples,a=t.colorTexture,o=e.get(a);if(a.width===n&&a.height===s&&a.samples===r)return o.texture;let l=o.texture;return l&&l.destroy(),l=e.device.createTexture({label:"colorBuffer",size:{width:n,height:s,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=s,a.samples=r,o.texture=l,l}getDepthBuffer(e=!0,t=!1){const n=this.backend,s=n.renderer.getCanvasTarget(),{width:r,height:a}=n.getDrawingBufferSize(),o=n.renderer.currentSamples,l=s.depthTexture;if(l.width===r&&l.height===a&&l.samples===o&&l.depth===e&&l.stencil===t)return n.get(l).texture;const u=n.get(l).texture;let f,p;if(t?(f=wo,p=Co):e&&(f=Ro,p=Xi),u!==void 0){if(l.image.width===r&&l.image.height===a&&l.format===f&&l.type===p&&l.samples===o)return u;this.destroyTexture(l)}return l.name="depthBuffer",l.format=f,l.type=p,l.image.width=r,l.image.height=a,l.samples=o,this.createTexture(l,{width:r,height:a}),n.get(l).texture}updateTexture(e,t){const n=this.backend.get(e),s=e.mipmaps,{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)if(s.length>0)for(let a=0,o=s.length;a<o;a++){const l=s[a];this._copyBufferToTexture(l,n.texture,r,0,e.flipY,0,a)}else this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let a=0;a<t.image.depth;a++)this._copyBufferToTexture(t.image,n.texture,r,a,e.flipY,a);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,r);else if(s.length>0)for(let a=0,o=s.length;a<o;a++){const l=s[a];this._copyImageToTexture(l,n.texture,r,0,e.flipY,e.premultiplyAlpha,a)}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,s,r,a){const o=this.backend.device,l=this.backend.get(e),u=l.texture,f=l.textureDescriptorGPU.format,p=this._getBytesPerTexel(f);let x=s*p;x=Math.ceil(x/256)*256;const y=o.createBuffer({size:(r-1)*x+s*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),_=o.createCommandEncoder();_.copyTextureToBuffer({texture:u,origin:{x:t,y:n,z:a}},{buffer:y,bytesPerRow:x},{width:s,height:r});const T=this._getTypedArrayType(f);o.queue.submit([_.finish()]),await y.mapAsync(GPUMapMode.READ);const A=y.getMappedRange();return new T(A)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new pi;n.minFilter=es,n.magFilter=es,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Zf;n.minFilter=es,n.magFilter=es,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const s=e.images,r=e.mipmaps;for(let a=0;a<6;a++){const o=s[a],l=e.flipY===!0?ise[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,l,e.flipY):this._copyImageToTexture(o,t,n,l,e.flipY,e.premultiplyAlpha);for(let u=0;u<r.length;u++){const p=r[u].images[a];p.isDataTexture?this._copyBufferToTexture(p.image,t,n,l,e.flipY,0,u+1):this._copyImageToTexture(p,t,n,l,e.flipY,e.premultiplyAlpha,u+1)}}}_copyImageToTexture(e,t,n,s,r,a,o=0){const l=this.backend.device,u=o>0?e.width:n.size.width,f=o>0?e.height:n.size.height;l.queue.copyExternalImageToTexture({source:e,flipY:r},{texture:t,mipLevel:o,origin:{x:0,y:0,z:s},premultipliedAlpha:a},{width:u,height:f,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new tse(this.backend.device)),e}_generateMipmaps(e,t,n=0,s=null){this._getPassUtils().generateMipmaps(e,t,n,s)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,s,r,a=0,o=0){const l=this.backend.device,u=e.data,f=this._getBytesPerTexel(n.format),p=e.width*f;l.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:s}},u,{offset:e.width*e.height*f*a,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),r===!0&&this._flipY(t,n,s)}_copyCompressedBufferToTexture(e,t,n){const s=this.backend.device,r=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],u=l.width,f=l.height,p=a?n.size.depthOrArrayLayers:1,x=Math.ceil(u/r.width)*r.byteLength,y=x*Math.ceil(f/r.height);for(let _=0;_<p;_++)s.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:_}},l.data,{offset:_*y,bytesPerRow:x,rowsPerImage:Math.ceil(f/r.height)},{width:Math.ceil(u/r.width)*r.width,height:Math.ceil(f/r.height)*r.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===me.BC1RGBAUnorm||e===me.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===me.BC2RGBAUnorm||e===me.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===me.BC3RGBAUnorm||e===me.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===me.BC4RUnorm||e===me.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===me.BC5RGUnorm||e===me.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===me.BC6HRGBUFloat||e===me.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===me.BC7RGBAUnorm||e===me.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===me.ETC2RGB8Unorm||e===me.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===me.ETC2RGB8A1Unorm||e===me.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===me.ETC2RGBA8Unorm||e===me.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===me.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===me.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===me.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===me.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===me.ASTC4x4Unorm||e===me.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===me.ASTC5x4Unorm||e===me.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===me.ASTC5x5Unorm||e===me.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===me.ASTC6x5Unorm||e===me.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===me.ASTC6x6Unorm||e===me.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===me.ASTC8x5Unorm||e===me.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===me.ASTC8x6Unorm||e===me.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===me.ASTC8x8Unorm||e===me.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===me.ASTC10x5Unorm||e===me.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===me.ASTC10x6Unorm||e===me.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===me.ASTC10x8Unorm||e===me.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===me.ASTC10x10Unorm||e===me.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===me.ASTC12x10Unorm||e===me.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===me.ASTC12x12Unorm||e===me.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=jw.ClampToEdge;return e===wl?t=jw.Repeat:e===lu&&(t=jw.MirrorRepeat),t}_convertFilterMode(e){let t=Tg.Linear;return(e===es||e===p0||e===Sl)&&(t=Tg.Nearest),t}_getBytesPerTexel(e){if(e===me.R8Unorm||e===me.R8Snorm||e===me.R8Uint||e===me.R8Sint)return 1;if(e===me.R16Uint||e===me.R16Sint||e===me.R16Float||e===me.RG8Unorm||e===me.RG8Snorm||e===me.RG8Uint||e===me.RG8Sint)return 2;if(e===me.R32Uint||e===me.R32Sint||e===me.R32Float||e===me.RG16Uint||e===me.RG16Sint||e===me.RG16Float||e===me.RGBA8Unorm||e===me.RGBA8UnormSRGB||e===me.RGBA8Snorm||e===me.RGBA8Uint||e===me.RGBA8Sint||e===me.BGRA8Unorm||e===me.BGRA8UnormSRGB||e===me.RGB9E5UFloat||e===me.RGB10A2Unorm||e===me.RG11B10UFloat||e===me.Depth32Float||e===me.Depth24Plus||e===me.Depth24PlusStencil8||e===me.Depth32FloatStencil8)return 4;if(e===me.RG32Uint||e===me.RG32Sint||e===me.RG32Float||e===me.RGBA16Uint||e===me.RGBA16Sint||e===me.RGBA16Float)return 8;if(e===me.RGBA32Uint||e===me.RGBA32Sint||e===me.RGBA32Float)return 16}_getTypedArrayType(e){if(e===me.R8Uint)return Uint8Array;if(e===me.R8Sint)return Int8Array;if(e===me.R8Unorm)return Uint8Array;if(e===me.R8Snorm)return Int8Array;if(e===me.RG8Uint)return Uint8Array;if(e===me.RG8Sint)return Int8Array;if(e===me.RG8Unorm)return Uint8Array;if(e===me.RG8Snorm)return Int8Array;if(e===me.RGBA8Uint)return Uint8Array;if(e===me.RGBA8Sint)return Int8Array;if(e===me.RGBA8Unorm||e===me.RGBA8UnormSRGB)return Uint8Array;if(e===me.RGBA8Snorm)return Int8Array;if(e===me.R16Uint)return Uint16Array;if(e===me.R16Sint)return Int16Array;if(e===me.RG16Uint)return Uint16Array;if(e===me.RG16Sint)return Int16Array;if(e===me.RGBA16Uint)return Uint16Array;if(e===me.RGBA16Sint)return Int16Array;if(e===me.R16Float||e===me.RG16Float||e===me.RGBA16Float)return Uint16Array;if(e===me.R32Uint)return Uint32Array;if(e===me.R32Sint)return Int32Array;if(e===me.R32Float)return Float32Array;if(e===me.RG32Uint)return Uint32Array;if(e===me.RG32Sint)return Int32Array;if(e===me.RG32Float)return Float32Array;if(e===me.RGBA32Uint)return Uint32Array;if(e===me.RGBA32Sint)return Int32Array;if(e===me.RGBA32Float)return Float32Array;if(e===me.BGRA8Unorm||e===me.BGRA8UnormSRGB)return Uint8Array;if(e===me.RGB10A2Unorm||e===me.RGB9E5UFloat||e===me.RG11B10UFloat)return Uint32Array;if(e===me.Depth32Float)return Float32Array;if(e===me.Depth24Plus||e===me.Depth24PlusStencil8)return Uint32Array;if(e===me.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=BF.ThreeD:t=BF.TwoD,t}}function DN(i,e=null){const t=i.format,n=i.type,s=i.colorSpace,r=yn.getTransfer(s);let a;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case hd:case pd:a=r===qt?me.BC1RGBAUnormSRGB:me.BC1RGBAUnorm;break;case md:a=r===qt?me.BC2RGBAUnormSRGB:me.BC2RGBAUnorm;break;case gd:a=r===qt?me.BC3RGBAUnormSRGB:me.BC3RGBAUnorm;break;case Ip:a=me.BC4RUnorm;break;case Pp:a=me.BC4RSnorm;break;case Fp:a=me.BC5RGUnorm;break;case Gp:a=me.BC5RGSnorm;break;case Lp:a=r===qt?me.BC7RGBAUnormSRGB:me.BC7RGBAUnorm;break;case vp:case yp:a=r===qt?me.ETC2RGB8UnormSRGB:me.ETC2RGB8Unorm;break;case _p:a=r===qt?me.ETC2RGBA8UnormSRGB:me.ETC2RGBA8Unorm;break;case bp:a=r===qt?me.ASTC4x4UnormSRGB:me.ASTC4x4Unorm;break;case Sp:a=r===qt?me.ASTC5x4UnormSRGB:me.ASTC5x4Unorm;break;case Tp:a=r===qt?me.ASTC5x5UnormSRGB:me.ASTC5x5Unorm;break;case Ap:a=r===qt?me.ASTC6x5UnormSRGB:me.ASTC6x5Unorm;break;case Ep:a=r===qt?me.ASTC6x6UnormSRGB:me.ASTC6x6Unorm;break;case Mp:a=r===qt?me.ASTC8x5UnormSRGB:me.ASTC8x5Unorm;break;case Cp:a=r===qt?me.ASTC8x6UnormSRGB:me.ASTC8x6Unorm;break;case Rp:a=r===qt?me.ASTC8x8UnormSRGB:me.ASTC8x8Unorm;break;case wp:a=r===qt?me.ASTC10x5UnormSRGB:me.ASTC10x5Unorm;break;case Np:a=r===qt?me.ASTC10x6UnormSRGB:me.ASTC10x6Unorm;break;case Bp:a=r===qt?me.ASTC10x8UnormSRGB:me.ASTC10x8Unorm;break;case Dp:a=r===qt?me.ASTC10x10UnormSRGB:me.ASTC10x10Unorm;break;case Op:a=r===qt?me.ASTC12x10UnormSRGB:me.ASTC12x10Unorm;break;case Up:a=r===qt?me.ASTC12x12UnormSRGB:me.ASTC12x12Unorm;break;case Oi:a=r===qt?me.RGBA8UnormSRGB:me.RGBA8Unorm;break;default:nt("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Oi:switch(n){case dd:a=me.RGBA8Snorm;break;case fd:a=me.RGBA16Sint;break;case Tl:a=me.RGBA16Uint;break;case Xi:a=me.RGBA32Uint;break;case fr:a=me.RGBA32Sint;break;case ss:a=r===qt?me.RGBA8UnormSRGB:me.RGBA8Unorm;break;case Ai:a=me.RGBA16Float;break;case Ti:a=me.RGBA32Float;break;default:nt("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case m0:switch(n){case iv:a=me.RGB9E5UFloat;break;case sv:a=me.RG11B10UFloat;break;default:nt("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Kf:switch(n){case dd:a=me.R8Snorm;break;case fd:a=me.R16Sint;break;case Tl:a=me.R16Uint;break;case Xi:a=me.R32Uint;break;case fr:a=me.R32Sint;break;case ss:a=me.R8Unorm;break;case Ai:a=me.R16Float;break;case Ti:a=me.R32Float;break;default:nt("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Al:switch(n){case dd:a=me.RG8Snorm;break;case fd:a=me.RG16Sint;break;case Tl:a=me.RG16Uint;break;case Xi:a=me.RG32Uint;break;case fr:a=me.RG32Sint;break;case ss:a=me.RG8Unorm;break;case Ai:a=me.RG16Float;break;case Ti:a=me.RG32Float;break;default:nt("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Ro:switch(n){case Tl:a=me.Depth16Unorm;break;case Xi:a=me.Depth24Plus;break;case Ti:a=me.Depth32Float;break;default:nt("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case wo:switch(n){case Co:a=me.Depth24PlusStencil8;break;case Ti:e&&e.features.has(BN.Depth32FloatStencil8)===!1&&nt('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=me.Depth32FloatStencil8;break;default:nt("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case Jf:switch(n){case fr:a=me.R32Sint;break;case Xi:a=me.R32Uint;break;default:nt("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Kp:switch(n){case fr:a=me.RG32Sint;break;case Xi:a=me.RG32Uint;break;default:nt("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case Jp:switch(n){case fr:a=me.RGBA32Sint;break;case Xi:a=me.RGBA32Uint;break;default:nt("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:nt("WebGPURenderer: Unsupported texture format.",t)}return a}const rse=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,ase=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,OF={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},ose=i=>{i=i.trim();const e=i.match(rse);if(e!==null&&e.length===4){const t=e[2],n=[];let s=null;for(;(s=ase.exec(t))!==null;)n.push({name:s[1],type:s[2]});const r=[];for(let f=0;f<n.length;f++){const{name:p,type:x}=n[f];let y=x;y.startsWith("ptr")?y="pointer":(y.startsWith("texture")&&(y=x.split("<")[0]),y=OF[y]),r.push(new B3(y,p))}const a=i.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:OF[o]||o,inputs:r,name:l,inputsCode:t,blockCode:a,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class lse extends bU{constructor(e){const{type:t,inputs:n,name:s,inputsCode:r,blockCode:a,outputType:o}=ose(e);super(t,n,s),this.inputsCode=r,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class cse extends Ek{parseFunction(e){return new lse(e)}}const ay=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},use={[la.READ_ONLY]:"read",[la.WRITE_ONLY]:"write",[la.READ_WRITE]:"read_write"},UF={[wl]:"repeat",[ts]:"clamp",[lu]:"mirror"},LE={vertex:ay?ay.VERTEX:1,fragment:ay?ay.FRAGMENT:2,compute:ay?ay.COMPUTE:4},LF={instance:!0,swizzleAssign:!1,storageBuffer:!0},dse={"^^":"tsl_xor"},fse={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},IF={},Ib={tsl_xor:new Fr("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Fr("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Fr("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Fr("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Fr("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Fr("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Fr("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Fr("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Fr("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Fr("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Fr("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Fr("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Fr(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},hse={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};let Gk="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(Gk+=`diagnostic( off, derivative_uniformity );
`);class pse extends _U{constructor(e,t){super(e,t,new cse),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,s,r,a=this.shaderStage){return a==="fragment"?s?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${s} )`:r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",s)}generateTextureSampleLevel(e,t,n,s,r,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,s):this.generateTextureLod(e,t,n,r,a,s)}generateWrapFunction(e){const t=`tsl_coord_${UF[e.wrapS]}S_${UF[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=IF[t];if(n===void 0){const s=[],r=e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${r} ) -> ${r} {

	return ${r}(
`;const o=(l,u)=>{l===wl?(s.push(Ib.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${u} )`):l===ts?(s.push(Ib.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${u} )`):l===lu?(s.push(Ib.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${u} )`):(a+=`		coord.${u}`,De(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),a+=`,
`,o(e.wrapT,"y"),e.isData3DTexture&&(a+=`,
`,o(e.wrapR,"z")),a+=`
	);

}
`,IF[t]=n=new Fr(a,s)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const s=this.getDataFromNode(e,this.shaderStage,this.globalCache);s.dimensionsSnippet===void 0&&(s.dimensionsSnippet={});let r=s.dimensionsSnippet[n];if(s.dimensionsSnippet[n]===void 0){let a,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",u||e.isStorageTexture?a=t:a=`${t}${n?`, u32( ${n} )`:""}`,r=new lS(new cS(`textureDimensions( ${a} )`,o)),s.dimensionsSnippet[n]=r,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(s.arrayLayerCount=new lS(new cS(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(s.cubeFaceCount=new lS(new cS("6u","u32")))}return r.build(this)}generateFilteredTexture(e,t,n,s,r="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return s&&(n=`${n} + vec2<f32>(${s}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${n} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,n,s,r,a="0u"){const o=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,a),u=e.isData3DTexture?"vec3":"vec2";r&&(n=`${n} + ${u}<f32>(${r}) / ${u}<f32>( ${l} )`);const f=`${u}<u32>( ${o}( ${n} ) * ${u}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,f,a,s,null)}generateTextureLoad(e,t,n,s,r,a){s===null&&(s="0u"),a&&(n=`${n} + ${a}`);let o;return r?o=`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,n,s,r){let a;return s?a=`textureStore( ${t}, ${n}, ${s}, ${r} )`:a=`textureStore( ${t}, ${n}, ${r} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Ti||this.isSampleCompare(e)===!1&&e.minFilter===es&&e.magFilter===es||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,s,r,a=this.shaderStage){let o=null;return this.isUnfilterable(e)?o=this.generateTextureLod(e,t,n,s,r,"0",a):o=this._generateTextureSample(e,t,n,s,r,a),o}generateTextureGrad(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${s[0]}, ${s[1]} )`;nt(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${s}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${s} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s} )`;nt(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,s,r,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,s):this.generateTextureLod(e,t,n,r,a,s)}generateTextureBias(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${s} )`;nt(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=dse[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(De("WebGPURenderer: Atomic operations are only supported in compute shaders."),la.READ_WRITE):la.READ_ONLY:e.access}getStorageAccess(e,t){return use[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,s=null){const r=super.getUniformFromNode(e,t,n,s),a=this.getDataFromNode(e,n,this.globalCache);if(a.uniformGPU===void 0){let o;const l=e.groupNode,u=l.name,f=this.getBindGroupArray(u,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let p=null;const x=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?p=new NN(r.name,r.node,l,x):p=new O3(r.name,r.node,l,x):t==="cubeTexture"?p=new Ik(r.name,r.node,l,x):t==="texture3D"&&(p=new NN(r.name,r.node,l,x)),p.store=e.isStorageTextureNode===!0,p.mipLevel=p.store?e.mipLevel:0,p.setVisibility(LE[n]),this.isUnfilterable(e.value)===!1&&p.store===!1){const y=new Jie(`${r.name}_sampler`,r.node,l);y.setVisibility(LE[n]),f.push(y,p),o=[y,p]}else f.push(p),o=[p]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const p=t==="buffer"?Ok:ese,x=new p(e,l);x.setVisibility(LE[n]),f.push(x),o=x,r.name=s||"NodeBuffer_"+r.id}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let x=p[u];x===void 0&&(x=new Uk(u,l),x.setVisibility(LE[n]),p[u]=x,f.push(x)),o=this.getNodeUniform(r,t),x.addUniform(o)}a.uniformGPU=o}return r}getBuiltin(e,t,n,s=this.shaderStage){const r=this.builtins[s]||(this.builtins[s]=new Map);return r.has(e)===!1&&r.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),s=[];for(const a of t.inputs)s.push(a.name+" : "+this.getType(a.type));let r=`fn ${t.name}( ${s.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(r+=`	return ${n.result};
`),r+=`
}
`,r}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const s of n)t.push(`enable ${s};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:s,property:r,type:a}of n.values())t.push(`@builtin( ${s} ) ${r} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,n,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:s,bufferType:r,bufferCount:a}of this.scopedArrays.values()){const o=this.getType(r);t.push(`var<${s}> ${n}: array< ${o}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const s=this.getAttributesArray();for(let r=0,a=s.length;r<a;r++){const o=s[r],l=o.name,u=this.getType(o.type);t.push(`@location( ${r} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const s=e.output?"@location( "+n.index+" ) ":"";let r=this.getType(n.type);n.atomic&&(r="atomic< "+r+" >"),t.push(`	${s+n.name} : ${r}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const s=[];for(const r of n){let a=`struct ${r.name} {
`;a+=this.getStructMembers(r),a+=`
};`,s.push(a)}t=`
`+s.join(`

`)+`
`}return t}getVar(e,t,n=null){let s=`var ${t} : `;return n!==null?s+=this.generateArrayDeclaration(e,n):s+=this.getType(e),s}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const s of n)t.push(`	${this.getVar(s.type,s.name,s.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const r=this.varyings,a=this.vars[e];for(let o=0;o<r.length;o++){const l=r[o];if(l.needsInterpolation){let u=`@location( ${o} )`;if(l.interpolationType){const f=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";u+=` @interpolate( ${l.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&a.includes(l)===!1&&a.push(l)}}const n=this.getBuiltins(e);n&&t.push(n);const s=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}isCustomStruct(e){const t=e.value,n=e.node,s=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,r=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return s&&!r}getUniforms(e){const t=this.uniforms[e],n=[],s=[],r=[],a={};for(const l of t){const u=l.groupNode.name,f=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const p=l.node.value;this.isUnfilterable(p)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${l.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${l.name}_sampler : sampler;`));let x,y="";const{primarySamples:_}=this.renderer.backend.utils.getTextureSampleData(p);if(_>1&&(y="_multisampled"),p.isCubeTexture===!0)x="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?x=`texture${y}_2d<f32>`:x=`texture_depth${y}_2d${p.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const T=DN(p),A=this.getStorageAccess(l.node,e),S=l.node.value.is3DTexture,C=l.node.value.isArrayTexture;x=`texture_storage_${S?"3d":`2d${C?"_array":""}`}<${T}, ${A}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)x="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)x="texture_3d<f32>";else{const T=this.getComponentTypeFromTexture(p).charAt(0);x=`texture${y}_2d<${T}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${l.name} : ${x};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const p=l.node,x=this.getType(p.getNodeType(this)),y=p.bufferCount,_=y>0&&l.type==="buffer"?", "+y:"",T=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,e)}`:"uniform";if(this.isCustomStruct(l))s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${T}> ${l.name} : ${x};`);else{const S=`	value : array< ${p.isAtomic?`atomic<${x}>`:`${x}`}${_} >`;s.push(this._getWGSLStructBinding(l.name,S,T,f.binding++,f.group))}}else{const p=this.getType(this.getVectorType(l.type)),x=l.groupNode.name;(a[x]||(a[x]={index:f.binding++,id:f.group,snippets:[]})).snippets.push(`	${l.name} : ${p}`)}}for(const l in a){const u=a[l];r.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let o=n.join(`
`);return o+=s.join(`
`),o+=r.join(`
`),o}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let s=`// code

`;s+=this.flowCode[t];const r=this.flowNodes[t],a=r[r.length-1],o=a.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const u of r){const f=this.getFlowData(u),p=u.name;if(p&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${p}
`),s+=`${f.code}
	`,u===a&&t!=="compute"){if(s+=`// result

	`,t==="vertex")s+=`varyings.Vertex = ${f.result};`;else if(t==="fragment")if(l)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",s+=`return ${f.result};`;else{let x="	@location(0) color: vec4<f32>";const y=this.getBuiltins("output");y&&(x+=`,
	`+y),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",x),n.structs+=`
var<private> output : OutputStruct;`,s+=`output.color = ${f.result};

	return output;`}}}n.flow=s}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return fse[e]||e}isAvailable(e){let t=LF[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),LF[e]=t),t}_getWGSLMethod(e){return Ib[e]!==void 0&&this._include(e),hse[e]}_include(e){const t=Ib[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${Gk}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[n,s,r]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${s}, ${r} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${s} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,s=0,r=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${s} ) @group( ${r} )
var<${n}> ${e} : ${a};`}}class mse{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=me.Depth24PlusStencil8:e.depth&&(t=me.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const r=this.backend.renderer,a=r.getRenderTarget();t=a?a.samples:r.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Ay.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Ay.LineList;if(e.isLine)return Ay.LineStrip;if(e.isMesh)return Ay.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===ss)return me.BGRA8Unorm;if(e===Ai)return me.RGBA16Float;throw new Error("Unsupported outputType")}}const zk=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&zk.set(Float16Array,["float16"]);const gse=new Map([[bC,["float16"]]]),xse=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class yse{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),s=this.backend,r=s.get(n);let a=r.buffer;if(a===void 0){const o=s.device;let l=n.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let p=0;p<l.length;p++)l[p]===65535&&(l[p]=4294967295)}if(n.array=l,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){l=new l.constructor(n.count*4);for(let p=0;p<n.count;p++)l.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=l,r._force3to4BytesAlignment=!0}const u=l.byteLength,f=u+(4-u%4)%4;a=o.createBuffer({label:n.name,size:f,usage:t,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),r.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,s=n.device,r=n.get(t),a=n.get(t).buffer;let o=t.array;if(r._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let f=0;f<t.count;f++)o.set(t.array.subarray(f*3,f*3+3),f*4);t.array=o}const l=this._isTypedArray(o),u=t.updateRanges;if(u.length===0)s.queue.writeBuffer(a,0,o,0);else{const f=l?1:o.BYTES_PER_ELEMENT;for(let p=0,x=u.length;p<x;p++){const y=u[p];let _,T;if(r._force3to4BytesAlignment===!0){const S=Math.floor(y.start/3),C=Math.ceil(y.count/3);_=S*4*f,T=C*4*f}else _=y.start*f,T=y.count*f;const A=_*(l?o.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(a,A,o,_,T)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let s=0;s<t.length;s++){const r=t[s],a=r.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(r);let l=n.get(o);if(l===void 0){let p,x;r.isInterleavedBufferAttribute===!0?(p=r.data.stride*a,x=r.data.isInstancedInterleavedBuffer?UE.Instance:UE.Vertex):(p=r.itemSize*a,x=r.isInstancedBufferAttribute?UE.Instance:UE.Vertex),r.normalized===!1&&(r.array.constructor===Int16Array||r.array.constructor===Uint16Array)&&(p=4),l={arrayStride:p,attributes:[],stepMode:x},n.set(o,l)}const u=this._getVertexFormat(r),f=r.isInterleavedBufferAttribute===!0?r.offset*a:0;l.attributes.push({shaderLocation:s,offset:f,format:u})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,a=r.size,o=n.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=n.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(r,0,o,0,a);const u=l.finish();n.queue.submit([u]),await o.mapAsync(GPUMapMode.READ);const f=o.getMappedRange(),p=new e.array.constructor(f.slice(0));return o.unmap(),p.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,s=e.array.constructor,r=e.constructor;let a;if(t===1)a=xse.get(s);else{const l=(gse.get(r)||zk.get(s))[n?1:0];if(l){const u=s.BYTES_PER_ELEMENT*t,p=Math.floor((u+3)/4)*4/s.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${l}x${p}`}}return a||nt("WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class vse{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,s=[];let r=0;for(const a of e.bindings){const o={binding:r++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const l={};a.isStorageBuffer&&(a.visibility&4&&(a.access===la.READ_WRITE||a.access===la.WRITE_ONLY)?l.type=$w.Storage:l.type=$w.ReadOnlyStorage),o.buffer=l}else if(a.isSampledTexture&&a.store){const l={};l.format=this.backend.get(a.texture).texture.format;const u=a.access;u===la.READ_WRITE?l.access=Kw.ReadWrite:u===la.WRITE_ONLY?l.access=Kw.WriteOnly:l.access=Kw.ReadOnly,a.texture.isArrayTexture?l.viewDimension=Er.TwoDArray:a.texture.is3DTexture&&(l.viewDimension=Er.ThreeD),o.storageTexture=l}else if(a.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(a.texture);if(u>1&&(l.multisampled=!0,a.texture.isDepthTexture||(l.sampleType=gg.UnfilterableFloat)),a.texture.isDepthTexture)t.compatibilityMode&&a.texture.compareFunction===null?l.sampleType=gg.UnfilterableFloat:l.sampleType=gg.Depth;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const f=a.texture.type;f===fr?l.sampleType=gg.SInt:f===Xi?l.sampleType=gg.UInt:f===Ti&&(this.backend.hasFeature("float32-filterable")?l.sampleType=gg.Float:l.sampleType=gg.UnfilterableFloat)}a.isSampledCubeTexture?l.viewDimension=Er.Cube:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?l.viewDimension=Er.TwoDArray:a.isSampledTexture3D&&(l.viewDimension=Er.ThreeD),o.texture=l}else if(a.isSampler){const l={};a.texture.isDepthTexture&&(a.texture.compareFunction!==null?l.type=NF.Comparison:t.compatibilityMode&&(l.type=NF.NonFiltering)),o.sampler=l}else nt(`WebGPUBindingUtils: Unsupported binding "${a}".`);s.push(o)}return n.createBindGroupLayout({entries:s})}createBindings(e,t,n,s=0){const{backend:r,bindGroupLayoutCache:a}=this,o=r.get(e);let l=a.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),a.set(e.bindingsReference,l));let u;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===s&&(u=o.groups[n])),u===void 0&&(u=this.createBindGroup(e,l),n>0&&(o.groups[n]=u,o.versions[n]=s)),o.group=u,o.layout=l}updateBinding(e){const t=this.backend,n=t.device,s=e.buffer,r=t.get(e).buffer;n.queue.writeBuffer(r,0,s,0)}createBindGroupIndex(e,t){const s=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],o=s.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:r});s.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return s.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:l})}createBindGroup(e,t){const n=this.backend,s=n.device;let r=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=n.get(o);if(l.buffer===void 0){const u=o.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=s.createBuffer({label:"bindingBuffer_"+o.name,size:u,usage:f});l.buffer=p}a.push({binding:r,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=n.get(o);if(l.buffer===void 0){const u=o.attribute;l.buffer=n.get(u).buffer}a.push({binding:r,resource:{buffer:l.buffer}})}else if(o.isSampledTexture){const l=n.get(o.texture);let u;if(l.externalTexture!==void 0)u=s.importExternalTexture({source:l.externalTexture});else{const f=o.store?1:l.texture.mipLevelCount,p=o.store?o.mipLevel:0;let x=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(x+=`-${l.texture.depthOrArrayLayers}`),x+=`-${f}-${p}`,u=l[x],u===void 0){const y=Kie.All;let _;o.isSampledCubeTexture?_=Er.Cube:o.isSampledTexture3D?_=Er.ThreeD:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?_=Er.TwoDArray:_=Er.TwoD,u=l[x]=l.texture.createView({aspect:y,dimension:_,mipLevelCount:f,baseMipLevel:p})}}a.push({binding:r,resource:u})}else if(o.isSampler){const l=n.get(o.texture);a.push({binding:r,resource:l.sampler})}r++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class _se{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:s,geometry:r,pipeline:a}=e,{vertexProgram:o,fragmentProgram:l}=a,u=this.backend,f=u.device,p=u.utils,x=u.get(a),y=[];for(const ee of e.getBindings()){const te=u.get(ee);y.push(te.layout)}const _=u.attributeUtils.createShaderVertexBuffers(e);let T;s.blending!==ca&&(s.blending!==Mo||s.transparent!==!1)&&(T=this._getBlending(s));let A={};s.stencilWrite===!0&&(A={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const S=this._getColorWriteMask(s),C=[];if(e.context.textures!==null){const ee=e.context.textures;for(let te=0;te<ee.length;te++){const re=p.getTextureFormatGPU(ee[te]);C.push({format:re,blend:T,writeMask:S})}}else{const ee=p.getCurrentColorFormat(e.context);C.push({format:ee,blend:T,writeMask:S})}const w=u.get(o).module,B=u.get(l).module,L=this._getPrimitiveState(n,r,s),D=this._getDepthCompare(s),O=p.getCurrentDepthStencilFormat(e.context),F=this._getSampleCount(e.context),U={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},w,{buffers:_}),fragment:Object.assign({},B,{targets:C}),primitive:L,multisample:{count:F,alphaToCoverageEnabled:s.alphaToCoverage&&F>1},layout:f.createPipelineLayout({bindGroupLayouts:y})},P={},X=e.context.depth,Z=e.context.stencil;if((X===!0||Z===!0)&&(X===!0&&(P.format=O,P.depthWriteEnabled=s.depthWrite,P.depthCompare=D),Z===!0&&(P.stencilFront=A,P.stencilBack={},P.stencilReadMask=s.stencilFuncMask,P.stencilWriteMask=s.stencilWriteMask),s.polygonOffset===!0&&(P.depthBias=s.polygonOffsetUnits,P.depthBiasSlopeScale=s.polygonOffsetFactor,P.depthBiasClamp=0),U.depthStencil=P),f.pushErrorScope("validation"),t===null)x.pipeline=f.createRenderPipeline(U),f.popErrorScope().then(ee=>{ee!==null&&(x.error=!0,nt(ee.message))});else{const ee=new Promise(async te=>{try{x.pipeline=await f.createRenderPipelineAsync(U)}catch{}const re=await f.popErrorScope();re!==null&&(x.error=!0,nt(re.message)),te()});t.push(ee)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:s,device:r}=n,a=s.getCurrentDepthStencilFormat(e),o=s.getCurrentColorFormats(e),l=this._getSampleCount(e),u={label:t,colorFormats:o,depthStencilFormat:a,sampleCount:l};return r.createRenderBundleEncoder(u)}createComputePipeline(e,t){const n=this.backend,s=n.device,r=n.get(e.computeProgram).module,a=n.get(e),o=[];for(const l of t){const u=n.get(l);o.push(u.layout)}a.pipeline=s.createComputePipeline({compute:r,layout:s.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n;const s=e.blending,r=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(s===fp){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:r,u=e.blendDstAlpha!==null?e.blendDstAlpha:a,f=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(f)}}else{const l=e.premultipliedAlpha,u=(f,p,x,y)=>{t={srcFactor:f,dstFactor:p,operation:mg.Add},n={srcFactor:x,dstFactor:y,operation:mg.Add}};if(l)switch(s){case Mo:u(fi.One,fi.OneMinusSrcAlpha,fi.One,fi.OneMinusSrcAlpha);break;case mp:u(fi.One,fi.One,fi.One,fi.One);break;case gp:u(fi.Zero,fi.OneMinusSrc,fi.Zero,fi.One);break;case xp:u(fi.Dst,fi.OneMinusSrcAlpha,fi.Zero,fi.One);break}else switch(s){case Mo:u(fi.SrcAlpha,fi.OneMinusSrcAlpha,fi.One,fi.OneMinusSrcAlpha);break;case mp:u(fi.SrcAlpha,fi.One,fi.One,fi.One);break;case gp:nt("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case xp:nt("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};nt("WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let t;switch(e){case nu:t=fi.Zero;break;case KS:t=fi.One;break;case JS:t=fi.Src;break;case ZS:t=fi.OneMinusSrc;break;case Vg:t=fi.SrcAlpha;break;case Hg:t=fi.OneMinusSrcAlpha;break;case tT:t=fi.Dst;break;case nT:t=fi.OneMinusDst;break;case QS:t=fi.DstAlpha;break;case eT:t=fi.OneMinusDstAlpha;break;case iT:t=fi.SrcAlphaSaturated;break;case uZ:t=fi.Constant;break;case dZ:t=fi.OneMinusConstant;break;default:nt("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case FB:t=va.Never;break;case AS:t=va.Always;break;case GB:t=va.Less;break;case VB:t=va.LessEqual;break;case zB:t=va.Equal;break;case WB:t=va.GreaterEqual;break;case HB:t=va.Greater;break;case kB:t=va.NotEqual;break;default:nt("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Tf:t=Jh.Keep;break;case BB:t=Jh.Zero;break;case DB:t=Jh.Replace;break;case PB:t=Jh.Invert;break;case OB:t=Jh.IncrementClamp;break;case UB:t=Jh.DecrementClamp;break;case LB:t=Jh.IncrementWrap;break;case IB:t=Jh.DecrementWrap;break;default:nt("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case aa:t=mg.Add;break;case jS:t=mg.Subtract;break;case $S:t=mg.ReverseSubtract;break;case lC:t=mg.Min;break;case cC:t=mg.Max;break;default:nt("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const s={},r=this.backend.utils;s.topology=r.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=t.index.array instanceof Uint16Array?jy.Uint16:jy.Uint32);let a=n.side===Yi;return e.isMesh&&e.matrixWorld.determinant()<0&&(a=!a),s.frontFace=a===!0?CF.CW:CF.CCW,s.cullMode=n.side===hr?RF.None:RF.Back,s}_getColorWriteMask(e){return e.colorWrite===!0?wF.All:wF.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=va.Always;else{const n=e.depthFunc;switch(n){case kg:t=va.Never;break;case Wg:t=va.Always;break;case Xg:t=va.Less;break;case Sd:t=va.LessEqual;break;case qg:t=va.Equal;break;case Yg:t=va.GreaterEqual;break;case jg:t=va.Greater;break;case $g:t=va.NotEqual;break;default:nt("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class bse extends Fk{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const s=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return qi(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const s=this.device.createCommandEncoder();s.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),s.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const r=s.finish();if(this.device.queue.submit([r]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),o={},l=[];for(const[f,p]of e){const x=f.match(/^(.*):f(\d+)$/),y=parseInt(x[2]);l.includes(y)===!1&&l.push(y),o[y]===void 0&&(o[y]=0);const _=a[p],T=a[p+1],A=Number(T-_)/1e6;this.timestamps.set(f,A),o[y]+=A}const u=o[l[l.length-1]];return this.resultBuffer.unmap(),this.lastValue=u,this.frames=l,u}catch(e){return e("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){e("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){e("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Sse extends Pk{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new mse(this),this.attributeUtils=new yse(this),this.bindingUtils=new vse(this),this.pipelineUtils=new _se(this),this.textureUtils=new sse(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const s={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},r=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(r===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const a=Object.values(BN),o=[];for(const u of a)r.features.has(u)&&o.push(u);const l={requiredFeatures:o,requiredLimits:t.requiredLimits};n=await r.requestDevice(l)}else n=t.device;n.lost.then(s=>{const r={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};e.onDeviceLost(r)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(BN.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(n===void 0){const s=this.parameters;e.isDefaultCanvasTarget===!0&&s.context!==void 0?n=s.context:n=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${$f} webgpu`);const r=s.alpha?"premultiplied":"opaque",a=s.outputType===Ai?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:r,toneMapping:{mode:a}}),t.context=n}return n}get coordinateSystem(){return Nl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),s=e.currentSamples;let r=n.descriptor;if(r===void 0||n.samples!==s){r={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(r.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const o=r.colorAttachments[0];s>0?o.view=this.textureUtils.getColorBuffer().createView():o.resolveTarget=void 0,n.descriptor=r,n.samples=s}const a=r.colorAttachments[0];return s>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),r}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,s=this.get(n);let r=s.descriptors;(r===void 0||s.width!==n.width||s.height!==n.height||s.samples!==n.samples)&&(r={},s.descriptors=r);const a=e.getCacheKey();let o=r[a];if(o===void 0){const u=e.textures,f=[];let p;const x=this._isRenderCameraDepthArray(e);for(let y=0;y<u.length;y++){const _=this.get(u[y]),T={label:`colorAttachment_${y}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Er.TwoD};if(n.isRenderTarget3D)p=e.activeCubeFace,T.baseArrayLayer=0,T.dimension=Er.ThreeD,T.depthOrArrayLayers=u[y].image.depth;else if(n.isRenderTarget&&u[y].image.depth>1)if(x===!0){const A=e.camera.cameras;for(let S=0;S<A.length;S++){const C={...T,baseArrayLayer:S,arrayLayerCount:1,dimension:Er.TwoD},w=_.texture.createView(C);f.push({view:w,resolveTarget:void 0,depthSlice:void 0})}}else T.dimension=Er.TwoDArray,T.depthOrArrayLayers=u[y].image.depth;if(x!==!0){const A=_.texture.createView(T);let S,C;_.msaaTexture!==void 0?(S=_.msaaTexture.createView(),C=A):(S=A,C=void 0),f.push({view:S,resolveTarget:C,depthSlice:p})}}if(o={textureViews:f},e.depth){const y=this.get(e.depthTexture),_={};e.depthTexture.isArrayTexture&&(_.dimension=Er.TwoD,_.arrayLayerCount=1,_.baseArrayLayer=e.activeCubeFace),o.depthStencilView=y.texture.createView(_)}r[a]=o,s.width=n.width,s.height=n.height,s.samples=n.samples,s.activeMipmapLevel=e.activeMipmapLevel,s.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let u=0;u<o.textureViews.length;u++){const f=o.textureViews[u];let p={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(p=t.clearValue),l.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:t.loadOp||Wi.Load,storeOp:t.storeOp||mo.Store,clearValue:p})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e),n=this.device,s=e.occlusionQueryCount;let r;s>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,r=n.createQuerySet({type:"occlusion",count:s,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=r,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(s),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:Wi.Load}),this.initTimestampQuery(dc.RENDER,this.getTimestampUID(e),a),a.occlusionQuerySet=r;const o=a.depthStencilAttachment;if(e.textures!==null){const u=a.colorAttachments;for(let f=0;f<u.length;f++){const p=u[f];e.clearColor?(p.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=Wi.Clear):p.loadOp=Wi.Load,p.storeOp=mo.Store}}else{const u=a.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=Wi.Clear):u.loadOp=Wi.Load,u.storeOp=mo.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Wi.Clear):o.depthLoadOp=Wi.Load,o.depthStoreOp=mo.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Wi.Clear):o.stencilLoadOp=Wi.Load,o.stencilStoreOp=mo.Store);const l=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,a,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let f=0;f<u.length;f++){const p=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+f),x={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(p),t.bundleSets.push(x)}t.currentPass=null}else{const u=l.beginRenderPass(a);t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=a,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,s){const r=n.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<s.length;o++){const l={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[o].view}]};if(n.depthStencilAttachment){const u=o;a.viewCache[u]||(a.viewCache[u]=a.texture.createView({dimension:Er.TwoD,baseArrayLayer:o,arrayLayerCount:1})),l.depthStencilAttachment={view:a.viewCache[u],depthLoadOp:r.depthLoadOp||Wi.Clear,depthStoreOp:r.depthStoreOp||mo.Store,depthClearValue:r.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=r.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=r.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=r.stencilClearValue)}else l.depthStencilAttachment={...r};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,n){for(let s=0;s<n.length;s++){const r=t.layerDescriptors[s];if(r.depthStencilAttachment){const a=r.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Wi.Clear):a.depthLoadOp=Wi.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Wi.Clear):a.stencilLoadOp=Wi.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const s=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const r=[];for(let a=0;a<t.bundleEncoders.length;a++){const o=t.bundleEncoders[a];r.push(o.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<r.length){const o=t.layerDescriptors[a],l=s.beginRenderPass(o);if(e.viewport){const{x:u,y:f,width:p,height:x,minDepth:y,maxDepth:_}=e.viewportValue;l.setViewport(u,f,p,x,y,_)}if(e.scissor){const{x:u,y:f,width:p,height:x}=e.scissorValue;l.setScissorRect(u,f,p,x)}l.executeBundles([r[a]]),l.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const r=n*8;let a=this.occludedResolveCache.get(r);a===void 0&&(a=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,a));const o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,a,0),t.encoder.copyBufferToBuffer(a,0,o,0,r),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let a=0;a<r.length;a++){const o=r[a];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=t;if(n&&s){const r=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),o=new BigUint64Array(a);for(let l=0;l<s.length;l++)o[l]===BigInt(0)&&r.add(s[l]);n.destroy(),t.occluded=r}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:s,width:r,height:a,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(n,s,r,a,o,l)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:s,width:r,height:a}=e.scissorValue;t.setScissorRect(n,s,r,a)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,s=null){const r=this.device,a=this.renderer;let o=[],l,u,f,p;if(e){const _=this.getClearColor();u={r:_.r,g:_.g,b:_.b,a:_.a}}if(s===null){f=a.depth,p=a.stencil;const _=this._getDefaultRenderPassDescriptor();if(e){o=_.colorAttachments;const T=o[0];T.clearValue=u,T.loadOp=Wi.Clear,T.storeOp=mo.Store}(f||p)&&(l=_.depthStencilAttachment)}else{f=s.depth,p=s.stencil;const _={loadOp:e?Wi.Clear:Wi.Load,clearValue:e?u:void 0};f&&(_.depthLoadOp=t?Wi.Clear:Wi.Load,_.depthClearValue=t?a.getClearDepth():void 0,_.depthStoreOp=mo.Store),p&&(_.stencilLoadOp=n?Wi.Clear:Wi.Load,_.stencilClearValue=n?a.getClearStencil():void 0,_.stencilStoreOp=mo.Store);const T=this._getRenderPassDescriptor(s,_);o=T.colorAttachments,l=T.depthStencilAttachment}f&&l&&(t?(l.depthLoadOp=Wi.Clear,l.depthClearValue=a.getClearDepth(),l.depthStoreOp=mo.Store):(l.depthLoadOp=Wi.Load,l.depthStoreOp=mo.Store)),p&&l&&(n?(l.stencilLoadOp=Wi.Clear,l.stencilClearValue=a.getClearStencil(),l.stencilStoreOp=mo.Store):(l.stencilLoadOp=Wi.Load,l.stencilStoreOp=mo.Store));const x=r.createCommandEncoder({label:"clear"});x.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),r.queue.submit([x.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(dc.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,s,r=null){const a=this.get(t),{passEncoderGPU:o}=this.get(e),l=this.get(s).pipeline;this.pipelineUtils.setPipeline(o,l);for(let u=0,f=n.length;u<f;u++){const p=n[u],x=this.get(p);o.setBindGroup(u,x.group)}if(r===null&&(r=t.count),r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute){const u=this.get(r).buffer;o.dispatchWorkgroupsIndirect(u,0);return}if(typeof r=="number"){const u=r;if(a.dispatchSize===void 0||a.count!==u){a.dispatchSize=[0,1,1],a.count=u;const f=t.workgroupSize;let p=f[0];for(let _=1;_<f.length;_++)p*=f[_];const x=Math.ceil(u/p),y=this.device.limits.maxComputeWorkgroupsPerDimension;r=[x,1,1],x>y&&(r[0]=Math.min(x,y),r[1]=Math.ceil(x/y)),a.dispatchSize=r}r=a.dispatchSize}o.dispatchWorkgroups(r[0],r[1]||1,r[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:s,context:r,pipeline:a}=e,o=e.getBindings(),l=this.get(r),u=this.get(a),f=u.pipeline;if(u.error===!0)return;const p=e.getIndex(),x=p!==null,y=e.getDrawParameters();if(y===null)return;const _=(A,S)=>{this.pipelineUtils.setPipeline(A,f),S.pipeline=f;const C=S.bindingGroups;for(let B=0,L=o.length;B<L;B++){const D=o[B],O=this.get(D);C[D.index]!==D.id&&(A.setBindGroup(D.index,O.group),C[D.index]=D.id)}if(x===!0&&S.index!==p){const B=this.get(p).buffer,L=p.array instanceof Uint16Array?jy.Uint16:jy.Uint32;A.setIndexBuffer(B,L),S.index=p}const w=e.getVertexBuffers();for(let B=0,L=w.length;B<L;B++){const D=w[B];if(S.attributes[B]!==D){const O=this.get(D).buffer;A.setVertexBuffer(B,O),S.attributes[B]=D}}r.stencil===!0&&s.stencilWrite===!0&&l.currentStencilRef!==s.stencilRef&&(A.setStencilReference(s.stencilRef),l.currentStencilRef=s.stencilRef)},T=(A,S)=>{if(_(A,S),n.isBatchedMesh===!0){const C=n._multiDrawStarts,w=n._multiDrawCounts,B=n._multiDrawCount,L=n._multiDrawInstances;L!==null&&qi("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let D=0;D<B;D++){const O=L?L[D]:1,F=O>1?0:D;x===!0?A.drawIndexed(w[D],O,C[D]/p.array.BYTES_PER_ELEMENT,0,F):A.draw(w[D],O,C[D],F),t.update(n,w[D],O)}}else if(x===!0){const{vertexCount:C,instanceCount:w,firstVertex:B}=y,L=e.getIndirect();if(L!==null){const D=this.get(L).buffer;A.drawIndexedIndirect(D,0)}else A.drawIndexed(C,w,B,0,0);t.update(n,C,w)}else{const{vertexCount:C,instanceCount:w,firstVertex:B}=y,L=e.getIndirect();if(L!==null){const D=this.get(L).buffer;A.drawIndirect(D,0)}else A.draw(C,w,B,0);t.update(n,C,w)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const A=this.get(e.camera),S=e.camera.cameras,C=e.getBindingGroup("cameraIndex");if(A.indexesGPU===void 0||A.indexesGPU.length!==S.length){const B=this.get(C),L=[],D=new Uint32Array([0,0,0,0]);for(let O=0,F=S.length;O<F;O++){D[0]=O;const U=this.bindingUtils.createBindGroupIndex(D,B.layout);L.push(U)}A.indexesGPU=L}const w=this.renderer.getPixelRatio();for(let B=0,L=S.length;B<L;B++){const D=S[B];if(n.layers.test(D.layers)){const O=D.viewport;let F=l.currentPass,U=l.currentSets;if(l.bundleEncoders){const P=l.bundleEncoders[B],X=l.bundleSets[B];F=P,U=X}O&&F.setViewport(Math.floor(O.x*w),Math.floor(O.y*w),Math.floor(O.width*w),Math.floor(O.height*w),r.viewportValue.minDepth,r.viewportValue.maxDepth),C&&A.indexesGPU&&(F.setBindGroup(C.index,A.indexesGPU[B]),U.bindingGroups[C.index]=C.id),T(F,U)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const A=l.lastOcclusionObject;A!==n&&(A!==null&&A.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),n.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=n),l.lastOcclusionObject=n)}T(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:s}=e,r=this.utils,a=r.getSampleCountRenderContext(e.context),o=r.getCurrentColorSpace(e.context),l=r.getCurrentColorFormat(e.context),u=r.getCurrentDepthStencilFormat(e.context),f=r.getPrimitiveTopology(n,s);let p=!1;return(t.material!==s||t.materialVersion!==s.version||t.transparent!==s.transparent||t.blending!==s.blending||t.premultipliedAlpha!==s.premultipliedAlpha||t.blendSrc!==s.blendSrc||t.blendDst!==s.blendDst||t.blendEquation!==s.blendEquation||t.blendSrcAlpha!==s.blendSrcAlpha||t.blendDstAlpha!==s.blendDstAlpha||t.blendEquationAlpha!==s.blendEquationAlpha||t.colorWrite!==s.colorWrite||t.depthWrite!==s.depthWrite||t.depthTest!==s.depthTest||t.depthFunc!==s.depthFunc||t.stencilWrite!==s.stencilWrite||t.stencilFunc!==s.stencilFunc||t.stencilFail!==s.stencilFail||t.stencilZFail!==s.stencilZFail||t.stencilZPass!==s.stencilZPass||t.stencilFuncMask!==s.stencilFuncMask||t.stencilWriteMask!==s.stencilWriteMask||t.side!==s.side||t.alphaToCoverage!==s.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==f||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=s,t.materialVersion=s.version,t.transparent=s.transparent,t.blending=s.blending,t.premultipliedAlpha=s.premultipliedAlpha,t.blendSrc=s.blendSrc,t.blendDst=s.blendDst,t.blendEquation=s.blendEquation,t.blendSrcAlpha=s.blendSrcAlpha,t.blendDstAlpha=s.blendDstAlpha,t.blendEquationAlpha=s.blendEquationAlpha,t.colorWrite=s.colorWrite,t.depthWrite=s.depthWrite,t.depthTest=s.depthTest,t.depthFunc=s.depthFunc,t.stencilWrite=s.stencilWrite,t.stencilFunc=s.stencilFunc,t.stencilFail=s.stencilFail,t.stencilZFail=s.stencilZFail,t.stencilZPass=s.stencilZPass,t.stencilFuncMask=s.stencilFuncMask,t.stencilWriteMask=s.stencilWriteMask,t.side=s.side,t.alphaToCoverage=s.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=f,t.clippingContextCacheKey=e.clippingContextCacheKey,p=!0),p}getRenderCacheKey(e){const{object:t,material:n}=e,s=this.utils,r=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,s.getSampleCountRenderContext(r),s.getCurrentColorSpace(r),s.getCurrentColorFormat(r),s.getCurrentDepthStencilFormat(r),s.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,s,r,a){return this.textureUtils.copyTextureToBuffer(e,t,n,s,r,a)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new bse(this.device,e,2048));const s=this.timestampQueryPool[e],r=s.allocateQueriesForContext(t);n.timestampWrites={querySet:s.querySet,beginningOfPassWriteIndex:r,endOfPassWriteIndex:r+1}}createNodeBuilder(e,t){return new pse(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,s){this.bindingUtils.createBindings(e,t,n,s)}updateBindings(e,t,n,s){this.bindingUtils.createBindings(e,t,n,s)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return DF[e]!==void 0&&(e=DF[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){let o=0,l=0,u=0,f=0,p=0,x=0,y=e.image.width,_=e.image.height,T=1;n!==null&&(n.isBox3===!0?(f=n.min.x,p=n.min.y,x=n.min.z,y=n.max.x-n.min.x,_=n.max.y-n.min.y,T=n.max.z-n.min.z):(f=n.min.x,p=n.min.y,y=n.max.x-n.min.x,_=n.max.y-n.min.y,T=1)),s!==null&&(o=s.x,l=s.y,u=s.z||0);const A=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),S=this.get(e).texture,C=this.get(t).texture;A.copyTextureToTexture({texture:S,mipLevel:r,origin:{x:f,y:p,z:x}},{texture:C,mipLevel:a,origin:{x:o,y:l,z:u}},[y,_,T]),this.device.queue.submit([A.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const s=this.get(t);let r=null;t.renderTarget?e.isDepthTexture?r=this.get(t.depthTexture).texture:r=this.get(t.textures[0]).texture:e.isDepthTexture?r=this.textureUtils.getDepthBuffer(t.depth,t.stencil):r=this.context.getCurrentTexture();const a=this.get(e).texture;if(r.format!==a.format){nt("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",r.format,a.format);return}let o;if(s.currentPass?(s.currentPass.end(),o=s.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:r,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,o),s.currentPass){const{descriptor:l}=s;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=Wi.Load;t.depth&&(l.depthStencilAttachment.depthLoadOp=Wi.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=Wi.Load),s.currentPass=o.beginRenderPass(l),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([o.finish()])}dispose(){this.textureUtils.dispose()}}class Vk extends S0{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Hk extends S0{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Tse extends Ck{constructor(){super(),this.addMaterial(B9,"MeshPhongMaterial"),this.addMaterial(JO,"MeshStandardMaterial"),this.addMaterial(ZO,"MeshPhysicalMaterial"),this.addMaterial(Y9,"MeshToonMaterial"),this.addMaterial(w9,"MeshBasicMaterial"),this.addMaterial(N9,"MeshLambertMaterial"),this.addMaterial(A9,"MeshNormalMaterial"),this.addMaterial($9,"MeshMatcapMaterial"),this.addMaterial(v9,"LineBasicMaterial"),this.addMaterial(_9,"LineDashedMaterial"),this.addMaterial(J9,"PointsMaterial"),this.addMaterial(QO,"SpriteMaterial"),this.addMaterial(Z9,"ShadowMaterial"),this.addLight(rk,PT),this.addLight(yk,FT),this.addLight(vk,qC),this.addLight(D3,S0),this.addLight(Sk,XC),this.addLight(Tk,WC),this.addLight(Ak,YC),this.addLight(_k,Vk),this.addLight(bk,Hk),this.addToneMapping(C6,fC),this.addToneMapping(R6,hC),this.addToneMapping(w6,pC),this.addToneMapping(N6,sT),this.addToneMapping(B6,mC),this.addToneMapping(D6,gC)}}class kk extends Rie{constructor(e={}){let t;e.forceWebGL?t=MF:(t=Sse,e.getFallback=()=>(De("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new MF(e)));const n=new t(e);super(n,e),this.library=new Tse,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class Ase extends fc{constructor(){super(),this.isBundleGroup=!0,this.type="BundleGroup",this.static=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}}class Ese{constructor(e,t=Vt(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const n=new ys;n.name="PostProcessing",this._quadMesh=new Ev(n),this._quadMesh.name="Post-Processing",this._context=null}render(){const e=this.renderer;this._update(),this._context.onBeforePostProcessing!==null&&this._context.onBeforePostProcessing();const t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=zr,e.outputColorSpace=yn.workingColorSpace;const s=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=s,e.toneMapping=t,e.outputColorSpace=n,this._context.onAfterPostProcessing!==null&&this._context.onAfterPostProcessing()}get context(){return this._context}dispose(){this._quadMesh.material.dispose()}_update(){if(this.needsUpdate===!0){const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace,s={postProcessing:this,onBeforePostProcessing:null,onAfterPostProcessing:null};let r=this.outputNode;this.outputColorTransform===!0?(r=r.context(s),r=vO(r,t,n)):(s.toneMapping=t,s.outputColorSpace=n,r=r.context(s)),this._context=s,this._quadMesh.material.fragmentNode=r,this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){qi('PostProcessing: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.renderer.init(),this.render()}}class Mse extends pi{constructor(e=1,t=1){super(),this.image={width:e,height:t},this.magFilter=Dn,this.minFilter=Dn,this.isStorageTexture=!0,this.mipmapsAutoUpdate=!0}setSize(e,t){(this.image.width!==e||this.image.height!==t)&&(this.image.width=e,this.image.height=t,this.dispose())}}class Cse extends pi{constructor(e=1,t=1,n=1){super(),this.isArrayTexture=!1,this.image={width:e,height:t,depth:n},this.magFilter=Dn,this.minFilter=Dn,this.wrapR=ts,this.isStorageTexture=!0,this.is3DTexture=!0}setSize(e,t,n){(this.image.width!==e||this.image.height!==t||this.image.depth!==n)&&(this.image.width=e,this.image.height=t,this.image.depth=n,this.dispose())}}class Rse extends pi{constructor(e=1,t=1,n=1){super(),this.isArrayTexture=!0,this.image={width:e,height:t,depth:n},this.magFilter=Dn,this.minFilter=Dn,this.isStorageTexture=!0}setSize(e,t,n){(this.image.width!==e||this.image.height!==t||this.image.depth!==n)&&(this.image.width=e,this.image.height=t,this.image.depth=n,this.dispose())}}class wse extends iU{constructor(e,t){super(e,t,Uint32Array),this.isIndirectStorageBufferAttribute=!0}}class Wk extends Xr{constructor(e){super(e),this.textures={},this.nodes={}}load(e,t,n,s){const r=new Hr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{try{t(this.parse(JSON.parse(a)))}catch(o){s?s(o):nt(o),this.manager.itemError(e)}},n,s)}parseNodes(e){const t={};if(e!==void 0){for(const s of e){const{uuid:r,type:a}=s;t[r]=this.createNodeFromType(a),t[r].uuid=r}const n={nodes:t,textures:this.textures};for(const s of e)s.meta=n,t[s.uuid].deserialize(s),delete s.meta}return t}parse(e){const t=this.createNodeFromType(e.type);t.uuid=e.uuid;const s={nodes:this.parseNodes(e.nodes),textures:this.textures};return e.meta=s,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}setNodes(e){return this.nodes=e,this}createNodeFromType(e){return this.nodes[e]===void 0?(nt("NodeLoader: Node type not found:",e),j()):Ke(new this.nodes[e])}}class Xk extends gv{constructor(e){super(e),this.nodes={},this.nodeMaterials={}}parse(e){const t=super.parse(e),n=this.nodes,s=e.inputNodes;for(const r in s){const a=s[r];t[r]=n[a]}return t}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}createMaterialFromType(e){const t=this.nodeMaterials[e];return t!==void 0?new t:super.createMaterialFromType(e)}}class Nse extends xD{constructor(e){super(e),this.nodes={},this.nodeMaterials={},this._nodesJSON=null}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}parse(e,t){this._nodesJSON=e.nodes;const n=super.parse(e,t);return this._nodesJSON=null,n}parseNodes(e,t){if(e!==void 0){const n=new Wk;return n.setNodes(this.nodes),n.setTextures(t),n.parseNodes(e)}return{}}parseMaterials(e,t){const n={};if(e!==void 0){const s=this.parseNodes(this._nodesJSON,t),r=new Xk;r.setTextures(t),r.setNodes(s),r.setNodeMaterials(this.nodeMaterials);for(let a=0,o=e.length;a<o;a++){const l=e[a];n[l.uuid]=r.parse(l)}}return n}}class Bse extends fc{constructor(){super(),this.isClippingGroup=!0,this.clippingPlanes=[],this.enabled=!0,this.clipIntersection=!1,this.clipShadows=!1}}const Dse=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:sT,AONode:a9,AddEquation:aa,AddOperation:dC,AdditiveAnimationBlendMode:xC,AdditiveBlending:mp,AgXToneMapping:mC,AlphaFormat:rT,AlwaysCompare:fT,AlwaysDepth:Wg,AlwaysStencilFunc:AS,AmbientLight:XC,AmbientLightNode:Sk,AnalyticLightNode:am,AnimationAction:TD,AnimationClip:kp,AnimationLoader:hV,AnimationMixer:AD,AnimationObjectGroup:_V,AnimationUtils:fV,ArcCurve:QB,ArrayCamera:$C,ArrayElementNode:nm,ArrayNode:hN,ArrowHelper:VV,AssignNode:p8,AttachedBindMode:pM,AttributeNode:bO,Audio:vD,AudioAnalyser:vV,AudioContext:jC,AudioListener:xV,AudioLoader:mV,AxesHelper:HV,BackSide:Yi,BasicDepthPacking:wB,BasicEnvironmentNode:y3,BasicShadowMap:oC,BatchNode:JH,BatchedMesh:KB,BitcastNode:Tv,Bone:_T,BooleanKeyframeTrack:Qp,Box2:RV,Box3:Vr,Box3Helper:GV,BoxGeometry:Nd,BoxHelper:FV,BufferAttribute:li,BufferAttributeNode:E5,BufferGeometry:Fn,BufferGeometryLoader:gD,BufferNode:f3,BumpMapNode:_H,BundleGroup:Ase,BypassNode:B5,ByteType:dd,Cache:au,Camera:cv,CameraHelper:PV,CanvasTarget:wk,CanvasTexture:rV,CapsuleGeometry:TT,CatmullRomCurve3:tD,CineonToneMapping:pC,CircleGeometry:AT,ClampToEdgeWrapping:ts,ClippingGroup:Bse,Clock:KC,CodeNode:Fr,Color:Bt,ColorKeyframeTrack:HC,ColorManagement:yn,ColorSpaceNode:u3,CompressedArrayTexture:iV,CompressedCubeTexture:sV,CompressedTexture:ST,CompressedTextureLoader:pV,ComputeNode:C5,ConeGeometry:hv,ConstNode:Il,ConstantAlphaFactor:_B,ConstantColorFactor:yB,ContextNode:hO,Controls:WV,ConvertNode:LD,CubeCamera:SC,CubeReflectionMapping:Do,CubeRefractionMapping:Rl,CubeTexture:Zf,CubeTextureLoader:dD,CubeTextureNode:aH,CubeUVReflectionMapping:Ed,CubicBezierCurve:RC,CubicBezierCurve3:nD,CubicInterpolant:lD,CullFaceBack:vS,CullFaceFront:aC,CullFaceFrontBack:Cz,CullFaceNone:rC,Curve:Tc,CurvePath:sD,CustomBlending:fp,CustomToneMapping:SB,CylinderGeometry:y0,Cylindrical:CV,Data3DTexture:hT,DataArrayTexture:lv,DataTexture:No,DataTextureLoader:kC,DataUtils:op,DebugNode:P5,DecrementStencilOp:UB,DecrementWrapStencilOp:IB,DefaultLoadingManager:Mg,DepthFormat:Ro,DepthStencilFormat:wo,DepthTexture:Bo,DetachedBindMode:TB,DirectionalLight:FT,DirectionalLightHelper:IV,DirectionalLightNode:yk,DiscreteInterpolant:cD,DodecahedronGeometry:ET,DoubleSide:hr,DstAlphaFactor:QS,DstColorFactor:tT,DynamicCopyUsage:Fz,DynamicDrawUsage:ap,DynamicReadUsage:Lz,EdgesGeometry:ZB,EllipseCurve:MT,EnvironmentNode:q9,EqualCompare:lT,EqualDepth:qg,EqualStencilFunc:zB,EquirectangularReflectionMapping:Ad,EquirectangularRefractionMapping:zf,Euler:Wa,EventDispatcher:Oo,EventNode:To,ExpressionNode:cS,ExternalTexture:CC,ExtrudeGeometry:CT,FileLoader:Hr,Float16BufferAttribute:bC,Float32BufferAttribute:an,FloatType:Ti,Fog:yT,FogExp2:xT,FramebufferTexture:bT,FrontFacingNode:$5,FrontSide:Ha,Frustum:Zp,FrustumArray:dv,FunctionCallNode:g8,FunctionNode:rU,FunctionOverloadingNode:l6,GLBufferAttribute:EV,GLSL1:zz,GLSL3:mM,GLSLNodeParser:Mk,GreaterCompare:cT,GreaterDepth:jg,GreaterEqualCompare:dT,GreaterEqualDepth:Yg,GreaterEqualStencilFunc:WB,GreaterStencilFunc:HB,GridHelper:UV,Group:fc,HalfFloatType:Ai,HemisphereLight:WC,HemisphereLightHelper:OV,HemisphereLightNode:Tk,IESSpotLight:Vk,IESSpotLightNode:_k,IcosahedronGeometry:pv,ImageBitmapLoader:yD,ImageLoader:Hy,ImageUtils:YB,IncrementStencilOp:OB,IncrementWrapStencilOp:LB,IndexNode:Ss,IndirectStorageBufferAttribute:wse,InspectorBase:_O,InstanceNode:PO,InstancedBufferAttribute:Jo,InstancedBufferGeometry:mD,InstancedInterleavedBuffer:ED,InstancedMesh:AC,InstancedMeshNode:$H,Int16BufferAttribute:Jz,Int32BufferAttribute:Zz,Int8BufferAttribute:jz,IntType:fr,InterleavedBuffer:x0,InterleavedBufferAttribute:Md,Interpolant:b0,InterpolateDiscrete:e0,InterpolateLinear:t0,InterpolateSmooth:tS,InterpolationSamplingMode:Hz,InterpolationSamplingType:Vz,InvertStencilOp:PB,IrradianceNode:c9,IsolateNode:w5,JoinNode:KV,KeepStencilOp:Tf,KeyframeTrack:Ll,LOD:$B,LatheGeometry:RT,Layers:r0,LessCompare:rv,LessDepth:Xg,LessEqualCompare:av,LessEqualDepth:Sd,LessEqualStencilFunc:VB,LessStencilFunc:GB,Light:th,LightProbe:YC,LightProbeNode:Ak,Lighting:Rk,LightingContextNode:o9,LightingModel:Sv,LightingNode:A0,LightsNode:R3,Line:Cd,Line2NodeMaterial:WK,Line3:wV,LineBasicMaterial:ua,LineBasicNodeMaterial:v9,LineCurve:wC,LineCurve3:iD,LineDashedMaterial:LT,LineDashedNodeMaterial:_9,LineLoop:EC,LineSegments:Sc,LinearFilter:Dn,LinearInterpolant:VC,LinearMipMapLinearFilter:_S,LinearMipMapNearestFilter:Nz,LinearMipmapLinearFilter:Cr,LinearMipmapNearestFilter:ud,LinearSRGBColorSpace:Qo,LinearToneMapping:fC,LinearTransfer:zp,Loader:Xr,LoaderUtils:Uf,LoadingManager:IT,LoopNode:n9,LoopOnce:EB,LoopPingPong:CB,LoopRepeat:MB,MOUSE:Ez,MRTNode:a6,Material:ir,MaterialLoader:gv,MaterialNode:je,MaterialReferenceNode:oH,MathUtils:ov,Matrix2:xv,Matrix3:Ln,Matrix4:Yt,MaxEquation:cC,MaxMipLevelNode:V5,MemberNode:ZV,Mesh:Ui,MeshBasicMaterial:er,MeshBasicNodeMaterial:w9,MeshDepthMaterial:FC,MeshDistanceMaterial:GC,MeshLambertMaterial:PC,MeshLambertNodeMaterial:N9,MeshMatcapMaterial:zC,MeshMatcapNodeMaterial:$9,MeshNormalMaterial:IC,MeshNormalNodeMaterial:A9,MeshPhongMaterial:UC,MeshPhongNodeMaterial:B9,MeshPhysicalMaterial:nl,MeshPhysicalNodeMaterial:ZO,MeshSSSNodeMaterial:qJ,MeshStandardMaterial:_0,MeshStandardNodeMaterial:JO,MeshToonMaterial:LC,MeshToonNodeMaterial:Y9,MinEquation:lC,MirroredRepeatWrapping:lu,MixOperation:uC,ModelNode:Ul,MorphNode:s9,MultiplyBlending:xp,MultiplyOperation:h0,NearestFilter:es,NearestMipMapLinearFilter:wz,NearestMipMapNearestFilter:Rz,NearestMipmapLinearFilter:Sl,NearestMipmapNearestFilter:p0,NeutralToneMapping:gC,NeverCompare:oT,NeverDepth:kg,NeverStencilFunc:FB,NoBlending:ca,NoColorSpace:Ga,NoToneMapping:zr,Node:jt,NodeAccess:la,NodeAttribute:RN,NodeBuilder:_U,NodeCache:lM,NodeCode:xk,NodeFrame:wN,NodeFunctionInput:B3,NodeLoader:Wk,NodeMaterial:ys,NodeMaterialLoader:Xk,NodeMaterialObserver:qV,NodeObjectLoader:Nse,NodeShaderStage:Sy,NodeType:$V,NodeUniform:mk,NodeUpdateType:Bn,NodeUtils:Yj,NodeVar:vU,NodeVarying:gk,NormalAnimationBlendMode:aT,NormalBlending:Mo,NormalMapNode:vH,NotEqualCompare:uT,NotEqualDepth:$g,NotEqualStencilFunc:kB,NumberKeyframeTrack:Hp,Object3D:mi,Object3DNode:si,ObjectLoader:xD,ObjectSpaceNormalMap:vC,OctahedronGeometry:mv,OneFactor:KS,OneMinusConstantAlphaFactor:bB,OneMinusConstantColorFactor:vB,OneMinusDstAlphaFactor:eT,OneMinusDstColorFactor:nT,OneMinusSrcAlphaFactor:Hg,OneMinusSrcColorFactor:ZS,OrthographicCamera:Ac,OutputStructNode:nU,PCFShadowMap:ev,PCFSoftShadowMap:My,PMREMGenerator:W9,PMREMNode:X9,ParameterNode:tU,PassNode:pu,Path:MS,PerspectiveCamera:bs,PhongLightingModel:qO,PhysicalLightingModel:_3,Plane:iu,PlaneGeometry:Bd,PlaneHelper:zV,PointLight:PT,PointLightHelper:DV,PointLightNode:rk,PointUVNode:m6,Points:MC,PointsMaterial:fv,PointsNodeMaterial:J9,PolarGridHelper:LV,PolyhedronGeometry:eh,PositionalAudio:yV,PostProcessing:Ese,PosterizeNode:A6,ProjectorLight:Hk,ProjectorLightNode:bk,PropertyBinding:Ni,PropertyMixer:_D,PropertyNode:Hi,QuadMesh:Ev,QuadraticBezierCurve:NC,QuadraticBezierCurve3:BC,Quaternion:wr,QuaternionKeyframeTrack:Vf,QuaternionLinearInterpolant:uD,RED_GREEN_RGTC2_Format:Fp,RED_RGTC1_Format:Ip,REVISION:$f,RGBADepthPacking:NB,RGBAFormat:Oi,RGBAIntegerFormat:Jp,RGBA_ASTC_10x10_Format:Dp,RGBA_ASTC_10x5_Format:wp,RGBA_ASTC_10x6_Format:Np,RGBA_ASTC_10x8_Format:Bp,RGBA_ASTC_12x10_Format:Op,RGBA_ASTC_12x12_Format:Up,RGBA_ASTC_4x4_Format:bp,RGBA_ASTC_5x4_Format:Sp,RGBA_ASTC_5x5_Format:Tp,RGBA_ASTC_6x5_Format:Ap,RGBA_ASTC_6x6_Format:Ep,RGBA_ASTC_8x5_Format:Mp,RGBA_ASTC_8x6_Format:Cp,RGBA_ASTC_8x8_Format:Rp,RGBA_BPTC_Format:Lp,RGBA_ETC2_EAC_Format:_p,RGBA_PVRTC_2BPPV1_Format:Qg,RGBA_PVRTC_4BPPV1_Format:Zg,RGBA_S3TC_DXT1_Format:pd,RGBA_S3TC_DXT3_Format:md,RGBA_S3TC_DXT5_Format:gd,RGBDepthPacking:Bz,RGBFormat:m0,RGBIntegerFormat:AB,RGB_BPTC_SIGNED_Format:bS,RGB_BPTC_UNSIGNED_Format:SS,RGB_ETC1_Format:yp,RGB_ETC2_Format:vp,RGB_PVRTC_2BPPV1_Format:Jg,RGB_PVRTC_4BPPV1_Format:Kg,RGB_S3TC_DXT1_Format:hd,RGDepthPacking:Dz,RGFormat:Al,RGIntegerFormat:Kp,RTTNode:f6,RangeNode:F6,RawShaderMaterial:aD,Ray:g0,Raycaster:GT,RectAreaLight:qC,RectAreaLightNode:vk,RedFormat:Kf,RedIntegerFormat:Jf,ReferenceNode:XT,ReflectorNode:T3,ReinhardToneMapping:hC,RemapNode:yO,RenderOutputNode:I5,RenderTarget:bc,RenderTarget3D:bV,RendererReferenceNode:_5,RendererUtils:$ee,RepeatWrapping:wl,ReplaceStencilOp:DB,ReverseSubtractEquation:$S,RingGeometry:wT,RotateNode:K9,SIGNED_RED_GREEN_RGTC2_Format:Gp,SIGNED_RED_RGTC1_Format:Pp,SRGBColorSpace:Mr,SRGBTransfer:qt,Scene:Qf,SceneNode:Ao,ScreenNode:us,ScriptableNode:I6,ScriptableValueNode:U6,SetNode:JV,ShaderMaterial:Xa,ShadowBaseNode:V6,ShadowMaterial:OC,ShadowNode:mU,ShadowNodeMaterial:Z9,Shape:hp,ShapeGeometry:NT,ShapePath:kV,ShapeUtils:hc,ShortType:fd,Skeleton:uv,SkeletonHelper:CD,SkinnedMesh:TC,SkinningNode:FO,Source:Bf,Sphere:mr,SphereGeometry:v0,Spherical:MD,SphericalHarmonics3:pD,SplineCurve:DC,SplitNode:ID,SpotLight:S0,SpotLightHelper:NV,SpotLightNode:D3,Sprite:jB,SpriteMaterial:vT,SpriteNodeMaterial:QO,SpriteSheetUVNode:u6,SrcAlphaFactor:Vg,SrcAlphaSaturateFactor:iT,SrcColorFactor:JS,StackNode:n6,StaticCopyUsage:Pz,StaticDrawUsage:n0,StaticReadUsage:Uz,StereoCamera:gV,Storage3DTexture:Cse,StorageArrayElementNode:QH,StorageArrayTexture:Rse,StorageBufferAttribute:iU,StorageBufferNode:e9,StorageInstancedBufferAttribute:p6,StorageTexture:Mse,StorageTextureNode:y6,StreamCopyUsage:Gz,StreamDrawUsage:Oz,StreamReadUsage:Iz,StringKeyframeTrack:em,StructNode:s6,StructTypeNode:i6,SubBuildNode:h5,SubtractEquation:jS,SubtractiveBlending:gp,TOUCH:Mz,TSL:Vne,TangentSpaceNormalMap:cu,TempNode:js,TetrahedronGeometry:BT,Texture:pi,Texture3DNode:_6,TextureLoader:fD,TextureNode:fu,TextureSizeNode:z5,TextureUtils:XV,Timer:MV,TimestampQuery:dc,ToneMappingNode:S5,ToonOutlinePassNode:M6,TorusGeometry:DT,TorusKnotGeometry:OT,Triangle:bo,TriangleFanDrawMode:TS,TriangleStripDrawMode:yC,TrianglesDrawMode:RB,TubeGeometry:UT,UVMapping:Td,Uint16BufferAttribute:pT,Uint32BufferAttribute:mT,Uint8BufferAttribute:$z,Uint8ClampedBufferAttribute:Kz,Uniform:SV,UniformArrayNode:H5,UniformGroupNode:$D,UniformNode:_v,UniformsGroup:AV,UnsignedByteType:ss,UnsignedInt101111Type:sv,UnsignedInt248Type:Co,UnsignedInt5999Type:iv,UnsignedIntType:Xi,UnsignedShort4444Type:tv,UnsignedShort5551Type:nv,UnsignedShortType:Tl,UserDataNode:S6,VSMShadowMap:Fa,VarNode:lS,VaryingNode:p5,Vector2:Ze,Vector3:Q,Vector4:mn,VectorKeyframeTrack:Hf,VertexColorNode:f9,VideoFrameTexture:nV,VideoTexture:JB,ViewportDepthNode:So,ViewportDepthTextureNode:u9,ViewportSharedTextureNode:b9,ViewportTextureNode:YT,VolumeNodeMaterial:sZ,WebGL3DRenderTarget:qz,WebGLArrayRenderTarget:Xz,WebGLCoordinateSystem:oa,WebGLCubeRenderTarget:gT,WebGLRenderTarget:Bl,WebGPUCoordinateSystem:Nl,WebGPURenderer:kk,WebXRController:Ry,WireframeGeometry:rD,WrapAroundEnding:Gy,ZeroCurvatureEnding:sp,ZeroFactor:nu,ZeroSlopeEnding:rp,ZeroStencilOp:BB,createCanvasElement:_C,defaultBuildStages:_M,defaultShaderStages:UD,error:nt,getConsoleFunction:Wz,log:i0,setConsoleFunction:kz,shaderStages:bM,vectorComponents:tm,warn:De,warnOnce:qi},Symbol.toStringTag,{value:"Module"}));var Jw={exports:{}},vf={};var PF;function Ose(){return PF||(PF=1,vf.ConcurrentRoot=1,vf.ContinuousEventPriority=8,vf.DefaultEventPriority=32,vf.DiscreteEventPriority=2,vf.IdleEventPriority=268435456,vf.LegacyRoot=0,vf.NoEventPriority=0),vf}var FF;function Use(){return FF||(FF=1,Jw.exports=Ose()),Jw.exports}var cM=Use();function qk(){let i=null,e=!1,t=null,n=null;function s(r,a){t(r,a),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function Lse(i){const e=new WeakMap;function t(o,l){const u=o.array,f=o.usage,p=u.byteLength,x=i.createBuffer();i.bindBuffer(l,x),i.bufferData(l,u,f),o.onUploadCallback();let y;if(u instanceof Float32Array)y=i.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)y=i.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?y=i.HALF_FLOAT:y=i.UNSIGNED_SHORT;else if(u instanceof Int16Array)y=i.SHORT;else if(u instanceof Uint32Array)y=i.UNSIGNED_INT;else if(u instanceof Int32Array)y=i.INT;else if(u instanceof Int8Array)y=i.BYTE;else if(u instanceof Uint8Array)y=i.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)y=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:x,type:y,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:p}}function n(o,l,u){const f=l.array,p=l.updateRanges;if(i.bindBuffer(u,o),p.length===0)i.bufferSubData(u,0,f);else{p.sort((y,_)=>y.start-_.start);let x=0;for(let y=1;y<p.length;y++){const _=p[x],T=p[y];T.start<=_.start+_.count+1?_.count=Math.max(_.count,T.start+T.count-_.start):(++x,p[x]=T)}p.length=x+1;for(let y=0,_=p.length;y<_;y++){const T=p[y];i.bufferSubData(u,T.start*f.BYTES_PER_ELEMENT,f,T.start,T.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function r(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(i.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const f=e.get(o);(!f||f.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,o,l),u.version=o.version}}return{get:s,remove:r,update:a}}var Ise=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Pse=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Fse=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Gse=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,zse=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Vse=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Hse=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,kse=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Wse=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Xse=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,qse=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Yse=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,jse=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,$se=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Kse=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Jse=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Zse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Qse=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,ere=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,tre=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,nre=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ire=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,sre=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,rre=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,are=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,ore=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,lre=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,cre=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,ure=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,dre=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,fre="gl_FragColor = linearToOutputTexel( gl_FragColor );",hre=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,pre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,mre=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,gre=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,xre=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,yre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,vre=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,_re=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,bre=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Sre=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Tre=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Are=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Ere=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Mre=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Cre=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Rre=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,wre=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Nre=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Bre=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Dre=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Ore=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Ure=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Lre=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Ire=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Pre=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Fre=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Gre=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,zre=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Vre=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Hre=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,kre=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Wre=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Xre=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qre=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Yre=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,jre=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,$re=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Kre=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Jre=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Zre=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Qre=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,eae=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,tae=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,nae=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,iae=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,sae=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,rae=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,aae=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,oae=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,lae=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,cae=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,uae=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,dae=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,fae=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,hae=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,pae=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,mae=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,gae=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,xae=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,yae=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,vae=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,_ae=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,bae=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Sae=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Tae=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Aae=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Eae=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Mae=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Cae=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Rae=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,wae=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Nae=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Bae=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Dae=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Oae=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Uae=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Lae=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Iae=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Pae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Fae=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Gae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,zae=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Vae=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Hae=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,kae=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Wae=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Xae=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,qae=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Yae=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,jae=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$ae=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Kae=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Jae=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Zae=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Qae=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,eoe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,toe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,noe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ioe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,soe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,roe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,aoe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ooe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,loe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,coe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,uoe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,doe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,foe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,hoe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,poe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ei={alphahash_fragment:Ise,alphahash_pars_fragment:Pse,alphamap_fragment:Fse,alphamap_pars_fragment:Gse,alphatest_fragment:zse,alphatest_pars_fragment:Vse,aomap_fragment:Hse,aomap_pars_fragment:kse,batching_pars_vertex:Wse,batching_vertex:Xse,begin_vertex:qse,beginnormal_vertex:Yse,bsdfs:jse,iridescence_fragment:$se,bumpmap_pars_fragment:Kse,clipping_planes_fragment:Jse,clipping_planes_pars_fragment:Zse,clipping_planes_pars_vertex:Qse,clipping_planes_vertex:ere,color_fragment:tre,color_pars_fragment:nre,color_pars_vertex:ire,color_vertex:sre,common:rre,cube_uv_reflection_fragment:are,defaultnormal_vertex:ore,displacementmap_pars_vertex:lre,displacementmap_vertex:cre,emissivemap_fragment:ure,emissivemap_pars_fragment:dre,colorspace_fragment:fre,colorspace_pars_fragment:hre,envmap_fragment:pre,envmap_common_pars_fragment:mre,envmap_pars_fragment:gre,envmap_pars_vertex:xre,envmap_physical_pars_fragment:Rre,envmap_vertex:yre,fog_vertex:vre,fog_pars_vertex:_re,fog_fragment:bre,fog_pars_fragment:Sre,gradientmap_pars_fragment:Tre,lightmap_pars_fragment:Are,lights_lambert_fragment:Ere,lights_lambert_pars_fragment:Mre,lights_pars_begin:Cre,lights_toon_fragment:wre,lights_toon_pars_fragment:Nre,lights_phong_fragment:Bre,lights_phong_pars_fragment:Dre,lights_physical_fragment:Ore,lights_physical_pars_fragment:Ure,lights_fragment_begin:Lre,lights_fragment_maps:Ire,lights_fragment_end:Pre,logdepthbuf_fragment:Fre,logdepthbuf_pars_fragment:Gre,logdepthbuf_pars_vertex:zre,logdepthbuf_vertex:Vre,map_fragment:Hre,map_pars_fragment:kre,map_particle_fragment:Wre,map_particle_pars_fragment:Xre,metalnessmap_fragment:qre,metalnessmap_pars_fragment:Yre,morphinstance_vertex:jre,morphcolor_vertex:$re,morphnormal_vertex:Kre,morphtarget_pars_vertex:Jre,morphtarget_vertex:Zre,normal_fragment_begin:Qre,normal_fragment_maps:eae,normal_pars_fragment:tae,normal_pars_vertex:nae,normal_vertex:iae,normalmap_pars_fragment:sae,clearcoat_normal_fragment_begin:rae,clearcoat_normal_fragment_maps:aae,clearcoat_pars_fragment:oae,iridescence_pars_fragment:lae,opaque_fragment:cae,packing:uae,premultiplied_alpha_fragment:dae,project_vertex:fae,dithering_fragment:hae,dithering_pars_fragment:pae,roughnessmap_fragment:mae,roughnessmap_pars_fragment:gae,shadowmap_pars_fragment:xae,shadowmap_pars_vertex:yae,shadowmap_vertex:vae,shadowmask_pars_fragment:_ae,skinbase_vertex:bae,skinning_pars_vertex:Sae,skinning_vertex:Tae,skinnormal_vertex:Aae,specularmap_fragment:Eae,specularmap_pars_fragment:Mae,tonemapping_fragment:Cae,tonemapping_pars_fragment:Rae,transmission_fragment:wae,transmission_pars_fragment:Nae,uv_pars_fragment:Bae,uv_pars_vertex:Dae,uv_vertex:Oae,worldpos_vertex:Uae,background_vert:Lae,background_frag:Iae,backgroundCube_vert:Pae,backgroundCube_frag:Fae,cube_vert:Gae,cube_frag:zae,depth_vert:Vae,depth_frag:Hae,distanceRGBA_vert:kae,distanceRGBA_frag:Wae,equirect_vert:Xae,equirect_frag:qae,linedashed_vert:Yae,linedashed_frag:jae,meshbasic_vert:$ae,meshbasic_frag:Kae,meshlambert_vert:Jae,meshlambert_frag:Zae,meshmatcap_vert:Qae,meshmatcap_frag:eoe,meshnormal_vert:toe,meshnormal_frag:noe,meshphong_vert:ioe,meshphong_frag:soe,meshphysical_vert:roe,meshphysical_frag:aoe,meshtoon_vert:ooe,meshtoon_frag:loe,points_vert:coe,points_frag:uoe,shadow_vert:doe,shadow_frag:foe,sprite_vert:hoe,sprite_frag:poe},Wt={common:{diffuse:{value:new Bt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ln}},envmap:{envMap:{value:null},envMapRotation:{value:new Ln},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ln}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ln}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ln},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ln},normalScale:{value:new Ze(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ln},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ln}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ln}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ln}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0},uvTransform:{value:new Ln}},sprite:{diffuse:{value:new Bt(16777215)},opacity:{value:1},center:{value:new Ze(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0}}},su={basic:{uniforms:po([Wt.common,Wt.specularmap,Wt.envmap,Wt.aomap,Wt.lightmap,Wt.fog]),vertexShader:ei.meshbasic_vert,fragmentShader:ei.meshbasic_frag},lambert:{uniforms:po([Wt.common,Wt.specularmap,Wt.envmap,Wt.aomap,Wt.lightmap,Wt.emissivemap,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,Wt.fog,Wt.lights,{emissive:{value:new Bt(0)}}]),vertexShader:ei.meshlambert_vert,fragmentShader:ei.meshlambert_frag},phong:{uniforms:po([Wt.common,Wt.specularmap,Wt.envmap,Wt.aomap,Wt.lightmap,Wt.emissivemap,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,Wt.fog,Wt.lights,{emissive:{value:new Bt(0)},specular:{value:new Bt(1118481)},shininess:{value:30}}]),vertexShader:ei.meshphong_vert,fragmentShader:ei.meshphong_frag},standard:{uniforms:po([Wt.common,Wt.envmap,Wt.aomap,Wt.lightmap,Wt.emissivemap,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,Wt.roughnessmap,Wt.metalnessmap,Wt.fog,Wt.lights,{emissive:{value:new Bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ei.meshphysical_vert,fragmentShader:ei.meshphysical_frag},toon:{uniforms:po([Wt.common,Wt.aomap,Wt.lightmap,Wt.emissivemap,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,Wt.gradientmap,Wt.fog,Wt.lights,{emissive:{value:new Bt(0)}}]),vertexShader:ei.meshtoon_vert,fragmentShader:ei.meshtoon_frag},matcap:{uniforms:po([Wt.common,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,Wt.fog,{matcap:{value:null}}]),vertexShader:ei.meshmatcap_vert,fragmentShader:ei.meshmatcap_frag},points:{uniforms:po([Wt.points,Wt.fog]),vertexShader:ei.points_vert,fragmentShader:ei.points_frag},dashed:{uniforms:po([Wt.common,Wt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ei.linedashed_vert,fragmentShader:ei.linedashed_frag},depth:{uniforms:po([Wt.common,Wt.displacementmap]),vertexShader:ei.depth_vert,fragmentShader:ei.depth_frag},normal:{uniforms:po([Wt.common,Wt.bumpmap,Wt.normalmap,Wt.displacementmap,{opacity:{value:1}}]),vertexShader:ei.meshnormal_vert,fragmentShader:ei.meshnormal_frag},sprite:{uniforms:po([Wt.sprite,Wt.fog]),vertexShader:ei.sprite_vert,fragmentShader:ei.sprite_frag},background:{uniforms:{uvTransform:{value:new Ln},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ei.background_vert,fragmentShader:ei.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ln}},vertexShader:ei.backgroundCube_vert,fragmentShader:ei.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ei.cube_vert,fragmentShader:ei.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ei.equirect_vert,fragmentShader:ei.equirect_frag},distanceRGBA:{uniforms:po([Wt.common,Wt.displacementmap,{referencePosition:{value:new Q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ei.distanceRGBA_vert,fragmentShader:ei.distanceRGBA_frag},shadow:{uniforms:po([Wt.lights,Wt.fog,{color:{value:new Bt(0)},opacity:{value:1}}]),vertexShader:ei.shadow_vert,fragmentShader:ei.shadow_frag}};su.physical={uniforms:po([su.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ln},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ln},clearcoatNormalScale:{value:new Ze(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ln},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ln},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ln},sheen:{value:0},sheenColor:{value:new Bt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ln},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ln},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ln},transmissionSamplerSize:{value:new Ze},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ln},attenuationDistance:{value:0},attenuationColor:{value:new Bt(0)},specularColor:{value:new Bt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ln},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ln},anisotropyVector:{value:new Ze},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ln}}]),vertexShader:ei.meshphysical_vert,fragmentShader:ei.meshphysical_frag};const IE={r:0,b:0,g:0},xg=new Wa,moe=new Yt;function goe(i,e,t,n,s,r,a){const o=new Bt(0);let l=r===!0?0:1,u,f,p=null,x=0,y=null;function _(w){let B=w.isScene===!0?w.background:null;return B&&B.isTexture&&(B=(w.backgroundBlurriness>0?t:e).get(B)),B}function T(w){let B=!1;const L=_(w);L===null?S(o,l):L&&L.isColor&&(S(L,1),B=!0);const D=i.xr.getEnvironmentBlendMode();D==="additive"?n.buffers.color.setClear(0,0,0,1,a):D==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||B)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function A(w,B){const L=_(B);L&&(L.isCubeTexture||L.mapping===Ed)?(f===void 0&&(f=new Ui(new Nd(1,1,1),new Xa({name:"BackgroundCubeMaterial",uniforms:zy(su.backgroundCube.uniforms),vertexShader:su.backgroundCube.vertexShader,fragmentShader:su.backgroundCube.fragmentShader,side:Yi,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(D,O,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(f)),xg.copy(B.backgroundRotation),xg.x*=-1,xg.y*=-1,xg.z*=-1,L.isCubeTexture&&L.isRenderTargetTexture===!1&&(xg.y*=-1,xg.z*=-1),f.material.uniforms.envMap.value=L,f.material.uniforms.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=B.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=B.backgroundIntensity,f.material.uniforms.backgroundRotation.value.setFromMatrix4(moe.makeRotationFromEuler(xg)),f.material.toneMapped=yn.getTransfer(L.colorSpace)!==qt,(p!==L||x!==L.version||y!==i.toneMapping)&&(f.material.needsUpdate=!0,p=L,x=L.version,y=i.toneMapping),f.layers.enableAll(),w.unshift(f,f.geometry,f.material,0,0,null)):L&&L.isTexture&&(u===void 0&&(u=new Ui(new Bd(2,2),new Xa({name:"BackgroundMaterial",uniforms:zy(su.background.uniforms),vertexShader:su.background.vertexShader,fragmentShader:su.background.fragmentShader,side:Ha,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(u)),u.material.uniforms.t2D.value=L,u.material.uniforms.backgroundIntensity.value=B.backgroundIntensity,u.material.toneMapped=yn.getTransfer(L.colorSpace)!==qt,L.matrixAutoUpdate===!0&&L.updateMatrix(),u.material.uniforms.uvTransform.value.copy(L.matrix),(p!==L||x!==L.version||y!==i.toneMapping)&&(u.material.needsUpdate=!0,p=L,x=L.version,y=i.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null))}function S(w,B){w.getRGB(IE,Qz(i)),n.buffers.color.setClear(IE.r,IE.g,IE.b,B,a)}function C(){f!==void 0&&(f.geometry.dispose(),f.material.dispose(),f=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(w,B=1){o.set(w),l=B,S(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(w){l=w,S(o,l)},render:T,addToRenderList:A,dispose:C}}function xoe(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},s=x(null);let r=s,a=!1;function o(P,X,Z,ee,te){let re=!1;const W=p(ee,Z,X);r!==W&&(r=W,u(r.object)),re=y(P,ee,Z,te),re&&_(P,ee,Z,te),te!==null&&e.update(te,i.ELEMENT_ARRAY_BUFFER),(re||a)&&(a=!1,B(P,X,Z,ee),te!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(te).buffer))}function l(){return i.createVertexArray()}function u(P){return i.bindVertexArray(P)}function f(P){return i.deleteVertexArray(P)}function p(P,X,Z){const ee=Z.wireframe===!0;let te=n[P.id];te===void 0&&(te={},n[P.id]=te);let re=te[X.id];re===void 0&&(re={},te[X.id]=re);let W=re[ee];return W===void 0&&(W=x(l()),re[ee]=W),W}function x(P){const X=[],Z=[],ee=[];for(let te=0;te<t;te++)X[te]=0,Z[te]=0,ee[te]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:X,enabledAttributes:Z,attributeDivisors:ee,object:P,attributes:{},index:null}}function y(P,X,Z,ee){const te=r.attributes,re=X.attributes;let W=0;const ne=Z.getAttributes();for(const se in ne)if(ne[se].location>=0){const _e=te[se];let K=re[se];if(K===void 0&&(se==="instanceMatrix"&&P.instanceMatrix&&(K=P.instanceMatrix),se==="instanceColor"&&P.instanceColor&&(K=P.instanceColor)),_e===void 0||_e.attribute!==K||K&&_e.data!==K.data)return!0;W++}return r.attributesNum!==W||r.index!==ee}function _(P,X,Z,ee){const te={},re=X.attributes;let W=0;const ne=Z.getAttributes();for(const se in ne)if(ne[se].location>=0){let _e=re[se];_e===void 0&&(se==="instanceMatrix"&&P.instanceMatrix&&(_e=P.instanceMatrix),se==="instanceColor"&&P.instanceColor&&(_e=P.instanceColor));const K={};K.attribute=_e,_e&&_e.data&&(K.data=_e.data),te[se]=K,W++}r.attributes=te,r.attributesNum=W,r.index=ee}function T(){const P=r.newAttributes;for(let X=0,Z=P.length;X<Z;X++)P[X]=0}function A(P){S(P,0)}function S(P,X){const Z=r.newAttributes,ee=r.enabledAttributes,te=r.attributeDivisors;Z[P]=1,ee[P]===0&&(i.enableVertexAttribArray(P),ee[P]=1),te[P]!==X&&(i.vertexAttribDivisor(P,X),te[P]=X)}function C(){const P=r.newAttributes,X=r.enabledAttributes;for(let Z=0,ee=X.length;Z<ee;Z++)X[Z]!==P[Z]&&(i.disableVertexAttribArray(Z),X[Z]=0)}function w(P,X,Z,ee,te,re,W){W===!0?i.vertexAttribIPointer(P,X,Z,te,re):i.vertexAttribPointer(P,X,Z,ee,te,re)}function B(P,X,Z,ee){T();const te=ee.attributes,re=Z.getAttributes(),W=X.defaultAttributeValues;for(const ne in re){const se=re[ne];if(se.location>=0){let ge=te[ne];if(ge===void 0&&(ne==="instanceMatrix"&&P.instanceMatrix&&(ge=P.instanceMatrix),ne==="instanceColor"&&P.instanceColor&&(ge=P.instanceColor)),ge!==void 0){const _e=ge.normalized,K=ge.itemSize,pe=e.get(ge);if(pe===void 0)continue;const we=pe.buffer,Ne=pe.type,gt=pe.bytesPerElement,Se=Ne===i.INT||Ne===i.UNSIGNED_INT||ge.gpuType===fr;if(ge.isInterleavedBufferAttribute){const Be=ge.data,ct=Be.stride,Dt=ge.offset;if(Be.isInstancedInterleavedBuffer){for(let Nt=0;Nt<se.locationSize;Nt++)S(se.location+Nt,Be.meshPerAttribute);P.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=Be.meshPerAttribute*Be.count)}else for(let Nt=0;Nt<se.locationSize;Nt++)A(se.location+Nt);i.bindBuffer(i.ARRAY_BUFFER,we);for(let Nt=0;Nt<se.locationSize;Nt++)w(se.location+Nt,K/se.locationSize,Ne,_e,ct*gt,(Dt+K/se.locationSize*Nt)*gt,Se)}else{if(ge.isInstancedBufferAttribute){for(let Be=0;Be<se.locationSize;Be++)S(se.location+Be,ge.meshPerAttribute);P.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let Be=0;Be<se.locationSize;Be++)A(se.location+Be);i.bindBuffer(i.ARRAY_BUFFER,we);for(let Be=0;Be<se.locationSize;Be++)w(se.location+Be,K/se.locationSize,Ne,_e,K*gt,K/se.locationSize*Be*gt,Se)}}else if(W!==void 0){const _e=W[ne];if(_e!==void 0)switch(_e.length){case 2:i.vertexAttrib2fv(se.location,_e);break;case 3:i.vertexAttrib3fv(se.location,_e);break;case 4:i.vertexAttrib4fv(se.location,_e);break;default:i.vertexAttrib1fv(se.location,_e)}}}}C()}function L(){F();for(const P in n){const X=n[P];for(const Z in X){const ee=X[Z];for(const te in ee)f(ee[te].object),delete ee[te];delete X[Z]}delete n[P]}}function D(P){if(n[P.id]===void 0)return;const X=n[P.id];for(const Z in X){const ee=X[Z];for(const te in ee)f(ee[te].object),delete ee[te];delete X[Z]}delete n[P.id]}function O(P){for(const X in n){const Z=n[X];if(Z[P.id]===void 0)continue;const ee=Z[P.id];for(const te in ee)f(ee[te].object),delete ee[te];delete Z[P.id]}}function F(){U(),a=!0,r!==s&&(r=s,u(r.object))}function U(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:F,resetDefaultState:U,dispose:L,releaseStatesOfGeometry:D,releaseStatesOfProgram:O,initAttributes:T,enableAttribute:A,disableUnusedAttributes:C}}function yoe(i,e,t){let n;function s(u){n=u}function r(u,f){i.drawArrays(n,u,f),t.update(f,n,1)}function a(u,f,p){p!==0&&(i.drawArraysInstanced(n,u,f,p),t.update(f,n,p))}function o(u,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,f,0,p);let y=0;for(let _=0;_<p;_++)y+=f[_];t.update(y,n,1)}function l(u,f,p,x){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let _=0;_<u.length;_++)a(u[_],f[_],x[_]);else{y.multiDrawArraysInstancedWEBGL(n,u,0,f,0,x,0,p);let _=0;for(let T=0;T<p;T++)_+=f[T]*x[T];t.update(_,n,1)}}this.setMode=s,this.render=r,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function voe(i,e,t,n){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const O=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function a(O){return!(O!==Oi&&n.convert(O)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(O){const F=O===Ai&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(O!==ss&&n.convert(O)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&O!==Ti&&!F)}function l(O){if(O==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";O="mediump"}return O==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const f=l(u);f!==u&&(De("WebGLRenderer:",u,"not supported, using",f,"instead."),u=f);const p=t.logarithmicDepthBuffer===!0,x=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),y=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),_=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T=i.getParameter(i.MAX_TEXTURE_SIZE),A=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),S=i.getParameter(i.MAX_VERTEX_ATTRIBS),C=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),w=i.getParameter(i.MAX_VARYING_VECTORS),B=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),L=_>0,D=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:p,reversedDepthBuffer:x,maxTextures:y,maxVertexTextures:_,maxTextureSize:T,maxCubemapSize:A,maxAttributes:S,maxVertexUniforms:C,maxVaryings:w,maxFragmentUniforms:B,vertexTextures:L,maxSamples:D}}function _oe(i){const e=this;let t=null,n=0,s=!1,r=!1;const a=new iu,o=new Ln,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(p,x){const y=p.length!==0||x||n!==0||s;return s=x,n=p.length,y},this.beginShadows=function(){r=!0,f(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(p,x){t=f(p,x,0)},this.setState=function(p,x,y){const _=p.clippingPlanes,T=p.clipIntersection,A=p.clipShadows,S=i.get(p);if(!s||_===null||_.length===0||r&&!A)r?f(null):u();else{const C=r?0:n,w=C*4;let B=S.clippingState||null;l.value=B,B=f(_,x,w,y);for(let L=0;L!==w;++L)B[L]=t[L];S.clippingState=B,this.numIntersection=T?this.numPlanes:0,this.numPlanes+=C}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function f(p,x,y,_){const T=p!==null?p.length:0;let A=null;if(T!==0){if(A=l.value,_!==!0||A===null){const S=y+T*4,C=x.matrixWorldInverse;o.getNormalMatrix(C),(A===null||A.length<S)&&(A=new Float32Array(S));for(let w=0,B=y;w!==T;++w,B+=4)a.copy(p[w]).applyMatrix4(C,o),a.normal.toArray(A,B),A[B+3]=a.constant}l.value=A,l.needsUpdate=!0}return e.numPlanes=T,e.numIntersection=0,A}}function boe(i){let e=new WeakMap;function t(a,o){return o===Ad?a.mapping=Do:o===zf&&(a.mapping=Rl),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===Ad||o===zf)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new gT(l.height);return u.fromEquirectangularTexture(i,a),e.set(a,u),a.addEventListener("dispose",s),t(u.texture,a.mapping)}else return null}}return a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const up=4,GF=[.125,.215,.35,.446,.526,.582],Ag=20,Soe=256,Pb=new Ac,zF=new Bt;let Zw=null,Qw=0,e2=0,t2=!1;const Toe=new Q;class ON{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,s=100,r={}){const{size:a=256,position:o=Toe}=r;Zw=this._renderer.getRenderTarget(),Qw=this._renderer.getActiveCubeFace(),e2=this._renderer.getActiveMipmapLevel(),t2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,s,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=kF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=HF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Zw,Qw,e2),this._renderer.xr.enabled=t2,e.scissorTest=!1,oy(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Do||e.mapping===Rl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Zw=this._renderer.getRenderTarget(),Qw=this._renderer.getActiveCubeFace(),e2=this._renderer.getActiveMipmapLevel(),t2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:Ai,format:Oi,colorSpace:Qo,depthBuffer:!1},s=VF(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VF(e,t,n);const{_lodMax:r}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Aoe(r)),this._blurMaterial=Moe(r,e,t),this._ggxMaterial=Eoe(r,e,t)}return s}_compileMaterial(e){const t=new Ui(new Fn,e);this._renderer.compile(t,Pb)}_sceneToCubeUV(e,t,n,s,r){const l=new bs(90,1,t,n),u=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],p=this._renderer,x=p.autoClear,y=p.toneMapping;p.getClearColor(zF),p.toneMapping=zr,p.autoClear=!1,p.state.buffers.depth.getReversed()&&(p.setRenderTarget(s),p.clearDepth(),p.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Ui(new Nd,new er({name:"PMREM.Background",side:Yi,depthWrite:!1,depthTest:!1})));const T=this._backgroundBox,A=T.material;let S=!1;const C=e.background;C?C.isColor&&(A.color.copy(C),e.background=null,S=!0):(A.color.copy(zF),S=!0);for(let w=0;w<6;w++){const B=w%3;B===0?(l.up.set(0,u[w],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x+f[w],r.y,r.z)):B===1?(l.up.set(0,0,u[w]),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y+f[w],r.z)):(l.up.set(0,u[w],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y,r.z+f[w]));const L=this._cubeSize;oy(s,B*L,w>2?L:0,L,L),p.setRenderTarget(s),S&&p.render(T,l),p.render(e,l)}p.toneMapping=y,p.autoClear=x,e.background=C}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Do||e.mapping===Rl;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=kF()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=HF());const r=s?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=r;const o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;oy(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,Pb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodMeshes.length;for(let r=1;r<s;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const s=this._renderer,r=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const l=a.uniforms,u=n/(this._lodMeshes.length-1),f=t/(this._lodMeshes.length-1),p=Math.sqrt(u*u-f*f),x=.05+u*.95,y=p*x,{_lodMax:_}=this,T=this._sizeLods[n],A=3*T*(n>_-up?n-_+up:0),S=4*(this._cubeSize-T);l.envMap.value=e.texture,l.roughness.value=y,l.mipInt.value=_-t,oy(r,A,S,3*T,2*T),s.setRenderTarget(r),s.render(o,Pb),l.envMap.value=r.texture,l.roughness.value=0,l.mipInt.value=_-n,oy(e,A,S,3*T,2*T),s.setRenderTarget(e),s.render(o,Pb)}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&nt("blur direction must be either latitudinal or longitudinal!");const f=3,p=this._lodMeshes[s];p.material=u;const x=u.uniforms,y=this._sizeLods[n]-1,_=isFinite(r)?Math.PI/(2*y):2*Math.PI/(2*Ag-1),T=r/_,A=isFinite(r)?1+Math.floor(f*T):Ag;A>Ag&&De(`sigmaRadians, ${r}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${Ag}`);const S=[];let C=0;for(let O=0;O<Ag;++O){const F=O/T,U=Math.exp(-F*F/2);S.push(U),O===0?C+=U:O<A&&(C+=2*U)}for(let O=0;O<S.length;O++)S[O]=S[O]/C;x.envMap.value=e.texture,x.samples.value=A,x.weights.value=S,x.latitudinal.value=a==="latitudinal",o&&(x.poleAxis.value=o);const{_lodMax:w}=this;x.dTheta.value=_,x.mipInt.value=w-n;const B=this._sizeLods[s],L=3*B*(s>w-up?s-w+up:0),D=4*(this._cubeSize-B);oy(t,L,D,3*B,2*B),l.setRenderTarget(t),l.render(p,Pb)}}function Aoe(i){const e=[],t=[],n=[];let s=i;const r=i-up+1+GF.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);e.push(o);let l=1/o;a>i-up?l=GF[a-i+up-1]:a===0&&(l=0),t.push(l);const u=1/(o-2),f=-u,p=1+u,x=[f,f,p,f,p,p,f,f,p,p,f,p],y=6,_=6,T=3,A=2,S=1,C=new Float32Array(T*_*y),w=new Float32Array(A*_*y),B=new Float32Array(S*_*y);for(let D=0;D<y;D++){const O=D%3*2/3-1,F=D>2?0:-1,U=[O,F,0,O+2/3,F,0,O+2/3,F+1,0,O,F,0,O+2/3,F+1,0,O,F+1,0];C.set(U,T*_*D),w.set(x,A*_*D);const P=[D,D,D,D,D,D];B.set(P,S*_*D)}const L=new Fn;L.setAttribute("position",new li(C,T)),L.setAttribute("uv",new li(w,A)),L.setAttribute("faceIndex",new li(B,S)),n.push(new Ui(L,null)),s>up&&s--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function VF(i,e,t){const n=new Bl(i,e,t);return n.texture.mapping=Ed,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function oy(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function Eoe(i,e,t){return new Xa({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:Soe,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:U3(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:ca,depthTest:!1,depthWrite:!1})}function Moe(i,e,t){const n=new Float32Array(Ag),s=new Q(0,1,0);return new Xa({name:"SphericalGaussianBlur",defines:{n:Ag,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:U3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ca,depthTest:!1,depthWrite:!1})}function HF(){return new Xa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:U3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ca,depthTest:!1,depthWrite:!1})}function kF(){return new Xa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:U3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ca,depthTest:!1,depthWrite:!1})}function U3(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Coe(i){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,u=l===Ad||l===zf,f=l===Do||l===Rl;if(u||f){let p=e.get(o);const x=p!==void 0?p.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==x)return t===null&&(t=new ON(i)),p=u?t.fromEquirectangular(o,p):t.fromCubemap(o,p),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),p.texture;if(p!==void 0)return p.texture;{const y=o.image;return u&&y&&y.height>0||f&&y&&s(y)?(t===null&&(t=new ON(i)),p=u?t.fromEquirectangular(o):t.fromCubemap(o),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),o.addEventListener("dispose",r),p.texture):null}}}return o}function s(o){let l=0;const u=6;for(let f=0;f<u;f++)o[f]!==void 0&&l++;return l===u}function r(o){const l=o.target;l.removeEventListener("dispose",r);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function Roe(i){const e={};function t(n){if(e[n]!==void 0)return e[n];const s=i.getExtension(n);return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const s=t(n);return s===null&&qi("WebGLRenderer: "+n+" extension not supported."),s}}}function woe(i,e,t,n){const s={},r=new WeakMap;function a(p){const x=p.target;x.index!==null&&e.remove(x.index);for(const _ in x.attributes)e.remove(x.attributes[_]);x.removeEventListener("dispose",a),delete s[x.id];const y=r.get(x);y&&(e.remove(y),r.delete(x)),n.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function o(p,x){return s[x.id]===!0||(x.addEventListener("dispose",a),s[x.id]=!0,t.memory.geometries++),x}function l(p){const x=p.attributes;for(const y in x)e.update(x[y],i.ARRAY_BUFFER)}function u(p){const x=[],y=p.index,_=p.attributes.position;let T=0;if(y!==null){const C=y.array;T=y.version;for(let w=0,B=C.length;w<B;w+=3){const L=C[w+0],D=C[w+1],O=C[w+2];x.push(L,D,D,O,O,L)}}else if(_!==void 0){const C=_.array;T=_.version;for(let w=0,B=C.length/3-1;w<B;w+=3){const L=w+0,D=w+1,O=w+2;x.push(L,D,D,O,O,L)}}else return;const A=new(XB(x)?mT:pT)(x,1);A.version=T;const S=r.get(p);S&&e.remove(S),r.set(p,A)}function f(p){const x=r.get(p);if(x){const y=p.index;y!==null&&x.version<y.version&&u(p)}else u(p);return r.get(p)}return{get:o,update:l,getWireframeAttribute:f}}function Noe(i,e,t){let n;function s(x){n=x}let r,a;function o(x){r=x.type,a=x.bytesPerElement}function l(x,y){i.drawElements(n,y,r,x*a),t.update(y,n,1)}function u(x,y,_){_!==0&&(i.drawElementsInstanced(n,y,r,x*a,_),t.update(y,n,_))}function f(x,y,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,r,x,0,_);let A=0;for(let S=0;S<_;S++)A+=y[S];t.update(A,n,1)}function p(x,y,_,T){if(_===0)return;const A=e.get("WEBGL_multi_draw");if(A===null)for(let S=0;S<x.length;S++)u(x[S]/a,y[S],T[S]);else{A.multiDrawElementsInstancedWEBGL(n,y,0,r,x,0,T,0,_);let S=0;for(let C=0;C<_;C++)S+=y[C]*T[C];t.update(S,n,1)}}this.setMode=s,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=f,this.renderMultiDrawInstances=p}function Boe(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=o*(r/3);break;case i.LINES:t.lines+=o*(r/2);break;case i.LINE_STRIP:t.lines+=o*(r-1);break;case i.LINE_LOOP:t.lines+=o*r;break;case i.POINTS:t.points+=o*r;break;default:nt("WebGLInfo: Unknown draw mode:",a);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function Doe(i,e,t){const n=new WeakMap,s=new mn;function r(a,o,l){const u=a.morphTargetInfluences,f=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,p=f!==void 0?f.length:0;let x=n.get(o);if(x===void 0||x.count!==p){let P=function(){F.dispose(),n.delete(o),o.removeEventListener("dispose",P)};var y=P;x!==void 0&&x.texture.dispose();const _=o.morphAttributes.position!==void 0,T=o.morphAttributes.normal!==void 0,A=o.morphAttributes.color!==void 0,S=o.morphAttributes.position||[],C=o.morphAttributes.normal||[],w=o.morphAttributes.color||[];let B=0;_===!0&&(B=1),T===!0&&(B=2),A===!0&&(B=3);let L=o.attributes.position.count*B,D=1;L>e.maxTextureSize&&(D=Math.ceil(L/e.maxTextureSize),L=e.maxTextureSize);const O=new Float32Array(L*D*4*p),F=new lv(O,L,D,p);F.type=Ti,F.needsUpdate=!0;const U=B*4;for(let X=0;X<p;X++){const Z=S[X],ee=C[X],te=w[X],re=L*D*4*X;for(let W=0;W<Z.count;W++){const ne=W*U;_===!0&&(s.fromBufferAttribute(Z,W),O[re+ne+0]=s.x,O[re+ne+1]=s.y,O[re+ne+2]=s.z,O[re+ne+3]=0),T===!0&&(s.fromBufferAttribute(ee,W),O[re+ne+4]=s.x,O[re+ne+5]=s.y,O[re+ne+6]=s.z,O[re+ne+7]=0),A===!0&&(s.fromBufferAttribute(te,W),O[re+ne+8]=s.x,O[re+ne+9]=s.y,O[re+ne+10]=s.z,O[re+ne+11]=te.itemSize===4?s.w:1)}}x={count:p,texture:F,size:new Ze(L,D)},n.set(o,x),o.addEventListener("dispose",P)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let _=0;for(let A=0;A<u.length;A++)_+=u[A];const T=o.morphTargetsRelative?1:1-_;l.getUniforms().setValue(i,"morphTargetBaseInfluence",T),l.getUniforms().setValue(i,"morphTargetInfluences",u)}l.getUniforms().setValue(i,"morphTargetsTexture",x.texture,t),l.getUniforms().setValue(i,"morphTargetsTextureSize",x.size)}return{update:r}}function Ooe(i,e,t,n){let s=new WeakMap;function r(l){const u=n.render.frame,f=l.geometry,p=e.get(l,f);if(s.get(p)!==u&&(e.update(p),s.set(p,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),s.get(l)!==u&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),s.set(l,u))),l.isSkinnedMesh){const x=l.skeleton;s.get(x)!==u&&(x.update(),s.set(x,u))}return p}function a(){s=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:r,dispose:a}}const Yk=new pi,WF=new Bo(1,1),jk=new lv,$k=new hT,Kk=new Zf,XF=[],qF=[],YF=new Float32Array(16),jF=new Float32Array(9),$F=new Float32Array(4);function Cv(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=XF[s];if(r===void 0&&(r=new Float32Array(s),XF[s]=r),e!==0){n.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,i[a].toArray(r,o)}return r}function kr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Wr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function L3(i,e){let t=qF[e];t===void 0&&(t=new Int32Array(e),qF[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function Uoe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Loe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;i.uniform2fv(this.addr,e),Wr(t,e)}}function Ioe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kr(t,e))return;i.uniform3fv(this.addr,e),Wr(t,e)}}function Poe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;i.uniform4fv(this.addr,e),Wr(t,e)}}function Foe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(kr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Wr(t,e)}else{if(kr(t,n))return;$F.set(n),i.uniformMatrix2fv(this.addr,!1,$F),Wr(t,n)}}function Goe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(kr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Wr(t,e)}else{if(kr(t,n))return;jF.set(n),i.uniformMatrix3fv(this.addr,!1,jF),Wr(t,n)}}function zoe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(kr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Wr(t,e)}else{if(kr(t,n))return;YF.set(n),i.uniformMatrix4fv(this.addr,!1,YF),Wr(t,n)}}function Voe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function Hoe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;i.uniform2iv(this.addr,e),Wr(t,e)}}function koe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;i.uniform3iv(this.addr,e),Wr(t,e)}}function Woe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;i.uniform4iv(this.addr,e),Wr(t,e)}}function Xoe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function qoe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;i.uniform2uiv(this.addr,e),Wr(t,e)}}function Yoe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;i.uniform3uiv(this.addr,e),Wr(t,e)}}function joe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;i.uniform4uiv(this.addr,e),Wr(t,e)}}function $oe(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r;this.type===i.SAMPLER_2D_SHADOW?(WF.compareFunction=av,r=WF):r=Yk,t.setTexture2D(e||r,s)}function Koe(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||$k,s)}function Joe(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||Kk,s)}function Zoe(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||jk,s)}function Qoe(i){switch(i){case 5126:return Uoe;case 35664:return Loe;case 35665:return Ioe;case 35666:return Poe;case 35674:return Foe;case 35675:return Goe;case 35676:return zoe;case 5124:case 35670:return Voe;case 35667:case 35671:return Hoe;case 35668:case 35672:return koe;case 35669:case 35673:return Woe;case 5125:return Xoe;case 36294:return qoe;case 36295:return Yoe;case 36296:return joe;case 35678:case 36198:case 36298:case 36306:case 35682:return $oe;case 35679:case 36299:case 36307:return Koe;case 35680:case 36300:case 36308:case 36293:return Joe;case 36289:case 36303:case 36311:case 36292:return Zoe}}function ele(i,e){i.uniform1fv(this.addr,e)}function tle(i,e){const t=Cv(e,this.size,2);i.uniform2fv(this.addr,t)}function nle(i,e){const t=Cv(e,this.size,3);i.uniform3fv(this.addr,t)}function ile(i,e){const t=Cv(e,this.size,4);i.uniform4fv(this.addr,t)}function sle(i,e){const t=Cv(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function rle(i,e){const t=Cv(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function ale(i,e){const t=Cv(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function ole(i,e){i.uniform1iv(this.addr,e)}function lle(i,e){i.uniform2iv(this.addr,e)}function cle(i,e){i.uniform3iv(this.addr,e)}function ule(i,e){i.uniform4iv(this.addr,e)}function dle(i,e){i.uniform1uiv(this.addr,e)}function fle(i,e){i.uniform2uiv(this.addr,e)}function hle(i,e){i.uniform3uiv(this.addr,e)}function ple(i,e){i.uniform4uiv(this.addr,e)}function mle(i,e,t){const n=this.cache,s=e.length,r=L3(t,s);kr(n,r)||(i.uniform1iv(this.addr,r),Wr(n,r));for(let a=0;a!==s;++a)t.setTexture2D(e[a]||Yk,r[a])}function gle(i,e,t){const n=this.cache,s=e.length,r=L3(t,s);kr(n,r)||(i.uniform1iv(this.addr,r),Wr(n,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||$k,r[a])}function xle(i,e,t){const n=this.cache,s=e.length,r=L3(t,s);kr(n,r)||(i.uniform1iv(this.addr,r),Wr(n,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||Kk,r[a])}function yle(i,e,t){const n=this.cache,s=e.length,r=L3(t,s);kr(n,r)||(i.uniform1iv(this.addr,r),Wr(n,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||jk,r[a])}function vle(i){switch(i){case 5126:return ele;case 35664:return tle;case 35665:return nle;case 35666:return ile;case 35674:return sle;case 35675:return rle;case 35676:return ale;case 5124:case 35670:return ole;case 35667:case 35671:return lle;case 35668:case 35672:return cle;case 35669:case 35673:return ule;case 5125:return dle;case 36294:return fle;case 36295:return hle;case 36296:return ple;case 35678:case 36198:case 36298:case 36306:case 35682:return mle;case 35679:case 36299:case 36307:return gle;case 35680:case 36300:case 36308:case 36293:return xle;case 36289:case 36303:case 36311:case 36292:return yle}}class _le{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Qoe(t.type)}}class ble{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=vle(t.type)}}class Sle{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(e,t[o.id],n)}}}const n2=/(\w+)(\])?(\[|\.)?/g;function KF(i,e){i.seq.push(e),i.map[e.id]=e}function Tle(i,e,t){const n=i.name,s=n.length;for(n2.lastIndex=0;;){const r=n2.exec(n),a=n2.lastIndex;let o=r[1];const l=r[2]==="]",u=r[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===s){KF(t,u===void 0?new _le(o,i,e):new ble(o,i,e));break}else{let p=t.map[o];p===void 0&&(p=new Sle(o),KF(t,p)),t=p}}}class uM{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),a=e.getUniformLocation(t,r.name);Tle(r,a,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&n.push(a)}return n}}function JF(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const Ale=37297;let Ele=0;function Mle(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const ZF=new Ln;function Cle(i){yn._getMatrix(ZF,yn.workingColorSpace,i);const e=`mat3( ${ZF.elements.map(t=>t.toFixed(4))} )`;switch(yn.getTransfer(i)){case zp:return[e,"LinearTransferOETF"];case qt:return[e,"sRGBTransferOETF"];default:return De("WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function QF(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=(i.getShaderInfoLog(e)||"").trim();if(n&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+Mle(i.getShaderSource(e),o)}else return r}function Rle(i,e){const t=Cle(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function wle(i,e){let t;switch(e){case fC:t="Linear";break;case hC:t="Reinhard";break;case pC:t="Cineon";break;case sT:t="ACESFilmic";break;case mC:t="AgX";break;case gC:t="Neutral";break;case SB:t="Custom";break;default:De("WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const PE=new Q;function Nle(){yn.getLuminanceCoefficients(PE);const i=PE.x.toFixed(4),e=PE.y.toFixed(4),t=PE.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Ble(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Qb).join(`
`)}function Dle(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Ole(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),a=r.name;let o=1;r.type===i.FLOAT_MAT2&&(o=2),r.type===i.FLOAT_MAT3&&(o=3),r.type===i.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:i.getAttribLocation(e,a),locationSize:o}}return t}function Qb(i){return i!==""}function e4(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function t4(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ule=/^[ \t]*#include +<([\w\d./]+)>/gm;function UN(i){return i.replace(Ule,Ile)}const Lle=new Map;function Ile(i,e){let t=ei[e];if(t===void 0){const n=Lle.get(e);if(n!==void 0)t=ei[n],De('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return UN(t)}const Ple=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function n4(i){return i.replace(Ple,Fle)}function Fle(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function i4(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Gle(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===ev?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===My?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Fa&&(e="SHADOWMAP_TYPE_VSM"),e}function zle(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Do:case Rl:e="ENVMAP_TYPE_CUBE";break;case Ed:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Vle(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Rl:e="ENVMAP_MODE_REFRACTION";break}return e}function Hle(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case h0:e="ENVMAP_BLENDING_MULTIPLY";break;case uC:e="ENVMAP_BLENDING_MIX";break;case dC:e="ENVMAP_BLENDING_ADD";break}return e}function kle(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function Wle(i,e,t,n){const s=i.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=Gle(t),u=zle(t),f=Vle(t),p=Hle(t),x=kle(t),y=Ble(t),_=Dle(r),T=s.createProgram();let A,S,C=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(Qb).join(`
`),A.length>0&&(A+=`
`),S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(Qb).join(`
`),S.length>0&&(S+=`
`)):(A=[i4(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Qb).join(`
`),S=[i4(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",t.envMap?"#define "+p:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==zr?"#define TONE_MAPPING":"",t.toneMapping!==zr?ei.tonemapping_pars_fragment:"",t.toneMapping!==zr?wle("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ei.colorspace_pars_fragment,Rle("linearToOutputTexel",t.outputColorSpace),Nle(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Qb).join(`
`)),a=UN(a),a=e4(a,t),a=t4(a,t),o=UN(o),o=e4(o,t),o=t4(o,t),a=n4(a),o=n4(o),t.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,A=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,S=["#define varying in",t.glslVersion===mM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===mM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const w=C+A+a,B=C+S+o,L=JF(s,s.VERTEX_SHADER,w),D=JF(s,s.FRAGMENT_SHADER,B);s.attachShader(T,L),s.attachShader(T,D),t.index0AttributeName!==void 0?s.bindAttribLocation(T,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(T,0,"position"),s.linkProgram(T);function O(X){if(i.debug.checkShaderErrors){const Z=s.getProgramInfoLog(T)||"",ee=s.getShaderInfoLog(L)||"",te=s.getShaderInfoLog(D)||"",re=Z.trim(),W=ee.trim(),ne=te.trim();let se=!0,ge=!0;if(s.getProgramParameter(T,s.LINK_STATUS)===!1)if(se=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,T,L,D);else{const _e=QF(s,L,"vertex"),K=QF(s,D,"fragment");nt("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(T,s.VALIDATE_STATUS)+`

Material Name: `+X.name+`
Material Type: `+X.type+`

Program Info Log: `+re+`
`+_e+`
`+K)}else re!==""?De("WebGLProgram: Program Info Log:",re):(W===""||ne==="")&&(ge=!1);ge&&(X.diagnostics={runnable:se,programLog:re,vertexShader:{log:W,prefix:A},fragmentShader:{log:ne,prefix:S}})}s.deleteShader(L),s.deleteShader(D),F=new uM(s,T),U=Ole(s,T)}let F;this.getUniforms=function(){return F===void 0&&O(this),F};let U;this.getAttributes=function(){return U===void 0&&O(this),U};let P=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=s.getProgramParameter(T,Ale)),P},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(T),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Ele++,this.cacheKey=e,this.usedTimes=1,this.program=T,this.vertexShader=L,this.fragmentShader=D,this}let Xle=0;class qle{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Yle(e),t.set(e,n)),n}}class Yle{constructor(e){this.id=Xle++,this.code=e,this.usedTimes=0}}function jle(i,e,t,n,s,r,a){const o=new r0,l=new qle,u=new Set,f=[],p=s.logarithmicDepthBuffer,x=s.vertexTextures;let y=s.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function T(U){return u.add(U),U===0?"uv":`uv${U}`}function A(U,P,X,Z,ee){const te=Z.fog,re=ee.geometry,W=U.isMeshStandardMaterial?Z.environment:null,ne=(U.isMeshStandardMaterial?t:e).get(U.envMap||W),se=ne&&ne.mapping===Ed?ne.image.height:null,ge=_[U.type];U.precision!==null&&(y=s.getMaxPrecision(U.precision),y!==U.precision&&De("WebGLProgram.getParameters:",U.precision,"not supported, using",y,"instead."));const _e=re.morphAttributes.position||re.morphAttributes.normal||re.morphAttributes.color,K=_e!==void 0?_e.length:0;let pe=0;re.morphAttributes.position!==void 0&&(pe=1),re.morphAttributes.normal!==void 0&&(pe=2),re.morphAttributes.color!==void 0&&(pe=3);let we,Ne,gt,Se;if(ge){const ni=su[ge];we=ni.vertexShader,Ne=ni.fragmentShader}else we=U.vertexShader,Ne=U.fragmentShader,l.update(U),gt=l.getVertexShaderID(U),Se=l.getFragmentShaderID(U);const Be=i.getRenderTarget(),ct=i.state.buffers.depth.getReversed(),Dt=ee.isInstancedMesh===!0,Nt=ee.isBatchedMesh===!0,It=!!U.map,Mn=!!U.matcap,Gt=!!ne,Qe=!!U.aoMap,ie=!!U.lightMap,ot=!!U.bumpMap,dt=!!U.normalMap,Tt=!!U.displacementMap,ht=!!U.emissiveMap,Ut=!!U.metalnessMap,At=!!U.roughnessMap,Ht=U.anisotropy>0,q=U.clearcoat>0,V=U.dispersion>0,Te=U.iridescence>0,Ge=U.sheen>0,$e=U.transmission>0,Ve=Ht&&!!U.anisotropyMap,Xt=q&&!!U.clearcoatMap,Ot=q&&!!U.clearcoatNormalMap,cn=q&&!!U.clearcoatRoughnessMap,Qt=Te&&!!U.iridescenceMap,et=Te&&!!U.iridescenceThicknessMap,st=Ge&&!!U.sheenColorMap,nn=Ge&&!!U.sheenRoughnessMap,zt=!!U.specularMap,Mt=!!U.specularColorMap,Kt=!!U.specularIntensityMap,ve=$e&&!!U.transmissionMap,ze=$e&&!!U.thicknessMap,Et=!!U.gradientMap,wt=!!U.alphaMap,pt=U.alphaTest>0,lt=!!U.alphaHash,en=!!U.extensions;let Tn=zr;U.toneMapped&&(Be===null||Be.isXRRenderTarget===!0)&&(Tn=i.toneMapping);const gi={shaderID:ge,shaderType:U.type,shaderName:U.name,vertexShader:we,fragmentShader:Ne,defines:U.defines,customVertexShaderID:gt,customFragmentShaderID:Se,isRawShaderMaterial:U.isRawShaderMaterial===!0,glslVersion:U.glslVersion,precision:y,batching:Nt,batchingColor:Nt&&ee._colorsTexture!==null,instancing:Dt,instancingColor:Dt&&ee.instanceColor!==null,instancingMorph:Dt&&ee.morphTexture!==null,supportsVertexTextures:x,outputColorSpace:Be===null?i.outputColorSpace:Be.isXRRenderTarget===!0?Be.texture.colorSpace:Qo,alphaToCoverage:!!U.alphaToCoverage,map:It,matcap:Mn,envMap:Gt,envMapMode:Gt&&ne.mapping,envMapCubeUVHeight:se,aoMap:Qe,lightMap:ie,bumpMap:ot,normalMap:dt,displacementMap:x&&Tt,emissiveMap:ht,normalMapObjectSpace:dt&&U.normalMapType===vC,normalMapTangentSpace:dt&&U.normalMapType===cu,metalnessMap:Ut,roughnessMap:At,anisotropy:Ht,anisotropyMap:Ve,clearcoat:q,clearcoatMap:Xt,clearcoatNormalMap:Ot,clearcoatRoughnessMap:cn,dispersion:V,iridescence:Te,iridescenceMap:Qt,iridescenceThicknessMap:et,sheen:Ge,sheenColorMap:st,sheenRoughnessMap:nn,specularMap:zt,specularColorMap:Mt,specularIntensityMap:Kt,transmission:$e,transmissionMap:ve,thicknessMap:ze,gradientMap:Et,opaque:U.transparent===!1&&U.blending===Mo&&U.alphaToCoverage===!1,alphaMap:wt,alphaTest:pt,alphaHash:lt,combine:U.combine,mapUv:It&&T(U.map.channel),aoMapUv:Qe&&T(U.aoMap.channel),lightMapUv:ie&&T(U.lightMap.channel),bumpMapUv:ot&&T(U.bumpMap.channel),normalMapUv:dt&&T(U.normalMap.channel),displacementMapUv:Tt&&T(U.displacementMap.channel),emissiveMapUv:ht&&T(U.emissiveMap.channel),metalnessMapUv:Ut&&T(U.metalnessMap.channel),roughnessMapUv:At&&T(U.roughnessMap.channel),anisotropyMapUv:Ve&&T(U.anisotropyMap.channel),clearcoatMapUv:Xt&&T(U.clearcoatMap.channel),clearcoatNormalMapUv:Ot&&T(U.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:cn&&T(U.clearcoatRoughnessMap.channel),iridescenceMapUv:Qt&&T(U.iridescenceMap.channel),iridescenceThicknessMapUv:et&&T(U.iridescenceThicknessMap.channel),sheenColorMapUv:st&&T(U.sheenColorMap.channel),sheenRoughnessMapUv:nn&&T(U.sheenRoughnessMap.channel),specularMapUv:zt&&T(U.specularMap.channel),specularColorMapUv:Mt&&T(U.specularColorMap.channel),specularIntensityMapUv:Kt&&T(U.specularIntensityMap.channel),transmissionMapUv:ve&&T(U.transmissionMap.channel),thicknessMapUv:ze&&T(U.thicknessMap.channel),alphaMapUv:wt&&T(U.alphaMap.channel),vertexTangents:!!re.attributes.tangent&&(dt||Ht),vertexColors:U.vertexColors,vertexAlphas:U.vertexColors===!0&&!!re.attributes.color&&re.attributes.color.itemSize===4,pointsUvs:ee.isPoints===!0&&!!re.attributes.uv&&(It||wt),fog:!!te,useFog:U.fog===!0,fogExp2:!!te&&te.isFogExp2,flatShading:U.flatShading===!0&&U.wireframe===!1,sizeAttenuation:U.sizeAttenuation===!0,logarithmicDepthBuffer:p,reversedDepthBuffer:ct,skinning:ee.isSkinnedMesh===!0,morphTargets:re.morphAttributes.position!==void 0,morphNormals:re.morphAttributes.normal!==void 0,morphColors:re.morphAttributes.color!==void 0,morphTargetsCount:K,morphTextureStride:pe,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:U.dithering,shadowMapEnabled:i.shadowMap.enabled&&X.length>0,shadowMapType:i.shadowMap.type,toneMapping:Tn,decodeVideoTexture:It&&U.map.isVideoTexture===!0&&yn.getTransfer(U.map.colorSpace)===qt,decodeVideoTextureEmissive:ht&&U.emissiveMap.isVideoTexture===!0&&yn.getTransfer(U.emissiveMap.colorSpace)===qt,premultipliedAlpha:U.premultipliedAlpha,doubleSided:U.side===hr,flipSided:U.side===Yi,useDepthPacking:U.depthPacking>=0,depthPacking:U.depthPacking||0,index0AttributeName:U.index0AttributeName,extensionClipCullDistance:en&&U.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(en&&U.extensions.multiDraw===!0||Nt)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:U.customProgramCacheKey()};return gi.vertexUv1s=u.has(1),gi.vertexUv2s=u.has(2),gi.vertexUv3s=u.has(3),u.clear(),gi}function S(U){const P=[];if(U.shaderID?P.push(U.shaderID):(P.push(U.customVertexShaderID),P.push(U.customFragmentShaderID)),U.defines!==void 0)for(const X in U.defines)P.push(X),P.push(U.defines[X]);return U.isRawShaderMaterial===!1&&(C(P,U),w(P,U),P.push(i.outputColorSpace)),P.push(U.customProgramCacheKey),P.join()}function C(U,P){U.push(P.precision),U.push(P.outputColorSpace),U.push(P.envMapMode),U.push(P.envMapCubeUVHeight),U.push(P.mapUv),U.push(P.alphaMapUv),U.push(P.lightMapUv),U.push(P.aoMapUv),U.push(P.bumpMapUv),U.push(P.normalMapUv),U.push(P.displacementMapUv),U.push(P.emissiveMapUv),U.push(P.metalnessMapUv),U.push(P.roughnessMapUv),U.push(P.anisotropyMapUv),U.push(P.clearcoatMapUv),U.push(P.clearcoatNormalMapUv),U.push(P.clearcoatRoughnessMapUv),U.push(P.iridescenceMapUv),U.push(P.iridescenceThicknessMapUv),U.push(P.sheenColorMapUv),U.push(P.sheenRoughnessMapUv),U.push(P.specularMapUv),U.push(P.specularColorMapUv),U.push(P.specularIntensityMapUv),U.push(P.transmissionMapUv),U.push(P.thicknessMapUv),U.push(P.combine),U.push(P.fogExp2),U.push(P.sizeAttenuation),U.push(P.morphTargetsCount),U.push(P.morphAttributeCount),U.push(P.numDirLights),U.push(P.numPointLights),U.push(P.numSpotLights),U.push(P.numSpotLightMaps),U.push(P.numHemiLights),U.push(P.numRectAreaLights),U.push(P.numDirLightShadows),U.push(P.numPointLightShadows),U.push(P.numSpotLightShadows),U.push(P.numSpotLightShadowsWithMaps),U.push(P.numLightProbes),U.push(P.shadowMapType),U.push(P.toneMapping),U.push(P.numClippingPlanes),U.push(P.numClipIntersection),U.push(P.depthPacking)}function w(U,P){o.disableAll(),P.supportsVertexTextures&&o.enable(0),P.instancing&&o.enable(1),P.instancingColor&&o.enable(2),P.instancingMorph&&o.enable(3),P.matcap&&o.enable(4),P.envMap&&o.enable(5),P.normalMapObjectSpace&&o.enable(6),P.normalMapTangentSpace&&o.enable(7),P.clearcoat&&o.enable(8),P.iridescence&&o.enable(9),P.alphaTest&&o.enable(10),P.vertexColors&&o.enable(11),P.vertexAlphas&&o.enable(12),P.vertexUv1s&&o.enable(13),P.vertexUv2s&&o.enable(14),P.vertexUv3s&&o.enable(15),P.vertexTangents&&o.enable(16),P.anisotropy&&o.enable(17),P.alphaHash&&o.enable(18),P.batching&&o.enable(19),P.dispersion&&o.enable(20),P.batchingColor&&o.enable(21),P.gradientMap&&o.enable(22),U.push(o.mask),o.disableAll(),P.fog&&o.enable(0),P.useFog&&o.enable(1),P.flatShading&&o.enable(2),P.logarithmicDepthBuffer&&o.enable(3),P.reversedDepthBuffer&&o.enable(4),P.skinning&&o.enable(5),P.morphTargets&&o.enable(6),P.morphNormals&&o.enable(7),P.morphColors&&o.enable(8),P.premultipliedAlpha&&o.enable(9),P.shadowMapEnabled&&o.enable(10),P.doubleSided&&o.enable(11),P.flipSided&&o.enable(12),P.useDepthPacking&&o.enable(13),P.dithering&&o.enable(14),P.transmission&&o.enable(15),P.sheen&&o.enable(16),P.opaque&&o.enable(17),P.pointsUvs&&o.enable(18),P.decodeVideoTexture&&o.enable(19),P.decodeVideoTextureEmissive&&o.enable(20),P.alphaToCoverage&&o.enable(21),U.push(o.mask)}function B(U){const P=_[U.type];let X;if(P){const Z=su[P];X=eV.clone(Z.uniforms)}else X=U.uniforms;return X}function L(U,P){let X;for(let Z=0,ee=f.length;Z<ee;Z++){const te=f[Z];if(te.cacheKey===P){X=te,++X.usedTimes;break}}return X===void 0&&(X=new Wle(i,P,U,r),f.push(X)),X}function D(U){if(--U.usedTimes===0){const P=f.indexOf(U);f[P]=f[f.length-1],f.pop(),U.destroy()}}function O(U){l.remove(U)}function F(){l.dispose()}return{getParameters:A,getProgramCacheKey:S,getUniforms:B,acquireProgram:L,releaseProgram:D,releaseShaderCache:O,programs:f,dispose:F}}function $le(){let i=new WeakMap;function e(a){return i.has(a)}function t(a){let o=i.get(a);return o===void 0&&(o={},i.set(a,o)),o}function n(a){i.delete(a)}function s(a,o,l){i.get(a)[o]=l}function r(){i=new WeakMap}return{has:e,get:t,remove:n,update:s,dispose:r}}function Kle(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function s4(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function r4(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function a(p,x,y,_,T,A){let S=i[e];return S===void 0?(S={id:p.id,object:p,geometry:x,material:y,groupOrder:_,renderOrder:p.renderOrder,z:T,group:A},i[e]=S):(S.id=p.id,S.object=p,S.geometry=x,S.material=y,S.groupOrder=_,S.renderOrder=p.renderOrder,S.z=T,S.group=A),e++,S}function o(p,x,y,_,T,A){const S=a(p,x,y,_,T,A);y.transmission>0?n.push(S):y.transparent===!0?s.push(S):t.push(S)}function l(p,x,y,_,T,A){const S=a(p,x,y,_,T,A);y.transmission>0?n.unshift(S):y.transparent===!0?s.unshift(S):t.unshift(S)}function u(p,x){t.length>1&&t.sort(p||Kle),n.length>1&&n.sort(x||s4),s.length>1&&s.sort(x||s4)}function f(){for(let p=e,x=i.length;p<x;p++){const y=i[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:o,unshift:l,finish:f,sort:u}}function Jle(){let i=new WeakMap;function e(n,s){const r=i.get(n);let a;return r===void 0?(a=new r4,i.set(n,[a])):s>=r.length?(a=new r4,r.push(a)):a=r[s],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function Zle(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Q,color:new Bt};break;case"SpotLight":t={position:new Q,direction:new Q,color:new Bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Q,color:new Bt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Q,skyColor:new Bt,groundColor:new Bt};break;case"RectAreaLight":t={color:new Bt,position:new Q,halfWidth:new Q,halfHeight:new Q};break}return i[e.id]=t,t}}}function Qle(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ze};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ze};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ze,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let ece=0;function tce(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function nce(i){const e=new Zle,t=Qle(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new Q);const s=new Q,r=new Yt,a=new Yt;function o(u){let f=0,p=0,x=0;for(let U=0;U<9;U++)n.probe[U].set(0,0,0);let y=0,_=0,T=0,A=0,S=0,C=0,w=0,B=0,L=0,D=0,O=0;u.sort(tce);for(let U=0,P=u.length;U<P;U++){const X=u[U],Z=X.color,ee=X.intensity,te=X.distance,re=X.shadow&&X.shadow.map?X.shadow.map.texture:null;if(X.isAmbientLight)f+=Z.r*ee,p+=Z.g*ee,x+=Z.b*ee;else if(X.isLightProbe){for(let W=0;W<9;W++)n.probe[W].addScaledVector(X.sh.coefficients[W],ee);O++}else if(X.isDirectionalLight){const W=e.get(X);if(W.color.copy(X.color).multiplyScalar(X.intensity),X.castShadow){const ne=X.shadow,se=t.get(X);se.shadowIntensity=ne.intensity,se.shadowBias=ne.bias,se.shadowNormalBias=ne.normalBias,se.shadowRadius=ne.radius,se.shadowMapSize=ne.mapSize,n.directionalShadow[y]=se,n.directionalShadowMap[y]=re,n.directionalShadowMatrix[y]=X.shadow.matrix,C++}n.directional[y]=W,y++}else if(X.isSpotLight){const W=e.get(X);W.position.setFromMatrixPosition(X.matrixWorld),W.color.copy(Z).multiplyScalar(ee),W.distance=te,W.coneCos=Math.cos(X.angle),W.penumbraCos=Math.cos(X.angle*(1-X.penumbra)),W.decay=X.decay,n.spot[T]=W;const ne=X.shadow;if(X.map&&(n.spotLightMap[L]=X.map,L++,ne.updateMatrices(X),X.castShadow&&D++),n.spotLightMatrix[T]=ne.matrix,X.castShadow){const se=t.get(X);se.shadowIntensity=ne.intensity,se.shadowBias=ne.bias,se.shadowNormalBias=ne.normalBias,se.shadowRadius=ne.radius,se.shadowMapSize=ne.mapSize,n.spotShadow[T]=se,n.spotShadowMap[T]=re,B++}T++}else if(X.isRectAreaLight){const W=e.get(X);W.color.copy(Z).multiplyScalar(ee),W.halfWidth.set(X.width*.5,0,0),W.halfHeight.set(0,X.height*.5,0),n.rectArea[A]=W,A++}else if(X.isPointLight){const W=e.get(X);if(W.color.copy(X.color).multiplyScalar(X.intensity),W.distance=X.distance,W.decay=X.decay,X.castShadow){const ne=X.shadow,se=t.get(X);se.shadowIntensity=ne.intensity,se.shadowBias=ne.bias,se.shadowNormalBias=ne.normalBias,se.shadowRadius=ne.radius,se.shadowMapSize=ne.mapSize,se.shadowCameraNear=ne.camera.near,se.shadowCameraFar=ne.camera.far,n.pointShadow[_]=se,n.pointShadowMap[_]=re,n.pointShadowMatrix[_]=X.shadow.matrix,w++}n.point[_]=W,_++}else if(X.isHemisphereLight){const W=e.get(X);W.skyColor.copy(X.color).multiplyScalar(ee),W.groundColor.copy(X.groundColor).multiplyScalar(ee),n.hemi[S]=W,S++}}A>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Wt.LTC_FLOAT_1,n.rectAreaLTC2=Wt.LTC_FLOAT_2):(n.rectAreaLTC1=Wt.LTC_HALF_1,n.rectAreaLTC2=Wt.LTC_HALF_2)),n.ambient[0]=f,n.ambient[1]=p,n.ambient[2]=x;const F=n.hash;(F.directionalLength!==y||F.pointLength!==_||F.spotLength!==T||F.rectAreaLength!==A||F.hemiLength!==S||F.numDirectionalShadows!==C||F.numPointShadows!==w||F.numSpotShadows!==B||F.numSpotMaps!==L||F.numLightProbes!==O)&&(n.directional.length=y,n.spot.length=T,n.rectArea.length=A,n.point.length=_,n.hemi.length=S,n.directionalShadow.length=C,n.directionalShadowMap.length=C,n.pointShadow.length=w,n.pointShadowMap.length=w,n.spotShadow.length=B,n.spotShadowMap.length=B,n.directionalShadowMatrix.length=C,n.pointShadowMatrix.length=w,n.spotLightMatrix.length=B+L-D,n.spotLightMap.length=L,n.numSpotLightShadowsWithMaps=D,n.numLightProbes=O,F.directionalLength=y,F.pointLength=_,F.spotLength=T,F.rectAreaLength=A,F.hemiLength=S,F.numDirectionalShadows=C,F.numPointShadows=w,F.numSpotShadows=B,F.numSpotMaps=L,F.numLightProbes=O,n.version=ece++)}function l(u,f){let p=0,x=0,y=0,_=0,T=0;const A=f.matrixWorldInverse;for(let S=0,C=u.length;S<C;S++){const w=u[S];if(w.isDirectionalLight){const B=n.directional[p];B.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(A),p++}else if(w.isSpotLight){const B=n.spot[y];B.position.setFromMatrixPosition(w.matrixWorld),B.position.applyMatrix4(A),B.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),B.direction.sub(s),B.direction.transformDirection(A),y++}else if(w.isRectAreaLight){const B=n.rectArea[_];B.position.setFromMatrixPosition(w.matrixWorld),B.position.applyMatrix4(A),a.identity(),r.copy(w.matrixWorld),r.premultiply(A),a.extractRotation(r),B.halfWidth.set(w.width*.5,0,0),B.halfHeight.set(0,w.height*.5,0),B.halfWidth.applyMatrix4(a),B.halfHeight.applyMatrix4(a),_++}else if(w.isPointLight){const B=n.point[x];B.position.setFromMatrixPosition(w.matrixWorld),B.position.applyMatrix4(A),x++}else if(w.isHemisphereLight){const B=n.hemi[T];B.direction.setFromMatrixPosition(w.matrixWorld),B.direction.transformDirection(A),T++}}}return{setup:o,setupView:l,state:n}}function a4(i){const e=new nce(i),t=[],n=[];function s(f){u.camera=f,t.length=0,n.length=0}function r(f){t.push(f)}function a(f){n.push(f)}function o(){e.setup(t)}function l(f){e.setupView(t,f)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:u,setupLights:o,setupLightsView:l,pushLight:r,pushShadow:a}}function ice(i){let e=new WeakMap;function t(s,r=0){const a=e.get(s);let o;return a===void 0?(o=new a4(i),e.set(s,[o])):r>=a.length?(o=new a4(i),a.push(o)):o=a[r],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const sce=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,rce=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ace(i,e,t){let n=new Zp;const s=new Ze,r=new Ze,a=new mn,o=new FC({depthPacking:NB}),l=new GC,u={},f=t.maxTextureSize,p={[Ha]:Yi,[Yi]:Ha,[hr]:hr},x=new Xa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ze},radius:{value:4}},vertexShader:sce,fragmentShader:rce}),y=x.clone();y.defines.HORIZONTAL_PASS=1;const _=new Fn;_.setAttribute("position",new li(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const T=new Ui(_,x),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ev;let S=this.type;this.render=function(D,O,F){if(A.enabled===!1||A.autoUpdate===!1&&A.needsUpdate===!1||D.length===0)return;const U=i.getRenderTarget(),P=i.getActiveCubeFace(),X=i.getActiveMipmapLevel(),Z=i.state;Z.setBlending(ca),Z.buffers.depth.getReversed()===!0?Z.buffers.color.setClear(0,0,0,0):Z.buffers.color.setClear(1,1,1,1),Z.buffers.depth.setTest(!0),Z.setScissorTest(!1);const ee=S!==Fa&&this.type===Fa,te=S===Fa&&this.type!==Fa;for(let re=0,W=D.length;re<W;re++){const ne=D[re],se=ne.shadow;if(se===void 0){De("WebGLShadowMap:",ne,"has no shadow.");continue}if(se.autoUpdate===!1&&se.needsUpdate===!1)continue;s.copy(se.mapSize);const ge=se.getFrameExtents();if(s.multiply(ge),r.copy(se.mapSize),(s.x>f||s.y>f)&&(s.x>f&&(r.x=Math.floor(f/ge.x),s.x=r.x*ge.x,se.mapSize.x=r.x),s.y>f&&(r.y=Math.floor(f/ge.y),s.y=r.y*ge.y,se.mapSize.y=r.y)),se.map===null||ee===!0||te===!0){const K=this.type!==Fa?{minFilter:es,magFilter:es}:{};se.map!==null&&se.map.dispose(),se.map=new Bl(s.x,s.y,K),se.map.texture.name=ne.name+".shadowMap",se.camera.updateProjectionMatrix()}i.setRenderTarget(se.map),i.clear();const _e=se.getViewportCount();for(let K=0;K<_e;K++){const pe=se.getViewport(K);a.set(r.x*pe.x,r.y*pe.y,r.x*pe.z,r.y*pe.w),Z.viewport(a),se.updateMatrices(ne,K),n=se.getFrustum(),B(O,F,se.camera,ne,this.type)}se.isPointLightShadow!==!0&&this.type===Fa&&C(se,F),se.needsUpdate=!1}S=this.type,A.needsUpdate=!1,i.setRenderTarget(U,P,X)};function C(D,O){const F=e.update(T);x.defines.VSM_SAMPLES!==D.blurSamples&&(x.defines.VSM_SAMPLES=D.blurSamples,y.defines.VSM_SAMPLES=D.blurSamples,x.needsUpdate=!0,y.needsUpdate=!0),D.mapPass===null&&(D.mapPass=new Bl(s.x,s.y)),x.uniforms.shadow_pass.value=D.map.texture,x.uniforms.resolution.value=D.mapSize,x.uniforms.radius.value=D.radius,i.setRenderTarget(D.mapPass),i.clear(),i.renderBufferDirect(O,null,F,x,T,null),y.uniforms.shadow_pass.value=D.mapPass.texture,y.uniforms.resolution.value=D.mapSize,y.uniforms.radius.value=D.radius,i.setRenderTarget(D.map),i.clear(),i.renderBufferDirect(O,null,F,y,T,null)}function w(D,O,F,U){let P=null;const X=F.isPointLight===!0?D.customDistanceMaterial:D.customDepthMaterial;if(X!==void 0)P=X;else if(P=F.isPointLight===!0?l:o,i.localClippingEnabled&&O.clipShadows===!0&&Array.isArray(O.clippingPlanes)&&O.clippingPlanes.length!==0||O.displacementMap&&O.displacementScale!==0||O.alphaMap&&O.alphaTest>0||O.map&&O.alphaTest>0||O.alphaToCoverage===!0){const Z=P.uuid,ee=O.uuid;let te=u[Z];te===void 0&&(te={},u[Z]=te);let re=te[ee];re===void 0&&(re=P.clone(),te[ee]=re,O.addEventListener("dispose",L)),P=re}if(P.visible=O.visible,P.wireframe=O.wireframe,U===Fa?P.side=O.shadowSide!==null?O.shadowSide:O.side:P.side=O.shadowSide!==null?O.shadowSide:p[O.side],P.alphaMap=O.alphaMap,P.alphaTest=O.alphaToCoverage===!0?.5:O.alphaTest,P.map=O.map,P.clipShadows=O.clipShadows,P.clippingPlanes=O.clippingPlanes,P.clipIntersection=O.clipIntersection,P.displacementMap=O.displacementMap,P.displacementScale=O.displacementScale,P.displacementBias=O.displacementBias,P.wireframeLinewidth=O.wireframeLinewidth,P.linewidth=O.linewidth,F.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const Z=i.properties.get(P);Z.light=F}return P}function B(D,O,F,U,P){if(D.visible===!1)return;if(D.layers.test(O.layers)&&(D.isMesh||D.isLine||D.isPoints)&&(D.castShadow||D.receiveShadow&&P===Fa)&&(!D.frustumCulled||n.intersectsObject(D))){D.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,D.matrixWorld);const ee=e.update(D),te=D.material;if(Array.isArray(te)){const re=ee.groups;for(let W=0,ne=re.length;W<ne;W++){const se=re[W],ge=te[se.materialIndex];if(ge&&ge.visible){const _e=w(D,ge,U,P);D.onBeforeShadow(i,D,O,F,ee,_e,se),i.renderBufferDirect(F,null,ee,_e,D,se),D.onAfterShadow(i,D,O,F,ee,_e,se)}}}else if(te.visible){const re=w(D,te,U,P);D.onBeforeShadow(i,D,O,F,ee,re,null),i.renderBufferDirect(F,null,ee,re,D,null),D.onAfterShadow(i,D,O,F,ee,re,null)}}const Z=D.children;for(let ee=0,te=Z.length;ee<te;ee++)B(Z[ee],O,F,U,P)}function L(D){D.target.removeEventListener("dispose",L);for(const F in u){const U=u[F],P=D.target.uuid;P in U&&(U[P].dispose(),delete U[P])}}}const oce={[kg]:Wg,[Xg]:jg,[qg]:$g,[Sd]:Yg,[Wg]:kg,[jg]:Xg,[$g]:qg,[Yg]:Sd};function lce(i,e){function t(){let ve=!1;const ze=new mn;let Et=null;const wt=new mn(0,0,0,0);return{setMask:function(pt){Et!==pt&&!ve&&(i.colorMask(pt,pt,pt,pt),Et=pt)},setLocked:function(pt){ve=pt},setClear:function(pt,lt,en,Tn,gi){gi===!0&&(pt*=Tn,lt*=Tn,en*=Tn),ze.set(pt,lt,en,Tn),wt.equals(ze)===!1&&(i.clearColor(pt,lt,en,Tn),wt.copy(ze))},reset:function(){ve=!1,Et=null,wt.set(-1,0,0,0)}}}function n(){let ve=!1,ze=!1,Et=null,wt=null,pt=null;return{setReversed:function(lt){if(ze!==lt){const en=e.get("EXT_clip_control");lt?en.clipControlEXT(en.LOWER_LEFT_EXT,en.ZERO_TO_ONE_EXT):en.clipControlEXT(en.LOWER_LEFT_EXT,en.NEGATIVE_ONE_TO_ONE_EXT),ze=lt;const Tn=pt;pt=null,this.setClear(Tn)}},getReversed:function(){return ze},setTest:function(lt){lt?Be(i.DEPTH_TEST):ct(i.DEPTH_TEST)},setMask:function(lt){Et!==lt&&!ve&&(i.depthMask(lt),Et=lt)},setFunc:function(lt){if(ze&&(lt=oce[lt]),wt!==lt){switch(lt){case kg:i.depthFunc(i.NEVER);break;case Wg:i.depthFunc(i.ALWAYS);break;case Xg:i.depthFunc(i.LESS);break;case Sd:i.depthFunc(i.LEQUAL);break;case qg:i.depthFunc(i.EQUAL);break;case Yg:i.depthFunc(i.GEQUAL);break;case jg:i.depthFunc(i.GREATER);break;case $g:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}wt=lt}},setLocked:function(lt){ve=lt},setClear:function(lt){pt!==lt&&(ze&&(lt=1-lt),i.clearDepth(lt),pt=lt)},reset:function(){ve=!1,Et=null,wt=null,pt=null,ze=!1}}}function s(){let ve=!1,ze=null,Et=null,wt=null,pt=null,lt=null,en=null,Tn=null,gi=null;return{setTest:function(ni){ve||(ni?Be(i.STENCIL_TEST):ct(i.STENCIL_TEST))},setMask:function(ni){ze!==ni&&!ve&&(i.stencilMask(ni),ze=ni)},setFunc:function(ni,rr,Yr){(Et!==ni||wt!==rr||pt!==Yr)&&(i.stencilFunc(ni,rr,Yr),Et=ni,wt=rr,pt=Yr)},setOp:function(ni,rr,Yr){(lt!==ni||en!==rr||Tn!==Yr)&&(i.stencilOp(ni,rr,Yr),lt=ni,en=rr,Tn=Yr)},setLocked:function(ni){ve=ni},setClear:function(ni){gi!==ni&&(i.clearStencil(ni),gi=ni)},reset:function(){ve=!1,ze=null,Et=null,wt=null,pt=null,lt=null,en=null,Tn=null,gi=null}}}const r=new t,a=new n,o=new s,l=new WeakMap,u=new WeakMap;let f={},p={},x=new WeakMap,y=[],_=null,T=!1,A=null,S=null,C=null,w=null,B=null,L=null,D=null,O=new Bt(0,0,0),F=0,U=!1,P=null,X=null,Z=null,ee=null,te=null;const re=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let W=!1,ne=0;const se=i.getParameter(i.VERSION);se.indexOf("WebGL")!==-1?(ne=parseFloat(/^WebGL (\d)/.exec(se)[1]),W=ne>=1):se.indexOf("OpenGL ES")!==-1&&(ne=parseFloat(/^OpenGL ES (\d)/.exec(se)[1]),W=ne>=2);let ge=null,_e={};const K=i.getParameter(i.SCISSOR_BOX),pe=i.getParameter(i.VIEWPORT),we=new mn().fromArray(K),Ne=new mn().fromArray(pe);function gt(ve,ze,Et,wt){const pt=new Uint8Array(4),lt=i.createTexture();i.bindTexture(ve,lt),i.texParameteri(ve,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ve,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let en=0;en<Et;en++)ve===i.TEXTURE_3D||ve===i.TEXTURE_2D_ARRAY?i.texImage3D(ze,0,i.RGBA,1,1,wt,0,i.RGBA,i.UNSIGNED_BYTE,pt):i.texImage2D(ze+en,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,pt);return lt}const Se={};Se[i.TEXTURE_2D]=gt(i.TEXTURE_2D,i.TEXTURE_2D,1),Se[i.TEXTURE_CUBE_MAP]=gt(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),Se[i.TEXTURE_2D_ARRAY]=gt(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Se[i.TEXTURE_3D]=gt(i.TEXTURE_3D,i.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Be(i.DEPTH_TEST),a.setFunc(Sd),ot(!1),dt(vS),Be(i.CULL_FACE),Qe(ca);function Be(ve){f[ve]!==!0&&(i.enable(ve),f[ve]=!0)}function ct(ve){f[ve]!==!1&&(i.disable(ve),f[ve]=!1)}function Dt(ve,ze){return p[ve]!==ze?(i.bindFramebuffer(ve,ze),p[ve]=ze,ve===i.DRAW_FRAMEBUFFER&&(p[i.FRAMEBUFFER]=ze),ve===i.FRAMEBUFFER&&(p[i.DRAW_FRAMEBUFFER]=ze),!0):!1}function Nt(ve,ze){let Et=y,wt=!1;if(ve){Et=x.get(ze),Et===void 0&&(Et=[],x.set(ze,Et));const pt=ve.textures;if(Et.length!==pt.length||Et[0]!==i.COLOR_ATTACHMENT0){for(let lt=0,en=pt.length;lt<en;lt++)Et[lt]=i.COLOR_ATTACHMENT0+lt;Et.length=pt.length,wt=!0}}else Et[0]!==i.BACK&&(Et[0]=i.BACK,wt=!0);wt&&i.drawBuffers(Et)}function It(ve){return _!==ve?(i.useProgram(ve),_=ve,!0):!1}const Mn={[aa]:i.FUNC_ADD,[jS]:i.FUNC_SUBTRACT,[$S]:i.FUNC_REVERSE_SUBTRACT};Mn[lC]=i.MIN,Mn[cC]=i.MAX;const Gt={[nu]:i.ZERO,[KS]:i.ONE,[JS]:i.SRC_COLOR,[Vg]:i.SRC_ALPHA,[iT]:i.SRC_ALPHA_SATURATE,[tT]:i.DST_COLOR,[QS]:i.DST_ALPHA,[ZS]:i.ONE_MINUS_SRC_COLOR,[Hg]:i.ONE_MINUS_SRC_ALPHA,[nT]:i.ONE_MINUS_DST_COLOR,[eT]:i.ONE_MINUS_DST_ALPHA,[yB]:i.CONSTANT_COLOR,[vB]:i.ONE_MINUS_CONSTANT_COLOR,[_B]:i.CONSTANT_ALPHA,[bB]:i.ONE_MINUS_CONSTANT_ALPHA};function Qe(ve,ze,Et,wt,pt,lt,en,Tn,gi,ni){if(ve===ca){T===!0&&(ct(i.BLEND),T=!1);return}if(T===!1&&(Be(i.BLEND),T=!0),ve!==fp){if(ve!==A||ni!==U){if((S!==aa||B!==aa)&&(i.blendEquation(i.FUNC_ADD),S=aa,B=aa),ni)switch(ve){case Mo:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case mp:i.blendFunc(i.ONE,i.ONE);break;case gp:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case xp:i.blendFuncSeparate(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ZERO,i.ONE);break;default:nt("WebGLState: Invalid blending: ",ve);break}else switch(ve){case Mo:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case mp:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE,i.ONE,i.ONE);break;case gp:nt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case xp:nt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:nt("WebGLState: Invalid blending: ",ve);break}C=null,w=null,L=null,D=null,O.set(0,0,0),F=0,A=ve,U=ni}return}pt=pt||ze,lt=lt||Et,en=en||wt,(ze!==S||pt!==B)&&(i.blendEquationSeparate(Mn[ze],Mn[pt]),S=ze,B=pt),(Et!==C||wt!==w||lt!==L||en!==D)&&(i.blendFuncSeparate(Gt[Et],Gt[wt],Gt[lt],Gt[en]),C=Et,w=wt,L=lt,D=en),(Tn.equals(O)===!1||gi!==F)&&(i.blendColor(Tn.r,Tn.g,Tn.b,gi),O.copy(Tn),F=gi),A=ve,U=!1}function ie(ve,ze){ve.side===hr?ct(i.CULL_FACE):Be(i.CULL_FACE);let Et=ve.side===Yi;ze&&(Et=!Et),ot(Et),ve.blending===Mo&&ve.transparent===!1?Qe(ca):Qe(ve.blending,ve.blendEquation,ve.blendSrc,ve.blendDst,ve.blendEquationAlpha,ve.blendSrcAlpha,ve.blendDstAlpha,ve.blendColor,ve.blendAlpha,ve.premultipliedAlpha),a.setFunc(ve.depthFunc),a.setTest(ve.depthTest),a.setMask(ve.depthWrite),r.setMask(ve.colorWrite);const wt=ve.stencilWrite;o.setTest(wt),wt&&(o.setMask(ve.stencilWriteMask),o.setFunc(ve.stencilFunc,ve.stencilRef,ve.stencilFuncMask),o.setOp(ve.stencilFail,ve.stencilZFail,ve.stencilZPass)),ht(ve.polygonOffset,ve.polygonOffsetFactor,ve.polygonOffsetUnits),ve.alphaToCoverage===!0?Be(i.SAMPLE_ALPHA_TO_COVERAGE):ct(i.SAMPLE_ALPHA_TO_COVERAGE)}function ot(ve){P!==ve&&(ve?i.frontFace(i.CW):i.frontFace(i.CCW),P=ve)}function dt(ve){ve!==rC?(Be(i.CULL_FACE),ve!==X&&(ve===vS?i.cullFace(i.BACK):ve===aC?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):ct(i.CULL_FACE),X=ve}function Tt(ve){ve!==Z&&(W&&i.lineWidth(ve),Z=ve)}function ht(ve,ze,Et){ve?(Be(i.POLYGON_OFFSET_FILL),(ee!==ze||te!==Et)&&(i.polygonOffset(ze,Et),ee=ze,te=Et)):ct(i.POLYGON_OFFSET_FILL)}function Ut(ve){ve?Be(i.SCISSOR_TEST):ct(i.SCISSOR_TEST)}function At(ve){ve===void 0&&(ve=i.TEXTURE0+re-1),ge!==ve&&(i.activeTexture(ve),ge=ve)}function Ht(ve,ze,Et){Et===void 0&&(ge===null?Et=i.TEXTURE0+re-1:Et=ge);let wt=_e[Et];wt===void 0&&(wt={type:void 0,texture:void 0},_e[Et]=wt),(wt.type!==ve||wt.texture!==ze)&&(ge!==Et&&(i.activeTexture(Et),ge=Et),i.bindTexture(ve,ze||Se[ve]),wt.type=ve,wt.texture=ze)}function q(){const ve=_e[ge];ve!==void 0&&ve.type!==void 0&&(i.bindTexture(ve.type,null),ve.type=void 0,ve.texture=void 0)}function V(){try{i.compressedTexImage2D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Te(){try{i.compressedTexImage3D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Ge(){try{i.texSubImage2D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function $e(){try{i.texSubImage3D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Ve(){try{i.compressedTexSubImage2D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Xt(){try{i.compressedTexSubImage3D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Ot(){try{i.texStorage2D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function cn(){try{i.texStorage3D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function Qt(){try{i.texImage2D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function et(){try{i.texImage3D(...arguments)}catch(ve){ve("WebGLState:",ve)}}function st(ve){we.equals(ve)===!1&&(i.scissor(ve.x,ve.y,ve.z,ve.w),we.copy(ve))}function nn(ve){Ne.equals(ve)===!1&&(i.viewport(ve.x,ve.y,ve.z,ve.w),Ne.copy(ve))}function zt(ve,ze){let Et=u.get(ze);Et===void 0&&(Et=new WeakMap,u.set(ze,Et));let wt=Et.get(ve);wt===void 0&&(wt=i.getUniformBlockIndex(ze,ve.name),Et.set(ve,wt))}function Mt(ve,ze){const wt=u.get(ze).get(ve);l.get(ze)!==wt&&(i.uniformBlockBinding(ze,wt,ve.__bindingPointIndex),l.set(ze,wt))}function Kt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),a.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},ge=null,_e={},p={},x=new WeakMap,y=[],_=null,T=!1,A=null,S=null,C=null,w=null,B=null,L=null,D=null,O=new Bt(0,0,0),F=0,U=!1,P=null,X=null,Z=null,ee=null,te=null,we.set(0,0,i.canvas.width,i.canvas.height),Ne.set(0,0,i.canvas.width,i.canvas.height),r.reset(),a.reset(),o.reset()}return{buffers:{color:r,depth:a,stencil:o},enable:Be,disable:ct,bindFramebuffer:Dt,drawBuffers:Nt,useProgram:It,setBlending:Qe,setMaterial:ie,setFlipSided:ot,setCullFace:dt,setLineWidth:Tt,setPolygonOffset:ht,setScissorTest:Ut,activeTexture:At,bindTexture:Ht,unbindTexture:q,compressedTexImage2D:V,compressedTexImage3D:Te,texImage2D:Qt,texImage3D:et,updateUBOMapping:zt,uniformBlockBinding:Mt,texStorage2D:Ot,texStorage3D:cn,texSubImage2D:Ge,texSubImage3D:$e,compressedTexSubImage2D:Ve,compressedTexSubImage3D:Xt,scissor:st,viewport:nn,reset:Kt}}function cce(i,e,t,n,s,r,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new Ze,f=new WeakMap;let p;const x=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(q,V){return y?new OffscreenCanvas(q,V):ES("canvas")}function T(q,V,Te){let Ge=1;const $e=Ht(q);if(($e.width>Te||$e.height>Te)&&(Ge=Te/Math.max($e.width,$e.height)),Ge<1)if(typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&q instanceof ImageBitmap||typeof VideoFrame<"u"&&q instanceof VideoFrame){const Ve=Math.floor(Ge*$e.width),Xt=Math.floor(Ge*$e.height);p===void 0&&(p=_(Ve,Xt));const Ot=V?_(Ve,Xt):p;return Ot.width=Ve,Ot.height=Xt,Ot.getContext("2d").drawImage(q,0,0,Ve,Xt),De("WebGLRenderer: Texture has been resized from ("+$e.width+"x"+$e.height+") to ("+Ve+"x"+Xt+")."),Ot}else return"data"in q&&De("WebGLRenderer: Image in DataTexture is too big ("+$e.width+"x"+$e.height+")."),q;return q}function A(q){return q.generateMipmaps}function S(q){i.generateMipmap(q)}function C(q){return q.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:q.isWebGL3DRenderTarget?i.TEXTURE_3D:q.isWebGLArrayRenderTarget||q.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function w(q,V,Te,Ge,$e=!1){if(q!==null){if(i[q]!==void 0)return i[q];De("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+q+"'")}let Ve=V;if(V===i.RED&&(Te===i.FLOAT&&(Ve=i.R32F),Te===i.HALF_FLOAT&&(Ve=i.R16F),Te===i.UNSIGNED_BYTE&&(Ve=i.R8)),V===i.RED_INTEGER&&(Te===i.UNSIGNED_BYTE&&(Ve=i.R8UI),Te===i.UNSIGNED_SHORT&&(Ve=i.R16UI),Te===i.UNSIGNED_INT&&(Ve=i.R32UI),Te===i.BYTE&&(Ve=i.R8I),Te===i.SHORT&&(Ve=i.R16I),Te===i.INT&&(Ve=i.R32I)),V===i.RG&&(Te===i.FLOAT&&(Ve=i.RG32F),Te===i.HALF_FLOAT&&(Ve=i.RG16F),Te===i.UNSIGNED_BYTE&&(Ve=i.RG8)),V===i.RG_INTEGER&&(Te===i.UNSIGNED_BYTE&&(Ve=i.RG8UI),Te===i.UNSIGNED_SHORT&&(Ve=i.RG16UI),Te===i.UNSIGNED_INT&&(Ve=i.RG32UI),Te===i.BYTE&&(Ve=i.RG8I),Te===i.SHORT&&(Ve=i.RG16I),Te===i.INT&&(Ve=i.RG32I)),V===i.RGB_INTEGER&&(Te===i.UNSIGNED_BYTE&&(Ve=i.RGB8UI),Te===i.UNSIGNED_SHORT&&(Ve=i.RGB16UI),Te===i.UNSIGNED_INT&&(Ve=i.RGB32UI),Te===i.BYTE&&(Ve=i.RGB8I),Te===i.SHORT&&(Ve=i.RGB16I),Te===i.INT&&(Ve=i.RGB32I)),V===i.RGBA_INTEGER&&(Te===i.UNSIGNED_BYTE&&(Ve=i.RGBA8UI),Te===i.UNSIGNED_SHORT&&(Ve=i.RGBA16UI),Te===i.UNSIGNED_INT&&(Ve=i.RGBA32UI),Te===i.BYTE&&(Ve=i.RGBA8I),Te===i.SHORT&&(Ve=i.RGBA16I),Te===i.INT&&(Ve=i.RGBA32I)),V===i.RGB&&(Te===i.UNSIGNED_INT_5_9_9_9_REV&&(Ve=i.RGB9_E5),Te===i.UNSIGNED_INT_10F_11F_11F_REV&&(Ve=i.R11F_G11F_B10F)),V===i.RGBA){const Xt=$e?zp:yn.getTransfer(Ge);Te===i.FLOAT&&(Ve=i.RGBA32F),Te===i.HALF_FLOAT&&(Ve=i.RGBA16F),Te===i.UNSIGNED_BYTE&&(Ve=Xt===qt?i.SRGB8_ALPHA8:i.RGBA8),Te===i.UNSIGNED_SHORT_4_4_4_4&&(Ve=i.RGBA4),Te===i.UNSIGNED_SHORT_5_5_5_1&&(Ve=i.RGB5_A1)}return(Ve===i.R16F||Ve===i.R32F||Ve===i.RG16F||Ve===i.RG32F||Ve===i.RGBA16F||Ve===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Ve}function B(q,V){let Te;return q?V===null||V===Xi||V===Co?Te=i.DEPTH24_STENCIL8:V===Ti?Te=i.DEPTH32F_STENCIL8:V===Tl&&(Te=i.DEPTH24_STENCIL8,De("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):V===null||V===Xi||V===Co?Te=i.DEPTH_COMPONENT24:V===Ti?Te=i.DEPTH_COMPONENT32F:V===Tl&&(Te=i.DEPTH_COMPONENT16),Te}function L(q,V){return A(q)===!0||q.isFramebufferTexture&&q.minFilter!==es&&q.minFilter!==Dn?Math.log2(Math.max(V.width,V.height))+1:q.mipmaps!==void 0&&q.mipmaps.length>0?q.mipmaps.length:q.isCompressedTexture&&Array.isArray(q.image)?V.mipmaps.length:1}function D(q){const V=q.target;V.removeEventListener("dispose",D),F(V),V.isVideoTexture&&f.delete(V)}function O(q){const V=q.target;V.removeEventListener("dispose",O),P(V)}function F(q){const V=n.get(q);if(V.__webglInit===void 0)return;const Te=q.source,Ge=x.get(Te);if(Ge){const $e=Ge[V.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&U(q),Object.keys(Ge).length===0&&x.delete(Te)}n.remove(q)}function U(q){const V=n.get(q);i.deleteTexture(V.__webglTexture);const Te=q.source,Ge=x.get(Te);delete Ge[V.__cacheKey],a.memory.textures--}function P(q){const V=n.get(q);if(q.depthTexture&&(q.depthTexture.dispose(),n.remove(q.depthTexture)),q.isWebGLCubeRenderTarget)for(let Ge=0;Ge<6;Ge++){if(Array.isArray(V.__webglFramebuffer[Ge]))for(let $e=0;$e<V.__webglFramebuffer[Ge].length;$e++)i.deleteFramebuffer(V.__webglFramebuffer[Ge][$e]);else i.deleteFramebuffer(V.__webglFramebuffer[Ge]);V.__webglDepthbuffer&&i.deleteRenderbuffer(V.__webglDepthbuffer[Ge])}else{if(Array.isArray(V.__webglFramebuffer))for(let Ge=0;Ge<V.__webglFramebuffer.length;Ge++)i.deleteFramebuffer(V.__webglFramebuffer[Ge]);else i.deleteFramebuffer(V.__webglFramebuffer);if(V.__webglDepthbuffer&&i.deleteRenderbuffer(V.__webglDepthbuffer),V.__webglMultisampledFramebuffer&&i.deleteFramebuffer(V.__webglMultisampledFramebuffer),V.__webglColorRenderbuffer)for(let Ge=0;Ge<V.__webglColorRenderbuffer.length;Ge++)V.__webglColorRenderbuffer[Ge]&&i.deleteRenderbuffer(V.__webglColorRenderbuffer[Ge]);V.__webglDepthRenderbuffer&&i.deleteRenderbuffer(V.__webglDepthRenderbuffer)}const Te=q.textures;for(let Ge=0,$e=Te.length;Ge<$e;Ge++){const Ve=n.get(Te[Ge]);Ve.__webglTexture&&(i.deleteTexture(Ve.__webglTexture),a.memory.textures--),n.remove(Te[Ge])}n.remove(q)}let X=0;function Z(){X=0}function ee(){const q=X;return q>=s.maxTextures&&De("WebGLTextures: Trying to use "+q+" texture units while this GPU supports only "+s.maxTextures),X+=1,q}function te(q){const V=[];return V.push(q.wrapS),V.push(q.wrapT),V.push(q.wrapR||0),V.push(q.magFilter),V.push(q.minFilter),V.push(q.anisotropy),V.push(q.internalFormat),V.push(q.format),V.push(q.type),V.push(q.generateMipmaps),V.push(q.premultiplyAlpha),V.push(q.flipY),V.push(q.unpackAlignment),V.push(q.colorSpace),V.join()}function re(q,V){const Te=n.get(q);if(q.isVideoTexture&&Ut(q),q.isRenderTargetTexture===!1&&q.isExternalTexture!==!0&&q.version>0&&Te.__version!==q.version){const Ge=q.image;if(Ge===null)De("WebGLRenderer: Texture marked for update but no image data found.");else if(Ge.complete===!1)De("WebGLRenderer: Texture marked for update but image is incomplete");else{Se(Te,q,V);return}}else q.isExternalTexture&&(Te.__webglTexture=q.sourceTexture?q.sourceTexture:null);t.bindTexture(i.TEXTURE_2D,Te.__webglTexture,i.TEXTURE0+V)}function W(q,V){const Te=n.get(q);if(q.isRenderTargetTexture===!1&&q.version>0&&Te.__version!==q.version){Se(Te,q,V);return}else q.isExternalTexture&&(Te.__webglTexture=q.sourceTexture?q.sourceTexture:null);t.bindTexture(i.TEXTURE_2D_ARRAY,Te.__webglTexture,i.TEXTURE0+V)}function ne(q,V){const Te=n.get(q);if(q.isRenderTargetTexture===!1&&q.version>0&&Te.__version!==q.version){Se(Te,q,V);return}t.bindTexture(i.TEXTURE_3D,Te.__webglTexture,i.TEXTURE0+V)}function se(q,V){const Te=n.get(q);if(q.version>0&&Te.__version!==q.version){Be(Te,q,V);return}t.bindTexture(i.TEXTURE_CUBE_MAP,Te.__webglTexture,i.TEXTURE0+V)}const ge={[wl]:i.REPEAT,[ts]:i.CLAMP_TO_EDGE,[lu]:i.MIRRORED_REPEAT},_e={[es]:i.NEAREST,[p0]:i.NEAREST_MIPMAP_NEAREST,[Sl]:i.NEAREST_MIPMAP_LINEAR,[Dn]:i.LINEAR,[ud]:i.LINEAR_MIPMAP_NEAREST,[Cr]:i.LINEAR_MIPMAP_LINEAR},K={[oT]:i.NEVER,[fT]:i.ALWAYS,[rv]:i.LESS,[av]:i.LEQUAL,[lT]:i.EQUAL,[dT]:i.GEQUAL,[cT]:i.GREATER,[uT]:i.NOTEQUAL};function pe(q,V){if(V.type===Ti&&e.has("OES_texture_float_linear")===!1&&(V.magFilter===Dn||V.magFilter===ud||V.magFilter===Sl||V.magFilter===Cr||V.minFilter===Dn||V.minFilter===ud||V.minFilter===Sl||V.minFilter===Cr)&&De("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(q,i.TEXTURE_WRAP_S,ge[V.wrapS]),i.texParameteri(q,i.TEXTURE_WRAP_T,ge[V.wrapT]),(q===i.TEXTURE_3D||q===i.TEXTURE_2D_ARRAY)&&i.texParameteri(q,i.TEXTURE_WRAP_R,ge[V.wrapR]),i.texParameteri(q,i.TEXTURE_MAG_FILTER,_e[V.magFilter]),i.texParameteri(q,i.TEXTURE_MIN_FILTER,_e[V.minFilter]),V.compareFunction&&(i.texParameteri(q,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(q,i.TEXTURE_COMPARE_FUNC,K[V.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(V.magFilter===es||V.minFilter!==Sl&&V.minFilter!==Cr||V.type===Ti&&e.has("OES_texture_float_linear")===!1)return;if(V.anisotropy>1||n.get(V).__currentAnisotropy){const Te=e.get("EXT_texture_filter_anisotropic");i.texParameterf(q,Te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,s.getMaxAnisotropy())),n.get(V).__currentAnisotropy=V.anisotropy}}}function we(q,V){let Te=!1;q.__webglInit===void 0&&(q.__webglInit=!0,V.addEventListener("dispose",D));const Ge=V.source;let $e=x.get(Ge);$e===void 0&&($e={},x.set(Ge,$e));const Ve=te(V);if(Ve!==q.__cacheKey){$e[Ve]===void 0&&($e[Ve]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,Te=!0),$e[Ve].usedTimes++;const Xt=$e[q.__cacheKey];Xt!==void 0&&($e[q.__cacheKey].usedTimes--,Xt.usedTimes===0&&U(V)),q.__cacheKey=Ve,q.__webglTexture=$e[Ve].texture}return Te}function Ne(q,V,Te){return Math.floor(Math.floor(q/Te)/V)}function gt(q,V,Te,Ge){const Ve=q.updateRanges;if(Ve.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,V.width,V.height,Te,Ge,V.data);else{Ve.sort((et,st)=>et.start-st.start);let Xt=0;for(let et=1;et<Ve.length;et++){const st=Ve[Xt],nn=Ve[et],zt=st.start+st.count,Mt=Ne(nn.start,V.width,4),Kt=Ne(st.start,V.width,4);nn.start<=zt+1&&Mt===Kt&&Ne(nn.start+nn.count-1,V.width,4)===Mt?st.count=Math.max(st.count,nn.start+nn.count-st.start):(++Xt,Ve[Xt]=nn)}Ve.length=Xt+1;const Ot=i.getParameter(i.UNPACK_ROW_LENGTH),cn=i.getParameter(i.UNPACK_SKIP_PIXELS),Qt=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,V.width);for(let et=0,st=Ve.length;et<st;et++){const nn=Ve[et],zt=Math.floor(nn.start/4),Mt=Math.ceil(nn.count/4),Kt=zt%V.width,ve=Math.floor(zt/V.width),ze=Mt,Et=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,Kt),i.pixelStorei(i.UNPACK_SKIP_ROWS,ve),t.texSubImage2D(i.TEXTURE_2D,0,Kt,ve,ze,Et,Te,Ge,V.data)}q.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,Ot),i.pixelStorei(i.UNPACK_SKIP_PIXELS,cn),i.pixelStorei(i.UNPACK_SKIP_ROWS,Qt)}}function Se(q,V,Te){let Ge=i.TEXTURE_2D;(V.isDataArrayTexture||V.isCompressedArrayTexture)&&(Ge=i.TEXTURE_2D_ARRAY),V.isData3DTexture&&(Ge=i.TEXTURE_3D);const $e=we(q,V),Ve=V.source;t.bindTexture(Ge,q.__webglTexture,i.TEXTURE0+Te);const Xt=n.get(Ve);if(Ve.version!==Xt.__version||$e===!0){t.activeTexture(i.TEXTURE0+Te);const Ot=yn.getPrimaries(yn.workingColorSpace),cn=V.colorSpace===Ga?null:yn.getPrimaries(V.colorSpace),Qt=V.colorSpace===Ga||Ot===cn?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,V.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,V.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qt);let et=T(V.image,!1,s.maxTextureSize);et=At(V,et);const st=r.convert(V.format,V.colorSpace),nn=r.convert(V.type);let zt=w(V.internalFormat,st,nn,V.colorSpace,V.isVideoTexture);pe(Ge,V);let Mt;const Kt=V.mipmaps,ve=V.isVideoTexture!==!0,ze=Xt.__version===void 0||$e===!0,Et=Ve.dataReady,wt=L(V,et);if(V.isDepthTexture)zt=B(V.format===wo,V.type),ze&&(ve?t.texStorage2D(i.TEXTURE_2D,1,zt,et.width,et.height):t.texImage2D(i.TEXTURE_2D,0,zt,et.width,et.height,0,st,nn,null));else if(V.isDataTexture)if(Kt.length>0){ve&&ze&&t.texStorage2D(i.TEXTURE_2D,wt,zt,Kt[0].width,Kt[0].height);for(let pt=0,lt=Kt.length;pt<lt;pt++)Mt=Kt[pt],ve?Et&&t.texSubImage2D(i.TEXTURE_2D,pt,0,0,Mt.width,Mt.height,st,nn,Mt.data):t.texImage2D(i.TEXTURE_2D,pt,zt,Mt.width,Mt.height,0,st,nn,Mt.data);V.generateMipmaps=!1}else ve?(ze&&t.texStorage2D(i.TEXTURE_2D,wt,zt,et.width,et.height),Et&&gt(V,et,st,nn)):t.texImage2D(i.TEXTURE_2D,0,zt,et.width,et.height,0,st,nn,et.data);else if(V.isCompressedTexture)if(V.isCompressedArrayTexture){ve&&ze&&t.texStorage3D(i.TEXTURE_2D_ARRAY,wt,zt,Kt[0].width,Kt[0].height,et.depth);for(let pt=0,lt=Kt.length;pt<lt;pt++)if(Mt=Kt[pt],V.format!==Oi)if(st!==null)if(ve){if(Et)if(V.layerUpdates.size>0){const en=vM(Mt.width,Mt.height,V.format,V.type);for(const Tn of V.layerUpdates){const gi=Mt.data.subarray(Tn*en/Mt.data.BYTES_PER_ELEMENT,(Tn+1)*en/Mt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,pt,0,0,Tn,Mt.width,Mt.height,1,st,gi)}V.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,pt,0,0,0,Mt.width,Mt.height,et.depth,st,Mt.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,pt,zt,Mt.width,Mt.height,et.depth,0,Mt.data,0,0);else De("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ve?Et&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,pt,0,0,0,Mt.width,Mt.height,et.depth,st,nn,Mt.data):t.texImage3D(i.TEXTURE_2D_ARRAY,pt,zt,Mt.width,Mt.height,et.depth,0,st,nn,Mt.data)}else{ve&&ze&&t.texStorage2D(i.TEXTURE_2D,wt,zt,Kt[0].width,Kt[0].height);for(let pt=0,lt=Kt.length;pt<lt;pt++)Mt=Kt[pt],V.format!==Oi?st!==null?ve?Et&&t.compressedTexSubImage2D(i.TEXTURE_2D,pt,0,0,Mt.width,Mt.height,st,Mt.data):t.compressedTexImage2D(i.TEXTURE_2D,pt,zt,Mt.width,Mt.height,0,Mt.data):De("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ve?Et&&t.texSubImage2D(i.TEXTURE_2D,pt,0,0,Mt.width,Mt.height,st,nn,Mt.data):t.texImage2D(i.TEXTURE_2D,pt,zt,Mt.width,Mt.height,0,st,nn,Mt.data)}else if(V.isDataArrayTexture)if(ve){if(ze&&t.texStorage3D(i.TEXTURE_2D_ARRAY,wt,zt,et.width,et.height,et.depth),Et)if(V.layerUpdates.size>0){const pt=vM(et.width,et.height,V.format,V.type);for(const lt of V.layerUpdates){const en=et.data.subarray(lt*pt/et.data.BYTES_PER_ELEMENT,(lt+1)*pt/et.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,lt,et.width,et.height,1,st,nn,en)}V.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,et.width,et.height,et.depth,st,nn,et.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,zt,et.width,et.height,et.depth,0,st,nn,et.data);else if(V.isData3DTexture)ve?(ze&&t.texStorage3D(i.TEXTURE_3D,wt,zt,et.width,et.height,et.depth),Et&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,et.width,et.height,et.depth,st,nn,et.data)):t.texImage3D(i.TEXTURE_3D,0,zt,et.width,et.height,et.depth,0,st,nn,et.data);else if(V.isFramebufferTexture){if(ze)if(ve)t.texStorage2D(i.TEXTURE_2D,wt,zt,et.width,et.height);else{let pt=et.width,lt=et.height;for(let en=0;en<wt;en++)t.texImage2D(i.TEXTURE_2D,en,zt,pt,lt,0,st,nn,null),pt>>=1,lt>>=1}}else if(Kt.length>0){if(ve&&ze){const pt=Ht(Kt[0]);t.texStorage2D(i.TEXTURE_2D,wt,zt,pt.width,pt.height)}for(let pt=0,lt=Kt.length;pt<lt;pt++)Mt=Kt[pt],ve?Et&&t.texSubImage2D(i.TEXTURE_2D,pt,0,0,st,nn,Mt):t.texImage2D(i.TEXTURE_2D,pt,zt,st,nn,Mt);V.generateMipmaps=!1}else if(ve){if(ze){const pt=Ht(et);t.texStorage2D(i.TEXTURE_2D,wt,zt,pt.width,pt.height)}Et&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,st,nn,et)}else t.texImage2D(i.TEXTURE_2D,0,zt,st,nn,et);A(V)&&S(Ge),Xt.__version=Ve.version,V.onUpdate&&V.onUpdate(V)}q.__version=V.version}function Be(q,V,Te){if(V.image.length!==6)return;const Ge=we(q,V),$e=V.source;t.bindTexture(i.TEXTURE_CUBE_MAP,q.__webglTexture,i.TEXTURE0+Te);const Ve=n.get($e);if($e.version!==Ve.__version||Ge===!0){t.activeTexture(i.TEXTURE0+Te);const Xt=yn.getPrimaries(yn.workingColorSpace),Ot=V.colorSpace===Ga?null:yn.getPrimaries(V.colorSpace),cn=V.colorSpace===Ga||Xt===Ot?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,V.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,V.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,cn);const Qt=V.isCompressedTexture||V.image[0].isCompressedTexture,et=V.image[0]&&V.image[0].isDataTexture,st=[];for(let lt=0;lt<6;lt++)!Qt&&!et?st[lt]=T(V.image[lt],!0,s.maxCubemapSize):st[lt]=et?V.image[lt].image:V.image[lt],st[lt]=At(V,st[lt]);const nn=st[0],zt=r.convert(V.format,V.colorSpace),Mt=r.convert(V.type),Kt=w(V.internalFormat,zt,Mt,V.colorSpace),ve=V.isVideoTexture!==!0,ze=Ve.__version===void 0||Ge===!0,Et=$e.dataReady;let wt=L(V,nn);pe(i.TEXTURE_CUBE_MAP,V);let pt;if(Qt){ve&&ze&&t.texStorage2D(i.TEXTURE_CUBE_MAP,wt,Kt,nn.width,nn.height);for(let lt=0;lt<6;lt++){pt=st[lt].mipmaps;for(let en=0;en<pt.length;en++){const Tn=pt[en];V.format!==Oi?zt!==null?ve?Et&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en,0,0,Tn.width,Tn.height,zt,Tn.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en,Kt,Tn.width,Tn.height,0,Tn.data):De("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ve?Et&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en,0,0,Tn.width,Tn.height,zt,Mt,Tn.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en,Kt,Tn.width,Tn.height,0,zt,Mt,Tn.data)}}}else{if(pt=V.mipmaps,ve&&ze){pt.length>0&&wt++;const lt=Ht(st[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,wt,Kt,lt.width,lt.height)}for(let lt=0;lt<6;lt++)if(et){ve?Et&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,st[lt].width,st[lt].height,zt,Mt,st[lt].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,Kt,st[lt].width,st[lt].height,0,zt,Mt,st[lt].data);for(let en=0;en<pt.length;en++){const gi=pt[en].image[lt].image;ve?Et&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en+1,0,0,gi.width,gi.height,zt,Mt,gi.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en+1,Kt,gi.width,gi.height,0,zt,Mt,gi.data)}}else{ve?Et&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,zt,Mt,st[lt]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,Kt,zt,Mt,st[lt]);for(let en=0;en<pt.length;en++){const Tn=pt[en];ve?Et&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en+1,0,0,zt,Mt,Tn.image[lt]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+lt,en+1,Kt,zt,Mt,Tn.image[lt])}}}A(V)&&S(i.TEXTURE_CUBE_MAP),Ve.__version=$e.version,V.onUpdate&&V.onUpdate(V)}q.__version=V.version}function ct(q,V,Te,Ge,$e,Ve){const Xt=r.convert(Te.format,Te.colorSpace),Ot=r.convert(Te.type),cn=w(Te.internalFormat,Xt,Ot,Te.colorSpace),Qt=n.get(V),et=n.get(Te);if(et.__renderTarget=V,!Qt.__hasExternalTextures){const st=Math.max(1,V.width>>Ve),nn=Math.max(1,V.height>>Ve);$e===i.TEXTURE_3D||$e===i.TEXTURE_2D_ARRAY?t.texImage3D($e,Ve,cn,st,nn,V.depth,0,Xt,Ot,null):t.texImage2D($e,Ve,cn,st,nn,0,Xt,Ot,null)}t.bindFramebuffer(i.FRAMEBUFFER,q),ht(V)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ge,$e,et.__webglTexture,0,Tt(V)):($e===i.TEXTURE_2D||$e>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ge,$e,et.__webglTexture,Ve),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Dt(q,V,Te){if(i.bindRenderbuffer(i.RENDERBUFFER,q),V.depthBuffer){const Ge=V.depthTexture,$e=Ge&&Ge.isDepthTexture?Ge.type:null,Ve=B(V.stencilBuffer,$e),Xt=V.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ot=Tt(V);ht(V)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ot,Ve,V.width,V.height):Te?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ot,Ve,V.width,V.height):i.renderbufferStorage(i.RENDERBUFFER,Ve,V.width,V.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Xt,i.RENDERBUFFER,q)}else{const Ge=V.textures;for(let $e=0;$e<Ge.length;$e++){const Ve=Ge[$e],Xt=r.convert(Ve.format,Ve.colorSpace),Ot=r.convert(Ve.type),cn=w(Ve.internalFormat,Xt,Ot,Ve.colorSpace),Qt=Tt(V);Te&&ht(V)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Qt,cn,V.width,V.height):ht(V)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Qt,cn,V.width,V.height):i.renderbufferStorage(i.RENDERBUFFER,cn,V.width,V.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function Nt(q,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,q),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ge=n.get(V.depthTexture);Ge.__renderTarget=V,(!Ge.__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),re(V.depthTexture,0);const $e=Ge.__webglTexture,Ve=Tt(V);if(V.depthTexture.format===Ro)ht(V)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$e,0,Ve):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$e,0);else if(V.depthTexture.format===wo)ht(V)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$e,0,Ve):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$e,0);else throw new Error("Unknown depthTexture format")}function It(q){const V=n.get(q),Te=q.isWebGLCubeRenderTarget===!0;if(V.__boundDepthTexture!==q.depthTexture){const Ge=q.depthTexture;if(V.__depthDisposeCallback&&V.__depthDisposeCallback(),Ge){const $e=()=>{delete V.__boundDepthTexture,delete V.__depthDisposeCallback,Ge.removeEventListener("dispose",$e)};Ge.addEventListener("dispose",$e),V.__depthDisposeCallback=$e}V.__boundDepthTexture=Ge}if(q.depthTexture&&!V.__autoAllocateDepthBuffer){if(Te)throw new Error("target.depthTexture not supported in Cube render targets");const Ge=q.texture.mipmaps;Ge&&Ge.length>0?Nt(V.__webglFramebuffer[0],q):Nt(V.__webglFramebuffer,q)}else if(Te){V.__webglDepthbuffer=[];for(let Ge=0;Ge<6;Ge++)if(t.bindFramebuffer(i.FRAMEBUFFER,V.__webglFramebuffer[Ge]),V.__webglDepthbuffer[Ge]===void 0)V.__webglDepthbuffer[Ge]=i.createRenderbuffer(),Dt(V.__webglDepthbuffer[Ge],q,!1);else{const $e=q.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ve=V.__webglDepthbuffer[Ge];i.bindRenderbuffer(i.RENDERBUFFER,Ve),i.framebufferRenderbuffer(i.FRAMEBUFFER,$e,i.RENDERBUFFER,Ve)}}else{const Ge=q.texture.mipmaps;if(Ge&&Ge.length>0?t.bindFramebuffer(i.FRAMEBUFFER,V.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,V.__webglFramebuffer),V.__webglDepthbuffer===void 0)V.__webglDepthbuffer=i.createRenderbuffer(),Dt(V.__webglDepthbuffer,q,!1);else{const $e=q.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ve=V.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,Ve),i.framebufferRenderbuffer(i.FRAMEBUFFER,$e,i.RENDERBUFFER,Ve)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function Mn(q,V,Te){const Ge=n.get(q);V!==void 0&&ct(Ge.__webglFramebuffer,q,q.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),Te!==void 0&&It(q)}function Gt(q){const V=q.texture,Te=n.get(q),Ge=n.get(V);q.addEventListener("dispose",O);const $e=q.textures,Ve=q.isWebGLCubeRenderTarget===!0,Xt=$e.length>1;if(Xt||(Ge.__webglTexture===void 0&&(Ge.__webglTexture=i.createTexture()),Ge.__version=V.version,a.memory.textures++),Ve){Te.__webglFramebuffer=[];for(let Ot=0;Ot<6;Ot++)if(V.mipmaps&&V.mipmaps.length>0){Te.__webglFramebuffer[Ot]=[];for(let cn=0;cn<V.mipmaps.length;cn++)Te.__webglFramebuffer[Ot][cn]=i.createFramebuffer()}else Te.__webglFramebuffer[Ot]=i.createFramebuffer()}else{if(V.mipmaps&&V.mipmaps.length>0){Te.__webglFramebuffer=[];for(let Ot=0;Ot<V.mipmaps.length;Ot++)Te.__webglFramebuffer[Ot]=i.createFramebuffer()}else Te.__webglFramebuffer=i.createFramebuffer();if(Xt)for(let Ot=0,cn=$e.length;Ot<cn;Ot++){const Qt=n.get($e[Ot]);Qt.__webglTexture===void 0&&(Qt.__webglTexture=i.createTexture(),a.memory.textures++)}if(q.samples>0&&ht(q)===!1){Te.__webglMultisampledFramebuffer=i.createFramebuffer(),Te.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,Te.__webglMultisampledFramebuffer);for(let Ot=0;Ot<$e.length;Ot++){const cn=$e[Ot];Te.__webglColorRenderbuffer[Ot]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,Te.__webglColorRenderbuffer[Ot]);const Qt=r.convert(cn.format,cn.colorSpace),et=r.convert(cn.type),st=w(cn.internalFormat,Qt,et,cn.colorSpace,q.isXRRenderTarget===!0),nn=Tt(q);i.renderbufferStorageMultisample(i.RENDERBUFFER,nn,st,q.width,q.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ot,i.RENDERBUFFER,Te.__webglColorRenderbuffer[Ot])}i.bindRenderbuffer(i.RENDERBUFFER,null),q.depthBuffer&&(Te.__webglDepthRenderbuffer=i.createRenderbuffer(),Dt(Te.__webglDepthRenderbuffer,q,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Ve){t.bindTexture(i.TEXTURE_CUBE_MAP,Ge.__webglTexture),pe(i.TEXTURE_CUBE_MAP,V);for(let Ot=0;Ot<6;Ot++)if(V.mipmaps&&V.mipmaps.length>0)for(let cn=0;cn<V.mipmaps.length;cn++)ct(Te.__webglFramebuffer[Ot][cn],q,V,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ot,cn);else ct(Te.__webglFramebuffer[Ot],q,V,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ot,0);A(V)&&S(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Xt){for(let Ot=0,cn=$e.length;Ot<cn;Ot++){const Qt=$e[Ot],et=n.get(Qt);let st=i.TEXTURE_2D;(q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(st=q.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(st,et.__webglTexture),pe(st,Qt),ct(Te.__webglFramebuffer,q,Qt,i.COLOR_ATTACHMENT0+Ot,st,0),A(Qt)&&S(st)}t.unbindTexture()}else{let Ot=i.TEXTURE_2D;if((q.isWebGL3DRenderTarget||q.isWebGLArrayRenderTarget)&&(Ot=q.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Ot,Ge.__webglTexture),pe(Ot,V),V.mipmaps&&V.mipmaps.length>0)for(let cn=0;cn<V.mipmaps.length;cn++)ct(Te.__webglFramebuffer[cn],q,V,i.COLOR_ATTACHMENT0,Ot,cn);else ct(Te.__webglFramebuffer,q,V,i.COLOR_ATTACHMENT0,Ot,0);A(V)&&S(Ot),t.unbindTexture()}q.depthBuffer&&It(q)}function Qe(q){const V=q.textures;for(let Te=0,Ge=V.length;Te<Ge;Te++){const $e=V[Te];if(A($e)){const Ve=C(q),Xt=n.get($e).__webglTexture;t.bindTexture(Ve,Xt),S(Ve),t.unbindTexture()}}}const ie=[],ot=[];function dt(q){if(q.samples>0){if(ht(q)===!1){const V=q.textures,Te=q.width,Ge=q.height;let $e=i.COLOR_BUFFER_BIT;const Ve=q.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Xt=n.get(q),Ot=V.length>1;if(Ot)for(let Qt=0;Qt<V.length;Qt++)t.bindFramebuffer(i.FRAMEBUFFER,Xt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Xt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Xt.__webglMultisampledFramebuffer);const cn=q.texture.mipmaps;cn&&cn.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Xt.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Xt.__webglFramebuffer);for(let Qt=0;Qt<V.length;Qt++){if(q.resolveDepthBuffer&&(q.depthBuffer&&($e|=i.DEPTH_BUFFER_BIT),q.stencilBuffer&&q.resolveStencilBuffer&&($e|=i.STENCIL_BUFFER_BIT)),Ot){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Xt.__webglColorRenderbuffer[Qt]);const et=n.get(V[Qt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,et,0)}i.blitFramebuffer(0,0,Te,Ge,0,0,Te,Ge,$e,i.NEAREST),l===!0&&(ie.length=0,ot.length=0,ie.push(i.COLOR_ATTACHMENT0+Qt),q.depthBuffer&&q.resolveDepthBuffer===!1&&(ie.push(Ve),ot.push(Ve),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,ot)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,ie))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Ot)for(let Qt=0;Qt<V.length;Qt++){t.bindFramebuffer(i.FRAMEBUFFER,Xt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.RENDERBUFFER,Xt.__webglColorRenderbuffer[Qt]);const et=n.get(V[Qt]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Xt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.TEXTURE_2D,et,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Xt.__webglMultisampledFramebuffer)}else if(q.depthBuffer&&q.resolveDepthBuffer===!1&&l){const V=q.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[V])}}}function Tt(q){return Math.min(s.maxSamples,q.samples)}function ht(q){const V=n.get(q);return q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function Ut(q){const V=a.render.frame;f.get(q)!==V&&(f.set(q,V),q.update())}function At(q,V){const Te=q.colorSpace,Ge=q.format,$e=q.type;return q.isCompressedTexture===!0||q.isVideoTexture===!0||Te!==Qo&&Te!==Ga&&(yn.getTransfer(Te)===qt?(Ge!==Oi||$e!==ss)&&De("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):nt("WebGLTextures: Unsupported texture color space:",Te)),V}function Ht(q){return typeof HTMLImageElement<"u"&&q instanceof HTMLImageElement?(u.width=q.naturalWidth||q.width,u.height=q.naturalHeight||q.height):typeof VideoFrame<"u"&&q instanceof VideoFrame?(u.width=q.displayWidth,u.height=q.displayHeight):(u.width=q.width,u.height=q.height),u}this.allocateTextureUnit=ee,this.resetTextureUnits=Z,this.setTexture2D=re,this.setTexture2DArray=W,this.setTexture3D=ne,this.setTextureCube=se,this.rebindTextures=Mn,this.setupRenderTarget=Gt,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=dt,this.setupDepthRenderbuffer=It,this.setupFrameBufferTexture=ct,this.useMultisampledRTT=ht}function Jk(i,e){function t(n,s=Ga){let r;const a=yn.getTransfer(s);if(n===ss)return i.UNSIGNED_BYTE;if(n===tv)return i.UNSIGNED_SHORT_4_4_4_4;if(n===nv)return i.UNSIGNED_SHORT_5_5_5_1;if(n===iv)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===sv)return i.UNSIGNED_INT_10F_11F_11F_REV;if(n===dd)return i.BYTE;if(n===fd)return i.SHORT;if(n===Tl)return i.UNSIGNED_SHORT;if(n===fr)return i.INT;if(n===Xi)return i.UNSIGNED_INT;if(n===Ti)return i.FLOAT;if(n===Ai)return i.HALF_FLOAT;if(n===rT)return i.ALPHA;if(n===m0)return i.RGB;if(n===Oi)return i.RGBA;if(n===Ro)return i.DEPTH_COMPONENT;if(n===wo)return i.DEPTH_STENCIL;if(n===Kf)return i.RED;if(n===Jf)return i.RED_INTEGER;if(n===Al)return i.RG;if(n===Kp)return i.RG_INTEGER;if(n===Jp)return i.RGBA_INTEGER;if(n===hd||n===pd||n===md||n===gd)if(a===qt)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===hd)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===pd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===md)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===gd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===hd)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===pd)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===md)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===gd)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Kg||n===Jg||n===Zg||n===Qg)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===Kg)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Jg)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Zg)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Qg)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===yp||n===vp||n===_p)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===yp||n===vp)return a===qt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===_p)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===bp||n===Sp||n===Tp||n===Ap||n===Ep||n===Mp||n===Cp||n===Rp||n===wp||n===Np||n===Bp||n===Dp||n===Op||n===Up)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===bp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Sp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Tp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ap)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ep)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Mp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Cp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Rp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===wp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Np)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Bp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Dp)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Op)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Up)return a===qt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Lp||n===bS||n===SS)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===Lp)return a===qt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===bS)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===SS)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Ip||n===Pp||n===Fp||n===Gp)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===Ip)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Pp)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Fp)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Gp)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Co?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const uce=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,dce=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class fce{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new CC(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Xa({vertexShader:uce,fragmentShader:dce,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ui(new Bd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class hce extends Oo{constructor(e,t){super();const n=this;let s=null,r=1,a=null,o="local-floor",l=1,u=null,f=null,p=null,x=null,y=null,_=null;const T=typeof XRWebGLBinding<"u",A=new fce,S={},C=t.getContextAttributes();let w=null,B=null;const L=[],D=[],O=new Ze;let F=null;const U=new bs;U.viewport=new mn;const P=new bs;P.viewport=new mn;const X=[U,P],Z=new $C;let ee=null,te=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Se){let Be=L[Se];return Be===void 0&&(Be=new Ry,L[Se]=Be),Be.getTargetRaySpace()},this.getControllerGrip=function(Se){let Be=L[Se];return Be===void 0&&(Be=new Ry,L[Se]=Be),Be.getGripSpace()},this.getHand=function(Se){let Be=L[Se];return Be===void 0&&(Be=new Ry,L[Se]=Be),Be.getHandSpace()};function re(Se){const Be=D.indexOf(Se.inputSource);if(Be===-1)return;const ct=L[Be];ct!==void 0&&(ct.update(Se.inputSource,Se.frame,u||a),ct.dispatchEvent({type:Se.type,data:Se.inputSource}))}function W(){s.removeEventListener("select",re),s.removeEventListener("selectstart",re),s.removeEventListener("selectend",re),s.removeEventListener("squeeze",re),s.removeEventListener("squeezestart",re),s.removeEventListener("squeezeend",re),s.removeEventListener("end",W),s.removeEventListener("inputsourceschange",ne);for(let Se=0;Se<L.length;Se++){const Be=D[Se];Be!==null&&(D[Se]=null,L[Se].disconnect(Be))}ee=null,te=null,A.reset();for(const Se in S)delete S[Se];e.setRenderTarget(w),y=null,x=null,p=null,s=null,B=null,gt.stop(),n.isPresenting=!1,e.setPixelRatio(F),e.setSize(O.width,O.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Se){r=Se,n.isPresenting===!0&&De("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Se){o=Se,n.isPresenting===!0&&De("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(Se){u=Se},this.getBaseLayer=function(){return x!==null?x:y},this.getBinding=function(){return p===null&&T&&(p=new XRWebGLBinding(s,t)),p},this.getFrame=function(){return _},this.getSession=function(){return s},this.setSession=async function(Se){if(s=Se,s!==null){if(w=e.getRenderTarget(),s.addEventListener("select",re),s.addEventListener("selectstart",re),s.addEventListener("selectend",re),s.addEventListener("squeeze",re),s.addEventListener("squeezestart",re),s.addEventListener("squeezeend",re),s.addEventListener("end",W),s.addEventListener("inputsourceschange",ne),C.xrCompatible!==!0&&await t.makeXRCompatible(),F=e.getPixelRatio(),e.getSize(O),T&&"createProjectionLayer"in XRWebGLBinding.prototype){let ct=null,Dt=null,Nt=null;C.depth&&(Nt=C.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ct=C.stencil?wo:Ro,Dt=C.stencil?Co:Xi);const It={colorFormat:t.RGBA8,depthFormat:Nt,scaleFactor:r};p=this.getBinding(),x=p.createProjectionLayer(It),s.updateRenderState({layers:[x]}),e.setPixelRatio(1),e.setSize(x.textureWidth,x.textureHeight,!1),B=new Bl(x.textureWidth,x.textureHeight,{format:Oi,type:ss,depthTexture:new Bo(x.textureWidth,x.textureHeight,Dt,void 0,void 0,void 0,void 0,void 0,void 0,ct),stencilBuffer:C.stencil,colorSpace:e.outputColorSpace,samples:C.antialias?4:0,resolveDepthBuffer:x.ignoreDepthValues===!1,resolveStencilBuffer:x.ignoreDepthValues===!1})}else{const ct={antialias:C.antialias,alpha:!0,depth:C.depth,stencil:C.stencil,framebufferScaleFactor:r};y=new XRWebGLLayer(s,t,ct),s.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),B=new Bl(y.framebufferWidth,y.framebufferHeight,{format:Oi,type:ss,colorSpace:e.outputColorSpace,stencilBuffer:C.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}B.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await s.requestReferenceSpace(o),gt.setContext(s),gt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return A.getDepthTexture()};function ne(Se){for(let Be=0;Be<Se.removed.length;Be++){const ct=Se.removed[Be],Dt=D.indexOf(ct);Dt>=0&&(D[Dt]=null,L[Dt].disconnect(ct))}for(let Be=0;Be<Se.added.length;Be++){const ct=Se.added[Be];let Dt=D.indexOf(ct);if(Dt===-1){for(let It=0;It<L.length;It++)if(It>=D.length){D.push(ct),Dt=It;break}else if(D[It]===null){D[It]=ct,Dt=It;break}if(Dt===-1)break}const Nt=L[Dt];Nt&&Nt.connect(ct)}}const se=new Q,ge=new Q;function _e(Se,Be,ct){se.setFromMatrixPosition(Be.matrixWorld),ge.setFromMatrixPosition(ct.matrixWorld);const Dt=se.distanceTo(ge),Nt=Be.projectionMatrix.elements,It=ct.projectionMatrix.elements,Mn=Nt[14]/(Nt[10]-1),Gt=Nt[14]/(Nt[10]+1),Qe=(Nt[9]+1)/Nt[5],ie=(Nt[9]-1)/Nt[5],ot=(Nt[8]-1)/Nt[0],dt=(It[8]+1)/It[0],Tt=Mn*ot,ht=Mn*dt,Ut=Dt/(-ot+dt),At=Ut*-ot;if(Be.matrixWorld.decompose(Se.position,Se.quaternion,Se.scale),Se.translateX(At),Se.translateZ(Ut),Se.matrixWorld.compose(Se.position,Se.quaternion,Se.scale),Se.matrixWorldInverse.copy(Se.matrixWorld).invert(),Nt[10]===-1)Se.projectionMatrix.copy(Be.projectionMatrix),Se.projectionMatrixInverse.copy(Be.projectionMatrixInverse);else{const Ht=Mn+Ut,q=Gt+Ut,V=Tt-At,Te=ht+(Dt-At),Ge=Qe*Gt/q*Ht,$e=ie*Gt/q*Ht;Se.projectionMatrix.makePerspective(V,Te,Ge,$e,Ht,q),Se.projectionMatrixInverse.copy(Se.projectionMatrix).invert()}}function K(Se,Be){Be===null?Se.matrixWorld.copy(Se.matrix):Se.matrixWorld.multiplyMatrices(Be.matrixWorld,Se.matrix),Se.matrixWorldInverse.copy(Se.matrixWorld).invert()}this.updateCamera=function(Se){if(s===null)return;let Be=Se.near,ct=Se.far;A.texture!==null&&(A.depthNear>0&&(Be=A.depthNear),A.depthFar>0&&(ct=A.depthFar)),Z.near=P.near=U.near=Be,Z.far=P.far=U.far=ct,(ee!==Z.near||te!==Z.far)&&(s.updateRenderState({depthNear:Z.near,depthFar:Z.far}),ee=Z.near,te=Z.far),Z.layers.mask=Se.layers.mask|6,U.layers.mask=Z.layers.mask&3,P.layers.mask=Z.layers.mask&5;const Dt=Se.parent,Nt=Z.cameras;K(Z,Dt);for(let It=0;It<Nt.length;It++)K(Nt[It],Dt);Nt.length===2?_e(Z,U,P):Z.projectionMatrix.copy(U.projectionMatrix),pe(Se,Z,Dt)};function pe(Se,Be,ct){ct===null?Se.matrix.copy(Be.matrixWorld):(Se.matrix.copy(ct.matrixWorld),Se.matrix.invert(),Se.matrix.multiply(Be.matrixWorld)),Se.matrix.decompose(Se.position,Se.quaternion,Se.scale),Se.updateMatrixWorld(!0),Se.projectionMatrix.copy(Be.projectionMatrix),Se.projectionMatrixInverse.copy(Be.projectionMatrixInverse),Se.isPerspectiveCamera&&(Se.fov=s0*2*Math.atan(1/Se.projectionMatrix.elements[5]),Se.zoom=1)}this.getCamera=function(){return Z},this.getFoveation=function(){if(!(x===null&&y===null))return l},this.setFoveation=function(Se){l=Se,x!==null&&(x.fixedFoveation=Se),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=Se)},this.hasDepthSensing=function(){return A.texture!==null},this.getDepthSensingMesh=function(){return A.getMesh(Z)},this.getCameraTexture=function(Se){return S[Se]};let we=null;function Ne(Se,Be){if(f=Be.getViewerPose(u||a),_=Be,f!==null){const ct=f.views;y!==null&&(e.setRenderTargetFramebuffer(B,y.framebuffer),e.setRenderTarget(B));let Dt=!1;ct.length!==Z.cameras.length&&(Z.cameras.length=0,Dt=!0);for(let Gt=0;Gt<ct.length;Gt++){const Qe=ct[Gt];let ie=null;if(y!==null)ie=y.getViewport(Qe);else{const dt=p.getViewSubImage(x,Qe);ie=dt.viewport,Gt===0&&(e.setRenderTargetTextures(B,dt.colorTexture,dt.depthStencilTexture),e.setRenderTarget(B))}let ot=X[Gt];ot===void 0&&(ot=new bs,ot.layers.enable(Gt),ot.viewport=new mn,X[Gt]=ot),ot.matrix.fromArray(Qe.transform.matrix),ot.matrix.decompose(ot.position,ot.quaternion,ot.scale),ot.projectionMatrix.fromArray(Qe.projectionMatrix),ot.projectionMatrixInverse.copy(ot.projectionMatrix).invert(),ot.viewport.set(ie.x,ie.y,ie.width,ie.height),Gt===0&&(Z.matrix.copy(ot.matrix),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale)),Dt===!0&&Z.cameras.push(ot)}const Nt=s.enabledFeatures;if(Nt&&Nt.includes("depth-sensing")&&s.depthUsage=="gpu-optimized"&&T){p=n.getBinding();const Gt=p.getDepthInformation(ct[0]);Gt&&Gt.isValid&&Gt.texture&&A.init(Gt,s.renderState)}if(Nt&&Nt.includes("camera-access")&&T){e.state.unbindTexture(),p=n.getBinding();for(let Gt=0;Gt<ct.length;Gt++){const Qe=ct[Gt].camera;if(Qe){let ie=S[Qe];ie||(ie=new CC,S[Qe]=ie);const ot=p.getCameraImage(Qe);ie.sourceTexture=ot}}}}for(let ct=0;ct<L.length;ct++){const Dt=D[ct],Nt=L[ct];Dt!==null&&Nt!==void 0&&Nt.update(Dt,Be,u||a)}we&&we(Se,Be),Be.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Be}),_=null}const gt=new qk;gt.setAnimationLoop(Ne),this.setAnimationLoop=function(Se){we=Se},this.dispose=function(){}}}const yg=new Wa,pce=new Yt;function mce(i,e){function t(A,S){A.matrixAutoUpdate===!0&&A.updateMatrix(),S.value.copy(A.matrix)}function n(A,S){S.color.getRGB(A.fogColor.value,Qz(i)),S.isFog?(A.fogNear.value=S.near,A.fogFar.value=S.far):S.isFogExp2&&(A.fogDensity.value=S.density)}function s(A,S,C,w,B){S.isMeshBasicMaterial||S.isMeshLambertMaterial?r(A,S):S.isMeshToonMaterial?(r(A,S),p(A,S)):S.isMeshPhongMaterial?(r(A,S),f(A,S)):S.isMeshStandardMaterial?(r(A,S),x(A,S),S.isMeshPhysicalMaterial&&y(A,S,B)):S.isMeshMatcapMaterial?(r(A,S),_(A,S)):S.isMeshDepthMaterial?r(A,S):S.isMeshDistanceMaterial?(r(A,S),T(A,S)):S.isMeshNormalMaterial?r(A,S):S.isLineBasicMaterial?(a(A,S),S.isLineDashedMaterial&&o(A,S)):S.isPointsMaterial?l(A,S,C,w):S.isSpriteMaterial?u(A,S):S.isShadowMaterial?(A.color.value.copy(S.color),A.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function r(A,S){A.opacity.value=S.opacity,S.color&&A.diffuse.value.copy(S.color),S.emissive&&A.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(A.map.value=S.map,t(S.map,A.mapTransform)),S.alphaMap&&(A.alphaMap.value=S.alphaMap,t(S.alphaMap,A.alphaMapTransform)),S.bumpMap&&(A.bumpMap.value=S.bumpMap,t(S.bumpMap,A.bumpMapTransform),A.bumpScale.value=S.bumpScale,S.side===Yi&&(A.bumpScale.value*=-1)),S.normalMap&&(A.normalMap.value=S.normalMap,t(S.normalMap,A.normalMapTransform),A.normalScale.value.copy(S.normalScale),S.side===Yi&&A.normalScale.value.negate()),S.displacementMap&&(A.displacementMap.value=S.displacementMap,t(S.displacementMap,A.displacementMapTransform),A.displacementScale.value=S.displacementScale,A.displacementBias.value=S.displacementBias),S.emissiveMap&&(A.emissiveMap.value=S.emissiveMap,t(S.emissiveMap,A.emissiveMapTransform)),S.specularMap&&(A.specularMap.value=S.specularMap,t(S.specularMap,A.specularMapTransform)),S.alphaTest>0&&(A.alphaTest.value=S.alphaTest);const C=e.get(S),w=C.envMap,B=C.envMapRotation;w&&(A.envMap.value=w,yg.copy(B),yg.x*=-1,yg.y*=-1,yg.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(yg.y*=-1,yg.z*=-1),A.envMapRotation.value.setFromMatrix4(pce.makeRotationFromEuler(yg)),A.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,A.reflectivity.value=S.reflectivity,A.ior.value=S.ior,A.refractionRatio.value=S.refractionRatio),S.lightMap&&(A.lightMap.value=S.lightMap,A.lightMapIntensity.value=S.lightMapIntensity,t(S.lightMap,A.lightMapTransform)),S.aoMap&&(A.aoMap.value=S.aoMap,A.aoMapIntensity.value=S.aoMapIntensity,t(S.aoMap,A.aoMapTransform))}function a(A,S){A.diffuse.value.copy(S.color),A.opacity.value=S.opacity,S.map&&(A.map.value=S.map,t(S.map,A.mapTransform))}function o(A,S){A.dashSize.value=S.dashSize,A.totalSize.value=S.dashSize+S.gapSize,A.scale.value=S.scale}function l(A,S,C,w){A.diffuse.value.copy(S.color),A.opacity.value=S.opacity,A.size.value=S.size*C,A.scale.value=w*.5,S.map&&(A.map.value=S.map,t(S.map,A.uvTransform)),S.alphaMap&&(A.alphaMap.value=S.alphaMap,t(S.alphaMap,A.alphaMapTransform)),S.alphaTest>0&&(A.alphaTest.value=S.alphaTest)}function u(A,S){A.diffuse.value.copy(S.color),A.opacity.value=S.opacity,A.rotation.value=S.rotation,S.map&&(A.map.value=S.map,t(S.map,A.mapTransform)),S.alphaMap&&(A.alphaMap.value=S.alphaMap,t(S.alphaMap,A.alphaMapTransform)),S.alphaTest>0&&(A.alphaTest.value=S.alphaTest)}function f(A,S){A.specular.value.copy(S.specular),A.shininess.value=Math.max(S.shininess,1e-4)}function p(A,S){S.gradientMap&&(A.gradientMap.value=S.gradientMap)}function x(A,S){A.metalness.value=S.metalness,S.metalnessMap&&(A.metalnessMap.value=S.metalnessMap,t(S.metalnessMap,A.metalnessMapTransform)),A.roughness.value=S.roughness,S.roughnessMap&&(A.roughnessMap.value=S.roughnessMap,t(S.roughnessMap,A.roughnessMapTransform)),S.envMap&&(A.envMapIntensity.value=S.envMapIntensity)}function y(A,S,C){A.ior.value=S.ior,S.sheen>0&&(A.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),A.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(A.sheenColorMap.value=S.sheenColorMap,t(S.sheenColorMap,A.sheenColorMapTransform)),S.sheenRoughnessMap&&(A.sheenRoughnessMap.value=S.sheenRoughnessMap,t(S.sheenRoughnessMap,A.sheenRoughnessMapTransform))),S.clearcoat>0&&(A.clearcoat.value=S.clearcoat,A.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(A.clearcoatMap.value=S.clearcoatMap,t(S.clearcoatMap,A.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(A.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,t(S.clearcoatRoughnessMap,A.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(A.clearcoatNormalMap.value=S.clearcoatNormalMap,t(S.clearcoatNormalMap,A.clearcoatNormalMapTransform),A.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),S.side===Yi&&A.clearcoatNormalScale.value.negate())),S.dispersion>0&&(A.dispersion.value=S.dispersion),S.iridescence>0&&(A.iridescence.value=S.iridescence,A.iridescenceIOR.value=S.iridescenceIOR,A.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],A.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(A.iridescenceMap.value=S.iridescenceMap,t(S.iridescenceMap,A.iridescenceMapTransform)),S.iridescenceThicknessMap&&(A.iridescenceThicknessMap.value=S.iridescenceThicknessMap,t(S.iridescenceThicknessMap,A.iridescenceThicknessMapTransform))),S.transmission>0&&(A.transmission.value=S.transmission,A.transmissionSamplerMap.value=C.texture,A.transmissionSamplerSize.value.set(C.width,C.height),S.transmissionMap&&(A.transmissionMap.value=S.transmissionMap,t(S.transmissionMap,A.transmissionMapTransform)),A.thickness.value=S.thickness,S.thicknessMap&&(A.thicknessMap.value=S.thicknessMap,t(S.thicknessMap,A.thicknessMapTransform)),A.attenuationDistance.value=S.attenuationDistance,A.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(A.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(A.anisotropyMap.value=S.anisotropyMap,t(S.anisotropyMap,A.anisotropyMapTransform))),A.specularIntensity.value=S.specularIntensity,A.specularColor.value.copy(S.specularColor),S.specularColorMap&&(A.specularColorMap.value=S.specularColorMap,t(S.specularColorMap,A.specularColorMapTransform)),S.specularIntensityMap&&(A.specularIntensityMap.value=S.specularIntensityMap,t(S.specularIntensityMap,A.specularIntensityMapTransform))}function _(A,S){S.matcap&&(A.matcap.value=S.matcap)}function T(A,S){const C=e.get(S).light;A.referencePosition.value.setFromMatrixPosition(C.matrixWorld),A.nearDistance.value=C.shadow.camera.near,A.farDistance.value=C.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function gce(i,e,t,n){let s={},r={},a=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(C,w){const B=w.program;n.uniformBlockBinding(C,B)}function u(C,w){let B=s[C.id];B===void 0&&(_(C),B=f(C),s[C.id]=B,C.addEventListener("dispose",A));const L=w.program;n.updateUBOMapping(C,L);const D=e.render.frame;r[C.id]!==D&&(x(C),r[C.id]=D)}function f(C){const w=p();C.__bindingPointIndex=w;const B=i.createBuffer(),L=C.__size,D=C.usage;return i.bindBuffer(i.UNIFORM_BUFFER,B),i.bufferData(i.UNIFORM_BUFFER,L,D),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,w,B),B}function p(){for(let C=0;C<o;C++)if(a.indexOf(C)===-1)return a.push(C),C;return nt("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function x(C){const w=s[C.id],B=C.uniforms,L=C.__cache;i.bindBuffer(i.UNIFORM_BUFFER,w);for(let D=0,O=B.length;D<O;D++){const F=Array.isArray(B[D])?B[D]:[B[D]];for(let U=0,P=F.length;U<P;U++){const X=F[U];if(y(X,D,U,L)===!0){const Z=X.__offset,ee=Array.isArray(X.value)?X.value:[X.value];let te=0;for(let re=0;re<ee.length;re++){const W=ee[re],ne=T(W);typeof W=="number"||typeof W=="boolean"?(X.__data[0]=W,i.bufferSubData(i.UNIFORM_BUFFER,Z+te,X.__data)):W.isMatrix3?(X.__data[0]=W.elements[0],X.__data[1]=W.elements[1],X.__data[2]=W.elements[2],X.__data[3]=0,X.__data[4]=W.elements[3],X.__data[5]=W.elements[4],X.__data[6]=W.elements[5],X.__data[7]=0,X.__data[8]=W.elements[6],X.__data[9]=W.elements[7],X.__data[10]=W.elements[8],X.__data[11]=0):(W.toArray(X.__data,te),te+=ne.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,Z,X.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function y(C,w,B,L){const D=C.value,O=w+"_"+B;if(L[O]===void 0)return typeof D=="number"||typeof D=="boolean"?L[O]=D:L[O]=D.clone(),!0;{const F=L[O];if(typeof D=="number"||typeof D=="boolean"){if(F!==D)return L[O]=D,!0}else if(F.equals(D)===!1)return F.copy(D),!0}return!1}function _(C){const w=C.uniforms;let B=0;const L=16;for(let O=0,F=w.length;O<F;O++){const U=Array.isArray(w[O])?w[O]:[w[O]];for(let P=0,X=U.length;P<X;P++){const Z=U[P],ee=Array.isArray(Z.value)?Z.value:[Z.value];for(let te=0,re=ee.length;te<re;te++){const W=ee[te],ne=T(W),se=B%L,ge=se%ne.boundary,_e=se+ge;B+=ge,_e!==0&&L-_e<ne.storage&&(B+=L-_e),Z.__data=new Float32Array(ne.storage/Float32Array.BYTES_PER_ELEMENT),Z.__offset=B,B+=ne.storage}}}const D=B%L;return D>0&&(B+=L-D),C.__size=B,C.__cache={},this}function T(C){const w={boundary:0,storage:0};return typeof C=="number"||typeof C=="boolean"?(w.boundary=4,w.storage=4):C.isVector2?(w.boundary=8,w.storage=8):C.isVector3||C.isColor?(w.boundary=16,w.storage=12):C.isVector4?(w.boundary=16,w.storage=16):C.isMatrix3?(w.boundary=48,w.storage=48):C.isMatrix4?(w.boundary=64,w.storage=64):C.isTexture?De("WebGLRenderer: Texture samplers can not be part of an uniforms group."):De("WebGLRenderer: Unsupported uniform value type.",C),w}function A(C){const w=C.target;w.removeEventListener("dispose",A);const B=a.indexOf(w.__bindingPointIndex);a.splice(B,1),i.deleteBuffer(s[w.id]),delete s[w.id],delete r[w.id]}function S(){for(const C in s)i.deleteBuffer(s[C]);a=[],s={},r={}}return{bind:l,update:u,dispose:S}}const xce=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let _f=null;function yce(){return _f===null&&(_f=new No(xce,32,32,Al,Ai),_f.minFilter=Dn,_f.magFilter=Dn,_f.wrapS=ts,_f.wrapT=ts,_f.generateMipmaps=!1,_f.needsUpdate=!0),_f}class SU{constructor(e={}){const{canvas:t=_C(),context:n=null,depth:s=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:p=!1,reversedDepthBuffer:x=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=a;const _=new Set([Jp,Kp,Jf]),T=new Set([ss,Xi,Tl,Co,tv,nv]),A=new Uint32Array(4),S=new Int32Array(4);let C=null,w=null;const B=[],L=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=zr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const D=this;let O=!1;this._outputColorSpace=Mr;let F=0,U=0,P=null,X=-1,Z=null;const ee=new mn,te=new mn;let re=null;const W=new Bt(0);let ne=0,se=t.width,ge=t.height,_e=1,K=null,pe=null;const we=new mn(0,0,se,ge),Ne=new mn(0,0,se,ge);let gt=!1;const Se=new Zp;let Be=!1,ct=!1;const Dt=new Yt,Nt=new Q,It=new mn,Mn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Gt=!1;function Qe(){return P===null?_e:1}let ie=n;function ot(k,ae){return t.getContext(k,ae)}try{const k={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:f,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${$f}`),t.addEventListener("webglcontextlost",pt,!1),t.addEventListener("webglcontextrestored",lt,!1),t.addEventListener("webglcontextcreationerror",en,!1),ie===null){const ae="webgl2";if(ie=ot(ae,k),ie===null)throw ot(ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(k){throw k("WebGLRenderer: "+k.message),k}let dt,Tt,ht,Ut,At,Ht,q,V,Te,Ge,$e,Ve,Xt,Ot,cn,Qt,et,st,nn,zt,Mt,Kt,ve,ze;function Et(){dt=new Roe(ie),dt.init(),Kt=new Jk(ie,dt),Tt=new voe(ie,dt,e,Kt),ht=new lce(ie,dt),Tt.reversedDepthBuffer&&x&&ht.buffers.depth.setReversed(!0),Ut=new Boe(ie),At=new $le,Ht=new cce(ie,dt,ht,At,Tt,Kt,Ut),q=new boe(D),V=new Coe(D),Te=new Lse(ie),ve=new xoe(ie,Te),Ge=new woe(ie,Te,Ut,ve),$e=new Ooe(ie,Ge,Te,Ut),nn=new Doe(ie,Tt,Ht),Qt=new _oe(At),Ve=new jle(D,q,V,dt,Tt,ve,Qt),Xt=new mce(D,At),Ot=new Jle,cn=new ice(dt),st=new goe(D,q,V,ht,$e,y,l),et=new ace(D,$e,Tt),ze=new gce(ie,Ut,Tt,ht),zt=new yoe(ie,dt,Ut),Mt=new Noe(ie,dt,Ut),Ut.programs=Ve.programs,D.capabilities=Tt,D.extensions=dt,D.properties=At,D.renderLists=Ot,D.shadowMap=et,D.state=ht,D.info=Ut}Et();const wt=new hce(D,ie);this.xr=wt,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){const k=dt.get("WEBGL_lose_context");k&&k.loseContext()},this.forceContextRestore=function(){const k=dt.get("WEBGL_lose_context");k&&k.restoreContext()},this.getPixelRatio=function(){return _e},this.setPixelRatio=function(k){k!==void 0&&(_e=k,this.setSize(se,ge,!1))},this.getSize=function(k){return k.set(se,ge)},this.setSize=function(k,ae,ce=!0){if(wt.isPresenting){De("WebGLRenderer: Can't change size while VR device is presenting.");return}se=k,ge=ae,t.width=Math.floor(k*_e),t.height=Math.floor(ae*_e),ce===!0&&(t.style.width=k+"px",t.style.height=ae+"px"),this.setViewport(0,0,k,ae)},this.getDrawingBufferSize=function(k){return k.set(se*_e,ge*_e).floor()},this.setDrawingBufferSize=function(k,ae,ce){se=k,ge=ae,_e=ce,t.width=Math.floor(k*ce),t.height=Math.floor(ae*ce),this.setViewport(0,0,k,ae)},this.getCurrentViewport=function(k){return k.copy(ee)},this.getViewport=function(k){return k.copy(we)},this.setViewport=function(k,ae,ce,Ae){k.isVector4?we.set(k.x,k.y,k.z,k.w):we.set(k,ae,ce,Ae),ht.viewport(ee.copy(we).multiplyScalar(_e).round())},this.getScissor=function(k){return k.copy(Ne)},this.setScissor=function(k,ae,ce,Ae){k.isVector4?Ne.set(k.x,k.y,k.z,k.w):Ne.set(k,ae,ce,Ae),ht.scissor(te.copy(Ne).multiplyScalar(_e).round())},this.getScissorTest=function(){return gt},this.setScissorTest=function(k){ht.setScissorTest(gt=k)},this.setOpaqueSort=function(k){K=k},this.setTransparentSort=function(k){pe=k},this.getClearColor=function(k){return k.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor(...arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha(...arguments)},this.clear=function(k=!0,ae=!0,ce=!0){let Ae=0;if(k){let le=!1;if(P!==null){const ke=P.texture.format;le=_.has(ke)}if(le){const ke=P.texture.type,it=T.has(ke),ft=st.getClearColor(),bt=st.getClearAlpha(),Ft=ft.r,Jt=ft.g,$t=ft.b;it?(A[0]=Ft,A[1]=Jt,A[2]=$t,A[3]=bt,ie.clearBufferuiv(ie.COLOR,0,A)):(S[0]=Ft,S[1]=Jt,S[2]=$t,S[3]=bt,ie.clearBufferiv(ie.COLOR,0,S))}else Ae|=ie.COLOR_BUFFER_BIT}ae&&(Ae|=ie.DEPTH_BUFFER_BIT),ce&&(Ae|=ie.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ie.clear(Ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pt,!1),t.removeEventListener("webglcontextrestored",lt,!1),t.removeEventListener("webglcontextcreationerror",en,!1),st.dispose(),Ot.dispose(),cn.dispose(),At.dispose(),q.dispose(),V.dispose(),$e.dispose(),ve.dispose(),ze.dispose(),Ve.dispose(),wt.dispose(),wt.removeEventListener("sessionstart",Mc),wt.removeEventListener("sessionend",Uo),$s.stop()};function pt(k){k.preventDefault(),i0("WebGLRenderer: Context Lost."),O=!0}function lt(){i0("WebGLRenderer: Context Restored."),O=!1;const k=Ut.autoReset,ae=et.enabled,ce=et.autoUpdate,Ae=et.needsUpdate,le=et.type;Et(),Ut.autoReset=k,et.enabled=ae,et.autoUpdate=ce,et.needsUpdate=Ae,et.type=le}function en(k){nt("WebGLRenderer: A WebGL context could not be created. Reason: ",k.statusMessage)}function Tn(k){const ae=k.target;ae.removeEventListener("dispose",Tn),gi(ae)}function gi(k){ni(k),At.remove(k)}function ni(k){const ae=At.get(k).programs;ae!==void 0&&(ae.forEach(function(ce){Ve.releaseProgram(ce)}),k.isShaderMaterial&&Ve.releaseShaderCache(k))}this.renderBufferDirect=function(k,ae,ce,Ae,le,ke){ae===null&&(ae=Mn);const it=le.isMesh&&le.matrixWorld.determinant()<0,ft=Ie(k,ae,ce,Ae,le);ht.setMaterial(Ae,it);let bt=ce.index,Ft=1;if(Ae.wireframe===!0){if(bt=Ge.getWireframeAttribute(ce),bt===void 0)return;Ft=2}const Jt=ce.drawRange,$t=ce.attributes.position;let tn=Jt.start*Ft,Gn=(Jt.start+Jt.count)*Ft;ke!==null&&(tn=Math.max(tn,ke.start*Ft),Gn=Math.min(Gn,(ke.start+ke.count)*Ft)),bt!==null?(tn=Math.max(tn,0),Gn=Math.min(Gn,bt.count)):$t!=null&&(tn=Math.max(tn,0),Gn=Math.min(Gn,$t.count));const fn=Gn-tn;if(fn<0||fn===1/0)return;ve.setup(le,Ae,ft,ce,bt);let bn,$n=zt;if(bt!==null&&(bn=Te.get(bt),$n=Mt,$n.setIndex(bn)),le.isMesh)Ae.wireframe===!0?(ht.setLineWidth(Ae.wireframeLinewidth*Qe()),$n.setMode(ie.LINES)):$n.setMode(ie.TRIANGLES);else if(le.isLine){let hn=Ae.linewidth;hn===void 0&&(hn=1),ht.setLineWidth(hn*Qe()),le.isLineSegments?$n.setMode(ie.LINES):le.isLineLoop?$n.setMode(ie.LINE_LOOP):$n.setMode(ie.LINE_STRIP)}else le.isPoints?$n.setMode(ie.POINTS):le.isSprite&&$n.setMode(ie.TRIANGLES);if(le.isBatchedMesh)if(le._multiDrawInstances!==null)qi("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),$n.renderMultiDrawInstances(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount,le._multiDrawInstances);else if(dt.get("WEBGL_multi_draw"))$n.renderMultiDraw(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount);else{const hn=le._multiDrawStarts,qn=le._multiDrawCounts,on=le._multiDrawCount,ii=bt?Te.get(bt).bytesPerElement:1,xi=At.get(Ae).currentProgram.getUniforms();for(let xn=0;xn<on;xn++)xi.setValue(ie,"_gl_DrawID",xn),$n.render(hn[xn]/ii,qn[xn])}else if(le.isInstancedMesh)$n.renderInstances(tn,fn,le.count);else if(ce.isInstancedBufferGeometry){const hn=ce._maxInstanceCount!==void 0?ce._maxInstanceCount:1/0,qn=Math.min(ce.instanceCount,hn);$n.renderInstances(tn,fn,qn)}else $n.render(tn,fn)};function rr(k,ae,ce){k.transparent===!0&&k.side===hr&&k.forceSinglePass===!1?(k.side=Yi,k.needsUpdate=!0,H(k,ae,ce),k.side=Ha,k.needsUpdate=!0,H(k,ae,ce),k.side=hr):H(k,ae,ce)}this.compile=function(k,ae,ce=null){ce===null&&(ce=k),w=cn.get(ce),w.init(ae),L.push(w),ce.traverseVisible(function(le){le.isLight&&le.layers.test(ae.layers)&&(w.pushLight(le),le.castShadow&&w.pushShadow(le))}),k!==ce&&k.traverseVisible(function(le){le.isLight&&le.layers.test(ae.layers)&&(w.pushLight(le),le.castShadow&&w.pushShadow(le))}),w.setupLights();const Ae=new Set;return k.traverse(function(le){if(!(le.isMesh||le.isPoints||le.isLine||le.isSprite))return;const ke=le.material;if(ke)if(Array.isArray(ke))for(let it=0;it<ke.length;it++){const ft=ke[it];rr(ft,ce,le),Ae.add(ft)}else rr(ke,ce,le),Ae.add(ke)}),w=L.pop(),Ae},this.compileAsync=function(k,ae,ce=null){const Ae=this.compile(k,ae,ce);return new Promise(le=>{function ke(){if(Ae.forEach(function(it){At.get(it).currentProgram.isReady()&&Ae.delete(it)}),Ae.size===0){le(k);return}setTimeout(ke,10)}dt.get("KHR_parallel_shader_compile")!==null?ke():setTimeout(ke,10)})};let Yr=null;function Ld(k){Yr&&Yr(k)}function Mc(){$s.stop()}function Uo(){$s.start()}const $s=new qk;$s.setAnimationLoop(Ld),typeof self<"u"&&$s.setContext(self),this.setAnimationLoop=function(k){Yr=k,wt.setAnimationLoop(k),k===null?$s.stop():$s.start()},wt.addEventListener("sessionstart",Mc),wt.addEventListener("sessionend",Uo),this.render=function(k,ae){if(ae!==void 0&&ae.isCamera!==!0){nt("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(O===!0)return;if(k.matrixWorldAutoUpdate===!0&&k.updateMatrixWorld(),ae.parent===null&&ae.matrixWorldAutoUpdate===!0&&ae.updateMatrixWorld(),wt.enabled===!0&&wt.isPresenting===!0&&(wt.cameraAutoUpdate===!0&&wt.updateCamera(ae),ae=wt.getCamera()),k.isScene===!0&&k.onBeforeRender(D,k,ae,P),w=cn.get(k,L.length),w.init(ae),L.push(w),Dt.multiplyMatrices(ae.projectionMatrix,ae.matrixWorldInverse),Se.setFromProjectionMatrix(Dt,oa,ae.reversedDepth),ct=this.localClippingEnabled,Be=Qt.init(this.clippingPlanes,ct),C=Ot.get(k,B.length),C.init(),B.push(C),wt.enabled===!0&&wt.isPresenting===!0){const ke=D.xr.getDepthSensingMesh();ke!==null&&Sa(ke,ae,-1/0,D.sortObjects)}Sa(k,ae,0,D.sortObjects),C.finish(),D.sortObjects===!0&&C.sort(K,pe),Gt=wt.enabled===!1||wt.isPresenting===!1||wt.hasDepthSensing()===!1,Gt&&st.addToRenderList(C,k),this.info.render.frame++,Be===!0&&Qt.beginShadows();const ce=w.state.shadowsArray;et.render(ce,k,ae),Be===!0&&Qt.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ae=C.opaque,le=C.transmissive;if(w.setupLights(),ae.isArrayCamera){const ke=ae.cameras;if(le.length>0)for(let it=0,ft=ke.length;it<ft;it++){const bt=ke[it];wn(Ae,le,k,bt)}Gt&&st.render(k);for(let it=0,ft=ke.length;it<ft;it++){const bt=ke[it];xr(C,k,bt,bt.viewport)}}else le.length>0&&wn(Ae,le,k,ae),Gt&&st.render(k),xr(C,k,ae);P!==null&&U===0&&(Ht.updateMultisampleRenderTarget(P),Ht.updateRenderTargetMipmap(P)),k.isScene===!0&&k.onAfterRender(D,k,ae),ve.resetDefaultState(),X=-1,Z=null,L.pop(),L.length>0?(w=L[L.length-1],Be===!0&&Qt.setGlobalState(D.clippingPlanes,w.state.camera)):w=null,B.pop(),B.length>0?C=B[B.length-1]:C=null};function Sa(k,ae,ce,Ae){if(k.visible===!1)return;if(k.layers.test(ae.layers)){if(k.isGroup)ce=k.renderOrder;else if(k.isLOD)k.autoUpdate===!0&&k.update(ae);else if(k.isLight)w.pushLight(k),k.castShadow&&w.pushShadow(k);else if(k.isSprite){if(!k.frustumCulled||Se.intersectsSprite(k)){Ae&&It.setFromMatrixPosition(k.matrixWorld).applyMatrix4(Dt);const it=$e.update(k),ft=k.material;ft.visible&&C.push(k,it,ft,ce,It.z,null)}}else if((k.isMesh||k.isLine||k.isPoints)&&(!k.frustumCulled||Se.intersectsObject(k))){const it=$e.update(k),ft=k.material;if(Ae&&(k.boundingSphere!==void 0?(k.boundingSphere===null&&k.computeBoundingSphere(),It.copy(k.boundingSphere.center)):(it.boundingSphere===null&&it.computeBoundingSphere(),It.copy(it.boundingSphere.center)),It.applyMatrix4(k.matrixWorld).applyMatrix4(Dt)),Array.isArray(ft)){const bt=it.groups;for(let Ft=0,Jt=bt.length;Ft<Jt;Ft++){const $t=bt[Ft],tn=ft[$t.materialIndex];tn&&tn.visible&&C.push(k,it,tn,ce,It.z,$t)}}else ft.visible&&C.push(k,it,ft,ce,It.z,null)}}const ke=k.children;for(let it=0,ft=ke.length;it<ft;it++)Sa(ke[it],ae,ce,Ae)}function xr(k,ae,ce,Ae){const{opaque:le,transmissive:ke,transparent:it}=k;w.setupLightsView(ce),Be===!0&&Qt.setGlobalState(D.clippingPlanes,ce),Ae&&ht.viewport(ee.copy(Ae)),le.length>0&&ar(le,ae,ce),ke.length>0&&ar(ke,ae,ce),it.length>0&&ar(it,ae,ce),ht.buffers.depth.setTest(!0),ht.buffers.depth.setMask(!0),ht.buffers.color.setMask(!0),ht.setPolygonOffset(!1)}function wn(k,ae,ce,Ae){if((ce.isScene===!0?ce.overrideMaterial:null)!==null)return;w.state.transmissionRenderTarget[Ae.id]===void 0&&(w.state.transmissionRenderTarget[Ae.id]=new Bl(1,1,{generateMipmaps:!0,type:dt.has("EXT_color_buffer_half_float")||dt.has("EXT_color_buffer_float")?Ai:ss,minFilter:Cr,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:yn.workingColorSpace}));const ke=w.state.transmissionRenderTarget[Ae.id],it=Ae.viewport||ee;ke.setSize(it.z*D.transmissionResolutionScale,it.w*D.transmissionResolutionScale);const ft=D.getRenderTarget(),bt=D.getActiveCubeFace(),Ft=D.getActiveMipmapLevel();D.setRenderTarget(ke),D.getClearColor(W),ne=D.getClearAlpha(),ne<1&&D.setClearColor(16777215,.5),D.clear(),Gt&&st.render(ce);const Jt=D.toneMapping;D.toneMapping=zr;const $t=Ae.viewport;if(Ae.viewport!==void 0&&(Ae.viewport=void 0),w.setupLightsView(Ae),Be===!0&&Qt.setGlobalState(D.clippingPlanes,Ae),ar(k,ce,Ae),Ht.updateMultisampleRenderTarget(ke),Ht.updateRenderTargetMipmap(ke),dt.has("WEBGL_multisampled_render_to_texture")===!1){let tn=!1;for(let Gn=0,fn=ae.length;Gn<fn;Gn++){const bn=ae[Gn],{object:$n,geometry:hn,material:qn,group:on}=bn;if(qn.side===hr&&$n.layers.test(Ae.layers)){const ii=qn.side;qn.side=Yi,qn.needsUpdate=!0,Wn($n,ce,Ae,hn,qn,on),qn.side=ii,qn.needsUpdate=!0,tn=!0}}tn===!0&&(Ht.updateMultisampleRenderTarget(ke),Ht.updateRenderTargetMipmap(ke))}D.setRenderTarget(ft,bt,Ft),D.setClearColor(W,ne),$t!==void 0&&(Ae.viewport=$t),D.toneMapping=Jt}function ar(k,ae,ce){const Ae=ae.isScene===!0?ae.overrideMaterial:null;for(let le=0,ke=k.length;le<ke;le++){const it=k[le],{object:ft,geometry:bt,group:Ft}=it;let Jt=it.material;Jt.allowOverride===!0&&Ae!==null&&(Jt=Ae),ft.layers.test(ce.layers)&&Wn(ft,ae,ce,bt,Jt,Ft)}}function Wn(k,ae,ce,Ae,le,ke){k.onBeforeRender(D,ae,ce,Ae,le,ke),k.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,k.matrixWorld),k.normalMatrix.getNormalMatrix(k.modelViewMatrix),le.onBeforeRender(D,ae,ce,Ae,k,ke),le.transparent===!0&&le.side===hr&&le.forceSinglePass===!1?(le.side=Yi,le.needsUpdate=!0,D.renderBufferDirect(ce,ae,Ae,le,k,ke),le.side=Ha,le.needsUpdate=!0,D.renderBufferDirect(ce,ae,Ae,le,k,ke),le.side=hr):D.renderBufferDirect(ce,ae,Ae,le,k,ke),k.onAfterRender(D,ae,ce,Ae,le,ke)}function H(k,ae,ce){ae.isScene!==!0&&(ae=Mn);const Ae=At.get(k),le=w.state.lights,ke=w.state.shadowsArray,it=le.state.version,ft=Ve.getParameters(k,le.state,ke,ae,ce),bt=Ve.getProgramCacheKey(ft);let Ft=Ae.programs;Ae.environment=k.isMeshStandardMaterial?ae.environment:null,Ae.fog=ae.fog,Ae.envMap=(k.isMeshStandardMaterial?V:q).get(k.envMap||Ae.environment),Ae.envMapRotation=Ae.environment!==null&&k.envMap===null?ae.environmentRotation:k.envMapRotation,Ft===void 0&&(k.addEventListener("dispose",Tn),Ft=new Map,Ae.programs=Ft);let Jt=Ft.get(bt);if(Jt!==void 0){if(Ae.currentProgram===Jt&&Ae.lightsStateVersion===it)return xe(k,ft),Jt}else ft.uniforms=Ve.getUniforms(k),k.onBeforeCompile(ft,D),Jt=Ve.acquireProgram(ft,bt),Ft.set(bt,Jt),Ae.uniforms=ft.uniforms;const $t=Ae.uniforms;return(!k.isShaderMaterial&&!k.isRawShaderMaterial||k.clipping===!0)&&($t.clippingPlanes=Qt.uniform),xe(k,ft),Ae.needsLights=qe(k),Ae.lightsStateVersion=it,Ae.needsLights&&($t.ambientLightColor.value=le.state.ambient,$t.lightProbe.value=le.state.probe,$t.directionalLights.value=le.state.directional,$t.directionalLightShadows.value=le.state.directionalShadow,$t.spotLights.value=le.state.spot,$t.spotLightShadows.value=le.state.spotShadow,$t.rectAreaLights.value=le.state.rectArea,$t.ltc_1.value=le.state.rectAreaLTC1,$t.ltc_2.value=le.state.rectAreaLTC2,$t.pointLights.value=le.state.point,$t.pointLightShadows.value=le.state.pointShadow,$t.hemisphereLights.value=le.state.hemi,$t.directionalShadowMap.value=le.state.directionalShadowMap,$t.directionalShadowMatrix.value=le.state.directionalShadowMatrix,$t.spotShadowMap.value=le.state.spotShadowMap,$t.spotLightMatrix.value=le.state.spotLightMatrix,$t.spotLightMap.value=le.state.spotLightMap,$t.pointShadowMap.value=le.state.pointShadowMap,$t.pointShadowMatrix.value=le.state.pointShadowMatrix),Ae.currentProgram=Jt,Ae.uniformsList=null,Jt}function J(k){if(k.uniformsList===null){const ae=k.currentProgram.getUniforms();k.uniformsList=uM.seqWithValue(ae.seq,k.uniforms)}return k.uniformsList}function xe(k,ae){const ce=At.get(k);ce.outputColorSpace=ae.outputColorSpace,ce.batching=ae.batching,ce.batchingColor=ae.batchingColor,ce.instancing=ae.instancing,ce.instancingColor=ae.instancingColor,ce.instancingMorph=ae.instancingMorph,ce.skinning=ae.skinning,ce.morphTargets=ae.morphTargets,ce.morphNormals=ae.morphNormals,ce.morphColors=ae.morphColors,ce.morphTargetsCount=ae.morphTargetsCount,ce.numClippingPlanes=ae.numClippingPlanes,ce.numIntersection=ae.numClipIntersection,ce.vertexAlphas=ae.vertexAlphas,ce.vertexTangents=ae.vertexTangents,ce.toneMapping=ae.toneMapping}function Ie(k,ae,ce,Ae,le){ae.isScene!==!0&&(ae=Mn),Ht.resetTextureUnits();const ke=ae.fog,it=Ae.isMeshStandardMaterial?ae.environment:null,ft=P===null?D.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:Qo,bt=(Ae.isMeshStandardMaterial?V:q).get(Ae.envMap||it),Ft=Ae.vertexColors===!0&&!!ce.attributes.color&&ce.attributes.color.itemSize===4,Jt=!!ce.attributes.tangent&&(!!Ae.normalMap||Ae.anisotropy>0),$t=!!ce.morphAttributes.position,tn=!!ce.morphAttributes.normal,Gn=!!ce.morphAttributes.color;let fn=zr;Ae.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(fn=D.toneMapping);const bn=ce.morphAttributes.position||ce.morphAttributes.normal||ce.morphAttributes.color,$n=bn!==void 0?bn.length:0,hn=At.get(Ae),qn=w.state.lights;if(Be===!0&&(ct===!0||k!==Z)){const or=k===Z&&Ae.id===X;Qt.setState(Ae,k,or)}let on=!1;Ae.version===hn.__version?(hn.needsLights&&hn.lightsStateVersion!==qn.state.version||hn.outputColorSpace!==ft||le.isBatchedMesh&&hn.batching===!1||!le.isBatchedMesh&&hn.batching===!0||le.isBatchedMesh&&hn.batchingColor===!0&&le.colorTexture===null||le.isBatchedMesh&&hn.batchingColor===!1&&le.colorTexture!==null||le.isInstancedMesh&&hn.instancing===!1||!le.isInstancedMesh&&hn.instancing===!0||le.isSkinnedMesh&&hn.skinning===!1||!le.isSkinnedMesh&&hn.skinning===!0||le.isInstancedMesh&&hn.instancingColor===!0&&le.instanceColor===null||le.isInstancedMesh&&hn.instancingColor===!1&&le.instanceColor!==null||le.isInstancedMesh&&hn.instancingMorph===!0&&le.morphTexture===null||le.isInstancedMesh&&hn.instancingMorph===!1&&le.morphTexture!==null||hn.envMap!==bt||Ae.fog===!0&&hn.fog!==ke||hn.numClippingPlanes!==void 0&&(hn.numClippingPlanes!==Qt.numPlanes||hn.numIntersection!==Qt.numIntersection)||hn.vertexAlphas!==Ft||hn.vertexTangents!==Jt||hn.morphTargets!==$t||hn.morphNormals!==tn||hn.morphColors!==Gn||hn.toneMapping!==fn||hn.morphTargetsCount!==$n)&&(on=!0):(on=!0,hn.__version=Ae.version);let ii=hn.currentProgram;on===!0&&(ii=H(Ae,ae,le));let xi=!1,xn=!1,As=!1;const ci=ii.getUniforms(),Ei=hn.uniforms;if(ht.useProgram(ii.program)&&(xi=!0,xn=!0,As=!0),Ae.id!==X&&(X=Ae.id,xn=!0),xi||Z!==k){ht.buffers.depth.getReversed()&&k.reversedDepth!==!0&&(k._reversedDepth=!0,k.updateProjectionMatrix()),ci.setValue(ie,"projectionMatrix",k.projectionMatrix),ci.setValue(ie,"viewMatrix",k.matrixWorldInverse);const ws=ci.map.cameraPosition;ws!==void 0&&ws.setValue(ie,Nt.setFromMatrixPosition(k.matrixWorld)),Tt.logarithmicDepthBuffer&&ci.setValue(ie,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&ci.setValue(ie,"isOrthographic",k.isOrthographicCamera===!0),Z!==k&&(Z=k,xn=!0,As=!0)}if(le.isSkinnedMesh){ci.setOptional(ie,le,"bindMatrix"),ci.setOptional(ie,le,"bindMatrixInverse");const or=le.skeleton;or&&(or.boneTexture===null&&or.computeBoneTexture(),ci.setValue(ie,"boneTexture",or.boneTexture,Ht))}le.isBatchedMesh&&(ci.setOptional(ie,le,"batchingTexture"),ci.setValue(ie,"batchingTexture",le._matricesTexture,Ht),ci.setOptional(ie,le,"batchingIdTexture"),ci.setValue(ie,"batchingIdTexture",le._indirectTexture,Ht),ci.setOptional(ie,le,"batchingColorTexture"),le._colorsTexture!==null&&ci.setValue(ie,"batchingColorTexture",le._colorsTexture,Ht));const $i=ce.morphAttributes;if(($i.position!==void 0||$i.normal!==void 0||$i.color!==void 0)&&nn.update(le,ce,ii),(xn||hn.receiveShadow!==le.receiveShadow)&&(hn.receiveShadow=le.receiveShadow,ci.setValue(ie,"receiveShadow",le.receiveShadow)),Ae.isMeshGouraudMaterial&&Ae.envMap!==null&&(Ei.envMap.value=bt,Ei.flipEnvMap.value=bt.isCubeTexture&&bt.isRenderTargetTexture===!1?-1:1),Ae.isMeshStandardMaterial&&Ae.envMap===null&&ae.environment!==null&&(Ei.envMapIntensity.value=ae.environmentIntensity),Ei.dfgLUT!==void 0&&(Ei.dfgLUT.value=yce()),xn&&(ci.setValue(ie,"toneMappingExposure",D.toneMappingExposure),hn.needsLights&&Ye(Ei,As),ke&&Ae.fog===!0&&Xt.refreshFogUniforms(Ei,ke),Xt.refreshMaterialUniforms(Ei,Ae,_e,ge,w.state.transmissionRenderTarget[k.id]),uM.upload(ie,J(hn),Ei,Ht)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(uM.upload(ie,J(hn),Ei,Ht),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&ci.setValue(ie,"center",le.center),ci.setValue(ie,"modelViewMatrix",le.modelViewMatrix),ci.setValue(ie,"normalMatrix",le.normalMatrix),ci.setValue(ie,"modelMatrix",le.matrixWorld),Ae.isShaderMaterial||Ae.isRawShaderMaterial){const or=Ae.uniformsGroups;for(let ws=0,il=or.length;ws<il;ws++){const Lo=or[ws];ze.update(Lo,ii),ze.bind(Lo,ii)}}return ii}function Ye(k,ae){k.ambientLightColor.needsUpdate=ae,k.lightProbe.needsUpdate=ae,k.directionalLights.needsUpdate=ae,k.directionalLightShadows.needsUpdate=ae,k.pointLights.needsUpdate=ae,k.pointLightShadows.needsUpdate=ae,k.spotLights.needsUpdate=ae,k.spotLightShadows.needsUpdate=ae,k.rectAreaLights.needsUpdate=ae,k.hemisphereLights.needsUpdate=ae}function qe(k){return k.isMeshLambertMaterial||k.isMeshToonMaterial||k.isMeshPhongMaterial||k.isMeshStandardMaterial||k.isShadowMaterial||k.isShaderMaterial&&k.lights===!0}this.getActiveCubeFace=function(){return F},this.getActiveMipmapLevel=function(){return U},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(k,ae,ce){const Ae=At.get(k);Ae.__autoAllocateDepthBuffer=k.resolveDepthBuffer===!1,Ae.__autoAllocateDepthBuffer===!1&&(Ae.__useRenderToTexture=!1),At.get(k.texture).__webglTexture=ae,At.get(k.depthTexture).__webglTexture=Ae.__autoAllocateDepthBuffer?void 0:ce,Ae.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(k,ae){const ce=At.get(k);ce.__webglFramebuffer=ae,ce.__useDefaultFramebuffer=ae===void 0};const vt=ie.createFramebuffer();this.setRenderTarget=function(k,ae=0,ce=0){P=k,F=ae,U=ce;let Ae=!0,le=null,ke=!1,it=!1;if(k){const bt=At.get(k);if(bt.__useDefaultFramebuffer!==void 0)ht.bindFramebuffer(ie.FRAMEBUFFER,null),Ae=!1;else if(bt.__webglFramebuffer===void 0)Ht.setupRenderTarget(k);else if(bt.__hasExternalTextures)Ht.rebindTextures(k,At.get(k.texture).__webglTexture,At.get(k.depthTexture).__webglTexture);else if(k.depthBuffer){const $t=k.depthTexture;if(bt.__boundDepthTexture!==$t){if($t!==null&&At.has($t)&&(k.width!==$t.image.width||k.height!==$t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ht.setupDepthRenderbuffer(k)}}const Ft=k.texture;(Ft.isData3DTexture||Ft.isDataArrayTexture||Ft.isCompressedArrayTexture)&&(it=!0);const Jt=At.get(k).__webglFramebuffer;k.isWebGLCubeRenderTarget?(Array.isArray(Jt[ae])?le=Jt[ae][ce]:le=Jt[ae],ke=!0):k.samples>0&&Ht.useMultisampledRTT(k)===!1?le=At.get(k).__webglMultisampledFramebuffer:Array.isArray(Jt)?le=Jt[ce]:le=Jt,ee.copy(k.viewport),te.copy(k.scissor),re=k.scissorTest}else ee.copy(we).multiplyScalar(_e).floor(),te.copy(Ne).multiplyScalar(_e).floor(),re=gt;if(ce!==0&&(le=vt),ht.bindFramebuffer(ie.FRAMEBUFFER,le)&&Ae&&ht.drawBuffers(k,le),ht.viewport(ee),ht.scissor(te),ht.setScissorTest(re),ke){const bt=At.get(k.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_CUBE_MAP_POSITIVE_X+ae,bt.__webglTexture,ce)}else if(it){const bt=ae;for(let Ft=0;Ft<k.textures.length;Ft++){const Jt=At.get(k.textures[Ft]);ie.framebufferTextureLayer(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0+Ft,Jt.__webglTexture,ce,bt)}}else if(k!==null&&ce!==0){const bt=At.get(k.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,bt.__webglTexture,ce)}X=-1},this.readRenderTargetPixels=function(k,ae,ce,Ae,le,ke,it,ft=0){if(!(k&&k.isWebGLRenderTarget)){nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let bt=At.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&it!==void 0&&(bt=bt[it]),bt){ht.bindFramebuffer(ie.FRAMEBUFFER,bt);try{const Ft=k.textures[ft],Jt=Ft.format,$t=Ft.type;if(!Tt.textureFormatReadable(Jt)){nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Tt.textureTypeReadable($t)){nt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ae>=0&&ae<=k.width-Ae&&ce>=0&&ce<=k.height-le&&(k.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+ft),ie.readPixels(ae,ce,Ae,le,Kt.convert(Jt),Kt.convert($t),ke))}finally{const Ft=P!==null?At.get(P).__webglFramebuffer:null;ht.bindFramebuffer(ie.FRAMEBUFFER,Ft)}}},this.readRenderTargetPixelsAsync=async function(k,ae,ce,Ae,le,ke,it,ft=0){if(!(k&&k.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let bt=At.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&it!==void 0&&(bt=bt[it]),bt)if(ae>=0&&ae<=k.width-Ae&&ce>=0&&ce<=k.height-le){ht.bindFramebuffer(ie.FRAMEBUFFER,bt);const Ft=k.textures[ft],Jt=Ft.format,$t=Ft.type;if(!Tt.textureFormatReadable(Jt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Tt.textureTypeReadable($t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const tn=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,tn),ie.bufferData(ie.PIXEL_PACK_BUFFER,ke.byteLength,ie.STREAM_READ),k.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+ft),ie.readPixels(ae,ce,Ae,le,Kt.convert(Jt),Kt.convert($t),0);const Gn=P!==null?At.get(P).__webglFramebuffer:null;ht.bindFramebuffer(ie.FRAMEBUFFER,Gn);const fn=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);return ie.flush(),await qq(ie,fn,4),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,tn),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,ke),ie.deleteBuffer(tn),ie.deleteSync(fn),ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(k,ae=null,ce=0){const Ae=Math.pow(2,-ce),le=Math.floor(k.image.width*Ae),ke=Math.floor(k.image.height*Ae),it=ae!==null?ae.x:0,ft=ae!==null?ae.y:0;Ht.setTexture2D(k,0),ie.copyTexSubImage2D(ie.TEXTURE_2D,ce,0,0,it,ft,le,ke),ht.unbindTexture()};const mt=ie.createFramebuffer(),xt=ie.createFramebuffer();this.copyTextureToTexture=function(k,ae,ce=null,Ae=null,le=0,ke=null){ke===null&&(le!==0?(qi("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ke=le,le=0):ke=0);let it,ft,bt,Ft,Jt,$t,tn,Gn,fn;const bn=k.isCompressedTexture?k.mipmaps[ke]:k.image;if(ce!==null)it=ce.max.x-ce.min.x,ft=ce.max.y-ce.min.y,bt=ce.isBox3?ce.max.z-ce.min.z:1,Ft=ce.min.x,Jt=ce.min.y,$t=ce.isBox3?ce.min.z:0;else{const $i=Math.pow(2,-le);it=Math.floor(bn.width*$i),ft=Math.floor(bn.height*$i),k.isDataArrayTexture?bt=bn.depth:k.isData3DTexture?bt=Math.floor(bn.depth*$i):bt=1,Ft=0,Jt=0,$t=0}Ae!==null?(tn=Ae.x,Gn=Ae.y,fn=Ae.z):(tn=0,Gn=0,fn=0);const $n=Kt.convert(ae.format),hn=Kt.convert(ae.type);let qn;ae.isData3DTexture?(Ht.setTexture3D(ae,0),qn=ie.TEXTURE_3D):ae.isDataArrayTexture||ae.isCompressedArrayTexture?(Ht.setTexture2DArray(ae,0),qn=ie.TEXTURE_2D_ARRAY):(Ht.setTexture2D(ae,0),qn=ie.TEXTURE_2D),ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,ae.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ae.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,ae.unpackAlignment);const on=ie.getParameter(ie.UNPACK_ROW_LENGTH),ii=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),xi=ie.getParameter(ie.UNPACK_SKIP_PIXELS),xn=ie.getParameter(ie.UNPACK_SKIP_ROWS),As=ie.getParameter(ie.UNPACK_SKIP_IMAGES);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,bn.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,bn.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Ft),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Jt),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,$t);const ci=k.isDataArrayTexture||k.isData3DTexture,Ei=ae.isDataArrayTexture||ae.isData3DTexture;if(k.isDepthTexture){const $i=At.get(k),or=At.get(ae),ws=At.get($i.__renderTarget),il=At.get(or.__renderTarget);ht.bindFramebuffer(ie.READ_FRAMEBUFFER,ws.__webglFramebuffer),ht.bindFramebuffer(ie.DRAW_FRAMEBUFFER,il.__webglFramebuffer);for(let Lo=0;Lo<bt;Lo++)ci&&(ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,At.get(k).__webglTexture,le,$t+Lo),ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,At.get(ae).__webglTexture,ke,fn+Lo)),ie.blitFramebuffer(Ft,Jt,it,ft,tn,Gn,it,ft,ie.DEPTH_BUFFER_BIT,ie.NEAREST);ht.bindFramebuffer(ie.READ_FRAMEBUFFER,null),ht.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else if(le!==0||k.isRenderTargetTexture||At.has(k)){const $i=At.get(k),or=At.get(ae);ht.bindFramebuffer(ie.READ_FRAMEBUFFER,mt),ht.bindFramebuffer(ie.DRAW_FRAMEBUFFER,xt);for(let ws=0;ws<bt;ws++)ci?ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,$i.__webglTexture,le,$t+ws):ie.framebufferTexture2D(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,$i.__webglTexture,le),Ei?ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,or.__webglTexture,ke,fn+ws):ie.framebufferTexture2D(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,or.__webglTexture,ke),le!==0?ie.blitFramebuffer(Ft,Jt,it,ft,tn,Gn,it,ft,ie.COLOR_BUFFER_BIT,ie.NEAREST):Ei?ie.copyTexSubImage3D(qn,ke,tn,Gn,fn+ws,Ft,Jt,it,ft):ie.copyTexSubImage2D(qn,ke,tn,Gn,Ft,Jt,it,ft);ht.bindFramebuffer(ie.READ_FRAMEBUFFER,null),ht.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else Ei?k.isDataTexture||k.isData3DTexture?ie.texSubImage3D(qn,ke,tn,Gn,fn,it,ft,bt,$n,hn,bn.data):ae.isCompressedArrayTexture?ie.compressedTexSubImage3D(qn,ke,tn,Gn,fn,it,ft,bt,$n,bn.data):ie.texSubImage3D(qn,ke,tn,Gn,fn,it,ft,bt,$n,hn,bn):k.isDataTexture?ie.texSubImage2D(ie.TEXTURE_2D,ke,tn,Gn,it,ft,$n,hn,bn.data):k.isCompressedTexture?ie.compressedTexSubImage2D(ie.TEXTURE_2D,ke,tn,Gn,bn.width,bn.height,$n,bn.data):ie.texSubImage2D(ie.TEXTURE_2D,ke,tn,Gn,it,ft,$n,hn,bn);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,on),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,ii),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,xi),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,xn),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,As),ke===0&&ae.generateMipmaps&&ie.generateMipmap(qn),ht.unbindTexture()},this.initRenderTarget=function(k){At.get(k).__webglFramebuffer===void 0&&Ht.setupRenderTarget(k)},this.initTexture=function(k){k.isCubeTexture?Ht.setTextureCube(k,0):k.isData3DTexture?Ht.setTexture3D(k,0):k.isDataArrayTexture||k.isCompressedArrayTexture?Ht.setTexture2DArray(k,0):Ht.setTexture2D(k,0),ht.unbindTexture()},this.resetState=function(){F=0,U=0,P=null,ht.reset(),ve.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return oa}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=yn._getDrawingBufferColorSpace(e),t.unpackColorSpace=yn._getUnpackColorSpace()}}const vce=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:sT,AddEquation:aa,AddOperation:dC,AdditiveAnimationBlendMode:xC,AdditiveBlending:mp,AgXToneMapping:mC,AlphaFormat:rT,AlwaysCompare:fT,AlwaysDepth:Wg,AlwaysStencilFunc:AS,AmbientLight:XC,AnimationAction:TD,AnimationClip:kp,AnimationLoader:hV,AnimationMixer:AD,AnimationObjectGroup:_V,AnimationUtils:fV,ArcCurve:QB,ArrayCamera:$C,ArrowHelper:VV,AttachedBindMode:pM,Audio:vD,AudioAnalyser:vV,AudioContext:jC,AudioListener:xV,AudioLoader:mV,AxesHelper:HV,BackSide:Yi,BasicDepthPacking:wB,BasicShadowMap:oC,BatchedMesh:KB,Bone:_T,BooleanKeyframeTrack:Qp,Box2:RV,Box3:Vr,Box3Helper:GV,BoxGeometry:Nd,BoxHelper:FV,BufferAttribute:li,BufferGeometry:Fn,BufferGeometryLoader:gD,ByteType:dd,Cache:au,Camera:cv,CameraHelper:PV,CanvasTexture:rV,CapsuleGeometry:TT,CatmullRomCurve3:tD,CineonToneMapping:pC,CircleGeometry:AT,ClampToEdgeWrapping:ts,Clock:KC,Color:Bt,ColorKeyframeTrack:HC,ColorManagement:yn,CompressedArrayTexture:iV,CompressedCubeTexture:sV,CompressedTexture:ST,CompressedTextureLoader:pV,ConeGeometry:hv,ConstantAlphaFactor:_B,ConstantColorFactor:yB,Controls:WV,CubeCamera:SC,CubeReflectionMapping:Do,CubeRefractionMapping:Rl,CubeTexture:Zf,CubeTextureLoader:dD,CubeUVReflectionMapping:Ed,CubicBezierCurve:RC,CubicBezierCurve3:nD,CubicInterpolant:lD,CullFaceBack:vS,CullFaceFront:aC,CullFaceFrontBack:Cz,CullFaceNone:rC,Curve:Tc,CurvePath:sD,CustomBlending:fp,CustomToneMapping:SB,CylinderGeometry:y0,Cylindrical:CV,Data3DTexture:hT,DataArrayTexture:lv,DataTexture:No,DataTextureLoader:kC,DataUtils:op,DecrementStencilOp:UB,DecrementWrapStencilOp:IB,DefaultLoadingManager:Mg,DepthFormat:Ro,DepthStencilFormat:wo,DepthTexture:Bo,DetachedBindMode:TB,DirectionalLight:FT,DirectionalLightHelper:IV,DiscreteInterpolant:cD,DodecahedronGeometry:ET,DoubleSide:hr,DstAlphaFactor:QS,DstColorFactor:tT,DynamicCopyUsage:Fz,DynamicDrawUsage:ap,DynamicReadUsage:Lz,EdgesGeometry:ZB,EllipseCurve:MT,EqualCompare:lT,EqualDepth:qg,EqualStencilFunc:zB,EquirectangularReflectionMapping:Ad,EquirectangularRefractionMapping:zf,Euler:Wa,EventDispatcher:Oo,ExternalTexture:CC,ExtrudeGeometry:CT,FileLoader:Hr,Float16BufferAttribute:bC,Float32BufferAttribute:an,FloatType:Ti,Fog:yT,FogExp2:xT,FramebufferTexture:bT,FrontSide:Ha,Frustum:Zp,FrustumArray:dv,GLBufferAttribute:EV,GLSL1:zz,GLSL3:mM,GreaterCompare:cT,GreaterDepth:jg,GreaterEqualCompare:dT,GreaterEqualDepth:Yg,GreaterEqualStencilFunc:WB,GreaterStencilFunc:HB,GridHelper:UV,Group:fc,HalfFloatType:Ai,HemisphereLight:WC,HemisphereLightHelper:OV,IcosahedronGeometry:pv,ImageBitmapLoader:yD,ImageLoader:Hy,ImageUtils:YB,IncrementStencilOp:OB,IncrementWrapStencilOp:LB,InstancedBufferAttribute:Jo,InstancedBufferGeometry:mD,InstancedInterleavedBuffer:ED,InstancedMesh:AC,Int16BufferAttribute:Jz,Int32BufferAttribute:Zz,Int8BufferAttribute:jz,IntType:fr,InterleavedBuffer:x0,InterleavedBufferAttribute:Md,Interpolant:b0,InterpolateDiscrete:e0,InterpolateLinear:t0,InterpolateSmooth:tS,InterpolationSamplingMode:Hz,InterpolationSamplingType:Vz,InvertStencilOp:PB,KeepStencilOp:Tf,KeyframeTrack:Ll,LOD:$B,LatheGeometry:RT,Layers:r0,LessCompare:rv,LessDepth:Xg,LessEqualCompare:av,LessEqualDepth:Sd,LessEqualStencilFunc:VB,LessStencilFunc:GB,Light:th,LightProbe:YC,Line:Cd,Line3:wV,LineBasicMaterial:ua,LineCurve:wC,LineCurve3:iD,LineDashedMaterial:LT,LineLoop:EC,LineSegments:Sc,LinearFilter:Dn,LinearInterpolant:VC,LinearMipMapLinearFilter:_S,LinearMipMapNearestFilter:Nz,LinearMipmapLinearFilter:Cr,LinearMipmapNearestFilter:ud,LinearSRGBColorSpace:Qo,LinearToneMapping:fC,LinearTransfer:zp,Loader:Xr,LoaderUtils:Uf,LoadingManager:IT,LoopOnce:EB,LoopPingPong:CB,LoopRepeat:MB,MOUSE:Ez,Material:ir,MaterialLoader:gv,MathUtils:ov,Matrix2:xv,Matrix3:Ln,Matrix4:Yt,MaxEquation:cC,Mesh:Ui,MeshBasicMaterial:er,MeshDepthMaterial:FC,MeshDistanceMaterial:GC,MeshLambertMaterial:PC,MeshMatcapMaterial:zC,MeshNormalMaterial:IC,MeshPhongMaterial:UC,MeshPhysicalMaterial:nl,MeshStandardMaterial:_0,MeshToonMaterial:LC,MinEquation:lC,MirroredRepeatWrapping:lu,MixOperation:uC,MultiplyBlending:xp,MultiplyOperation:h0,NearestFilter:es,NearestMipMapLinearFilter:wz,NearestMipMapNearestFilter:Rz,NearestMipmapLinearFilter:Sl,NearestMipmapNearestFilter:p0,NeutralToneMapping:gC,NeverCompare:oT,NeverDepth:kg,NeverStencilFunc:FB,NoBlending:ca,NoColorSpace:Ga,NoToneMapping:zr,NormalAnimationBlendMode:aT,NormalBlending:Mo,NotEqualCompare:uT,NotEqualDepth:$g,NotEqualStencilFunc:kB,NumberKeyframeTrack:Hp,Object3D:mi,ObjectLoader:xD,ObjectSpaceNormalMap:vC,OctahedronGeometry:mv,OneFactor:KS,OneMinusConstantAlphaFactor:bB,OneMinusConstantColorFactor:vB,OneMinusDstAlphaFactor:eT,OneMinusDstColorFactor:nT,OneMinusSrcAlphaFactor:Hg,OneMinusSrcColorFactor:ZS,OrthographicCamera:Ac,PCFShadowMap:ev,PCFSoftShadowMap:My,PMREMGenerator:ON,Path:MS,PerspectiveCamera:bs,Plane:iu,PlaneGeometry:Bd,PlaneHelper:zV,PointLight:PT,PointLightHelper:DV,Points:MC,PointsMaterial:fv,PolarGridHelper:LV,PolyhedronGeometry:eh,PositionalAudio:yV,PropertyBinding:Ni,PropertyMixer:_D,QuadraticBezierCurve:NC,QuadraticBezierCurve3:BC,Quaternion:wr,QuaternionKeyframeTrack:Vf,QuaternionLinearInterpolant:uD,RED_GREEN_RGTC2_Format:Fp,RED_RGTC1_Format:Ip,REVISION:$f,RGBADepthPacking:NB,RGBAFormat:Oi,RGBAIntegerFormat:Jp,RGBA_ASTC_10x10_Format:Dp,RGBA_ASTC_10x5_Format:wp,RGBA_ASTC_10x6_Format:Np,RGBA_ASTC_10x8_Format:Bp,RGBA_ASTC_12x10_Format:Op,RGBA_ASTC_12x12_Format:Up,RGBA_ASTC_4x4_Format:bp,RGBA_ASTC_5x4_Format:Sp,RGBA_ASTC_5x5_Format:Tp,RGBA_ASTC_6x5_Format:Ap,RGBA_ASTC_6x6_Format:Ep,RGBA_ASTC_8x5_Format:Mp,RGBA_ASTC_8x6_Format:Cp,RGBA_ASTC_8x8_Format:Rp,RGBA_BPTC_Format:Lp,RGBA_ETC2_EAC_Format:_p,RGBA_PVRTC_2BPPV1_Format:Qg,RGBA_PVRTC_4BPPV1_Format:Zg,RGBA_S3TC_DXT1_Format:pd,RGBA_S3TC_DXT3_Format:md,RGBA_S3TC_DXT5_Format:gd,RGBDepthPacking:Bz,RGBFormat:m0,RGBIntegerFormat:AB,RGB_BPTC_SIGNED_Format:bS,RGB_BPTC_UNSIGNED_Format:SS,RGB_ETC1_Format:yp,RGB_ETC2_Format:vp,RGB_PVRTC_2BPPV1_Format:Jg,RGB_PVRTC_4BPPV1_Format:Kg,RGB_S3TC_DXT1_Format:hd,RGDepthPacking:Dz,RGFormat:Al,RGIntegerFormat:Kp,RawShaderMaterial:aD,Ray:g0,Raycaster:GT,RectAreaLight:qC,RedFormat:Kf,RedIntegerFormat:Jf,ReinhardToneMapping:hC,RenderTarget:bc,RenderTarget3D:bV,RepeatWrapping:wl,ReplaceStencilOp:DB,ReverseSubtractEquation:$S,RingGeometry:wT,SIGNED_RED_GREEN_RGTC2_Format:Gp,SIGNED_RED_RGTC1_Format:Pp,SRGBColorSpace:Mr,SRGBTransfer:qt,Scene:Qf,ShaderChunk:ei,ShaderLib:su,ShaderMaterial:Xa,ShadowMaterial:OC,Shape:hp,ShapeGeometry:NT,ShapePath:kV,ShapeUtils:hc,ShortType:fd,Skeleton:uv,SkeletonHelper:CD,SkinnedMesh:TC,Source:Bf,Sphere:mr,SphereGeometry:v0,Spherical:MD,SphericalHarmonics3:pD,SplineCurve:DC,SpotLight:S0,SpotLightHelper:NV,Sprite:jB,SpriteMaterial:vT,SrcAlphaFactor:Vg,SrcAlphaSaturateFactor:iT,SrcColorFactor:JS,StaticCopyUsage:Pz,StaticDrawUsage:n0,StaticReadUsage:Uz,StereoCamera:gV,StreamCopyUsage:Gz,StreamDrawUsage:Oz,StreamReadUsage:Iz,StringKeyframeTrack:em,SubtractEquation:jS,SubtractiveBlending:gp,TOUCH:Mz,TangentSpaceNormalMap:cu,TetrahedronGeometry:BT,Texture:pi,TextureLoader:fD,TextureUtils:XV,Timer:MV,TimestampQuery:dc,TorusGeometry:DT,TorusKnotGeometry:OT,Triangle:bo,TriangleFanDrawMode:TS,TriangleStripDrawMode:yC,TrianglesDrawMode:RB,TubeGeometry:UT,UVMapping:Td,Uint16BufferAttribute:pT,Uint32BufferAttribute:mT,Uint8BufferAttribute:$z,Uint8ClampedBufferAttribute:Kz,Uniform:SV,UniformsGroup:AV,UniformsLib:Wt,UniformsUtils:eV,UnsignedByteType:ss,UnsignedInt101111Type:sv,UnsignedInt248Type:Co,UnsignedInt5999Type:iv,UnsignedIntType:Xi,UnsignedShort4444Type:tv,UnsignedShort5551Type:nv,UnsignedShortType:Tl,VSMShadowMap:Fa,Vector2:Ze,Vector3:Q,Vector4:mn,VectorKeyframeTrack:Hf,VideoFrameTexture:nV,VideoTexture:JB,WebGL3DRenderTarget:qz,WebGLArrayRenderTarget:Xz,WebGLCoordinateSystem:oa,WebGLCubeRenderTarget:gT,WebGLRenderTarget:Bl,WebGLRenderer:SU,WebGLUtils:Jk,WebGPUCoordinateSystem:Nl,WebXRController:Ry,WireframeGeometry:rD,WrapAroundEnding:Gy,ZeroCurvatureEnding:sp,ZeroFactor:nu,ZeroSlopeEnding:rp,ZeroStencilOp:BB,createCanvasElement:_C,error:nt,getConsoleFunction:Wz,log:i0,setConsoleFunction:kz,warn:De,warnOnce:qi},Symbol.toStringTag,{value:"Module"}));var i2={exports:{}},s2={},r2={exports:{}},a2={};var o4;function _ce(){if(o4)return a2;o4=1;var i=Qy();function e(p,x){return p===x&&(p!==0||1/p===1/x)||p!==p&&x!==x}var t=typeof Object.is=="function"?Object.is:e,n=i.useState,s=i.useEffect,r=i.useLayoutEffect,a=i.useDebugValue;function o(p,x){var y=x(),_=n({inst:{value:y,getSnapshot:x}}),T=_[0].inst,A=_[1];return r(function(){T.value=y,T.getSnapshot=x,l(T)&&A({inst:T})},[p,y,x]),s(function(){return l(T)&&A({inst:T}),p(function(){l(T)&&A({inst:T})})},[p]),a(y),y}function l(p){var x=p.getSnapshot;p=p.value;try{var y=x();return!t(p,y)}catch{return!0}}function u(p,x){return x()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return a2.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:f,a2}var l4;function bce(){return l4||(l4=1,r2.exports=_ce()),r2.exports}var c4;function Sce(){if(c4)return s2;c4=1;var i=Qy(),e=bce();function t(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var n=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,r=i.useRef,a=i.useEffect,o=i.useMemo,l=i.useDebugValue;return s2.useSyncExternalStoreWithSelector=function(u,f,p,x,y){var _=r(null);if(_.current===null){var T={hasValue:!1,value:null};_.current=T}else T=_.current;_=o(function(){function S(D){if(!C){if(C=!0,w=D,D=x(D),y!==void 0&&T.hasValue){var O=T.value;if(y(O,D))return B=O}return B=D}if(O=B,n(w,D))return O;var F=x(D);return y!==void 0&&y(O,F)?(w=D,O):(w=D,B=F)}var C=!1,w,B,L=p===void 0?null:p;return[function(){return S(f())},L===null?void 0:function(){return S(L())}]},[f,p,x,y]);var A=s(u,_[0],_[1]);return a(function(){T.hasValue=!0,T.value=A},[A]),l(A),A},s2}var u4;function Tce(){return u4||(u4=1,i2.exports=Sce()),i2.exports}var Ace=Tce();const Ece=$p(Ace),d4=i=>{let e;const t=new Set,n=(u,f)=>{const p=typeof u=="function"?u(e):u;if(!Object.is(p,e)){const x=e;e=f??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(y=>y(e,x))}},s=()=>e,o={setState:n,getState:s,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=i(n,s,o);return o},Zk=(i=>i?d4(i):d4),{useSyncExternalStoreWithSelector:Mce}=Ece,Cce=i=>i;function Rce(i,e=Cce,t){const n=Mce(i.subscribe,i.getState,i.getInitialState,e,t);return ue.useDebugValue(n),n}const f4=(i,e)=>{const t=Zk(i),n=(s,r=e)=>Rce(t,s,r);return Object.assign(n,t),n},Qk=((i,e)=>i?f4(i,e):f4),wce=i=>typeof i=="object"&&typeof i.then=="function",Ng=[];function e7(i,e,t=(n,s)=>n===s){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let s=0;s<n;s++)if(!t(i[s],e[s]))return!1;return!0}function t7(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const r of Ng)if(e7(e,r.keys,r.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response"))return n.lifespan&&n.lifespan>0&&(r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(r.remove,n.lifespan)),r.response;if(!t)throw r.promise}const s={keys:e,equal:n.equal,remove:()=>{const r=Ng.indexOf(s);r!==-1&&Ng.splice(r,1)},promise:(wce(i)?i:i(...e)).then(r=>{s.response=r,n.lifespan&&n.lifespan>0&&(s.timeout=setTimeout(s.remove,n.lifespan))}).catch(r=>s.error=r)};if(Ng.push(s),!t)throw s.promise}const Nce=(i,e,t)=>t7(i,e,!1,t),Bce=(i,e,t)=>void t7(i,e,!0,t),Dce=i=>{if(i===void 0||i.length===0)Ng.splice(0,Ng.length);else{const e=Ng.find(t=>e7(i,t.keys,t.equal));e&&e.remove()}};var o2={exports:{}},l2={exports:{}},c2={exports:{}},u2={};var h4;function Oce(){return h4||(h4=1,(function(i){function e(W,ne){var se=W.length;W.push(ne);e:for(;0<se;){var ge=se-1>>>1,_e=W[ge];if(0<s(_e,ne))W[ge]=ne,W[se]=_e,se=ge;else break e}}function t(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var ne=W[0],se=W.pop();if(se!==ne){W[0]=se;e:for(var ge=0,_e=W.length,K=_e>>>1;ge<K;){var pe=2*(ge+1)-1,we=W[pe],Ne=pe+1,gt=W[Ne];if(0>s(we,se))Ne<_e&&0>s(gt,we)?(W[ge]=gt,W[Ne]=se,ge=Ne):(W[ge]=we,W[pe]=se,ge=pe);else if(Ne<_e&&0>s(gt,se))W[ge]=gt,W[Ne]=se,ge=Ne;else break e}}return ne}function s(W,ne){var se=W.sortIndex-ne.sortIndex;return se!==0?se:W.id-ne.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],u=[],f=1,p=null,x=3,y=!1,_=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function w(W){for(var ne=t(u);ne!==null;){if(ne.callback===null)n(u);else if(ne.startTime<=W)n(u),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=t(u)}}function B(W){if(T=!1,w(W),!_)if(t(l)!==null)_=!0,te();else{var ne=t(u);ne!==null&&re(B,ne.startTime-W)}}var L=!1,D=-1,O=5,F=-1;function U(){return!(i.unstable_now()-F<O)}function P(){if(L){var W=i.unstable_now();F=W;var ne=!0;try{e:{_=!1,T&&(T=!1,S(D),D=-1),y=!0;var se=x;try{t:{for(w(W),p=t(l);p!==null&&!(p.expirationTime>W&&U());){var ge=p.callback;if(typeof ge=="function"){p.callback=null,x=p.priorityLevel;var _e=ge(p.expirationTime<=W);if(W=i.unstable_now(),typeof _e=="function"){p.callback=_e,w(W),ne=!0;break t}p===t(l)&&n(l),w(W)}else n(l);p=t(l)}if(p!==null)ne=!0;else{var K=t(u);K!==null&&re(B,K.startTime-W),ne=!1}}break e}finally{p=null,x=se,y=!1}ne=void 0}}finally{ne?X():L=!1}}}var X;if(typeof C=="function")X=function(){C(P)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ee=Z.port2;Z.port1.onmessage=P,X=function(){ee.postMessage(null)}}else X=function(){A(P,0)};function te(){L||(L=!0,X())}function re(W,ne){D=A(function(){W(i.unstable_now())},ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(W){W.callback=null},i.unstable_continueExecution=function(){_||y||(_=!0,te())},i.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<W?Math.floor(1e3/W):5},i.unstable_getCurrentPriorityLevel=function(){return x},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(W){switch(x){case 1:case 2:case 3:var ne=3;break;default:ne=x}var se=x;x=ne;try{return W()}finally{x=se}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(W,ne){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var se=x;x=W;try{return ne()}finally{x=se}},i.unstable_scheduleCallback=function(W,ne,se){var ge=i.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ge+se:ge):se=ge,W){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=se+_e,W={id:f++,callback:ne,priorityLevel:W,startTime:se,expirationTime:_e,sortIndex:-1},se>ge?(W.sortIndex=se,e(u,W),t(l)===null&&W===t(u)&&(T?(S(D),D=-1):T=!0,re(B,se-ge))):(W.sortIndex=_e,e(l,W),_||y||(_=!0,te())),W},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(W){var ne=x;return function(){var se=x;x=ne;try{return W.apply(this,arguments)}finally{x=se}}}})(u2)),u2}var p4;function n7(){return p4||(p4=1,c2.exports=Oce()),c2.exports}var m4;function Uce(){return m4||(m4=1,(function(i){i.exports=function(e){function t(h,m,b,M){return new o_(h,m,b,M)}function n(){}function s(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)m+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(h){return h===null||typeof h!="object"?null:(h=p_&&h[p_]||h["@@iterator"],typeof h=="function"?h:null)}function a(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===$d?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case _h:return"Fragment";case ol:return"Portal";case h_:return"Profiler";case f_:return"StrictMode";case Z0:return"Suspense";case Iu:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case Xl:return(h.displayName||"Context")+".Provider";case Lu:return(h._context.displayName||"Context")+".Consumer";case bh:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case wm:return m=h.displayName||null,m!==null?m:a(h.type)||"Memo";case ll:m=h._payload,h=h._init;try{return a(h(m))}catch{}}return null}function o(h){if(Q0===void 0)try{throw Error()}catch(b){var m=b.stack.trim().match(/\n( *(at )?)/);Q0=m&&m[1]||"",m_=-1<b.stack.indexOf(`
    at`)?" (<anonymous>)":-1<b.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Q0+h+m_}function l(h,m){if(!h||Pu)return"";Pu=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var M={DetermineComponentFrameRoot:function(){try{if(m){var kt=function(){throw Error()};if(Object.defineProperty(kt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(kt,[])}catch(zn){var Zt=zn}Reflect.construct(h,[],kt)}else{try{kt.call()}catch(zn){Zt=zn}h.call(kt.prototype)}}else{try{throw Error()}catch(zn){Zt=zn}(kt=h())&&typeof kt.catch=="function"&&kt.catch(function(){})}}catch(zn){if(zn&&Zt&&typeof zn.stack=="string")return[zn.stack,Zt.stack]}return[null,null]}};M.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(M.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(M.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=M.DetermineComponentFrameRoot(),$=I[0],fe=I[1];if($&&fe){var Ce=$.split(`
`),rt=fe.split(`
`);for(N=M=0;M<Ce.length&&!Ce[M].includes("DetermineComponentFrameRoot");)M++;for(;N<rt.length&&!rt[N].includes("DetermineComponentFrameRoot");)N++;if(M===Ce.length||N===rt.length)for(M=Ce.length-1,N=rt.length-1;1<=M&&0<=N&&Ce[M]!==rt[N];)N--;for(;1<=M&&0<=N;M--,N--)if(Ce[M]!==rt[N]){if(M!==1||N!==1)do if(M--,N--,0>N||Ce[M]!==rt[N]){var Ct=`
`+Ce[M].replace(" at new "," at ");return h.displayName&&Ct.includes("<anonymous>")&&(Ct=Ct.replace("<anonymous>",h.displayName)),Ct}while(1<=M&&0<=N);break}}}finally{Pu=!1,Error.prepareStackTrace=b}return(b=h?h.displayName||h.name:"")?o(b):""}function u(h){switch(h.tag){case 26:case 27:case 5:return o(h.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return h=l(h.type,!1),h;case 11:return h=l(h.type.render,!1),h;case 1:return h=l(h.type,!0),h;default:return""}}function f(h){try{var m="";do m+=u(h),h=h.return;while(h);return m}catch(b){return`
Error generating stack: `+b.message+`
`+b.stack}}function p(h){var m=h,b=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(b=m.return),h=m.return;while(h)}return m.tag===3?b:null}function x(h){if(p(h)!==h)throw Error(s(188))}function y(h){var m=h.alternate;if(!m){if(m=p(h),m===null)throw Error(s(188));return m!==h?null:h}for(var b=h,M=m;;){var N=b.return;if(N===null)break;var I=N.alternate;if(I===null){if(M=N.return,M!==null){b=M;continue}break}if(N.child===I.child){for(I=N.child;I;){if(I===b)return x(N),h;if(I===M)return x(N),m;I=I.sibling}throw Error(s(188))}if(b.return!==M.return)b=N,M=I;else{for(var $=!1,fe=N.child;fe;){if(fe===b){$=!0,b=N,M=I;break}if(fe===M){$=!0,M=N,b=I;break}fe=fe.sibling}if(!$){for(fe=I.child;fe;){if(fe===b){$=!0,b=I,M=N;break}if(fe===M){$=!0,M=I,b=N;break}fe=fe.sibling}if(!$)throw Error(s(189))}}if(b.alternate!==M)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?h:m}function _(h){var m=h.tag;if(m===5||m===26||m===27||m===6)return h;for(h=h.child;h!==null;){if(m=_(h),m!==null)return m;h=h.sibling}return null}function T(h){var m=h.tag;if(m===5||m===26||m===27||m===6)return h;for(h=h.child;h!==null;){if(h.tag!==4&&(m=T(h),m!==null))return m;h=h.sibling}return null}function A(h){return{current:h}}function S(h){0>zc||(h.current=Fm[zc],Fm[zc]=null,zc--)}function C(h,m){zc++,Fm[zc]=h.current,h.current=m}function w(h){return h>>>=0,h===0?32:31-(Gm(h)/n1|0)|0}function B(h){var m=h&42;if(m!==0)return m;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function L(h,m){var b=h.pendingLanes;if(b===0)return 0;var M=0,N=h.suspendedLanes,I=h.pingedLanes,$=h.warmLanes;h=h.finishedLanes!==0;var fe=b&134217727;return fe!==0?(b=fe&~N,b!==0?M=B(b):(I&=fe,I!==0?M=B(I):h||($=fe&~$,$!==0&&(M=B($))))):(fe=b&~N,fe!==0?M=B(fe):I!==0?M=B(I):h||($=b&~$,$!==0&&(M=B($)))),M===0?0:m!==0&&m!==M&&(m&N)===0&&(N=M&-M,$=m&-m,N>=$||N===32&&($&4194176)!==0)?m:M}function D(h,m){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&m)===0}function O(h,m){switch(h){case 1:case 2:case 4:case 8:return m+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function F(){var h=Eh;return Eh<<=1,(Eh&4194176)===0&&(Eh=128),h}function U(){var h=zm;return zm<<=1,(zm&62914560)===0&&(zm=4194304),h}function P(h){for(var m=[],b=0;31>b;b++)m.push(h);return m}function X(h,m){h.pendingLanes|=m,m!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function Z(h,m,b,M,N,I){var $=h.pendingLanes;h.pendingLanes=b,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=b,h.entangledLanes&=b,h.errorRecoveryDisabledLanes&=b,h.shellSuspendCounter=0;var fe=h.entanglements,Ce=h.expirationTimes,rt=h.hiddenUpdates;for(b=$&~b;0<b;){var Ct=31-Ca(b),kt=1<<Ct;fe[Ct]=0,Ce[Ct]=-1;var Zt=rt[Ct];if(Zt!==null)for(rt[Ct]=null,Ct=0;Ct<Zt.length;Ct++){var zn=Zt[Ct];zn!==null&&(zn.lane&=-536870913)}b&=~kt}M!==0&&ee(h,M,0),I!==0&&N===0&&h.tag!==0&&(h.suspendedLanes|=I&~($&~m))}function ee(h,m,b){h.pendingLanes|=m,h.suspendedLanes&=~m;var M=31-Ca(m);h.entangledLanes|=m,h.entanglements[M]=h.entanglements[M]|1073741824|b&4194218}function te(h,m){var b=h.entangledLanes|=m;for(h=h.entanglements;b;){var M=31-Ca(b),N=1<<M;N&m|h[M]&m&&(h[M]|=m),b&=~N}}function re(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function W(h){if(Ra&&typeof Ra.onCommitFiberRoot=="function")try{Ra.onCommitFiberRoot(Ch,h,void 0,(h.current.flags&128)===128)}catch{}}function ne(h){if(typeof a1=="function"&&q_(h),Ra&&typeof Ra.setStrictMode=="function")try{Ra.setStrictMode(Ch,h)}catch{}}function se(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}function ge(h,m){if(typeof h=="object"&&h!==null){var b=gx.get(h);return b!==void 0?b:(m={value:h,source:m,stack:f(m)},gx.set(h,m),m)}return{value:h,source:m,stack:f(m)}}function _e(h,m){ms[Ds++]=km,ms[Ds++]=Hm,Hm=h,km=m}function K(h,m,b){to[no++]=Kl,to[no++]=Fo,to[no++]=cl,cl=h;var M=Kl;h=Fo;var N=32-Ca(M)-1;M&=~(1<<N),b+=1;var I=32-Ca(m)+N;if(30<I){var $=N-N%5;I=(M&(1<<$)-1).toString(32),M>>=$,N-=$,Kl=1<<32-Ca(m)+N|b<<N|M,Fo=I+h}else Kl=1<<I|b<<N|M,Fo=h}function pe(h){h.return!==null&&(_e(h,1),K(h,1,0))}function we(h){for(;h===Hm;)Hm=ms[--Ds],ms[Ds]=null,km=ms[--Ds],ms[Ds]=null;for(;h===cl;)cl=to[--no],to[no]=null,Fo=to[--no],to[no]=null,Kl=to[--no],to[no]=null}function Ne(h,m){C(ul,m),C(Wm,h),C(Sr,null),h=Kd(m),S(Sr),C(Sr,h)}function gt(){S(Sr),S(Wm),S(ul)}function Se(h){h.memoizedState!==null&&C(Rh,h);var m=Sr.current,b=LA(m,h.type);m!==b&&(C(Wm,h),C(Sr,b))}function Be(h){Wm.current===h&&(S(Sr),S(Wm)),Rh.current===h&&(S(Rh),Yl?On._currentValue=Ma:On._currentValue2=Ma)}function ct(h){var m=Error(s(418,""));throw Gt(ge(m,h)),Xm}function Dt(h,m){if(!pa)throw Error(s(175));eR(h.stateNode,h.type,h.memoizedProps,m,h)||ct(h)}function Nt(h){for(Qr=h.return;Qr;)switch(Qr.tag){case 3:case 27:Go=!0;return;case 5:case 13:Go=!1;return;default:Qr=Qr.return}}function It(h){if(!pa||h!==Qr)return!1;if(!Mi)return Nt(h),Mi=!0,!1;var m=!1;if(Lr?h.tag!==3&&h.tag!==27&&(h.tag!==5||JA(h.type)&&!zu(h.type,h.memoizedProps))&&(m=!0):h.tag!==3&&(h.tag!==5||JA(h.type)&&!zu(h.type,h.memoizedProps))&&(m=!0),m&&Pr&&ct(h),Nt(h),h.tag===13){if(!pa)throw Error(s(316));if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(s(317));Pr=$A(h)}else Pr=Qr?O_(h.stateNode):null;return!0}function Mn(){pa&&(Pr=Qr=null,Mi=!1)}function Gt(h){io===null?io=[h]:io.push(h)}function Qe(){for(var h=Hu,m=wh=Hu=0;m<h;){var b=so[m];so[m++]=null;var M=so[m];so[m++]=null;var N=so[m];so[m++]=null;var I=so[m];if(so[m++]=null,M!==null&&N!==null){var $=M.pending;$===null?N.next=N:(N.next=$.next,$.next=N),M.pending=N}I!==0&&Tt(b,N,I)}}function ie(h,m,b,M){so[Hu++]=h,so[Hu++]=m,so[Hu++]=b,so[Hu++]=M,wh|=M,h.lanes|=M,h=h.alternate,h!==null&&(h.lanes|=M)}function ot(h,m,b,M){return ie(h,m,b,M),ht(h)}function dt(h,m){return ie(h,null,null,m),ht(h)}function Tt(h,m,b){h.lanes|=b;var M=h.alternate;M!==null&&(M.lanes|=b);for(var N=!1,I=h.return;I!==null;)I.childLanes|=b,M=I.alternate,M!==null&&(M.childLanes|=b),I.tag===22&&(h=I.stateNode,h===null||h._visibility&1||(N=!0)),h=I,I=I.return;N&&m!==null&&h.tag===3&&(I=h.stateNode,N=31-Ca(b),I=I.hiddenUpdates,h=I[N],h===null?I[N]=[m]:h.push(m),m.lane=b|536870912)}function ht(h){if(50<lf)throw lf=0,xa=null,Error(s(185));for(var m=h.return;m!==null;)h=m,m=h.return;return h.tag===3?h.stateNode:null}function Ut(h){h!==ef&&h.next===null&&(ef===null?Nh=ef=h:ef=ef.next=h),Ym=!0,qm||(qm=!0,Ge(Ht))}function At(h,m){if(!dl&&Ym){dl=!0;do for(var b=!1,M=Nh;M!==null;){if(h!==0){var N=M.pendingLanes;if(N===0)var I=0;else{var $=M.suspendedLanes,fe=M.pingedLanes;I=(1<<31-Ca(42|h)+1)-1,I&=N&~($&~fe),I=I&201326677?I&201326677|1:I?I|2:0}I!==0&&(b=!0,Te(M,I))}else I=Jn,I=L(M,M===ti?I:0),(I&3)===0||D(M,I)||(b=!0,Te(M,I));M=M.next}while(b);dl=!1}}function Ht(){Ym=qm=!1;var h=0;ku!==0&&(Vu()&&(h=ku),ku=0);for(var m=Ir(),b=null,M=Nh;M!==null;){var N=M.next,I=q(M,m);I===0?(M.next=null,b===null?Nh=N:b.next=N,N===null&&(ef=b)):(b=M,(h!==0||(I&3)!==0)&&(Ym=!0)),M=N}At(h)}function q(h,m){for(var b=h.suspendedLanes,M=h.pingedLanes,N=h.expirationTimes,I=h.pendingLanes&-62914561;0<I;){var $=31-Ca(I),fe=1<<$,Ce=N[$];Ce===-1?((fe&b)===0||(fe&M)!==0)&&(N[$]=O(fe,m)):Ce<=m&&(h.expiredLanes|=fe),I&=~fe}if(m=ti,b=Jn,b=L(h,h===m?b:0),M=h.callbackNode,b===0||h===m&&Ji===2||h.cancelPendingCommit!==null)return M!==null&&M!==null&&Vm(M),h.callbackNode=null,h.callbackPriority=0;if((b&3)===0||D(h,b)){if(m=b&-b,m===h.callbackPriority)return m;switch(M!==null&&Vm(M),re(b)){case 2:case 8:b=r1;break;case 32:b=px;break;case 268435456:b=mx;break;default:b=px}return M=V.bind(null,h),b=Mh(b,M),h.callbackPriority=m,h.callbackNode=b,m}return M!==null&&M!==null&&Vm(M),h.callbackPriority=2,h.callbackNode=null,2}function V(h,m){var b=h.callbackNode;if(_r()&&h.callbackNode!==b)return null;var M=Jn;return M=L(h,h===ti?M:0),M===0?null:(Am(h,M,m),q(h,Ir()),h.callbackNode!=null&&h.callbackNode===b?V.bind(null,h):null)}function Te(h,m){if(_r())return null;Am(h,m,!0)}function Ge(h){Ks?ix(function(){(_n&6)!==0?Mh(X_,h):h()}):Mh(X_,h)}function $e(){return ku===0&&(ku=F()),ku}function Ve(h,m){if(jm===null){var b=jm=[];xx=0,wa=$e(),Wu={status:"pending",value:void 0,then:function(M){b.push(M)}}}return xx++,m.then(Xt,Xt),m}function Xt(){if(--xx===0&&jm!==null){Wu!==null&&(Wu.status="fulfilled");var h=jm;jm=null,wa=0,Wu=null;for(var m=0;m<h.length;m++)(0,h[m])()}}function Ot(h,m){var b=[],M={status:"pending",value:null,reason:null,then:function(N){b.push(N)}};return h.then(function(){M.status="fulfilled",M.value=m;for(var N=0;N<b.length;N++)(0,b[N])(m)},function(N){for(M.status="rejected",M.reason=N,N=0;N<b.length;N++)(0,b[N])(void 0)}),M}function cn(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qt(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function et(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function st(h,m,b){var M=h.updateQueue;if(M===null)return null;if(M=M.shared,(_n&2)!==0){var N=M.pending;return N===null?m.next=m:(m.next=N.next,N.next=m),M.pending=m,m=ht(h),Tt(h,null,b),m}return ie(h,M,m,b),ht(h)}function nn(h,m,b){if(m=m.updateQueue,m!==null&&(m=m.shared,(b&4194176)!==0)){var M=m.lanes;M&=h.pendingLanes,b|=M,m.lanes=b,te(h,b)}}function zt(h,m){var b=h.updateQueue,M=h.alternate;if(M!==null&&(M=M.updateQueue,b===M)){var N=null,I=null;if(b=b.firstBaseUpdate,b!==null){do{var $={lane:b.lane,tag:b.tag,payload:b.payload,callback:null,next:null};I===null?N=I=$:I=I.next=$,b=b.next}while(b!==null);I===null?N=I=m:I=I.next=m}else N=I=m;b={baseState:M.baseState,firstBaseUpdate:N,lastBaseUpdate:I,shared:M.shared,callbacks:M.callbacks},h.updateQueue=b;return}h=b.lastBaseUpdate,h===null?b.firstBaseUpdate=m:h.next=m,b.lastBaseUpdate=m}function Mt(){if(Bh){var h=Wu;if(h!==null)throw h}}function Kt(h,m,b,M){Bh=!1;var N=h.updateQueue;Vc=!1;var I=N.firstBaseUpdate,$=N.lastBaseUpdate,fe=N.shared.pending;if(fe!==null){N.shared.pending=null;var Ce=fe,rt=Ce.next;Ce.next=null,$===null?I=rt:$.next=rt,$=Ce;var Ct=h.alternate;Ct!==null&&(Ct=Ct.updateQueue,fe=Ct.lastBaseUpdate,fe!==$&&(fe===null?Ct.firstBaseUpdate=rt:fe.next=rt,Ct.lastBaseUpdate=Ce))}if(I!==null){var kt=N.baseState;$=0,Ct=rt=Ce=null,fe=I;do{var Zt=fe.lane&-536870913,zn=Zt!==fe.lane;if(zn?(Jn&Zt)===Zt:(M&Zt)===Zt){Zt!==0&&Zt===wa&&(Bh=!0),Ct!==null&&(Ct=Ct.next={lane:0,tag:fe.tag,payload:fe.payload,callback:null,next:null});e:{var Oa=h,Zm=fe;Zt=m;var cf=b;switch(Zm.tag){case 1:if(Oa=Zm.payload,typeof Oa=="function"){kt=Oa.call(cf,kt,Zt);break e}kt=Oa;break e;case 3:Oa.flags=Oa.flags&-65537|128;case 0:if(Oa=Zm.payload,Zt=typeof Oa=="function"?Oa.call(cf,kt,Zt):Oa,Zt==null)break e;kt=jd({},kt,Zt);break e;case 2:Vc=!0}}Zt=fe.callback,Zt!==null&&(h.flags|=64,zn&&(h.flags|=8192),zn=N.callbacks,zn===null?N.callbacks=[Zt]:zn.push(Zt))}else zn={lane:Zt,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null},Ct===null?(rt=Ct=zn,Ce=kt):Ct=Ct.next=zn,$|=Zt;if(fe=fe.next,fe===null){if(fe=N.shared.pending,fe===null)break;zn=fe,fe=zn.next,zn.next=null,N.lastBaseUpdate=zn,N.shared.pending=null}}while(!0);Ct===null&&(Ce=kt),N.baseState=Ce,N.firstBaseUpdate=rt,N.lastBaseUpdate=Ct,I===null&&(N.shared.lanes=0),lo|=$,h.lanes=$,h.memoizedState=kt}}function ve(h,m){if(typeof h!="function")throw Error(s(191,h));h.call(m)}function ze(h,m){var b=h.callbacks;if(b!==null)for(h.callbacks=null,h=0;h<b.length;h++)ve(b[h],m)}function Et(h,m){if(eo(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var b=Object.keys(h),M=Object.keys(m);if(b.length!==M.length)return!1;for(M=0;M<b.length;M++){var N=b[M];if(!$m.call(m,N)||!eo(h[N],m[N]))return!1}return!0}function wt(h){return h=h.status,h==="fulfilled"||h==="rejected"}function pt(){}function lt(h,m,b){switch(b=h[b],b===void 0?h.push(m):b!==m&&(m.then(pt,pt),m=b),m.status){case"fulfilled":return m.value;case"rejected":throw h=m.reason,h===ki?Error(s(483)):h;default:if(typeof m.status=="string")m.then(pt,pt);else{if(h=ti,h!==null&&100<h.shellSuspendCounter)throw Error(s(482));h=m,h.status="pending",h.then(function(M){if(m.status==="pending"){var N=m;N.status="fulfilled",N.value=M}},function(M){if(m.status==="pending"){var N=m;N.status="rejected",N.reason=M}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw h=m.reason,h===ki?Error(s(483)):h}throw tf=m,ki}}function en(){if(tf===null)throw Error(s(459));var h=tf;return tf=null,h}function Tn(h){var m=zo;return zo+=1,Jl===null&&(Jl=[]),lt(Jl,h,m)}function gi(h,m){m=m.props.ref,h.ref=m!==void 0?m:null}function ni(h,m){throw m.$$typeof===d_?Error(s(525)):(h=Object.prototype.toString.call(m),Error(s(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h)))}function rr(h){var m=h._init;return m(h._payload)}function Yr(h){function m(Le,Ee){if(h){var He=Le.deletions;He===null?(Le.deletions=[Ee],Le.flags|=16):He.push(Ee)}}function b(Le,Ee){if(!h)return null;for(;Ee!==null;)m(Le,Ee),Ee=Ee.sibling;return null}function M(Le){for(var Ee=new Map;Le!==null;)Le.key!==null?Ee.set(Le.key,Le):Ee.set(Le.index,Le),Le=Le.sibling;return Ee}function N(Le,Ee){return Le=Jr(Le,Ee),Le.index=0,Le.sibling=null,Le}function I(Le,Ee,He){return Le.index=He,h?(He=Le.alternate,He!==null?(He=He.index,He<Ee?(Le.flags|=33554434,Ee):He):(Le.flags|=33554434,Ee)):(Le.flags|=1048576,Ee)}function $(Le){return h&&Le.alternate===null&&(Le.flags|=33554434),Le}function fe(Le,Ee,He,_t){return Ee===null||Ee.tag!==6?(Ee=Uu(He,Le.mode,_t),Ee.return=Le,Ee):(Ee=N(Ee,He),Ee.return=Le,Ee)}function Ce(Le,Ee,He,_t){var gn=He.type;return gn===_h?Ct(Le,Ee,He.props.children,_t,He.key):Ee!==null&&(Ee.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===ll&&rr(gn)===Ee.type)?(Ee=N(Ee,He.props),gi(Ee,He),Ee.return=Le,Ee):(Ee=Io(He.type,He.key,He.props,null,Le.mode,_t),gi(Ee,He),Ee.return=Le,Ee)}function rt(Le,Ee,He,_t){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==He.containerInfo||Ee.stateNode.implementation!==He.implementation?(Ee=vh(He,Le.mode,_t),Ee.return=Le,Ee):(Ee=N(Ee,He.children||[]),Ee.return=Le,Ee)}function Ct(Le,Ee,He,_t,gn){return Ee===null||Ee.tag!==7?(Ee=Lc(He,Le.mode,_t,gn),Ee.return=Le,Ee):(Ee=N(Ee,He),Ee.return=Le,Ee)}function kt(Le,Ee,He){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return Ee=Uu(""+Ee,Le.mode,He),Ee.return=Le,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Ic:return He=Io(Ee.type,Ee.key,Ee.props,null,Le.mode,He),gi(He,Ee),He.return=Le,He;case ol:return Ee=vh(Ee,Le.mode,He),Ee.return=Le,Ee;case ll:var _t=Ee._init;return Ee=_t(Ee._payload),kt(Le,Ee,He)}if(Fu(Ee)||r(Ee))return Ee=Lc(Ee,Le.mode,He,null),Ee.return=Le,Ee;if(typeof Ee.then=="function")return kt(Le,Tn(Ee),He);if(Ee.$$typeof===Xl)return kt(Le,vm(Le,Ee),He);ni(Le,Ee)}return null}function Zt(Le,Ee,He,_t){var gn=Ee!==null?Ee.key:null;if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return gn!==null?null:fe(Le,Ee,""+He,_t);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case Ic:return He.key===gn?Ce(Le,Ee,He,_t):null;case ol:return He.key===gn?rt(Le,Ee,He,_t):null;case ll:return gn=He._init,He=gn(He._payload),Zt(Le,Ee,He,_t)}if(Fu(He)||r(He))return gn!==null?null:Ct(Le,Ee,He,_t,null);if(typeof He.then=="function")return Zt(Le,Ee,Tn(He),_t);if(He.$$typeof===Xl)return Zt(Le,Ee,vm(Le,He),_t);ni(Le,He)}return null}function zn(Le,Ee,He,_t,gn){if(typeof _t=="string"&&_t!==""||typeof _t=="number"||typeof _t=="bigint")return Le=Le.get(He)||null,fe(Ee,Le,""+_t,gn);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case Ic:return Le=Le.get(_t.key===null?He:_t.key)||null,Ce(Ee,Le,_t,gn);case ol:return Le=Le.get(_t.key===null?He:_t.key)||null,rt(Ee,Le,_t,gn);case ll:var as=_t._init;return _t=as(_t._payload),zn(Le,Ee,He,_t,gn)}if(Fu(_t)||r(_t))return Le=Le.get(He)||null,Ct(Ee,Le,_t,gn,null);if(typeof _t.then=="function")return zn(Le,Ee,He,Tn(_t),gn);if(_t.$$typeof===Xl)return zn(Le,Ee,He,vm(Ee,_t),gn);ni(Ee,_t)}return null}function Oa(Le,Ee,He,_t){for(var gn=null,as=null,Un=Ee,Ri=Ee=0,ur=null;Un!==null&&Ri<He.length;Ri++){Un.index>Ri?(ur=Un,Un=null):ur=Un.sibling;var wi=Zt(Le,Un,He[Ri],_t);if(wi===null){Un===null&&(Un=ur);break}h&&Un&&wi.alternate===null&&m(Le,Un),Ee=I(wi,Ee,Ri),as===null?gn=wi:as.sibling=wi,as=wi,Un=ur}if(Ri===He.length)return b(Le,Un),Mi&&_e(Le,Ri),gn;if(Un===null){for(;Ri<He.length;Ri++)Un=kt(Le,He[Ri],_t),Un!==null&&(Ee=I(Un,Ee,Ri),as===null?gn=Un:as.sibling=Un,as=Un);return Mi&&_e(Le,Ri),gn}for(Un=M(Un);Ri<He.length;Ri++)ur=zn(Un,Le,Ri,He[Ri],_t),ur!==null&&(h&&ur.alternate!==null&&Un.delete(ur.key===null?Ri:ur.key),Ee=I(ur,Ee,Ri),as===null?gn=ur:as.sibling=ur,as=ur);return h&&Un.forEach(function(jc){return m(Le,jc)}),Mi&&_e(Le,Ri),gn}function Zm(Le,Ee,He,_t){if(He==null)throw Error(s(151));for(var gn=null,as=null,Un=Ee,Ri=Ee=0,ur=null,wi=He.next();Un!==null&&!wi.done;Ri++,wi=He.next()){Un.index>Ri?(ur=Un,Un=null):ur=Un.sibling;var jc=Zt(Le,Un,wi.value,_t);if(jc===null){Un===null&&(Un=ur);break}h&&Un&&jc.alternate===null&&m(Le,Un),Ee=I(jc,Ee,Ri),as===null?gn=jc:as.sibling=jc,as=jc,Un=ur}if(wi.done)return b(Le,Un),Mi&&_e(Le,Ri),gn;if(Un===null){for(;!wi.done;Ri++,wi=He.next())wi=kt(Le,wi.value,_t),wi!==null&&(Ee=I(wi,Ee,Ri),as===null?gn=wi:as.sibling=wi,as=wi);return Mi&&_e(Le,Ri),gn}for(Un=M(Un);!wi.done;Ri++,wi=He.next())wi=zn(Un,Le,Ri,wi.value,_t),wi!==null&&(h&&wi.alternate!==null&&Un.delete(wi.key===null?Ri:wi.key),Ee=I(wi,Ee,Ri),as===null?gn=wi:as.sibling=wi,as=wi);return h&&Un.forEach(function(Mx){return m(Le,Mx)}),Mi&&_e(Le,Ri),gn}function cf(Le,Ee,He,_t){if(typeof He=="object"&&He!==null&&He.type===_h&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case Ic:e:{for(var gn=He.key;Ee!==null;){if(Ee.key===gn){if(gn=He.type,gn===_h){if(Ee.tag===7){b(Le,Ee.sibling),_t=N(Ee,He.props.children),_t.return=Le,Le=_t;break e}}else if(Ee.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===ll&&rr(gn)===Ee.type){b(Le,Ee.sibling),_t=N(Ee,He.props),gi(_t,He),_t.return=Le,Le=_t;break e}b(Le,Ee);break}else m(Le,Ee);Ee=Ee.sibling}He.type===_h?(_t=Lc(He.props.children,Le.mode,_t,He.key),_t.return=Le,Le=_t):(_t=Io(He.type,He.key,He.props,null,Le.mode,_t),gi(_t,He),_t.return=Le,Le=_t)}return $(Le);case ol:e:{for(gn=He.key;Ee!==null;){if(Ee.key===gn)if(Ee.tag===4&&Ee.stateNode.containerInfo===He.containerInfo&&Ee.stateNode.implementation===He.implementation){b(Le,Ee.sibling),_t=N(Ee,He.children||[]),_t.return=Le,Le=_t;break e}else{b(Le,Ee);break}else m(Le,Ee);Ee=Ee.sibling}_t=vh(He,Le.mode,_t),_t.return=Le,Le=_t}return $(Le);case ll:return gn=He._init,He=gn(He._payload),cf(Le,Ee,He,_t)}if(Fu(He))return Oa(Le,Ee,He,_t);if(r(He)){if(gn=r(He),typeof gn!="function")throw Error(s(150));return He=gn.call(He),Zm(Le,Ee,He,_t)}if(typeof He.then=="function")return cf(Le,Ee,Tn(He),_t);if(He.$$typeof===Xl)return cf(Le,Ee,vm(Le,He),_t);ni(Le,He)}return typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint"?(He=""+He,Ee!==null&&Ee.tag===6?(b(Le,Ee.sibling),_t=N(Ee,He),_t.return=Le,Le=_t):(b(Le,Ee),_t=Uu(He,Le.mode,_t),_t.return=Le,Le=_t),$(Le)):b(Le,Ee)}return function(Le,Ee,He,_t){try{zo=0;var gn=cf(Le,Ee,He,_t);return Jl=null,gn}catch(Un){if(Un===ki)throw Un;var as=t(29,Un,null,Le.mode);return as.lanes=_t,as.return=Le,as}finally{}}}function Ld(h,m){h=fl,C(ro,h),C(Zl,m),fl=h|m.baseLanes}function Mc(){C(ro,fl),C(Zl,Zl.current)}function Uo(){fl=ro.current,S(Zl),S(ro)}function $s(h){var m=h.alternate;C(Js,Js.current&1),C(ao,h),Vo===null&&(m===null||Zl.current!==null||m.memoizedState!==null)&&(Vo=h)}function Sa(h){if(h.tag===22){if(C(Js,Js.current),C(ao,h),Vo===null){var m=h.alternate;m!==null&&m.memoizedState!==null&&(Vo=h)}}else xr()}function xr(){C(Js,Js.current),C(ao,ao.current)}function wn(h){S(ao),Vo===h&&(Vo=null),S(Js)}function ar(h){for(var m=h;m!==null;){if(m.tag===13){var b=m.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||lx(b)||Pm(b)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}function Wn(){throw Error(s(321))}function H(h,m){if(m===null)return!1;for(var b=0;b<m.length&&b<h.length;b++)if(!eo(h[b],m[b]))return!1;return!0}function J(h,m,b,M,N,I){return Ql=I,Yn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,An.H=h===null||h.memoizedState===null?Zs:ea,Hc=!1,I=b(M,N),Hc=!1,gs&&(I=Ie(m,b,M,N)),xe(h),I}function xe(h){An.H=Ci;var m=Bi!==null&&Bi.next!==null;if(Ql=0,Gs=Bi=Yn=null,Ho=!1,Os=0,Dh=null,m)throw Error(s(300));h===null||zs||(h=h.dependencies,h!==null&&Tu(h)&&(zs=!0))}function Ie(h,m,b,M){Yn=h;var N=0;do{if(gs&&(Dh=null),Os=0,gs=!1,25<=N)throw Error(s(301));if(N+=1,Gs=Bi=null,h.updateQueue!=null){var I=h.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}An.H=qu,I=m(b,M)}while(gs);return I}function Ye(){var h=An.H,m=h.useState()[0];return m=typeof m.then=="function"?ae(m):m,h=h.useState()[0],(Bi!==null?Bi.memoizedState:null)!==h&&(Yn.flags|=1024),m}function qe(){var h=Km!==0;return Km=0,h}function vt(h,m,b){m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~b}function mt(h){if(Ho){for(h=h.memoizedState;h!==null;){var m=h.queue;m!==null&&(m.pending=null),h=h.next}Ho=!1}Ql=0,Gs=Bi=Yn=null,gs=!1,Os=Km=0,Dh=null}function xt(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gs===null?Yn.memoizedState=Gs=h:Gs=Gs.next=h,Gs}function k(){if(Bi===null){var h=Yn.alternate;h=h!==null?h.memoizedState:null}else h=Bi.next;var m=Gs===null?Yn.memoizedState:Gs.next;if(m!==null)Gs=m,Bi=h;else{if(h===null)throw Yn.alternate===null?Error(s(467)):Error(s(310));Bi=h,h={memoizedState:Bi.memoizedState,baseState:Bi.baseState,baseQueue:Bi.baseQueue,queue:Bi.queue,next:null},Gs===null?Yn.memoizedState=Gs=h:Gs=Gs.next=h}return Gs}function ae(h){var m=Os;return Os+=1,Dh===null&&(Dh=[]),h=lt(Dh,h,m),m=Yn,(Gs===null?m.memoizedState:Gs.next)===null&&(m=m.alternate,An.H=m===null||m.memoizedState===null?Zs:ea),h}function ce(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return ae(h);if(h.$$typeof===Xl)return Dr(h)}throw Error(s(438,String(h)))}function Ae(h){var m=null,b=Yn.updateQueue;if(b!==null&&(m=b.memoCache),m==null){var M=Yn.alternate;M!==null&&(M=M.updateQueue,M!==null&&(M=M.memoCache,M!=null&&(m={data:M.data.map(function(N){return N.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),b===null&&(b=vx(),Yn.updateQueue=b),b.memoCache=m,b=m.data[m.index],b===void 0)for(b=m.data[m.index]=Array(h),M=0;M<h;M++)b[M]=UA;return m.index++,b}function le(h,m){return typeof m=="function"?m(h):m}function ke(h){var m=k();return it(m,Bi,h)}function it(h,m,b){var M=h.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=b;var N=h.baseQueue,I=M.pending;if(I!==null){if(N!==null){var $=N.next;N.next=I.next,I.next=$}m.baseQueue=N=I,M.pending=null}if(I=h.baseState,N===null)h.memoizedState=I;else{m=N.next;var fe=$=null,Ce=null,rt=m,Ct=!1;do{var kt=rt.lane&-536870913;if(kt!==rt.lane?(Jn&kt)===kt:(Ql&kt)===kt){var Zt=rt.revertLane;if(Zt===0)Ce!==null&&(Ce=Ce.next={lane:0,revertLane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),kt===wa&&(Ct=!0);else if((Ql&Zt)===Zt){rt=rt.next,Zt===wa&&(Ct=!0);continue}else kt={lane:0,revertLane:rt.revertLane,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},Ce===null?(fe=Ce=kt,$=I):Ce=Ce.next=kt,Yn.lanes|=Zt,lo|=Zt;kt=rt.action,Hc&&b(I,kt),I=rt.hasEagerState?rt.eagerState:b(I,kt)}else Zt={lane:kt,revertLane:rt.revertLane,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},Ce===null?(fe=Ce=Zt,$=I):Ce=Ce.next=Zt,Yn.lanes|=kt,lo|=kt;rt=rt.next}while(rt!==null&&rt!==m);if(Ce===null?$=I:Ce.next=fe,!eo(I,h.memoizedState)&&(zs=!0,Ct&&(b=Wu,b!==null)))throw b;h.memoizedState=I,h.baseState=$,h.baseQueue=Ce,M.lastRenderedState=I}return N===null&&(M.lanes=0),[h.memoizedState,M.dispatch]}function ft(h){var m=k(),b=m.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=h;var M=b.dispatch,N=b.pending,I=m.memoizedState;if(N!==null){b.pending=null;var $=N=N.next;do I=h(I,$.action),$=$.next;while($!==N);eo(I,m.memoizedState)||(zs=!0),m.memoizedState=I,m.baseQueue===null&&(m.baseState=I),b.lastRenderedState=I}return[I,M]}function bt(h,m,b){var M=Yn,N=k(),I=Mi;if(I){if(b===void 0)throw Error(s(407));b=b()}else b=m();var $=!eo((Bi||N).memoizedState,b);if($&&(N.memoizedState=b,zs=!0),N=N.queue,cm($t.bind(null,M,N,h),[h]),N.getSnapshot!==m||$||Gs!==null&&Gs.memoizedState.tag&1){if(M.flags|=2048,ws(9,Jt.bind(null,M,N,b,m),{destroy:void 0},null),ti===null)throw Error(s(349));I||(Ql&60)!==0||Ft(M,m,b)}return b}function Ft(h,m,b){h.flags|=16384,h={getSnapshot:m,value:b},m=Yn.updateQueue,m===null?(m=vx(),Yn.updateQueue=m,m.stores=[h]):(b=m.stores,b===null?m.stores=[h]:b.push(h))}function Jt(h,m,b,M){m.value=b,m.getSnapshot=M,tn(m)&&Gn(h)}function $t(h,m,b){return b(function(){tn(m)&&Gn(h)})}function tn(h){var m=h.getSnapshot;h=h.value;try{var b=m();return!eo(h,b)}catch{return!0}}function Gn(h){var m=dt(h,2);m!==null&&Kr(m,h,2)}function fn(h){var m=xt();if(typeof h=="function"){var b=h;if(h=b(),Hc){ne(!0);try{b()}finally{ne(!1)}}}return m.memoizedState=m.baseState=h,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:le,lastRenderedState:h},m}function bn(h,m,b,M){return h.baseState=b,it(h,Bi,typeof M=="function"?M:le)}function $n(h,m,b,M,N){if(Fd(h))throw Error(s(485));if(h=m.action,h!==null){var I={payload:N,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){I.listeners.push($)}};An.T!==null?b(!0):I.isTransition=!1,M(I),b=m.pending,b===null?(I.next=m.pending=I,hn(m,I)):(I.next=b.next,m.pending=b.next=I)}}function hn(h,m){var b=m.action,M=m.payload,N=h.state;if(m.isTransition){var I=An.T,$={};An.T=$;try{var fe=b(N,M),Ce=An.S;Ce!==null&&Ce($,fe),qn(h,m,fe)}catch(rt){ii(h,m,rt)}finally{An.T=I}}else try{I=b(N,M),qn(h,m,I)}catch(rt){ii(h,m,rt)}}function qn(h,m,b){b!==null&&typeof b=="object"&&typeof b.then=="function"?b.then(function(M){on(h,m,M)},function(M){return ii(h,m,M)}):on(h,m,b)}function on(h,m,b){m.status="fulfilled",m.value=b,xi(m),h.state=b,m=h.pending,m!==null&&(b=m.next,b===m?h.pending=null:(b=b.next,m.next=b,hn(h,b)))}function ii(h,m,b){var M=h.pending;if(h.pending=null,M!==null){M=M.next;do m.status="rejected",m.reason=b,xi(m),m=m.next;while(m!==M)}h.action=null}function xi(h){h=h.listeners;for(var m=0;m<h.length;m++)(0,h[m])()}function xn(h,m){return m}function As(h,m){if(Mi){var b=ti.formState;if(b!==null){e:{var M=Yn;if(Mi){if(Pr){var N=VA(Pr,Go);if(N){Pr=O_(N),M=HA(N);break e}}ct(M)}M=!1}M&&(m=b[0])}}b=xt(),b.memoizedState=b.baseState=m,M={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xn,lastRenderedState:m},b.queue=M,b=N0.bind(null,Yn,M),M.dispatch=b,M=fn(!1);var I=B0.bind(null,Yn,!1,M.queue);return M=xt(),N={state:m,dispatch:null,action:h,pending:null},M.queue=N,b=$n.bind(null,Yn,N,I,b),N.dispatch=b,M.memoizedState=h,[m,b,!1]}function ci(h){var m=k();return Ei(m,Bi,h)}function Ei(h,m,b){m=it(h,m,xn)[0],h=ke(le)[0],m=typeof m=="object"&&m!==null&&typeof m.then=="function"?ae(m):m;var M=k(),N=M.queue,I=N.dispatch;return b!==M.memoizedState&&(Yn.flags|=2048,ws(9,$i.bind(null,N,b),{destroy:void 0},null)),[m,I,h]}function $i(h,m){h.action=m}function or(h){var m=k(),b=Bi;if(b!==null)return Ei(m,b,h);k(),m=m.memoizedState,b=k();var M=b.queue.dispatch;return b.memoizedState=h,[m,M,!1]}function ws(h,m,b,M){return h={tag:h,create:m,inst:b,deps:M,next:null},m=Yn.updateQueue,m===null&&(m=vx(),Yn.updateQueue=m),b=m.lastEffect,b===null?m.lastEffect=h.next=h:(M=b.next,b.next=h,h.next=M,m.lastEffect=h),h}function il(){return k().memoizedState}function Lo(h,m,b,M){var N=xt();Yn.flags|=h,N.memoizedState=ws(1|m,b,{destroy:void 0},M===void 0?null:M)}function lm(h,m,b,M){var N=k();M=M===void 0?null:M;var I=N.memoizedState.inst;Bi!==null&&M!==null&&H(M,Bi.memoizedState.deps)?N.memoizedState=ws(m,b,I,M):(Yn.flags|=h,N.memoizedState=ws(1|m,b,I,M))}function Iv(h,m){Lo(8390656,8,h,m)}function cm(h,m){lm(2048,8,h,m)}function cA(h,m){return lm(4,2,h,m)}function uA(h,m){return lm(4,4,h,m)}function um(h,m){if(typeof m=="function"){h=h();var b=m(h);return function(){typeof b=="function"?b():m(null)}}if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function Fl(h,m,b){b=b!=null?b.concat([h]):null,lm(4,4,um.bind(null,m,h),b)}function dm(){}function C0(h,m){var b=k();m=m===void 0?null:m;var M=b.memoizedState;return m!==null&&H(m,M[1])?M[0]:(b.memoizedState=[h,m],h)}function Id(h,m){var b=k();m=m===void 0?null:m;var M=b.memoizedState;if(m!==null&&H(m,M[1]))return M[0];if(M=h(),Hc){ne(!0);try{h()}finally{ne(!1)}}return b.memoizedState=[M,m],M}function yu(h,m,b){return b===void 0||(Ql&1073741824)!==0?h.memoizedState=m:(h.memoizedState=b,h=Vl(),Yn.lanes|=h,lo|=h,b)}function Pv(h,m,b,M){return eo(b,m)?b:Zl.current!==null?(h=yu(h,b,M),eo(h,m)||(zs=!0),h):(Ql&42)===0?(zs=!0,h.memoizedState=b):(h=Vl(),Yn.lanes|=h,lo|=h,m)}function R0(h,m,b,M,N){var I=lr();Zr(I!==0&&8>I?I:8);var $=An.T,fe={};An.T=fe,B0(h,!1,m,b);try{var Ce=N(),rt=An.S;if(rt!==null&&rt(fe,Ce),Ce!==null&&typeof Ce=="object"&&typeof Ce.then=="function"){var Ct=Ot(Ce,M);_u(h,m,Ct,ha(h))}else _u(h,m,M,ha(h))}catch(kt){_u(h,m,{then:function(){},status:"rejected",reason:kt},ha())}finally{Zr(I),An.T=$}}function Fv(h){var m=h.memoizedState;if(m!==null)return m;m={memoizedState:Ma,baseState:Ma,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:le,lastRenderedState:Ma},next:null};var b={};return m.next={memoizedState:b,baseState:b,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:le,lastRenderedState:b},next:null},h.memoizedState=m,h=h.alternate,h!==null&&(h.memoizedState=m),m}function Pd(){return Dr(On)}function Gl(){return k().memoizedState}function w0(){return k().memoizedState}function fm(h){for(var m=h.return;m!==null;){switch(m.tag){case 24:case 3:var b=ha();h=et(b);var M=st(m,h,b);M!==null&&(Kr(M,m,b),nn(M,m,b)),m={cache:I0()},h.payload=m;return}m=m.return}}function vu(h,m,b){var M=ha();b={lane:M,revertLane:0,action:b,hasEagerState:!1,eagerState:null,next:null},Fd(h)?hm(m,b):(b=ot(h,m,b,M),b!==null&&(Kr(b,h,M),Gv(b,m,M)))}function N0(h,m,b){var M=ha();_u(h,m,b,M)}function _u(h,m,b,M){var N={lane:M,revertLane:0,action:b,hasEagerState:!1,eagerState:null,next:null};if(Fd(h))hm(m,N);else{var I=h.alternate;if(h.lanes===0&&(I===null||I.lanes===0)&&(I=m.lastRenderedReducer,I!==null))try{var $=m.lastRenderedState,fe=I($,b);if(N.hasEagerState=!0,N.eagerState=fe,eo(fe,$))return ie(h,m,N,0),ti===null&&Qe(),!1}catch{}finally{}if(b=ot(h,m,N,M),b!==null)return Kr(b,h,M),Gv(b,m,M),!0}return!1}function B0(h,m,b,M){if(M={lane:2,revertLane:$e(),action:M,hasEagerState:!1,eagerState:null,next:null},Fd(h)){if(m)throw Error(s(479))}else m=ot(h,b,M,2),m!==null&&Kr(m,h,2)}function Fd(h){var m=h.alternate;return h===Yn||m!==null&&m===Yn}function hm(h,m){gs=Ho=!0;var b=h.pending;b===null?m.next=m:(m.next=b.next,b.next=m),h.pending=m}function Gv(h,m,b){if((b&4194176)!==0){var M=m.lanes;M&=h.pendingLanes,b|=M,m.lanes=b,te(h,b)}}function jr(h,m,b,M){m=h.memoizedState,b=b(M,m),b=b==null?m:jd({},m,b),h.memoizedState=b,h.lanes===0&&(h.updateQueue.baseState=b)}function bu(h,m,b,M,N,I,$){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(M,I,$):m.prototype&&m.prototype.isPureReactComponent?!Et(b,M)||!Et(N,I):!0}function pm(h,m,b,M){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(b,M),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(b,M),m.state!==h&&_x.enqueueReplaceState(m,m.state,null)}function sl(h,m){var b=m;if("ref"in m){b={};for(var M in m)M!=="ref"&&(b[M]=m[M])}if(h=h.defaultProps){b===m&&(b=jd({},b));for(var N in h)b[N]===void 0&&(b[N]=h[N])}return b}function D0(h,m){try{var b=h.onUncaughtError;b(m.value,{componentStack:m.stack})}catch(M){setTimeout(function(){throw M})}}function O0(h,m,b){try{var M=h.onCaughtError;M(b.value,{componentStack:b.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function mm(h,m,b){return b=et(b),b.tag=3,b.payload={element:null},b.callback=function(){D0(h,m)},b}function rh(h){return h=et(h),h.tag=3,h}function gm(h,m,b,M){var N=b.type.getDerivedStateFromError;if(typeof N=="function"){var I=M.value;h.payload=function(){return N(I)},h.callback=function(){O0(m,b,M)}}var $=b.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(h.callback=function(){O0(m,b,M),typeof N!="function"&&(uo===null?uo=new Set([this]):uo.add(this));var fe=M.stack;this.componentDidCatch(M.value,{componentStack:fe!==null?fe:""})})}function dA(h,m,b,M,N){if(b.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){if(m=b.alternate,m!==null&&Gd(m,b,N,!0),b=ao.current,b!==null){switch(b.tag){case 13:return Vo===null?Ea():b.alternate===null&&vi===0&&(vi=3),b.flags&=-257,b.flags|=65536,b.lanes=N,M===yx?b.flags|=16384:(m=b.updateQueue,m===null?b.updateQueue=new Set([M]):m.add(M),K0(h,M,N)),!1;case 22:return b.flags|=65536,M===yx?b.flags|=16384:(m=b.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([M])},b.updateQueue=m):(b=m.retryQueue,b===null?m.retryQueue=new Set([M]):b.add(M)),K0(h,M,N)),!1}throw Error(s(435,b.tag))}return K0(h,M,N),Ea(),!1}if(Mi)return m=ao.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=N,M!==Xm&&(h=Error(s(422),{cause:M}),Gt(ge(h,b)))):(M!==Xm&&(m=Error(s(423),{cause:M}),Gt(ge(m,b))),h=h.current.alternate,h.flags|=65536,N&=-N,h.lanes|=N,M=ge(M,b),N=mm(h.stateNode,M,N),zt(h,N),vi!==4&&(vi=2)),!1;var I=Error(s(520),{cause:M});if(I=ge(I,b),Uh===null?Uh=[I]:Uh.push(I),vi!==4&&(vi=2),m===null)return!0;M=ge(M,b),b=m;do{switch(b.tag){case 3:return b.flags|=65536,h=N&-N,b.lanes|=h,h=mm(b.stateNode,M,h),zt(b,h),!1;case 1:if(m=b.type,I=b.stateNode,(b.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(uo===null||!uo.has(I))))return b.flags|=65536,N&=-N,b.lanes|=N,N=rh(N),gm(N,h,b,M),zt(b,N),!1}b=b.return}while(b!==null);return!1}function Br(h,m,b,M){m.child=h===null?j_(m,null,b,M):Xu(m,h.child,b,M)}function fA(h,m,b,M,N){b=b.render;var I=m.ref;if("ref"in M){var $={};for(var fe in M)fe!=="ref"&&($[fe]=M[fe])}else $=M;return zd(m),M=J(h,m,b,$,I,N),fe=qe(),h!==null&&!zs?(vt(h,m,N),Cc(h,m,N)):(Mi&&fe&&pe(m),m.flags|=1,Br(h,m,M,N),m.child)}function hA(h,m,b,M,N){if(h===null){var I=b.type;return typeof I=="function"&&!Oc(I)&&I.defaultProps===void 0&&b.compare===null?(m.tag=15,m.type=I,U0(h,m,I,M,N)):(h=Io(b.type,null,M,m,m.mode,N),h.ref=m.ref,h.return=m,m.child=h)}if(I=h.child,!qv(h,N)){var $=I.memoizedProps;if(b=b.compare,b=b!==null?b:Et,b($,M)&&h.ref===m.ref)return Cc(h,m,N)}return m.flags|=1,h=Jr(I,M),h.ref=m.ref,h.return=m,m.child=h}function U0(h,m,b,M,N){if(h!==null){var I=h.memoizedProps;if(Et(I,M)&&h.ref===m.ref)if(zs=!1,m.pendingProps=M=I,qv(h,N))(h.flags&131072)!==0&&(zs=!0);else return m.lanes=h.lanes,Cc(h,m,N)}return zv(h,m,b,M,N)}function pA(h,m,b){var M=m.pendingProps,N=M.children,I=(m.stateNode._pendingVisibility&2)!==0,$=h!==null?h.memoizedState:null;if(xm(h,m),M.mode==="hidden"||I){if((m.flags&128)!==0){if(M=$!==null?$.baseLanes|b:b,h!==null){for(N=m.child=h.child,I=0;N!==null;)I=I|N.lanes|N.childLanes,N=N.sibling;m.childLanes=I&~M}else m.childLanes=0,m.child=null;return mA(h,m,M,b)}if((b&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},h!==null&&P0(m,$!==null?$.cachePool:null),$!==null?Ld(m,$):Mc(),Sa(m);else return m.lanes=m.childLanes=536870912,mA(h,m,$!==null?$.baseLanes|b:b,b)}else $!==null?(P0(m,$.cachePool),Ld(m,$),xr(),m.memoizedState=null):(h!==null&&P0(m,null),Mc(),xr());return Br(h,m,N,b),m.child}function mA(h,m,b,M){var N=Au();return N=N===null?null:{parent:Yl?Li._currentValue:Li._currentValue2,pool:N},m.memoizedState={baseLanes:b,cachePool:N},h!==null&&P0(m,null),Mc(),Sa(m),h!==null&&Gd(h,m,M,!0),null}function xm(h,m){var b=m.ref;if(b===null)h!==null&&h.ref!==null&&(m.flags|=2097664);else{if(typeof b!="function"&&typeof b!="object")throw Error(s(284));(h===null||h.ref!==b)&&(m.flags|=2097664)}}function zv(h,m,b,M,N){return zd(m),b=J(h,m,b,M,void 0,N),M=qe(),h!==null&&!zs?(vt(h,m,N),Cc(h,m,N)):(Mi&&M&&pe(m),m.flags|=1,Br(h,m,b,N),m.child)}function gA(h,m,b,M,N,I){return zd(m),m.updateQueue=null,b=Ie(m,M,b,N),xe(h),M=qe(),h!==null&&!zs?(vt(h,m,I),Cc(h,m,I)):(Mi&&M&&pe(m),m.flags|=1,Br(h,m,b,I),m.child)}function Vv(h,m,b,M,N){if(zd(m),m.stateNode===null){var I=Qd,$=b.contextType;typeof $=="object"&&$!==null&&(I=Dr($)),I=new b(M,I),m.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=_x,m.stateNode=I,I._reactInternals=m,I=m.stateNode,I.props=M,I.state=m.memoizedState,I.refs={},cn(m),$=b.contextType,I.context=typeof $=="object"&&$!==null?Dr($):Qd,I.state=m.memoizedState,$=b.getDerivedStateFromProps,typeof $=="function"&&(jr(m,b,$,M),I.state=m.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||($=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),$!==I.state&&_x.enqueueReplaceState(I,I.state,null),Kt(m,M,I,N),Mt(),I.state=m.memoizedState),typeof I.componentDidMount=="function"&&(m.flags|=4194308),M=!0}else if(h===null){I=m.stateNode;var fe=m.memoizedProps,Ce=sl(b,fe);I.props=Ce;var rt=I.context,Ct=b.contextType;$=Qd,typeof Ct=="object"&&Ct!==null&&($=Dr(Ct));var kt=b.getDerivedStateFromProps;Ct=typeof kt=="function"||typeof I.getSnapshotBeforeUpdate=="function",fe=m.pendingProps!==fe,Ct||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(fe||rt!==$)&&pm(m,I,M,$),Vc=!1;var Zt=m.memoizedState;I.state=Zt,Kt(m,M,I,N),Mt(),rt=m.memoizedState,fe||Zt!==rt||Vc?(typeof kt=="function"&&(jr(m,b,kt,M),rt=m.memoizedState),(Ce=Vc||bu(m,b,Ce,M,Zt,rt,$))?(Ct||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(m.flags|=4194308)):(typeof I.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=M,m.memoizedState=rt),I.props=M,I.state=rt,I.context=$,M=Ce):(typeof I.componentDidMount=="function"&&(m.flags|=4194308),M=!1)}else{I=m.stateNode,Qt(h,m),$=m.memoizedProps,Ct=sl(b,$),I.props=Ct,kt=m.pendingProps,Zt=I.context,rt=b.contextType,Ce=Qd,typeof rt=="object"&&rt!==null&&(Ce=Dr(rt)),fe=b.getDerivedStateFromProps,(rt=typeof fe=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||($!==kt||Zt!==Ce)&&pm(m,I,M,Ce),Vc=!1,Zt=m.memoizedState,I.state=Zt,Kt(m,M,I,N),Mt();var zn=m.memoizedState;$!==kt||Zt!==zn||Vc||h!==null&&h.dependencies!==null&&Tu(h.dependencies)?(typeof fe=="function"&&(jr(m,b,fe,M),zn=m.memoizedState),(Ct=Vc||bu(m,b,Ct,M,Zt,zn,Ce)||h!==null&&h.dependencies!==null&&Tu(h.dependencies))?(rt||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(M,zn,Ce),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(M,zn,Ce)),typeof I.componentDidUpdate=="function"&&(m.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof I.componentDidUpdate!="function"||$===h.memoizedProps&&Zt===h.memoizedState||(m.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||$===h.memoizedProps&&Zt===h.memoizedState||(m.flags|=1024),m.memoizedProps=M,m.memoizedState=zn),I.props=M,I.state=zn,I.context=Ce,M=Ct):(typeof I.componentDidUpdate!="function"||$===h.memoizedProps&&Zt===h.memoizedState||(m.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||$===h.memoizedProps&&Zt===h.memoizedState||(m.flags|=1024),M=!1)}return I=M,xm(h,m),M=(m.flags&128)!==0,I||M?(I=m.stateNode,b=M&&typeof b.getDerivedStateFromError!="function"?null:I.render(),m.flags|=1,h!==null&&M?(m.child=Xu(m,h.child,null,N),m.child=Xu(m,null,b,N)):Br(h,m,b,N),m.memoizedState=I.state,h=m.child):h=Cc(h,m,N),h}function xA(h,m,b,M){return Mn(),m.flags|=256,Br(h,m,b,M),m.child}function Hv(h){return{baseLanes:h,cachePool:SA()}}function kv(h,m,b){return h=h!==null?h.childLanes&~b:0,m&&(h|=Da),h}function yA(h,m,b){var M=m.pendingProps,N=!1,I=(m.flags&128)!==0,$;if(($=I)||($=h!==null&&h.memoizedState===null?!1:(Js.current&2)!==0),$&&(N=!0,m.flags&=-129),$=(m.flags&32)!==0,m.flags&=-33,h===null){if(Mi){if(N?$s(m):xr(),Mi){var fe=Pr,Ce;(Ce=fe)&&(fe=YA(fe,Go),fe!==null?(m.memoizedState={dehydrated:fe,treeContext:cl!==null?{id:Kl,overflow:Fo}:null,retryLane:536870912},Ce=t(18,null,null,0),Ce.stateNode=fe,Ce.return=m,m.child=Ce,Qr=m,Pr=null,Ce=!0):Ce=!1),Ce||ct(m)}if(fe=m.memoizedState,fe!==null&&(fe=fe.dehydrated,fe!==null))return Pm(fe)?m.lanes=16:m.lanes=536870912,null;wn(m)}return fe=M.children,M=M.fallback,N?(xr(),N=m.mode,fe=Wv({mode:"hidden",children:fe},N),M=Lc(M,N,b,null),fe.return=m,M.return=m,fe.sibling=M,m.child=fe,N=m.child,N.memoizedState=Hv(b),N.childLanes=kv(h,$,b),m.memoizedState=ta,M):($s(m),ym(m,fe))}if(Ce=h.memoizedState,Ce!==null&&(fe=Ce.dehydrated,fe!==null)){if(I)m.flags&256?($s(m),m.flags&=-257,m=Xv(h,m,b)):m.memoizedState!==null?(xr(),m.child=h.child,m.flags|=128,m=null):(xr(),N=M.fallback,fe=m.mode,M=Wv({mode:"visible",children:M.children},fe),N=Lc(N,fe,b,null),N.flags|=2,M.return=m,N.return=m,M.sibling=N,m.child=M,Xu(m,h.child,null,b),M=m.child,M.memoizedState=Hv(b),M.childLanes=kv(h,$,b),m.memoizedState=ta,m=N);else if($s(m),Pm(fe))$=zA(fe).digest,M=Error(s(419)),M.stack="",M.digest=$,Gt({value:M,source:null,stack:null}),m=Xv(h,m,b);else if(zs||Gd(h,m,b,!1),$=(b&h.childLanes)!==0,zs||$){if($=ti,$!==null){if(M=b&-b,(M&42)!==0)M=1;else switch(M){case 2:M=1;break;case 8:M=4;break;case 32:M=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:M=64;break;case 268435456:M=134217728;break;default:M=0}if(M=(M&($.suspendedLanes|b))!==0?0:M,M!==0&&M!==Ce.retryLane)throw Ce.retryLane=M,dt(h,M),Kr($,h,M),l1}lx(fe)||Ea(),m=Xv(h,m,b)}else lx(fe)?(m.flags|=128,m.child=h.child,m=qd.bind(null,h),Q3(fe,m),m=null):(h=Ce.treeContext,pa&&(Pr=WA(fe),Qr=m,Mi=!0,io=null,Go=!1,h!==null&&(to[no++]=Kl,to[no++]=Fo,to[no++]=cl,Kl=h.id,Fo=h.overflow,cl=m)),m=ym(m,M.children),m.flags|=4096);return m}return N?(xr(),N=M.fallback,fe=m.mode,Ce=h.child,I=Ce.sibling,M=Jr(Ce,{mode:"hidden",children:M.children}),M.subtreeFlags=Ce.subtreeFlags&31457280,I!==null?N=Jr(I,N):(N=Lc(N,fe,b,null),N.flags|=2),N.return=m,M.return=m,M.sibling=N,m.child=M,M=N,N=m.child,fe=h.child.memoizedState,fe===null?fe=Hv(b):(Ce=fe.cachePool,Ce!==null?(I=Yl?Li._currentValue:Li._currentValue2,Ce=Ce.parent!==I?{parent:I,pool:I}:Ce):Ce=SA(),fe={baseLanes:fe.baseLanes|b,cachePool:Ce}),N.memoizedState=fe,N.childLanes=kv(h,$,b),m.memoizedState=ta,M):($s(m),b=h.child,h=b.sibling,b=Jr(b,{mode:"visible",children:M.children}),b.return=m,b.sibling=null,h!==null&&($=m.deletions,$===null?(m.deletions=[h],m.flags|=16):$.push(h)),m.child=b,m.memoizedState=null,b)}function ym(h,m){return m=Wv({mode:"visible",children:m},h.mode),m.return=h,h.child=m}function Wv(h,m){return J0(h,m,0,null)}function Xv(h,m,b){return Xu(m,h.child,null,b),h=ym(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function vA(h,m,b){h.lanes|=m;var M=h.alternate;M!==null&&(M.lanes|=m),Yv(h.return,m,b)}function L0(h,m,b,M,N){var I=h.memoizedState;I===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:M,tail:b,tailMode:N}:(I.isBackwards=m,I.rendering=null,I.renderingStartTime=0,I.last=M,I.tail=b,I.tailMode=N)}function _A(h,m,b){var M=m.pendingProps,N=M.revealOrder,I=M.tail;if(Br(h,m,M.children,b),M=Js.current,(M&2)!==0)M=M&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&vA(h,b,m);else if(h.tag===19)vA(h,b,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}M&=1}switch(C(Js,M),N){case"forwards":for(b=m.child,N=null;b!==null;)h=b.alternate,h!==null&&ar(h)===null&&(N=b),b=b.sibling;b=N,b===null?(N=m.child,m.child=null):(N=b.sibling,b.sibling=null),L0(m,!1,N,b,I);break;case"backwards":for(b=null,N=m.child,m.child=null;N!==null;){if(h=N.alternate,h!==null&&ar(h)===null){m.child=N;break}h=N.sibling,N.sibling=b,b=N,N=h}L0(m,!0,b,null,I);break;case"together":L0(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Cc(h,m,b){if(h!==null&&(m.dependencies=h.dependencies),lo|=m.lanes,(b&m.childLanes)===0)if(h!==null){if(Gd(h,m,b,!1),(b&m.childLanes)===0)return null}else return null;if(h!==null&&m.child!==h.child)throw Error(s(153));if(m.child!==null){for(h=m.child,b=Jr(h,h.pendingProps),m.child=b,b.return=m;h.sibling!==null;)h=h.sibling,b=b.sibling=Jr(h,h.pendingProps),b.return=m;b.sibling=null}return m.child}function qv(h,m){return(h.lanes&m)!==0?!0:(h=h.dependencies,!!(h!==null&&Tu(h)))}function K3(h,m,b){switch(m.tag){case 3:Ne(m,m.stateNode.containerInfo),Su(m,Li,h.memoizedState.cache),Mn();break;case 27:case 5:Se(m);break;case 4:Ne(m,m.stateNode.containerInfo);break;case 10:Su(m,m.type,m.memoizedProps.value);break;case 13:var M=m.memoizedState;if(M!==null)return M.dehydrated!==null?($s(m),m.flags|=128,null):(b&m.child.childLanes)!==0?yA(h,m,b):($s(m),h=Cc(h,m,b),h!==null?h.sibling:null);$s(m);break;case 19:var N=(h.flags&128)!==0;if(M=(b&m.childLanes)!==0,M||(Gd(h,m,b,!1),M=(b&m.childLanes)!==0),N){if(M)return _A(h,m,b);m.flags|=128}if(N=m.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),C(Js,Js.current),M)break;return null;case 22:case 23:return m.lanes=0,pA(h,m,b);case 24:Su(m,Li,h.memoizedState.cache)}return Cc(h,m,b)}function bA(h,m,b){if(h!==null)if(h.memoizedProps!==m.pendingProps)zs=!0;else{if(!qv(h,b)&&(m.flags&128)===0)return zs=!1,K3(h,m,b);zs=(h.flags&131072)!==0}else zs=!1,Mi&&(m.flags&1048576)!==0&&K(m,km,m.index);switch(m.lanes=0,m.tag){case 16:e:{h=m.pendingProps;var M=m.elementType,N=M._init;if(M=N(M._payload),m.type=M,typeof M=="function")Oc(M)?(h=sl(M,h),m.tag=1,m=Vv(null,m,M,h,b)):(m.tag=0,m=zv(null,m,M,h,b));else{if(M!=null){if(N=M.$$typeof,N===bh){m.tag=11,m=fA(null,m,M,h,b);break e}else if(N===wm){m.tag=14,m=hA(null,m,M,h,b);break e}}throw m=a(M)||M,Error(s(306,m,""))}}return m;case 0:return zv(h,m,m.type,m.pendingProps,b);case 1:return M=m.type,N=sl(M,m.pendingProps),Vv(h,m,M,N,b);case 3:e:{if(Ne(m,m.stateNode.containerInfo),h===null)throw Error(s(387));var I=m.pendingProps;N=m.memoizedState,M=N.element,Qt(h,m),Kt(m,I,null,b);var $=m.memoizedState;if(I=$.cache,Su(m,Li,I),I!==N.cache&&jv(m,[Li],b,!0),Mt(),I=$.element,pa&&N.isDehydrated)if(N={element:I,isDehydrated:!1,cache:$.cache},m.updateQueue.baseState=N,m.memoizedState=N,m.flags&256){m=xA(h,m,I,b);break e}else if(I!==M){M=ge(Error(s(424)),m),Gt(M),m=xA(h,m,I,b);break e}else for(pa&&(Pr=kA(m.stateNode.containerInfo),Qr=m,Mi=!0,io=null,Go=!0),b=j_(m,null,I,b),m.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Mn(),I===M){m=Cc(h,m,b);break e}Br(h,m,I,b)}m=m.child}return m;case 26:if(Qa)return xm(h,m),h===null?(b=hx(m.type,null,m.pendingProps,null))?m.memoizedState=b:Mi||(m.stateNode=tR(m.type,m.pendingProps,ul.current,m)):m.memoizedState=hx(m.type,h.memoizedProps,m.pendingProps,h.memoizedState),null;case 27:if(Lr)return Se(m),h===null&&Lr&&Mi&&(M=m.stateNode=W_(m.type,m.pendingProps,ul.current,Sr.current,!1),Qr=m,Go=!0,Pr=cx(M)),M=m.pendingProps.children,h!==null||Mi?Br(h,m,M,b):m.child=Xu(m,null,M,b),xm(h,m),m.child;case 5:return h===null&&Mi&&(ZA(m.type,m.pendingProps,Sr.current),(N=M=Pr)&&(M=XA(M,m.type,m.pendingProps,Go),M!==null?(m.stateNode=M,Qr=m,Pr=cx(M),Go=!1,N=!0):N=!1),N||ct(m)),Se(m),N=m.type,I=m.pendingProps,$=h!==null?h.memoizedProps:null,M=I.children,zu(N,I)?M=null:$!==null&&zu(N,$)&&(m.flags|=32),m.memoizedState!==null&&(N=J(h,m,Ye,null,null,b),Yl?On._currentValue=N:On._currentValue2=N),xm(h,m),Br(h,m,M,b),m.child;case 6:return h===null&&Mi&&(QA(m.pendingProps,Sr.current),(h=b=Pr)&&(b=qA(b,m.pendingProps,Go),b!==null?(m.stateNode=b,Qr=m,Pr=null,h=!0):h=!1),h||ct(m)),null;case 13:return yA(h,m,b);case 4:return Ne(m,m.stateNode.containerInfo),M=m.pendingProps,h===null?m.child=Xu(m,null,M,b):Br(h,m,M,b),m.child;case 11:return fA(h,m,m.type,m.pendingProps,b);case 7:return Br(h,m,m.pendingProps,b),m.child;case 8:return Br(h,m,m.pendingProps.children,b),m.child;case 12:return Br(h,m,m.pendingProps.children,b),m.child;case 10:return M=m.pendingProps,Su(m,m.type,M.value),Br(h,m,M.children,b),m.child;case 9:return N=m.type._context,M=m.pendingProps.children,zd(m),N=Dr(N),M=M(N),m.flags|=1,Br(h,m,M,b),m.child;case 14:return hA(h,m,m.type,m.pendingProps,b);case 15:return U0(h,m,m.type,m.pendingProps,b);case 19:return _A(h,m,b);case 22:return pA(h,m,b);case 24:return zd(m),M=Dr(Li),h===null?(N=Au(),N===null&&(N=ti,I=I0(),N.pooledCache=I,I.refCount++,I!==null&&(N.pooledCacheLanes|=b),N=I),m.memoizedState={parent:M,cache:N},cn(m),Su(m,Li,N)):((h.lanes&b)!==0&&(Qt(h,m),Kt(m,null,null,b),Mt()),N=h.memoizedState,I=m.memoizedState,N.parent!==M?(N={parent:M,cache:M},m.memoizedState=N,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=N),Su(m,Li,M)):(M=I.cache,Su(m,Li,M),M!==N.cache&&jv(m,[Li],b,!0))),Br(h,m,m.pendingProps.children,b),m.child;case 29:throw m.pendingProps}throw Error(s(156,m.tag))}function Su(h,m,b){Yl?(C(Na,m._currentValue),m._currentValue=b):(C(Na,m._currentValue2),m._currentValue2=b)}function Rc(h){var m=Na.current;Yl?h._currentValue=m:h._currentValue2=m,S(Na)}function Yv(h,m,b){for(;h!==null;){var M=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,M!==null&&(M.childLanes|=m)):M!==null&&(M.childLanes&m)!==m&&(M.childLanes|=m),h===b)break;h=h.return}}function jv(h,m,b,M){var N=h.child;for(N!==null&&(N.return=h);N!==null;){var I=N.dependencies;if(I!==null){var $=N.child;I=I.firstContext;e:for(;I!==null;){var fe=I;I=N;for(var Ce=0;Ce<m.length;Ce++)if(fe.context===m[Ce]){I.lanes|=b,fe=I.alternate,fe!==null&&(fe.lanes|=b),Yv(I.return,b,h),M||($=null);break e}I=fe.next}}else if(N.tag===18){if($=N.return,$===null)throw Error(s(341));$.lanes|=b,I=$.alternate,I!==null&&(I.lanes|=b),Yv($,b,h),$=null}else $=N.child;if($!==null)$.return=N;else for($=N;$!==null;){if($===h){$=null;break}if(N=$.sibling,N!==null){N.return=$.return,$=N;break}$=$.return}N=$}}function Gd(h,m,b,M){h=null;for(var N=m,I=!1;N!==null;){if(!I){if((N.flags&524288)!==0)I=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var $=N.alternate;if($===null)throw Error(s(387));if($=$.memoizedProps,$!==null){var fe=N.type;eo(N.pendingProps.value,$.value)||(h!==null?h.push(fe):h=[fe])}}else if(N===Rh.current){if($=N.alternate,$===null)throw Error(s(387));$.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(h!==null?h.push(On):h=[On])}N=N.return}h!==null&&jv(m,h,b,M),m.flags|=262144}function Tu(h){for(h=h.firstContext;h!==null;){var m=h.context;if(!eo(Yl?m._currentValue:m._currentValue2,h.memoizedValue))return!0;h=h.next}return!1}function zd(h){Yu=h,Us=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Dr(h){return $v(Yu,h)}function vm(h,m){return Yu===null&&zd(h),$v(h,m)}function $v(h,m){var b=Yl?m._currentValue:m._currentValue2;if(m={context:m,memoizedValue:b,next:null},Us===null){if(h===null)throw Error(s(308));Us=m,h.dependencies={lanes:0,firstContext:m},h.flags|=524288}else Us=Us.next=m;return b}function I0(){return{controller:new c1,data:new Map,refCount:0}}function ah(h){h.refCount--,h.refCount===0&&kc(nf,function(){h.controller.abort()})}function Au(){var h=Wc.current;return h!==null?h:ti.pooledCache}function P0(h,m){m===null?C(Wc,Wc.current):C(Wc,m.pool)}function SA(){var h=Au();return h===null?null:{parent:Yl?Li._currentValue:Li._currentValue2,pool:h}}function ja(h){h.flags|=4}function Kv(h,m){if(h!==null&&h.child===m.child)return!1;if((m.flags&16)!==0)return!0;for(h=m.child;h!==null;){if((h.flags&13878)!==0||(h.subtreeFlags&13878)!==0)return!0;h=h.sibling}return!1}function F0(h,m,b,M){if(Ur)for(b=m.child;b!==null;){if(b.tag===5||b.tag===6)ql(h,b.stateNode);else if(!(b.tag===4||Lr&&b.tag===27)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===m)break;for(;b.sibling===null;){if(b.return===null||b.return===m)return;b=b.return}b.sibling.return=b.return,b=b.sibling}else if(Ja)for(var N=m.child;N!==null;){if(N.tag===5){var I=N.stateNode;b&&M&&(I=B_(I,N.type,N.memoizedProps)),ql(h,I)}else if(N.tag===6)I=N.stateNode,b&&M&&(I=D_(I,N.memoizedProps)),ql(h,I);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)I=N.child,I!==null&&(I.return=N),F0(h,N,!0,!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===m)break;for(;N.sibling===null;){if(N.return===null||N.return===m)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function oh(h,m,b,M){if(Ja)for(var N=m.child;N!==null;){if(N.tag===5){var I=N.stateNode;b&&M&&(I=B_(I,N.type,N.memoizedProps)),w_(h,I)}else if(N.tag===6)I=N.stateNode,b&&M&&(I=D_(I,N.memoizedProps)),w_(h,I);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)I=N.child,I!==null&&(I.return=N),oh(h,N,!(N.memoizedProps!==null&&N.memoizedProps.mode==="manual"),!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===m)break;for(;N.sibling===null;){if(N.return===null||N.return===m)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function lh(h,m){if(Ja&&Kv(h,m)){h=m.stateNode;var b=h.containerInfo,M=ox();oh(M,m,!1,!1),h.pendingChildren=M,ja(m),GA(b,M)}}function Jv(h,m,b,M){if(Ur)h.memoizedProps!==M&&ja(m);else if(Ja){var N=h.stateNode,I=h.memoizedProps;if((h=Kv(h,m))||I!==M){var $=Sr.current;I=R_(N,b,I,M,!h,null),I===N?m.stateNode=N:(Pc(I,b,M,$)&&ja(m),m.stateNode=I,h?F0(I,m,!1,!1):ja(m))}else m.stateNode=N}}function ch(h,m,b){if(IA(m,b)){if(h.flags|=16777216,!Fc(m,b))if(Em())h.flags|=8192;else throw tf=yx,Y_}else h.flags&=-16777217}function Zv(h,m){if(e1(m)){if(h.flags|=16777216,!H_(m))if(Em())h.flags|=8192;else throw tf=yx,Y_}else h.flags&=-16777217}function _m(h,m){m!==null&&(h.flags|=4),h.flags&16384&&(m=h.tag!==22?U():536870912,h.lanes|=m,qc|=m)}function Vd(h,m){if(!Mi)switch(h.tailMode){case"hidden":m=h.tail;for(var b=null;m!==null;)m.alternate!==null&&(b=m),m=m.sibling;b===null?h.tail=null:b.sibling=null;break;case"collapsed":b=h.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:M.sibling=null}}function hs(h){var m=h.alternate!==null&&h.alternate.child===h.child,b=0,M=0;if(m)for(var N=h.child;N!==null;)b|=N.lanes|N.childLanes,M|=N.subtreeFlags&31457280,M|=N.flags&31457280,N.return=h,N=N.sibling;else for(N=h.child;N!==null;)b|=N.lanes|N.childLanes,M|=N.subtreeFlags,M|=N.flags,N.return=h,N=N.sibling;return h.subtreeFlags|=M,h.childLanes=b,m}function TA(h,m,b){var M=m.pendingProps;switch(we(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hs(m),null;case 1:return hs(m),null;case 3:return b=m.stateNode,M=null,h!==null&&(M=h.memoizedState.cache),m.memoizedState.cache!==M&&(m.flags|=2048),Rc(Li),gt(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(h===null||h.child===null)&&(It(m)?ja(m):h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,io!==null&&(Nc(io),io=null))),lh(h,m),hs(m),null;case 26:if(Qa){b=m.type;var N=m.memoizedState;return h===null?(ja(m),N!==null?(hs(m),Zv(m,N)):(hs(m),ch(m,b,M))):N?N!==h.memoizedState?(ja(m),hs(m),Zv(m,N)):(hs(m),m.flags&=-16777217):(Ur?h.memoizedProps!==M&&ja(m):Jv(h,m,b,M),hs(m),ch(m,b,M)),null}case 27:if(Lr){if(Be(m),b=ul.current,N=m.type,h!==null&&m.stateNode!=null)Ur?h.memoizedProps!==M&&ja(m):Jv(h,m,N,M);else{if(!M){if(m.stateNode===null)throw Error(s(166));return hs(m),null}h=Sr.current,It(m)?Dt(m,h):(h=W_(N,M,b,h,!0),m.stateNode=h,ja(m))}return hs(m),null}case 5:if(Be(m),b=m.type,h!==null&&m.stateNode!=null)Jv(h,m,b,M);else{if(!M){if(m.stateNode===null)throw Error(s(166));return hs(m),null}h=Sr.current,It(m)?Dt(m,h):(N=x_(b,M,ul.current,h,m),F0(N,m,!1,!1),m.stateNode=N,Pc(N,b,M,h)&&ja(m))}return hs(m),ch(m,m.type,m.pendingProps),null;case 6:if(h&&m.stateNode!=null)b=h.memoizedProps,Ur?b!==M&&ja(m):Ja&&(b!==M?(m.stateNode=tx(M,ul.current,Sr.current,m),ja(m)):m.stateNode=h.stateNode);else{if(typeof M!="string"&&m.stateNode===null)throw Error(s(166));if(h=ul.current,b=Sr.current,It(m)){if(!pa)throw Error(s(176));if(h=m.stateNode,b=m.memoizedProps,M=null,N=Qr,N!==null)switch(N.tag){case 27:case 5:M=N.memoizedProps}jA(h,b,m,M)||ct(m)}else m.stateNode=tx(M,h,b,m)}return hs(m),null;case 13:if(M=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(N=It(m),M!==null&&M.dehydrated!==null){if(h===null){if(!N)throw Error(s(318));if(!pa)throw Error(s(344));if(N=m.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(s(317));Th(N,m)}else Mn(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;hs(m),N=!1}else io!==null&&(Nc(io),io=null),N=!0;if(!N)return m.flags&256?(wn(m),m):(wn(m),null)}if(wn(m),(m.flags&128)!==0)return m.lanes=b,m;if(b=M!==null,h=h!==null&&h.memoizedState!==null,b){M=m.child,N=null,M.alternate!==null&&M.alternate.memoizedState!==null&&M.alternate.memoizedState.cachePool!==null&&(N=M.alternate.memoizedState.cachePool.pool);var I=null;M.memoizedState!==null&&M.memoizedState.cachePool!==null&&(I=M.memoizedState.cachePool.pool),I!==N&&(M.flags|=2048)}return b!==h&&b&&(m.child.flags|=8192),_m(m,m.updateQueue),hs(m),null;case 4:return gt(),lh(h,m),h===null&&__(m.stateNode.containerInfo),hs(m),null;case 10:return Rc(m.type),hs(m),null;case 19:if(S(Js),N=m.memoizedState,N===null)return hs(m),null;if(M=(m.flags&128)!==0,I=N.rendering,I===null)if(M)Vd(N,!1);else{if(vi!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(I=ar(h),I!==null){for(m.flags|=128,Vd(N,!1),h=I.updateQueue,m.updateQueue=h,_m(m,h),m.subtreeFlags=0,h=b,b=m.child;b!==null;)Uc(b,h),b=b.sibling;return C(Js,Js.current&1|2),m.child}h=h.sibling}N.tail!==null&&Ir()>Ms&&(m.flags|=128,M=!0,Vd(N,!1),m.lanes=4194304)}else{if(!M)if(h=ar(I),h!==null){if(m.flags|=128,M=!0,h=h.updateQueue,m.updateQueue=h,_m(m,h),Vd(N,!0),N.tail===null&&N.tailMode==="hidden"&&!I.alternate&&!Mi)return hs(m),null}else 2*Ir()-N.renderingStartTime>Ms&&b!==536870912&&(m.flags|=128,M=!0,Vd(N,!1),m.lanes=4194304);N.isBackwards?(I.sibling=m.child,m.child=I):(h=N.last,h!==null?h.sibling=I:m.child=I,N.last=I)}return N.tail!==null?(m=N.tail,N.rendering=m,N.tail=m.sibling,N.renderingStartTime=Ir(),m.sibling=null,h=Js.current,C(Js,M?h&1|2:h&1),m):(hs(m),null);case 22:case 23:return wn(m),Uo(),M=m.memoizedState!==null,h!==null?h.memoizedState!==null!==M&&(m.flags|=8192):M&&(m.flags|=8192),M?(b&536870912)!==0&&(m.flags&128)===0&&(hs(m),m.subtreeFlags&6&&(m.flags|=8192)):hs(m),b=m.updateQueue,b!==null&&_m(m,b.retryQueue),b=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),M=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(M=m.memoizedState.cachePool.pool),M!==b&&(m.flags|=2048),h!==null&&S(Wc),null;case 24:return b=null,h!==null&&(b=h.memoizedState.cache),m.memoizedState.cache!==b&&(m.flags|=2048),Rc(Li),hs(m),null;case 25:return null}throw Error(s(156,m.tag))}function AA(h,m){switch(we(m),m.tag){case 1:return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return Rc(Li),gt(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 26:case 27:case 5:return Be(m),null;case 13:if(wn(m),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(s(340));Mn()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return S(Js),null;case 4:return gt(),null;case 10:return Rc(m.type),null;case 22:case 23:return wn(m),Uo(),h!==null&&S(Wc),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 24:return Rc(Li),null;case 25:return null;default:return null}}function Qv(h,m){switch(we(m),m.tag){case 3:Rc(Li),gt();break;case 26:case 27:case 5:Be(m);break;case 4:gt();break;case 13:wn(m);break;case 19:S(Js);break;case 10:Rc(m.type);break;case 22:case 23:wn(m),Uo(),h!==null&&S(Wc);break;case 24:Rc(Li)}}function bm(h,m){try{var b=m.updateQueue,M=b!==null?b.lastEffect:null;if(M!==null){var N=M.next;b=N;do{if((b.tag&h)===h){M=void 0;var I=b.create,$=b.inst;M=I(),$.destroy=M}b=b.next}while(b!==N)}}catch(fe){ai(m,m.return,fe)}}function Eu(h,m,b){try{var M=m.updateQueue,N=M!==null?M.lastEffect:null;if(N!==null){var I=N.next;M=I;do{if((M.tag&h)===h){var $=M.inst,fe=$.destroy;if(fe!==void 0){$.destroy=void 0,N=m;var Ce=b;try{fe()}catch(rt){ai(N,Ce,rt)}}}M=M.next}while(M!==I)}}catch(rt){ai(m,m.return,rt)}}function EA(h){var m=h.updateQueue;if(m!==null){var b=h.stateNode;try{ze(m,b)}catch(M){ai(h,h.return,M)}}}function MA(h,m,b){b.props=sl(h.type,h.memoizedProps),b.state=h.memoizedState;try{b.componentWillUnmount()}catch(M){ai(h,m,M)}}function Hd(h,m){try{var b=h.ref;if(b!==null){var M=h.stateNode;switch(h.tag){case 26:case 27:case 5:var N=Sh(M);break;default:N=M}typeof b=="function"?h.refCleanup=b(N):b.current=N}}catch(I){ai(h,m,I)}}function ps(h,m){var b=h.ref,M=h.refCleanup;if(b!==null)if(typeof M=="function")try{M()}catch(N){ai(h,m,N)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof b=="function")try{b(null)}catch(N){ai(h,m,N)}else b.current=null}function uh(h){var m=h.type,b=h.memoizedProps,M=h.stateNode;try{Z3(M,m,b,h)}catch(N){ai(h,h.return,N)}}function e_(h,m,b){try{A_(h.stateNode,h.type,b,m,h)}catch(M){ai(h,h.return,M)}}function t_(h){return h.tag===5||h.tag===3||(Qa?h.tag===26:!1)||(Lr?h.tag===27:!1)||h.tag===4}function G0(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||t_(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&(!Lr||h.tag!==27)&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function z0(h,m,b){var M=h.tag;if(M===5||M===6)h=h.stateNode,m?M_(b,h,m):PA(b,h);else if(!(M===4||Lr&&M===27)&&(h=h.child,h!==null))for(z0(h,m,b),h=h.sibling;h!==null;)z0(h,m,b),h=h.sibling}function dh(h,m,b){var M=h.tag;if(M===5||M===6)h=h.stateNode,m?E_(b,h,m):T_(b,h);else if(!(M===4||Lr&&M===27)&&(h=h.child,h!==null))for(dh(h,m,b),h=h.sibling;h!==null;)dh(h,m,b),h=h.sibling}function CA(h,m,b){h=h.containerInfo;try{N_(h,b)}catch(M){ai(m,m.return,M)}}function fh(h,m){for(Gu(h.containerInfo),Ls=m;Ls!==null;)if(h=Ls,m=h.child,(h.subtreeFlags&1028)!==0&&m!==null)m.return=h,Ls=m;else for(;Ls!==null;){h=Ls;var b=h.alternate;switch(m=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((m&1024)!==0&&b!==null){m=void 0;var M=h,N=b.memoizedProps;b=b.memoizedState;var I=M.stateNode;try{var $=sl(M.type,N,M.elementType===M.type);m=I.getSnapshotBeforeUpdate($,b),I.__reactInternalSnapshotBeforeUpdate=m}catch(fe){ai(M,M.return,fe)}}break;case 3:(m&1024)!==0&&Ur&&ax(h.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((m&1024)!==0)throw Error(s(163))}if(m=h.sibling,m!==null){m.return=h.return,Ls=m;break}Ls=h.return}return $=sf,sf=!1,$}function V0(h,m,b){var M=b.flags;switch(b.tag){case 0:case 11:case 15:zl(h,b),M&4&&bm(5,b);break;case 1:if(zl(h,b),M&4)if(h=b.stateNode,m===null)try{h.componentDidMount()}catch(fe){ai(b,b.return,fe)}else{var N=sl(b.type,m.memoizedProps);m=m.memoizedState;try{h.componentDidUpdate(N,m,h.__reactInternalSnapshotBeforeUpdate)}catch(fe){ai(b,b.return,fe)}}M&64&&EA(b),M&512&&Hd(b,b.return);break;case 3:if(zl(h,b),M&64&&(M=b.updateQueue,M!==null)){if(h=null,b.child!==null)switch(b.child.tag){case 27:case 5:h=Sh(b.child.stateNode);break;case 1:h=b.child.stateNode}try{ze(M,h)}catch(fe){ai(b,b.return,fe)}}break;case 26:if(Qa){zl(h,b),M&512&&Hd(b,b.return);break}case 27:case 5:zl(h,b),m===null&&M&4&&uh(b),M&512&&Hd(b,b.return);break;case 12:zl(h,b);break;case 13:zl(h,b),M&4&&Mu(h,b);break;case 22:if(N=b.memoizedState!==null||cr,!N){m=m!==null&&m.memoizedState!==null||Es;var I=cr,$=Es;cr=N,(Es=m)&&!$?Ru(h,b,(b.subtreeFlags&8772)!==0):zl(h,b),cr=I,Es=$}M&512&&(b.memoizedProps.mode==="manual"?Hd(b,b.return):ps(b,b.return));break;default:zl(h,b)}}function hh(h){var m=h.alternate;m!==null&&(h.alternate=null,hh(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&b_(m)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function $a(h,m,b){for(b=b.child;b!==null;)H0(h,m,b),b=b.sibling}function H0(h,m,b){if(Ra&&typeof Ra.onCommitFiberUnmount=="function")try{Ra.onCommitFiberUnmount(Ch,b)}catch{}switch(b.tag){case 26:if(Qa){Es||ps(b,m),$a(h,m,b),b.memoizedState?P_(b.memoizedState):b.stateNode&&z_(b.stateNode);break}case 27:if(Lr){Es||ps(b,m);var M=Vs,N=Ba;Vs=b.stateNode,$a(h,m,b),t1(b.stateNode),Vs=M,Ba=N;break}case 5:Es||ps(b,m);case 6:if(Ur){if(M=Vs,N=Ba,Vs=null,$a(h,m,b),Vs=M,Ba=N,Vs!==null)if(Ba)try{Fs(Vs,b.stateNode)}catch(I){ai(b,m,I)}else try{ma(Vs,b.stateNode)}catch(I){ai(b,m,I)}}else $a(h,m,b);break;case 18:Ur&&Vs!==null&&(Ba?U_(Vs,b.stateNode):KA(Vs,b.stateNode));break;case 4:Ur?(M=Vs,N=Ba,Vs=b.stateNode.containerInfo,Ba=!0,$a(h,m,b),Vs=M,Ba=N):(Ja&&CA(b.stateNode,b,ox()),$a(h,m,b));break;case 0:case 11:case 14:case 15:Es||Eu(2,b,m),Es||Eu(4,b,m),$a(h,m,b);break;case 1:Es||(ps(b,m),M=b.stateNode,typeof M.componentWillUnmount=="function"&&MA(b,m,M)),$a(h,m,b);break;case 21:$a(h,m,b);break;case 22:Es||ps(b,m),Es=(M=Es)||b.memoizedState!==null,$a(h,m,b),Es=M;break;default:$a(h,m,b)}}function Mu(h,m){if(pa&&m.memoizedState===null&&(h=m.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{dx(h)}catch(b){ai(m,m.return,b)}}function ph(h){switch(h.tag){case 13:case 19:var m=h.stateNode;return m===null&&(m=h.stateNode=new Oh),m;case 22:return h=h.stateNode,m=h._retryCache,m===null&&(m=h._retryCache=new Oh),m;default:throw Error(s(435,h.tag))}}function Sm(h,m){var b=ph(h);m.forEach(function(M){var N=a_.bind(null,h,M);b.has(M)||(b.add(M),M.then(N,N))})}function da(h,m){var b=m.deletions;if(b!==null)for(var M=0;M<b.length;M++){var N=b[M],I=h,$=m;if(Ur){var fe=$;e:for(;fe!==null;){switch(fe.tag){case 27:case 5:Vs=fe.stateNode,Ba=!1;break e;case 3:Vs=fe.stateNode.containerInfo,Ba=!0;break e;case 4:Vs=fe.stateNode.containerInfo,Ba=!0;break e}fe=fe.return}if(Vs===null)throw Error(s(160));H0(I,$,N),Vs=null,Ba=!1}else H0(I,$,N);I=N.alternate,I!==null&&(I.return=null),N.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)Cu(m,h),m=m.sibling}function Cu(h,m){var b=h.alternate,M=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:da(m,h),Ta(h),M&4&&(Eu(3,h,h.return),bm(3,h),Eu(5,h,h.return));break;case 1:da(m,h),Ta(h),M&512&&(Es||b===null||ps(b,b.return)),M&64&&cr&&(h=h.updateQueue,h!==null&&(M=h.callbacks,M!==null&&(b=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=b===null?M:b.concat(M))));break;case 26:if(Qa){var N=ga;da(m,h),Ta(h),M&512&&(Es||b===null||ps(b,b.return)),M&4&&(M=b!==null?b.memoizedState:null,m=h.memoizedState,b===null?m===null?h.stateNode===null?h.stateNode=F_(N,h.type,h.memoizedProps,h):G_(N,h.type,h.stateNode):h.stateNode=I_(N,m,h.memoizedProps):M!==m?(M===null?b.stateNode!==null&&z_(b.stateNode):P_(M),m===null?G_(N,h.type,h.stateNode):I_(N,m,h.memoizedProps)):m===null&&h.stateNode!==null&&e_(h,h.memoizedProps,b.memoizedProps));break}case 27:if(Lr&&M&4&&h.alternate===null){N=h.stateNode;var I=h.memoizedProps;try{nR(N),iR(h.type,I,N,h)}catch(Ct){ai(h,h.return,Ct)}}case 5:if(da(m,h),Ta(h),M&512&&(Es||b===null||ps(b,b.return)),Ur){if(h.flags&32){m=h.stateNode;try{Lm(m)}catch(Ct){ai(h,h.return,Ct)}}M&4&&h.stateNode!=null&&(m=h.memoizedProps,e_(h,m,b!==null?b.memoizedProps:m)),M&1024&&(ju=!0)}break;case 6:if(da(m,h),Ta(h),M&4&&Ur){if(h.stateNode===null)throw Error(s(162));M=h.memoizedProps,b=b!==null?b.memoizedProps:M,m=h.stateNode;try{FA(m,b,M)}catch(Ct){ai(h,h.return,Ct)}}break;case 3:if(Qa?(V_(),N=ga,ga=fx(m.containerInfo),da(m,h),ga=N):da(m,h),Ta(h),M&4){if(Ur&&pa&&b!==null&&b.memoizedState.isDehydrated)try{ux(m.containerInfo)}catch(Ct){ai(h,h.return,Ct)}if(Ja){M=m.containerInfo,b=m.pendingChildren;try{N_(M,b)}catch(Ct){ai(h,h.return,Ct)}}}ju&&(ju=!1,n_(h));break;case 4:Qa?(b=ga,ga=fx(h.stateNode.containerInfo),da(m,h),Ta(h),ga=b):(da(m,h),Ta(h)),M&4&&Ja&&CA(h.stateNode,h,h.stateNode.pendingChildren);break;case 12:da(m,h),Ta(h);break;case 13:da(m,h),Ta(h),h.child.flags&8192&&h.memoizedState!==null!=(b!==null&&b.memoizedState!==null)&&(ec=Ir()),M&4&&(M=h.updateQueue,M!==null&&(h.updateQueue=null,Sm(h,M)));break;case 22:M&512&&(Es||b===null||ps(b,b.return)),N=h.memoizedState!==null;var $=b!==null&&b.memoizedState!==null,fe=cr,Ce=Es;if(cr=fe||N,Es=Ce||$,da(m,h),Es=Ce,cr=fe,Ta(h),m=h.stateNode,m._current=h,m._visibility&=-3,m._visibility|=m._pendingVisibility&2,M&8192&&(m._visibility=N?m._visibility&-2:m._visibility|1,N&&(m=cr||Es,b===null||$||m||mh(h)),Ur&&(h.memoizedProps===null||h.memoizedProps.mode!=="manual"))){e:if(b=null,Ur)for(m=h;;){if(m.tag===5||Qa&&m.tag===26||Lr&&m.tag===27){if(b===null){$=b=m;try{I=$.stateNode,N?Im(I):C_($.stateNode,$.memoizedProps)}catch(Ct){ai($,$.return,Ct)}}}else if(m.tag===6){if(b===null){$=m;try{var rt=$.stateNode;N?rx(rt):Gc(rt,$.memoizedProps)}catch(Ct){ai($,$.return,Ct)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===h)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break e;for(;m.sibling===null;){if(m.return===null||m.return===h)break e;b===m&&(b=null),m=m.return}b===m&&(b=null),m.sibling.return=m.return,m=m.sibling}}M&4&&(M=h.updateQueue,M!==null&&(b=M.retryQueue,b!==null&&(M.retryQueue=null,Sm(h,b))));break;case 19:da(m,h),Ta(h),M&4&&(M=h.updateQueue,M!==null&&(h.updateQueue=null,Sm(h,M)));break;case 21:break;default:da(m,h),Ta(h)}}function Ta(h){var m=h.flags;if(m&2){try{if(Ur&&(!Lr||h.tag!==27)){e:{for(var b=h.return;b!==null;){if(t_(b)){var M=b;break e}b=b.return}throw Error(s(160))}switch(M.tag){case 27:if(Lr){var N=M.stateNode,I=G0(h);dh(h,I,N);break}case 5:var $=M.stateNode;M.flags&32&&(Lm($),M.flags&=-33);var fe=G0(h);dh(h,fe,$);break;case 3:case 4:var Ce=M.stateNode.containerInfo,rt=G0(h);z0(h,rt,Ce);break;default:throw Error(s(161))}}}catch(Ct){ai(h,h.return,Ct)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function n_(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var m=h;n_(m),m.tag===5&&m.flags&1024&&Ki(m.stateNode),h=h.sibling}}function zl(h,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)V0(h,m.alternate,m),m=m.sibling}function mh(h){for(h=h.child;h!==null;){var m=h;switch(m.tag){case 0:case 11:case 14:case 15:Eu(4,m,m.return),mh(m);break;case 1:ps(m,m.return);var b=m.stateNode;typeof b.componentWillUnmount=="function"&&MA(m,m.return,b),mh(m);break;case 26:case 27:case 5:ps(m,m.return),mh(m);break;case 22:ps(m,m.return),m.memoizedState===null&&mh(m);break;default:mh(m)}h=h.sibling}}function Ru(h,m,b){for(b=b&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var M=m.alternate,N=h,I=m,$=I.flags;switch(I.tag){case 0:case 11:case 15:Ru(N,I,b),bm(4,I);break;case 1:if(Ru(N,I,b),M=I,N=M.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(rt){ai(M,M.return,rt)}if(M=I,N=M.updateQueue,N!==null){var fe=M.stateNode;try{var Ce=N.shared.hiddenCallbacks;if(Ce!==null)for(N.shared.hiddenCallbacks=null,N=0;N<Ce.length;N++)ve(Ce[N],fe)}catch(rt){ai(M,M.return,rt)}}b&&$&64&&EA(I),Hd(I,I.return);break;case 26:case 27:case 5:Ru(N,I,b),b&&M===null&&$&4&&uh(I),Hd(I,I.return);break;case 12:Ru(N,I,b);break;case 13:Ru(N,I,b),b&&$&4&&Mu(N,I);break;case 22:I.memoizedState===null&&Ru(N,I,b),Hd(I,I.return);break;default:Ru(N,I,b)}m=m.sibling}}function i_(h,m){var b=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),h=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(h=m.memoizedState.cachePool.pool),h!==b&&(h!=null&&h.refCount++,b!=null&&ah(b))}function k0(h,m){h=null,m.alternate!==null&&(h=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==h&&(m.refCount++,h!=null&&ah(h))}function wc(h,m,b,M){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)W0(h,m,b,M),m=m.sibling}function W0(h,m,b,M){var N=m.flags;switch(m.tag){case 0:case 11:case 15:wc(h,m,b,M),N&2048&&bm(9,m);break;case 3:wc(h,m,b,M),N&2048&&(h=null,m.alternate!==null&&(h=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==h&&(m.refCount++,h!=null&&ah(h)));break;case 12:if(N&2048){wc(h,m,b,M),h=m.stateNode;try{var I=m.memoizedProps,$=I.id,fe=I.onPostCommit;typeof fe=="function"&&fe($,m.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(Ce){ai(m,m.return,Ce)}}else wc(h,m,b,M);break;case 23:break;case 22:I=m.stateNode,m.memoizedState!==null?I._visibility&4?wc(h,m,b,M):wu(h,m):I._visibility&4?wc(h,m,b,M):(I._visibility|=4,$r(h,m,b,M,(m.subtreeFlags&10256)!==0)),N&2048&&i_(m.alternate,m);break;case 24:wc(h,m,b,M),N&2048&&k0(m.alternate,m);break;default:wc(h,m,b,M)}}function $r(h,m,b,M,N){for(N=N&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var I=h,$=m,fe=b,Ce=M,rt=$.flags;switch($.tag){case 0:case 11:case 15:$r(I,$,fe,Ce,N),bm(8,$);break;case 23:break;case 22:var Ct=$.stateNode;$.memoizedState!==null?Ct._visibility&4?$r(I,$,fe,Ce,N):wu(I,$):(Ct._visibility|=4,$r(I,$,fe,Ce,N)),N&&rt&2048&&i_($.alternate,$);break;case 24:$r(I,$,fe,Ce,N),N&&rt&2048&&k0($.alternate,$);break;default:$r(I,$,fe,Ce,N)}m=m.sibling}}function wu(h,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var b=h,M=m,N=M.flags;switch(M.tag){case 22:wu(b,M),N&2048&&i_(M.alternate,M);break;case 24:wu(b,M),N&2048&&k0(M.alternate,M);break;default:wu(b,M)}m=m.sibling}}function yr(h){if(h.subtreeFlags&rf)for(h=h.child;h!==null;)kd(h),h=h.sibling}function kd(h){switch(h.tag){case 26:yr(h),h.flags&rf&&(h.memoizedState!==null?k_(ga,h.memoizedState,h.memoizedProps):Ns(h.type,h.memoizedProps));break;case 5:yr(h),h.flags&rf&&Ns(h.type,h.memoizedProps);break;case 3:case 4:if(Qa){var m=ga;ga=fx(h.stateNode.containerInfo),yr(h),ga=m}else yr(h);break;case 22:h.memoizedState===null&&(m=h.alternate,m!==null&&m.memoizedState!==null?(m=rf,rf=16777216,yr(h),rf=m):yr(h));break;default:yr(h)}}function X0(h){var m=h.alternate;if(m!==null&&(h=m.child,h!==null)){m.child=null;do m=h.sibling,h.sibling=null,h=m;while(h!==null)}}function Nu(h){var m=h.deletions;if((h.flags&16)!==0){if(m!==null)for(var b=0;b<m.length;b++){var M=m[b];Ls=M,Bu(M,h)}X0(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Tm(h),h=h.sibling}function Tm(h){switch(h.tag){case 0:case 11:case 15:Nu(h),h.flags&2048&&Eu(9,h,h.return);break;case 3:Nu(h);break;case 12:Nu(h);break;case 22:var m=h.stateNode;h.memoizedState!==null&&m._visibility&4&&(h.return===null||h.return.tag!==13)?(m._visibility&=-5,gh(h)):Nu(h);break;default:Nu(h)}}function gh(h){var m=h.deletions;if((h.flags&16)!==0){if(m!==null)for(var b=0;b<m.length;b++){var M=m[b];Ls=M,Bu(M,h)}X0(h)}for(h=h.child;h!==null;){switch(m=h,m.tag){case 0:case 11:case 15:Eu(8,m,m.return),gh(m);break;case 22:b=m.stateNode,b._visibility&4&&(b._visibility&=-5,gh(m));break;default:gh(m)}h=h.sibling}}function Bu(h,m){for(;Ls!==null;){var b=Ls;switch(b.tag){case 0:case 11:case 15:Eu(8,b,m);break;case 23:case 22:if(b.memoizedState!==null&&b.memoizedState.cachePool!==null){var M=b.memoizedState.cachePool.pool;M!=null&&M.refCount++}break;case 24:ah(b.memoizedState.cache)}if(M=b.child,M!==null)M.return=b,Ls=M;else e:for(b=h;Ls!==null;){M=Ls;var N=M.sibling,I=M.return;if(hh(M),M===b){Ls=null;break e}if(N!==null){N.return=I,Ls=N;break e}Ls=I}}}function q0(h){var m=v_(h);if(m!=null){if(typeof m.memoizedProps["data-testname"]!="string")throw Error(s(364));return m}if(h=Zd(h),h===null)throw Error(s(362));return h.stateNode.current}function xh(h,m){var b=h.tag;switch(m.$$typeof){case Jm:if(h.type===m.value)return!0;break;case Tx:e:{for(m=m.value,h=[h,0],b=0;b<h.length;){var M=h[b++],N=M.tag,I=h[b++],$=m[I];if(N!==5&&N!==26&&N!==27||!$l(M)){for(;$!=null&&xh(M,$);)I++,$=m[I];if(I===m.length){m=!0;break e}else for(M=M.child;M!==null;)h.push(M,I),M=M.sibling}}m=!1}return m;case Ax:if((b===5||b===26||b===27)&&J3(h.stateNode,m.value))return!0;break;case Ii:if((b===5||b===6||b===26||b===27)&&(h=Um(h),h!==null&&0<=h.indexOf(m.value)))return!0;break;case yi:if((b===5||b===26||b===27)&&(h=h.memoizedProps["data-testname"],typeof h=="string"&&h.toLowerCase()===m.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Du(h){switch(h.$$typeof){case Jm:return"<"+(a(h.value)||"Unknown")+">";case Tx:return":has("+(Du(h)||"")+")";case Ax:return'[role="'+h.value+'"]';case Ii:return'"'+h.value+'"';case yi:return'[data-testname="'+h.value+'"]';default:throw Error(s(365))}}function RA(h,m){var b=[];h=[h,0];for(var M=0;M<h.length;){var N=h[M++],I=N.tag,$=h[M++],fe=m[$];if(I!==5&&I!==26&&I!==27||!$l(N)){for(;fe!=null&&xh(N,fe);)$++,fe=m[$];if($===m.length)b.push(N);else for(N=N.child;N!==null;)h.push(N,$),N=N.sibling}}return b}function fa(h,m){if(!jl)throw Error(s(363));h=q0(h),h=RA(h,m),m=[],h=Array.from(h);for(var b=0;b<h.length;){var M=h[b++],N=M.tag;if(N===5||N===26||N===27)$l(M)||m.push(M.stateNode);else for(M=M.child;M!==null;)h.push(M),M=M.sibling}return m}function ha(){if((_n&2)!==0&&Jn!==0)return Jn&-Jn;if(An.T!==null){var h=wa;return h!==0?h:$e()}return Po()}function Vl(){Da===0&&(Da=(Jn&536870912)===0||Mi?F():536870912);var h=ao.current;return h!==null&&(h.flags|=32),Da}function Kr(h,m,b){(h===ti&&Ji===2||h.cancelPendingCommit!==null)&&(al(h,0),rl(h,Jn,Da,!1)),X(h,b),((_n&2)===0||h!==ti)&&(h===ti&&((_n&2)===0&&(hl|=b),vi===4&&rl(h,Jn,Da,!1)),Ut(h))}function Am(h,m,b){if((_n&6)!==0)throw Error(s(327));var M=!b&&(m&60)===0&&(m&h.expiredLanes)===0||D(h,m),N=M?Wl(h,m):Hl(h,m,!0),I=M;do{if(N===0){oo&&!M&&rl(h,m,0,!1);break}else if(N===6)rl(h,m,0,!Pi);else{if(b=h.current.alternate,I&&!wA(b)){N=Hl(h,m,!1),I=!1;continue}if(N===2){if(I=m,h.errorRecoveryDisabledLanes&I)var $=0;else $=h.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){m=$;e:{var fe=h;N=Uh;var Ce=pa&&fe.current.memoizedState.isDehydrated;if(Ce&&(al(fe,$).flags|=256),$=Hl(fe,$,!1),$!==2){if(Xc&&!Ce){fe.errorRecoveryDisabledLanes|=I,hl|=I,N=4;break e}I=co,co=N,I!==null&&Nc(I)}N=$}if(I=!1,N!==2)continue}}if(N===1){al(h,0),rl(h,m,0,!0);break}e:{switch(M=h,N){case 0:case 1:throw Error(s(345));case 4:if((m&4194176)===m){rl(M,m,Da,!Pi);break e}break;case 2:co=null;break;case 3:case 5:break;default:throw Error(s(329))}if(M.finishedWork=b,M.finishedLanes=m,(m&62914560)===m&&(I=ec+300-Ir(),10<I)){if(rl(M,m,Da,!Pi),L(M,0)!==0)break e;M.timeoutHandle=y_(Y0.bind(null,M,b,co,pl,Lh,m,Da,hl,qc,Pi,2,-0,0),I);break e}Y0(M,b,co,pl,Lh,m,Da,hl,qc,Pi,0,-0,0)}}break}while(!0);Ut(h)}function Nc(h){co===null?co=h:co.push.apply(co,h)}function Y0(h,m,b,M,N,I,$,fe,Ce,rt,Ct,kt,Zt){var zn=m.subtreeFlags;if((zn&8192||(zn&16785408)===16785408)&&(Za(),kd(m),m=nx(),m!==null)){h.cancelPendingCommit=m(rs.bind(null,h,b,M,N,$,fe,Ce,1,kt,Zt)),rl(h,I,$,!rt);return}rs(h,b,M,N,$,fe,Ce,Ct,kt,Zt)}function wA(h){for(var m=h;;){var b=m.tag;if((b===0||b===11||b===15)&&m.flags&16384&&(b=m.updateQueue,b!==null&&(b=b.stores,b!==null)))for(var M=0;M<b.length;M++){var N=b[M],I=N.getSnapshot;N=N.value;try{if(!eo(I(),N))return!1}catch{return!1}}if(b=m.child,m.subtreeFlags&16384&&b!==null)b.return=m,m=b;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function rl(h,m,b,M){m&=~na,m&=~hl,h.suspendedLanes|=m,h.pingedLanes&=~m,M&&(h.warmLanes|=m),M=h.expirationTimes;for(var N=m;0<N;){var I=31-Ca(N),$=1<<I;M[I]=-1,N&=~$}b!==0&&ee(h,b,m)}function s_(){return(_n&6)===0?(At(0),!1):!0}function Aa(){if(Hn!==null){if(Ji===0)var h=Hn.return;else h=Hn,Us=Yu=null,mt(h),Jl=null,zo=0,h=Hn;for(;h!==null;)Qv(h.alternate,h),h=h.return;Hn=null}}function al(h,m){h.finishedWork=null,h.finishedLanes=0;var b=h.timeoutHandle;b!==Jd&&(h.timeoutHandle=Jd,Om(b)),b=h.cancelPendingCommit,b!==null&&(h.cancelPendingCommit=null,b()),Aa(),ti=h,Hn=b=Jr(h.current,null),Jn=m,Ji=0,Hs=null,Pi=!1,oo=D(h,m),Xc=!1,qc=Da=na=hl=lo=vi=0,co=Uh=null,Lh=!1,(m&8)!==0&&(m|=m&32);var M=h.entangledLanes;if(M!==0)for(h=h.entanglements,M&=m;0<M;){var N=31-Ca(M),I=1<<N;m|=h[N],M&=~I}return fl=m,Qe(),b}function Wd(h,m){Yn=null,An.H=Ci,m===ki?(m=en(),Ji=3):m===Y_?(m=en(),Ji=4):Ji=m===l1?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,Hs=m,Hn===null&&(vi=1,D0(h,ge(m,h.current)))}function Em(){var h=ao.current;return h===null?!0:(Jn&4194176)===Jn?Vo===null:(Jn&62914560)===Jn||(Jn&536870912)!==0?h===Vo:!1}function yh(){var h=An.H;return An.H=Ci,h===null?Ci:h}function Ka(){var h=An.A;return An.A=Sx,h}function Ea(){vi=4,Pi||(Jn&4194176)!==Jn&&ao.current!==null||(oo=!0),(lo&134217727)===0&&(hl&134217727)===0||ti===null||rl(ti,Jn,Da,!1)}function Hl(h,m,b){var M=_n;_n|=2;var N=yh(),I=Ka();(ti!==h||Jn!==m)&&(pl=null,al(h,m)),m=!1;var $=vi;e:do try{if(Ji!==0&&Hn!==null){var fe=Hn,Ce=Hs;switch(Ji){case 8:Aa(),$=6;break e;case 3:case 2:case 6:ao.current===null&&(m=!0);var rt=Ji;if(Ji=0,Hs=null,Ou(h,fe,Ce,rt),b&&oo){$=0;break e}break;default:rt=Ji,Ji=0,Hs=null,Ou(h,fe,Ce,rt)}}kl(),$=vi;break}catch(Ct){Wd(h,Ct)}while(!0);return m&&h.shellSuspendCounter++,Us=Yu=null,_n=M,An.H=N,An.A=I,Hn===null&&(ti=null,Jn=0,Qe()),$}function kl(){for(;Hn!==null;)r_(Hn)}function Wl(h,m){var b=_n;_n|=2;var M=yh(),N=Ka();ti!==h||Jn!==m?(pl=null,Ms=Ir()+500,al(h,m)):oo=D(h,m);e:do try{if(Ji!==0&&Hn!==null){m=Hn;var I=Hs;t:switch(Ji){case 1:Ji=0,Hs=null,Ou(h,m,I,1);break;case 2:if(wt(I)){Ji=0,Hs=null,j0(m);break}m=function(){Ji===2&&ti===h&&(Ji=7),Ut(h)},I.then(m,m);break e;case 3:Ji=7;break e;case 4:Ji=5;break e;case 7:wt(I)?(Ji=0,Hs=null,j0(m)):(Ji=0,Hs=null,Ou(h,m,I,7));break;case 5:var $=null;switch(Hn.tag){case 26:$=Hn.memoizedState;case 5:case 27:var fe=Hn,Ce=fe.type,rt=fe.pendingProps;if($?H_($):Fc(Ce,rt)){Ji=0,Hs=null;var Ct=fe.sibling;if(Ct!==null)Hn=Ct;else{var kt=fe.return;kt!==null?(Hn=kt,Mm(kt)):Hn=null}break t}}Ji=0,Hs=null,Ou(h,m,I,5);break;case 6:Ji=0,Hs=null,Ou(h,m,I,6);break;case 8:Aa(),vi=6;break e;default:throw Error(s(462))}}Bc();break}catch(Zt){Wd(h,Zt)}while(!0);return Us=Yu=null,An.H=M,An.A=N,_n=b,Hn!==null?0:(ti=null,Jn=0,Qe(),vi)}function Bc(){for(;Hn!==null&&!i1();)r_(Hn)}function r_(h){var m=bA(h.alternate,h,fl);h.memoizedProps=h.pendingProps,m===null?Mm(h):Hn=m}function j0(h){var m=h,b=m.alternate;switch(m.tag){case 15:case 0:m=gA(b,m,m.pendingProps,m.type,void 0,Jn);break;case 11:m=gA(b,m,m.pendingProps,m.type.render,m.ref,Jn);break;case 5:mt(m);default:Qv(b,m),m=Hn=Uc(m,fl),m=bA(b,m,fl)}h.memoizedProps=h.pendingProps,m===null?Mm(h):Hn=m}function Ou(h,m,b,M){Us=Yu=null,mt(m),Jl=null,zo=0;var N=m.return;try{if(dA(h,N,m,b,Jn)){vi=1,D0(h,ge(b,h.current)),Hn=null;return}}catch(I){if(N!==null)throw Hn=N,I;vi=1,D0(h,ge(b,h.current)),Hn=null;return}m.flags&32768?(Mi||M===1?h=!0:oo||(Jn&536870912)!==0?h=!1:(Pi=h=!0,(M===2||M===3||M===6)&&(M=ao.current,M!==null&&M.tag===13&&(M.flags|=16384))),vr(m,h)):Mm(m)}function Mm(h){var m=h;do{if((m.flags&32768)!==0){vr(m,Pi);return}h=m.return;var b=TA(m.alternate,m,fl);if(b!==null){Hn=b;return}if(m=m.sibling,m!==null){Hn=m;return}Hn=m=h}while(m!==null);vi===0&&(vi=5)}function vr(h,m){do{var b=AA(h.alternate,h);if(b!==null){b.flags&=32767,Hn=b;return}if(b=h.return,b!==null&&(b.flags|=32768,b.subtreeFlags=0,b.deletions=null),!m&&(h=h.sibling,h!==null)){Hn=h;return}Hn=h=b}while(h!==null);vi=6,Hn=null}function rs(h,m,b,M,N,I,$,fe,Ce,rt){var Ct=An.T,kt=lr();try{Zr(2),An.T=null,ui(h,m,b,M,kt,N,I,$,fe,Ce,rt)}finally{An.T=Ct,Zr(kt)}}function ui(h,m,b,M,N,I,$,fe){do _r();while(Yc!==null);if((_n&6)!==0)throw Error(s(327));var Ce=h.finishedWork;if(M=h.finishedLanes,Ce===null)return null;if(h.finishedWork=null,h.finishedLanes=0,Ce===h.current)throw Error(s(177));h.callbackNode=null,h.callbackPriority=0,h.cancelPendingCommit=null;var rt=Ce.lanes|Ce.childLanes;if(rt|=wh,Z(h,M,rt,I,$,fe),h===ti&&(Hn=ti=null,Jn=0),(Ce.subtreeFlags&10256)===0&&(Ce.flags&10256)===0||ko||(ko=!0,Ex=rt,of=b,Cm(px,function(){return _r(),null})),b=(Ce.flags&15990)!==0,(Ce.subtreeFlags&15990)!==0||b?(b=An.T,An.T=null,I=lr(),Zr(2),$=_n,_n|=4,fh(h,Ce),Cu(Ce,h),g_(h.containerInfo),h.current=Ce,V0(h,Ce.alternate,Ce),s1(),_n=$,Zr(I),An.T=b):h.current=Ce,ko?(ko=!1,Yc=h,af=M):Dc(h,rt),rt=h.pendingLanes,rt===0&&(uo=null),W(Ce.stateNode),Ut(h),m!==null)for(N=h.onRecoverableError,Ce=0;Ce<m.length;Ce++)rt=m[Ce],N(rt.value,{componentStack:rt.stack});return(af&3)!==0&&_r(),rt=h.pendingLanes,(M&4194218)!==0&&(rt&42)!==0?h===xa?lf++:(lf=0,xa=h):lf=0,At(0),null}function Dc(h,m){(h.pooledCacheLanes&=m)===0&&(m=h.pooledCache,m!=null&&(h.pooledCache=null,ah(m)))}function _r(){if(Yc!==null){var h=Yc,m=Ex;Ex=0;var b=re(af),M=32>b?32:b;b=An.T;var N=lr();try{if(Zr(M),An.T=null,Yc===null)var I=!1;else{M=of,of=null;var $=Yc,fe=af;if(Yc=null,af=0,(_n&6)!==0)throw Error(s(331));var Ce=_n;if(_n|=4,Tm($.current),W0($,$.current,fe,M),_n=Ce,At(0,!1),Ra&&typeof Ra.onPostCommitFiberRoot=="function")try{Ra.onPostCommitFiberRoot(Ch,$)}catch{}I=!0}return I}finally{Zr(N),An.T=b,Dc(h,m)}}return!1}function $0(h,m,b){m=ge(b,m),m=mm(h.stateNode,m,2),h=st(h,m,2),h!==null&&(X(h,2),Ut(h))}function ai(h,m,b){if(h.tag===3)$0(h,h,b);else for(;m!==null;){if(m.tag===3){$0(m,h,b);break}else if(m.tag===1){var M=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof M.componentDidCatch=="function"&&(uo===null||!uo.has(M))){h=ge(b,h),b=rh(2),M=st(m,b,2),M!==null&&(gm(b,M,m,h),X(M,2),Ut(M));break}}m=m.return}}function K0(h,m,b){var M=h.pingCache;if(M===null){M=h.pingCache=new oi;var N=new Set;M.set(m,N)}else N=M.get(m),N===void 0&&(N=new Set,M.set(m,N));N.has(b)||(Xc=!0,N.add(b),h=NA.bind(null,h,m,b),m.then(h,h))}function NA(h,m,b){var M=h.pingCache;M!==null&&M.delete(m),h.pingedLanes|=h.suspendedLanes&b,h.warmLanes&=~b,ti===h&&(Jn&b)===b&&(vi===4||vi===3&&(Jn&62914560)===Jn&&300>Ir()-ec?(_n&2)===0&&al(h,0):na|=b,qc===Jn&&(qc=0)),Ut(h)}function Xd(h,m){m===0&&(m=U()),h=dt(h,m),h!==null&&(X(h,m),Ut(h))}function qd(h){var m=h.memoizedState,b=0;m!==null&&(b=m.retryLane),Xd(h,b)}function a_(h,m){var b=0;switch(h.tag){case 13:var M=h.stateNode,N=h.memoizedState;N!==null&&(b=N.retryLane);break;case 19:M=h.stateNode;break;case 22:M=h.stateNode._retryCache;break;default:throw Error(s(314))}M!==null&&M.delete(m),Xd(h,b)}function Cm(h,m){return Mh(h,m)}function o_(h,m,b,M){this.tag=h,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=M,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oc(h){return h=h.prototype,!(!h||!h.isReactComponent)}function Jr(h,m){var b=h.alternate;return b===null?(b=t(h.tag,m,h.key,h.mode),b.elementType=h.elementType,b.type=h.type,b.stateNode=h.stateNode,b.alternate=h,h.alternate=b):(b.pendingProps=m,b.type=h.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=h.flags&31457280,b.childLanes=h.childLanes,b.lanes=h.lanes,b.child=h.child,b.memoizedProps=h.memoizedProps,b.memoizedState=h.memoizedState,b.updateQueue=h.updateQueue,m=h.dependencies,b.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},b.sibling=h.sibling,b.index=h.index,b.ref=h.ref,b.refCleanup=h.refCleanup,b}function Uc(h,m){h.flags&=31457282;var b=h.alternate;return b===null?(h.childLanes=0,h.lanes=m,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=b.childLanes,h.lanes=b.lanes,h.child=b.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=b.memoizedProps,h.memoizedState=b.memoizedState,h.updateQueue=b.updateQueue,h.type=b.type,m=b.dependencies,h.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),h}function Io(h,m,b,M,N,I){var $=0;if(M=h,typeof h=="function")Oc(h)&&($=1);else if(typeof h=="string")$=Qa&&Lr?L_(h,b,Sr.current)?26:Ah(h)?27:5:Qa?L_(h,b,Sr.current)?26:5:Lr&&Ah(h)?27:5;else e:switch(h){case _h:return Lc(b.children,N,I,m);case f_:$=8,N|=24;break;case h_:return h=t(12,b,m,N|2),h.elementType=h_,h.lanes=I,h;case Z0:return h=t(13,b,m,N),h.elementType=Z0,h.lanes=I,h;case Iu:return h=t(19,b,m,N),h.elementType=Iu,h.lanes=I,h;case Nm:return J0(b,N,I,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case OA:case Xl:$=10;break e;case Lu:$=9;break e;case bh:$=11;break e;case wm:$=14;break e;case ll:$=16,M=null;break e}$=29,b=Error(s(130,h===null?"null":typeof h,"")),M=null}return m=t($,b,m,N),m.elementType=h,m.type=M,m.lanes=I,m}function Lc(h,m,b,M){return h=t(7,h,M,m),h.lanes=b,h}function J0(h,m,b,M){h=t(22,h,M,m),h.elementType=Nm,h.lanes=b;var N={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var I=N._current;if(I===null)throw Error(s(456));if((N._pendingVisibility&2)===0){var $=dt(I,2);$!==null&&(N._pendingVisibility|=2,Kr($,I,2))}},attach:function(){var I=N._current;if(I===null)throw Error(s(456));if((N._pendingVisibility&2)!==0){var $=dt(I,2);$!==null&&(N._pendingVisibility&=-3,Kr($,I,2))}}};return h.stateNode=N,h}function Uu(h,m,b){return h=t(6,h,null,m),h.lanes=b,h}function vh(h,m,b){return m=t(4,h.children!==null?h.children:[],h.key,m),m.lanes=b,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function Yd(h,m,b,M,N,I,$,fe){this.tag=1,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Jd,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=P(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=P(0),this.hiddenUpdates=P(null),this.identifierPrefix=M,this.onUncaughtError=N,this.onCaughtError=I,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=fe,this.incompleteTransitions=new Map}function br(h,m,b,M,N,I,$,fe,Ce,rt,Ct,kt){return h=new Yd(h,m,b,$,fe,Ce,rt,kt),m=1,I===!0&&(m|=24),I=t(3,null,null,m),h.current=I,I.stateNode=h,m=I0(),m.refCount++,h.pooledCache=m,m.refCount++,I.memoizedState={element:M,isDehydrated:b,cache:m},cn(I),h}function Rm(h){return h?(h=Qd,h):Qd}function l_(h){var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(s(188)):(h=Object.keys(h).join(","),Error(s(268,h)));return h=y(m),h=h!==null?_(h):null,h===null?null:Sh(h.stateNode)}function BA(h,m,b,M,N,I){N=Rm(N),M.context===null?M.context=N:M.pendingContext=N,M=et(m),M.payload={element:b},I=I===void 0?null:I,I!==null&&(M.callback=I),b=st(h,M,m),b!==null&&(Kr(b,h,m),nn(b,h,m))}function DA(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var b=h.retryLane;h.retryLane=b!==0&&b<m?b:m}}function c_(h,m){DA(h,m),(h=h.alternate)&&DA(h,m)}var vn={},u_=Qy(),Or=n7(),jd=Object.assign,d_=Symbol.for("react.element"),Ic=Symbol.for("react.transitional.element"),ol=Symbol.for("react.portal"),_h=Symbol.for("react.fragment"),f_=Symbol.for("react.strict_mode"),h_=Symbol.for("react.profiler"),OA=Symbol.for("react.provider"),Lu=Symbol.for("react.consumer"),Xl=Symbol.for("react.context"),bh=Symbol.for("react.forward_ref"),Z0=Symbol.for("react.suspense"),Iu=Symbol.for("react.suspense_list"),wm=Symbol.for("react.memo"),ll=Symbol.for("react.lazy"),Nm=Symbol.for("react.offscreen"),UA=Symbol.for("react.memo_cache_sentinel"),p_=Symbol.iterator,$d=Symbol.for("react.client.reference"),An=u_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q0,m_,Pu=!1,Fu=Array.isArray,ex=e.rendererVersion,Bm=e.rendererPackageName,Dm=e.extraDevToolsConfig,Sh=e.getPublicInstance,Kd=e.getRootHostContext,LA=e.getChildHostContext,Gu=e.prepareForCommit,g_=e.resetAfterCommit,x_=e.createInstance,ql=e.appendInitialChild,Pc=e.finalizeInitialChildren,zu=e.shouldSetTextContent,tx=e.createTextInstance,y_=e.scheduleTimeout,Om=e.cancelTimeout,Jd=e.noTimeout,Yl=e.isPrimaryRenderer;e.warnsIfNotActing;var Ur=e.supportsMutation,Ja=e.supportsPersistence,pa=e.supportsHydration,v_=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var __=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Zr=e.setCurrentUpdatePriority,lr=e.getCurrentUpdatePriority,Po=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Vu=e.shouldAttemptEagerTransition,b_=e.detachDeletedInstance;e.requestPostPaintCallback;var IA=e.maySuspendCommit,Fc=e.preloadInstance,Za=e.startSuspendingCommit,Ns=e.suspendInstance,nx=e.waitForCommitToBeReady,Ma=e.NotPendingTransition,On=e.HostTransitionContext,Ki=e.resetFormInstance;e.bindToConsole;var Ks=e.supportsMicrotasks,ix=e.scheduleMicrotask,jl=e.supportsTestSelectors,Zd=e.findFiberRoot,sx=e.getBoundingRect,Um=e.getTextContent,$l=e.isHiddenSubtree,J3=e.matchAccessibilityRole,Bs=e.setFocusIfFocusable,S_=e.setupIntersectionObserver,T_=e.appendChild,PA=e.appendChildToContainer,FA=e.commitTextUpdate,Z3=e.commitMount,A_=e.commitUpdate,E_=e.insertBefore,M_=e.insertInContainerBefore,ma=e.removeChild,Fs=e.removeChildFromContainer,Lm=e.resetTextContent,Im=e.hideInstance,rx=e.hideTextInstance,C_=e.unhideInstance,Gc=e.unhideTextInstance,ax=e.clearContainer,R_=e.cloneInstance,ox=e.createContainerChildSet,w_=e.appendChildToContainerChildSet,GA=e.finalizeContainerChildren,N_=e.replaceContainerChildren,B_=e.cloneHiddenInstance,D_=e.cloneHiddenTextInstance,lx=e.isSuspenseInstancePending,Pm=e.isSuspenseInstanceFallback,zA=e.getSuspenseInstanceFallbackErrorDetails,Q3=e.registerSuspenseInstanceRetry,VA=e.canHydrateFormStateMarker,HA=e.isFormStateMarkerMatching,O_=e.getNextHydratableSibling,cx=e.getFirstHydratableChild,kA=e.getFirstHydratableChildWithinContainer,WA=e.getFirstHydratableChildWithinSuspenseInstance,XA=e.canHydrateInstance,qA=e.canHydrateTextInstance,YA=e.canHydrateSuspenseInstance,eR=e.hydrateInstance,jA=e.hydrateTextInstance,Th=e.hydrateSuspenseInstance,$A=e.getNextHydratableInstanceAfterSuspenseInstance,ux=e.commitHydratedContainer,dx=e.commitHydratedSuspenseInstance,KA=e.clearSuspenseBoundary,U_=e.clearSuspenseBoundaryFromContainer,JA=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var ZA=e.validateHydratableInstance,QA=e.validateHydratableTextInstance,Qa=e.supportsResources,L_=e.isHostHoistableType,fx=e.getHoistableRoot,hx=e.getResource,I_=e.acquireResource,P_=e.releaseResource,F_=e.hydrateHoistable,G_=e.mountHoistable,z_=e.unmountHoistable,tR=e.createHoistableInstance,V_=e.prepareToCommitHoistables,e1=e.mayResourceSuspendCommit,H_=e.preloadResource,k_=e.suspendResource,Lr=e.supportsSingletons,W_=e.resolveSingletonInstance,nR=e.clearSingleton,iR=e.acquireSingletonInstance,t1=e.releaseSingletonInstance,Ah=e.isHostSingletonType,Fm=[],zc=-1,Qd={},Ca=Math.clz32?Math.clz32:w,Gm=Math.log,n1=Math.LN2,Eh=128,zm=4194304,Mh=Or.unstable_scheduleCallback,Vm=Or.unstable_cancelCallback,i1=Or.unstable_shouldYield,s1=Or.unstable_requestPaint,Ir=Or.unstable_now,X_=Or.unstable_ImmediatePriority,r1=Or.unstable_UserBlockingPriority,px=Or.unstable_NormalPriority,mx=Or.unstable_IdlePriority,a1=Or.log,q_=Or.unstable_setDisableYieldValue,Ch=null,Ra=null,eo=typeof Object.is=="function"?Object.is:se,gx=new WeakMap,ms=[],Ds=0,Hm=null,km=0,to=[],no=0,cl=null,Kl=1,Fo="",Sr=A(null),Wm=A(null),ul=A(null),Rh=A(null),Qr=null,Pr=null,Mi=!1,io=null,Go=!1,Xm=Error(s(519)),so=[],Hu=0,wh=0,Nh=null,ef=null,qm=!1,Ym=!1,dl=!1,ku=0,jm=null,xx=0,wa=0,Wu=null,Vc=!1,Bh=!1,$m=Object.prototype.hasOwnProperty,ki=Error(s(460)),Y_=Error(s(474)),yx={then:function(){}},tf=null,Jl=null,zo=0,Xu=Yr(!0),j_=Yr(!1),Zl=A(null),ro=A(0),ao=A(null),Vo=null,Js=A(0),Ql=0,Yn=null,Bi=null,Gs=null,Ho=!1,gs=!1,Hc=!1,Km=0,Os=0,Dh=null,o1=0,vx=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Ci={readContext:Dr,use:ce,useCallback:Wn,useContext:Wn,useEffect:Wn,useImperativeHandle:Wn,useLayoutEffect:Wn,useInsertionEffect:Wn,useMemo:Wn,useReducer:Wn,useRef:Wn,useState:Wn,useDebugValue:Wn,useDeferredValue:Wn,useTransition:Wn,useSyncExternalStore:Wn,useId:Wn};Ci.useCacheRefresh=Wn,Ci.useMemoCache=Wn,Ci.useHostTransitionStatus=Wn,Ci.useFormState=Wn,Ci.useActionState=Wn,Ci.useOptimistic=Wn;var Zs={readContext:Dr,use:ce,useCallback:function(h,m){return xt().memoizedState=[h,m===void 0?null:m],h},useContext:Dr,useEffect:Iv,useImperativeHandle:function(h,m,b){b=b!=null?b.concat([h]):null,Lo(4194308,4,um.bind(null,m,h),b)},useLayoutEffect:function(h,m){return Lo(4194308,4,h,m)},useInsertionEffect:function(h,m){Lo(4,2,h,m)},useMemo:function(h,m){var b=xt();m=m===void 0?null:m;var M=h();if(Hc){ne(!0);try{h()}finally{ne(!1)}}return b.memoizedState=[M,m],M},useReducer:function(h,m,b){var M=xt();if(b!==void 0){var N=b(m);if(Hc){ne(!0);try{b(m)}finally{ne(!1)}}}else N=m;return M.memoizedState=M.baseState=N,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:N},M.queue=h,h=h.dispatch=vu.bind(null,Yn,h),[M.memoizedState,h]},useRef:function(h){var m=xt();return h={current:h},m.memoizedState=h},useState:function(h){h=fn(h);var m=h.queue,b=N0.bind(null,Yn,m);return m.dispatch=b,[h.memoizedState,b]},useDebugValue:dm,useDeferredValue:function(h,m){var b=xt();return yu(b,h,m)},useTransition:function(){var h=fn(!1);return h=R0.bind(null,Yn,h.queue,!0,!1),xt().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,m,b){var M=Yn,N=xt();if(Mi){if(b===void 0)throw Error(s(407));b=b()}else{if(b=m(),ti===null)throw Error(s(349));(Jn&60)!==0||Ft(M,m,b)}N.memoizedState=b;var I={value:b,getSnapshot:m};return N.queue=I,Iv($t.bind(null,M,I,h),[h]),M.flags|=2048,ws(9,Jt.bind(null,M,I,b,m),{destroy:void 0},null),b},useId:function(){var h=xt(),m=ti.identifierPrefix;if(Mi){var b=Fo,M=Kl;b=(M&~(1<<32-Ca(M)-1)).toString(32)+b,m=":"+m+"R"+b,b=Km++,0<b&&(m+="H"+b.toString(32)),m+=":"}else b=o1++,m=":"+m+"r"+b.toString(32)+":";return h.memoizedState=m},useCacheRefresh:function(){return xt().memoizedState=fm.bind(null,Yn)}};Zs.useMemoCache=Ae,Zs.useHostTransitionStatus=Pd,Zs.useFormState=As,Zs.useActionState=As,Zs.useOptimistic=function(h){var m=xt();m.memoizedState=m.baseState=h;var b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=b,m=B0.bind(null,Yn,!0,b),b.dispatch=m,[h,m]};var ea={readContext:Dr,use:ce,useCallback:C0,useContext:Dr,useEffect:cm,useImperativeHandle:Fl,useInsertionEffect:cA,useLayoutEffect:uA,useMemo:Id,useReducer:ke,useRef:il,useState:function(){return ke(le)},useDebugValue:dm,useDeferredValue:function(h,m){var b=k();return Pv(b,Bi.memoizedState,h,m)},useTransition:function(){var h=ke(le)[0],m=k().memoizedState;return[typeof h=="boolean"?h:ae(h),m]},useSyncExternalStore:bt,useId:Gl};ea.useCacheRefresh=w0,ea.useMemoCache=Ae,ea.useHostTransitionStatus=Pd,ea.useFormState=ci,ea.useActionState=ci,ea.useOptimistic=function(h,m){var b=k();return bn(b,Bi,h,m)};var qu={readContext:Dr,use:ce,useCallback:C0,useContext:Dr,useEffect:cm,useImperativeHandle:Fl,useInsertionEffect:cA,useLayoutEffect:uA,useMemo:Id,useReducer:ft,useRef:il,useState:function(){return ft(le)},useDebugValue:dm,useDeferredValue:function(h,m){var b=k();return Bi===null?yu(b,h,m):Pv(b,Bi.memoizedState,h,m)},useTransition:function(){var h=ft(le)[0],m=k().memoizedState;return[typeof h=="boolean"?h:ae(h),m]},useSyncExternalStore:bt,useId:Gl};qu.useCacheRefresh=w0,qu.useMemoCache=Ae,qu.useHostTransitionStatus=Pd,qu.useFormState=or,qu.useActionState=or,qu.useOptimistic=function(h,m){var b=k();return Bi!==null?bn(b,Bi,h,m):(b.baseState=h,[h,b.queue.dispatch])};var _x={isMounted:function(h){return(h=h._reactInternals)?p(h)===h:!1},enqueueSetState:function(h,m,b){h=h._reactInternals;var M=ha(),N=et(M);N.payload=m,b!=null&&(N.callback=b),m=st(h,N,M),m!==null&&(Kr(m,h,M),nn(m,h,M))},enqueueReplaceState:function(h,m,b){h=h._reactInternals;var M=ha(),N=et(M);N.tag=1,N.payload=m,b!=null&&(N.callback=b),m=st(h,N,M),m!==null&&(Kr(m,h,M),nn(m,h,M))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var b=ha(),M=et(b);M.tag=2,m!=null&&(M.callback=m),m=st(h,M,b),m!==null&&(Kr(m,h,b),nn(m,h,b))}},$_=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},l1=Error(s(461)),zs=!1,ta={dehydrated:null,treeContext:null,retryLane:0},Na=A(null),Yu=null,Us=null,c1=typeof AbortController<"u"?AbortController:function(){var h=[],m=this.signal={aborted:!1,addEventListener:function(b,M){h.push(M)}};this.abort=function(){m.aborted=!0,h.forEach(function(b){return b()})}},kc=Or.unstable_scheduleCallback,nf=Or.unstable_NormalPriority,Li={$$typeof:Xl,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},bx=An.S;An.S=function(h,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&Ve(h,m),bx!==null&&bx(h,m)};var Wc=A(null),cr=!1,Es=!1,ju=!1,Oh=typeof WeakSet=="function"?WeakSet:Set,Ls=null,sf=!1,Vs=null,Ba=!1,ga=null,rf=8192,Sx={getCacheForType:function(h){var m=Dr(Li),b=m.data.get(h);return b===void 0&&(b=h(),m.data.set(h,b)),b}},Jm=0,Tx=1,Ax=2,yi=3,Ii=4;if(typeof Symbol=="function"&&Symbol.for){var jn=Symbol.for;Jm=jn("selector.component"),Tx=jn("selector.has_pseudo_class"),Ax=jn("selector.role"),yi=jn("selector.test_id"),Ii=jn("selector.text")}var oi=typeof WeakMap=="function"?WeakMap:Map,_n=0,ti=null,Hn=null,Jn=0,Ji=0,Hs=null,Pi=!1,oo=!1,Xc=!1,fl=0,vi=0,lo=0,hl=0,na=0,Da=0,qc=0,Uh=null,co=null,Lh=!1,ec=0,Ms=1/0,pl=null,uo=null,ko=!1,Yc=null,af=0,Ex=0,of=null,lf=0,xa=null;return vn.attemptContinuousHydration=function(h){if(h.tag===13){var m=dt(h,67108864);m!==null&&Kr(m,h,67108864),c_(h,67108864)}},vn.attemptHydrationAtCurrentPriority=function(h){if(h.tag===13){var m=ha(),b=dt(h,m);b!==null&&Kr(b,h,m),c_(h,m)}},vn.attemptSynchronousHydration=function(h){switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var m=B(h.pendingLanes);if(m!==0){for(h.pendingLanes|=2,h.entangledLanes|=2;m;){var b=1<<31-Ca(m);h.entanglements[1]|=b,m&=~b}Ut(h),(_n&6)===0&&(Ms=Ir()+500,At(0))}}break;case 13:m=dt(h,2),m!==null&&Kr(m,h,2),s_(),c_(h,2)}},vn.batchedUpdates=function(h,m){return h(m)},vn.createComponentSelector=function(h){return{$$typeof:Jm,value:h}},vn.createContainer=function(h,m,b,M,N,I,$,fe,Ce,rt){return br(h,m,!1,null,b,M,I,$,fe,Ce,rt,null)},vn.createHasPseudoClassSelector=function(h){return{$$typeof:Tx,value:h}},vn.createHydrationContainer=function(h,m,b,M,N,I,$,fe,Ce,rt,Ct,kt,Zt){return h=br(b,M,!0,h,N,I,fe,Ce,rt,Ct,kt,Zt),h.context=Rm(null),b=h.current,M=ha(),N=et(M),N.callback=m??null,st(b,N,M),h.current.lanes=M,X(h,M),Ut(h),h},vn.createPortal=function(h,m,b){var M=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ol,key:M==null?null:""+M,children:h,containerInfo:m,implementation:b}},vn.createRoleSelector=function(h){return{$$typeof:Ax,value:h}},vn.createTestNameSelector=function(h){return{$$typeof:yi,value:h}},vn.createTextSelector=function(h){return{$$typeof:Ii,value:h}},vn.defaultOnCaughtError=function(h){console.error(h)},vn.defaultOnRecoverableError=function(h){$_(h)},vn.defaultOnUncaughtError=function(h){$_(h)},vn.deferredUpdates=function(h){var m=An.T,b=lr();try{return Zr(32),An.T=null,h()}finally{Zr(b),An.T=m}},vn.discreteUpdates=function(h,m,b,M,N){var I=An.T,$=lr();try{return Zr(2),An.T=null,h(m,b,M,N)}finally{Zr($),An.T=I,_n===0&&(Ms=Ir()+500)}},vn.findAllNodes=fa,vn.findBoundingRects=function(h,m){if(!jl)throw Error(s(363));m=fa(h,m),h=[];for(var b=0;b<m.length;b++)h.push(sx(m[b]));for(m=h.length-1;0<m;m--){b=h[m];for(var M=b.x,N=M+b.width,I=b.y,$=I+b.height,fe=m-1;0<=fe;fe--)if(m!==fe){var Ce=h[fe],rt=Ce.x,Ct=rt+Ce.width,kt=Ce.y,Zt=kt+Ce.height;if(M>=rt&&I>=kt&&N<=Ct&&$<=Zt){h.splice(m,1);break}else if(M!==rt||b.width!==Ce.width||Zt<I||kt>$){if(!(I!==kt||b.height!==Ce.height||Ct<M||rt>N)){rt>M&&(Ce.width+=rt-M,Ce.x=M),Ct<N&&(Ce.width=N-rt),h.splice(m,1);break}}else{kt>I&&(Ce.height+=kt-I,Ce.y=I),Zt<$&&(Ce.height=$-kt),h.splice(m,1);break}}}return h},vn.findHostInstance=l_,vn.findHostInstanceWithNoPortals=function(h){return h=y(h),h=h!==null?T(h):null,h===null?null:Sh(h.stateNode)},vn.findHostInstanceWithWarning=function(h){return l_(h)},vn.flushPassiveEffects=_r,vn.flushSyncFromReconciler=function(h){var m=_n;_n|=1;var b=An.T,M=lr();try{if(Zr(2),An.T=null,h)return h()}finally{Zr(M),An.T=b,_n=m,(_n&6)===0&&At(0)}},vn.flushSyncWork=s_,vn.focusWithin=function(h,m){if(!jl)throw Error(s(363));for(h=q0(h),m=RA(h,m),m=Array.from(m),h=0;h<m.length;){var b=m[h++],M=b.tag;if(!$l(b)){if((M===5||M===26||M===27)&&Bs(b.stateNode))return!0;for(b=b.child;b!==null;)m.push(b),b=b.sibling}}return!1},vn.getFindAllNodesFailureDescription=function(h,m){if(!jl)throw Error(s(363));var b=0,M=[];h=[q0(h),0];for(var N=0;N<h.length;){var I=h[N++],$=I.tag,fe=h[N++],Ce=m[fe];if(($!==5&&$!==26&&$!==27||!$l(I))&&(xh(I,Ce)&&(M.push(Du(Ce)),fe++,fe>b&&(b=fe)),fe<m.length))for(I=I.child;I!==null;)h.push(I,fe),I=I.sibling}if(b<m.length){for(h=[];b<m.length;b++)h.push(Du(m[b]));return`findAllNodes was able to match part of the selector:
  `+(M.join(" > ")+`

No matching component was found for:
  `)+h.join(" > ")}return null},vn.getPublicRootInstance=function(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 27:case 5:return Sh(h.child.stateNode);default:return h.child.stateNode}},vn.injectIntoDevTools=function(){var h={bundleType:0,version:ex,rendererPackageName:Bm,currentDispatcherRef:An,findFiberByHostInstance:v_,reconcilerVersion:"19.0.0"};if(Dm!==null&&(h.rendererConfig=Dm),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")h=!1;else{var m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(m.isDisabled||!m.supportsFiber)h=!0;else{try{Ch=m.inject(h),Ra=m}catch{}h=!!m.checkDCE}}return h},vn.isAlreadyRendering=function(){return!1},vn.observeVisibleRects=function(h,m,b,M){if(!jl)throw Error(s(363));h=fa(h,m);var N=S_(h,b,M).disconnect;return{disconnect:function(){N()}}},vn.shouldError=function(){return null},vn.shouldSuspend=function(){return!1},vn.startHostTransition=function(h,m,b,M){if(h.tag!==5)throw Error(s(476));var N=Fv(h).queue;R0(h,N,m,Ma,b===null?n:function(){var I=Fv(h).next.queue;return _u(h,I,{},ha()),b(M)})},vn.updateContainer=function(h,m,b,M){var N=m.current,I=ha();return BA(N,I,h,m,b,M),I},vn.updateContainerSync=function(h,m,b,M){return m.tag===0&&_r(),BA(m.current,2,h,m,b,M),2},vn},i.exports.default=i.exports,Object.defineProperty(i.exports,"__esModule",{value:!0})})(l2)),l2.exports}var g4;function Lce(){return g4||(g4=1,o2.exports=Uce()),o2.exports}var Ice=Lce();const Pce=$p(Ice);var x4=n7();function TU(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=e?i.return:i.child;for(;n;){const s=TU(n,e,t);if(s)return s;n=e?null:n.sibling}}function i7(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const AU=i7(G.createContext(null));let s7=class extends G.Component{render(){return G.createElement(AU.Provider,{value:this._reactInternals},this.props.children)}};function r7(){const i=G.useContext(AU);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=G.useId();return G.useMemo(()=>{for(const t of[i,i?.alternate]){if(!t)continue;const n=TU(t,!1,s=>{let r=s.memoizedState;for(;r;){if(r.memoizedState===e)return!0;r=r.next}});if(n)return n}},[i,e])}const Fce=Symbol.for("react.context"),Gce=i=>i!==null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===Fce;function zce(){const i=r7(),[e]=G.useState(()=>new Map);e.clear();let t=i;for(;t;){const n=t.type;Gce(n)&&n!==AU&&!e.has(n)&&e.set(n,G.use(i7(n))),t=t.return}return e}function Vce(){const i=zce();return G.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>G.createElement(e,null,G.createElement(t.Provider,{...n,value:i.get(t)})),e=>G.createElement(s7,{...e})),[i])}function a7(i){let e=i.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const o7=i=>i&&i.isOrthographicCamera,Hce=i=>i&&i.hasOwnProperty("current"),kce=i=>i!=null&&(typeof i=="string"||typeof i=="number"||i.isColor),ZT=((i,e)=>typeof window<"u"&&(((i=window.document)==null?void 0:i.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?G.useLayoutEffect:G.useEffect;function EU(i){const e=G.useRef(i);return ZT(()=>void(e.current=i),[i]),e}function Wce(){const i=r7(),e=Vce();return G.useMemo(()=>({children:t})=>{const s=!!TU(i,!0,r=>r.type===G.StrictMode)?G.StrictMode:G.Fragment;return Pt.jsx(s,{children:Pt.jsx(e,{children:t})})},[i,e])}function Xce({set:i}){return ZT(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}const qce=(i=>(i=class extends G.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},i.getDerivedStateFromError=()=>({error:!0}),i))();function l7(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}function ly(i){var e;return(e=i.__r3f)==null?void 0:e.root.getState()}const Is={obj:i=>i===Object(i)&&!Is.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,nul:i=>i===null,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:s=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(Is.str(i)||Is.num(i)||Is.boo(i))return i===e;const r=Is.obj(i);if(r&&n==="reference")return i===e;const a=Is.arr(i);if(a&&t==="reference")return i===e;if((a||r)&&i===e)return!0;let o;for(o in i)if(!(o in e))return!1;if(r&&t==="shallow"&&n==="shallow"){for(o in s?e:i)if(!Is.equ(i[o],e[o],{strict:s,objects:"reference"}))return!1}else for(o in s?e:i)if(i[o]!==e[o])return!1;if(Is.und(o)){if(a&&i.length===0&&e.length===0||r&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function Yce(i){const e={nodes:{},materials:{},meshes:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function jce(i){i.type!=="Scene"&&(i.dispose==null||i.dispose());for(const e in i){const t=i[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const c7=["children","key","ref"];function $ce(i){const e={};for(const t in i)c7.includes(t)||(e[t]=i[t]);return e}function LM(i,e,t,n){const s=i;let r=s?.__r3f;return r||(r={root:e,type:t,parent:null,children:[],props:$ce(n),object:s,eventCount:0,handlers:{},isHidden:!1},s&&(s.__r3f=r)),r}function VS(i,e){if(!e.includes("-"))return{root:i,key:e,target:i[e]};if(e in i)return{root:i,key:e,target:i[e]};let t=i;const n=e.split("-");for(const s of n){if(typeof t!="object"||t===null){if(t!==void 0){const r=n.slice(n.indexOf(s)).join("-");return{root:t,key:r,target:void 0}}return{root:i,key:e,target:void 0}}e=s,i=t,t=t[e]}return{root:i,key:e,target:t}}const y4=/-\d+$/;function IM(i,e){if(Is.str(e.props.attach)){if(y4.test(e.props.attach)){const s=e.props.attach.replace(y4,""),{root:r,key:a}=VS(i.object,s);Array.isArray(r[a])||(r[a]=[])}const{root:t,key:n}=VS(i.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else Is.fun(e.props.attach)&&(e.previousAttach=e.props.attach(i.object,e.object))}function PM(i,e){if(Is.str(e.props.attach)){const{root:t,key:n}=VS(i.object,e.props.attach),s=e.previousAttach;s===void 0?delete t[n]:t[n]=s}else e.previousAttach==null||e.previousAttach(i.object,e.object);delete e.previousAttach}const LN=[...c7,"args","dispose","attach","object","onUpdate","dispose"],v4=new Map;function Kce(i){let e=v4.get(i.constructor);try{e||(e=new i.constructor,v4.set(i.constructor,e))}catch{}return e}function Jce(i,e){const t={};for(const n in e)if(!LN.includes(n)&&!Is.equ(e[n],i.props[n])){t[n]=e[n];for(const s in e)s.startsWith(`${n}-`)&&(t[s]=e[s])}for(const n in i.props){if(LN.includes(n)||e.hasOwnProperty(n))continue;const{root:s,key:r}=VS(i.object,n);if(s.constructor&&s.constructor.length===0){const a=Kce(s);Is.und(a)||(t[r]=a[r])}else t[r]=0}return t}const Zce=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Qce=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function ld(i,e){var t;const n=i.__r3f,s=n&&a7(n).getState(),r=n?.eventCount;for(const o in e){let l=e[o];if(LN.includes(o))continue;if(n&&Qce.test(o)){typeof l=="function"?n.handlers[o]=l:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(l===void 0)continue;let{root:u,key:f,target:p}=VS(i,o);if(p===void 0&&(typeof u!="object"||u===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${f}".`);if(p instanceof r0&&l instanceof r0)p.mask=l.mask;else if(p instanceof Bt&&kce(l))p.set(l);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof p.copy=="function"&&l!=null&&l.constructor&&p.constructor===l.constructor)p.copy(l);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&Array.isArray(l))typeof p.fromArray=="function"?p.fromArray(l):p.set(...l);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof l=="number")typeof p.setScalar=="function"?p.setScalar(l):p.set(l);else{var a;u[f]=l,s&&!s.linear&&Zce.includes(f)&&(a=u[f])!=null&&a.isTexture&&u[f].format===Oi&&u[f].type===ss&&(u[f].colorSpace=Mr)}}if(n!=null&&n.parent&&s!=null&&s.internal&&(t=n.object)!=null&&t.isObject3D&&r!==n.eventCount){const o=n.object,l=s.internal.interaction.indexOf(o);l>-1&&s.internal.interaction.splice(l,1),n.eventCount&&o.raycast!==null&&s.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&Rv(n),i}function Rv(i){var e;if(!i.parent)return;i.props.onUpdate==null||i.props.onUpdate(i.object);const t=(e=i.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function u7(i,e){i.manual||(o7(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix())}const xo=i=>i?.isObject3D;function FE(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function d7(i,e,t,n){const s=t.get(e);s&&(t.delete(e),t.size===0&&(i.delete(n),s.target.releasePointerCapture(n)))}function eue(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,s)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(s)}),t.capturedMap.forEach((n,s)=>{d7(t.capturedMap,e,n,s)})}function tue(i){function e(l){const{internal:u}=i.getState(),f=l.offsetX-u.initialClick[0],p=l.offsetY-u.initialClick[1];return Math.round(Math.sqrt(f*f+p*p))}function t(l){return l.filter(u=>["Move","Over","Enter","Out","Leave"].some(f=>{var p;return(p=u.__r3f)==null?void 0:p.handlers["onPointer"+f]}))}function n(l,u){const f=i.getState(),p=new Set,x=[],y=u?u(f.internal.interaction):f.internal.interaction;for(let S=0;S<y.length;S++){const C=ly(y[S]);C&&(C.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(l,f);function _(S){const C=ly(S);if(!C||!C.events.enabled||C.raycaster.camera===null)return[];if(C.raycaster.camera===void 0){var w;C.events.compute==null||C.events.compute(l,C,(w=C.previousRoot)==null?void 0:w.getState()),C.raycaster.camera===void 0&&(C.raycaster.camera=null)}return C.raycaster.camera?C.raycaster.intersectObject(S,!0):[]}let T=y.flatMap(_).sort((S,C)=>{const w=ly(S.object),B=ly(C.object);return!w||!B?S.distance-C.distance:B.events.priority-w.events.priority||S.distance-C.distance}).filter(S=>{const C=FE(S);return p.has(C)?!1:(p.add(C),!0)});f.events.filter&&(T=f.events.filter(T,f));for(const S of T){let C=S.object;for(;C;){var A;(A=C.__r3f)!=null&&A.eventCount&&x.push({...S,eventObject:C}),C=C.parent}}if("pointerId"in l&&f.internal.capturedMap.has(l.pointerId))for(let S of f.internal.capturedMap.get(l.pointerId).values())p.has(FE(S.intersection))||x.push(S.intersection);return x}function s(l,u,f,p){if(l.length){const x={stopped:!1};for(const y of l){let _=ly(y.object);if(_||y.object.traverseAncestors(T=>{const A=ly(T);if(A)return _=A,!1}),_){const{raycaster:T,pointer:A,camera:S,internal:C}=_,w=new Q(A.x,A.y,0).unproject(S),B=U=>{var P,X;return(P=(X=C.capturedMap.get(U))==null?void 0:X.has(y.eventObject))!=null?P:!1},L=U=>{const P={intersection:y,target:u.target};C.capturedMap.has(U)?C.capturedMap.get(U).set(y.eventObject,P):C.capturedMap.set(U,new Map([[y.eventObject,P]])),u.target.setPointerCapture(U)},D=U=>{const P=C.capturedMap.get(U);P&&d7(C.capturedMap,y.eventObject,P,U)};let O={};for(let U in u){let P=u[U];typeof P!="function"&&(O[U]=P)}let F={...y,...O,pointer:A,intersections:l,stopped:x.stopped,delta:f,unprojectedPoint:w,ray:T.ray,camera:S,stopPropagation(){const U="pointerId"in u&&C.capturedMap.get(u.pointerId);if((!U||U.has(y.eventObject))&&(F.stopped=x.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(P=>P.eventObject===y.eventObject))){const P=l.slice(0,l.indexOf(y));r([...P,y])}},target:{hasPointerCapture:B,setPointerCapture:L,releasePointerCapture:D},currentTarget:{hasPointerCapture:B,setPointerCapture:L,releasePointerCapture:D},nativeEvent:u};if(p(F),x.stopped===!0)break}}}return l}function r(l){const{internal:u}=i.getState();for(const f of u.hovered.values())if(!l.length||!l.find(p=>p.object===f.object&&p.index===f.index&&p.instanceId===f.instanceId)){const x=f.eventObject.__r3f;if(u.hovered.delete(FE(f)),x!=null&&x.eventCount){const y=x.handlers,_={...f,intersections:l};y.onPointerOut==null||y.onPointerOut(_),y.onPointerLeave==null||y.onPointerLeave(_)}}}function a(l,u){for(let f=0;f<u.length;f++){const p=u[f].__r3f;p==null||p.handlers.onPointerMissed==null||p.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return u=>{const{internal:f}=i.getState();"pointerId"in u&&f.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(u.pointerId)&&(f.capturedMap.delete(u.pointerId),r([]))})}}return function(f){const{onPointerMissed:p,internal:x}=i.getState();x.lastEvent.current=f;const y=l==="onPointerMove",_=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",A=n(f,y?t:void 0),S=_?e(f):0;l==="onPointerDown"&&(x.initialClick=[f.offsetX,f.offsetY],x.initialHits=A.map(w=>w.eventObject)),_&&!A.length&&S<=2&&(a(f,x.interaction),p&&p(f)),y&&r(A);function C(w){const B=w.eventObject,L=B.__r3f;if(!(L!=null&&L.eventCount))return;const D=L.handlers;if(y){if(D.onPointerOver||D.onPointerEnter||D.onPointerOut||D.onPointerLeave){const O=FE(w),F=x.hovered.get(O);F?F.stopped&&w.stopPropagation():(x.hovered.set(O,w),D.onPointerOver==null||D.onPointerOver(w),D.onPointerEnter==null||D.onPointerEnter(w))}D.onPointerMove==null||D.onPointerMove(w)}else{const O=D[l];O?(!_||x.initialHits.includes(B))&&(a(f,x.interaction.filter(F=>!x.initialHits.includes(F))),O(w)):_&&x.initialHits.includes(B)&&a(f,x.interaction.filter(F=>!x.initialHits.includes(F)))}}s(A,f,S,C)}}return{handlePointer:o}}const _4=i=>!!(i!=null&&i.render),MU=G.createContext(null),nue=(i,e)=>{const t=Qk((o,l)=>{const u=new Q,f=new Q,p=new Q;function x(S=l().camera,C=f,w=l().size){const{width:B,height:L,top:D,left:O}=w,F=B/L;C.isVector3?p.copy(C):p.set(...C);const U=S.getWorldPosition(u).distanceTo(p);if(o7(S))return{width:B/S.zoom,height:L/S.zoom,top:D,left:O,factor:1,distance:U,aspect:F};{const P=S.fov*Math.PI/180,X=2*Math.tan(P/2)*U,Z=X*(B/L);return{width:Z,height:X,top:D,left:O,factor:B/Z,distance:U,aspect:F}}}let y;const _=S=>o(C=>({performance:{...C.performance,current:S}})),T=new Ze;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(S=1)=>i(l(),S),advance:(S,C)=>e(S,C,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new KC,pointer:T,mouse:T,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const S=l();y&&clearTimeout(y),S.performance.current!==S.performance.min&&_(S.performance.min),y=setTimeout(()=>_(l().performance.max),S.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:x},setEvents:S=>o(C=>({...C,events:{...C.events,...S}})),setSize:(S,C,w=0,B=0)=>{const L=l().camera,D={width:S,height:C,top:w,left:B};o(O=>({size:D,viewport:{...O.viewport,...x(L,f,D)}}))},setDpr:S=>o(C=>{const w=l7(S);return{viewport:{...C.viewport,dpr:w,initialDpr:C.viewport.initialDpr||w}}}),setFrameloop:(S="always")=>{const C=l().clock;C.stop(),C.elapsedTime=0,S!=="never"&&(C.start(),C.elapsedTime=0),o(()=>({frameloop:S}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:G.createRef(),active:!1,frames:0,priority:0,subscribe:(S,C,w)=>{const B=l().internal;return B.priority=B.priority+(C>0?1:0),B.subscribers.push({ref:S,priority:C,store:w}),B.subscribers=B.subscribers.sort((L,D)=>L.priority-D.priority),()=>{const L=l().internal;L!=null&&L.subscribers&&(L.priority=L.priority-(C>0?1:0),L.subscribers=L.subscribers.filter(D=>D.ref!==S))}}}}}),n=t.getState();let s=n.size,r=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:o,size:l,viewport:u,gl:f,set:p}=t.getState();if(l.width!==s.width||l.height!==s.height||u.dpr!==r){s=l,r=u.dpr,u7(o,l),u.dpr>0&&f.setPixelRatio(u.dpr);const x=typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(l.width,l.height,x)}o!==a&&(a=o,p(x=>({viewport:{...x.viewport,...x.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>i(o)),t};function CU(){const i=G.useContext(MU);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function yo(i=t=>t,e){return CU()(i,e)}function RU(i,e=0){const t=CU(),n=t.getState().internal.subscribe,s=EU(i);return ZT(()=>n(s,e,t),[e,n,t]),null}const b4=new WeakMap,iue=i=>{var e;return typeof i=="function"&&(i==null||(e=i.prototype)==null?void 0:e.constructor)===i};function f7(i,e){return function(t,...n){let s;return iue(t)?(s=b4.get(t),s||(s=new t,b4.set(t,s))):s=t,i&&i(s),Promise.all(n.map(r=>new Promise((a,o)=>s.load(r,l=>{xo(l?.scene)&&Object.assign(l,Yce(l.scene)),a(l)},e,l=>o(new Error(`Could not load ${r}: ${l?.message}`))))))}}function Xf(i,e,t,n){const s=Array.isArray(e)?e:[e],r=Nce(f7(t,n),[i,...s],{equal:Is.equ});return Array.isArray(e)?r:r[0]}Xf.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return Bce(f7(t),[i,...n])};Xf.clear=function(i,e){const t=Array.isArray(e)?e:[e];return Dce([i,...t])};function sue(i){const e=Pce(i);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:G.version}),e}const h7=0,$y={},rue=/^three(?=[A-Z])/,I3=i=>`${i[0].toUpperCase()}${i.slice(1)}`;let aue=0;const oue=i=>typeof i=="function";function P3(i){if(oue(i)){const e=`${aue++}`;return $y[e]=i,e}else Object.assign($y,i)}function p7(i,e){const t=I3(i),n=$y[t];if(i!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(i==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function lue(i,e,t){var n;return i=I3(i)in $y?i:i.replace(rue,""),p7(i,e),i==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,LM(e.object,t,i,e)}function cue(i){if(!i.isHidden){var e;i.props.attach&&(e=i.parent)!=null&&e.object?PM(i.parent,i):xo(i.object)&&(i.object.visible=!1),i.isHidden=!0,Rv(i)}}function m7(i){if(i.isHidden){var e;i.props.attach&&(e=i.parent)!=null&&e.object?IM(i.parent,i):xo(i.object)&&i.props.visible!==!1&&(i.object.visible=!0),i.isHidden=!1,Rv(i)}}function wU(i,e,t){const n=e.root.getState();if(!(!i.parent&&i.object!==n.scene)){if(!e.object){var s,r;const a=$y[I3(e.type)];e.object=(s=e.props.object)!=null?s:new a(...(r=e.props.args)!=null?r:[]),e.object.__r3f=e}if(ld(e.object,e.props),e.props.attach)IM(i,e);else if(xo(e.object)&&xo(i.object)){const a=i.object.children.indexOf(t?.object);if(t&&a!==-1){const o=i.object.children.indexOf(e.object);if(o!==-1){i.object.children.splice(o,1);const l=o<a?a-1:a;i.object.children.splice(l,0,e.object)}else e.object.parent=i.object,i.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),i.object.dispatchEvent({type:"childadded",child:e.object})}else i.object.add(e.object)}for(const a of e.children)wU(e,a);Rv(e)}}function d2(i,e){e&&(e.parent=i,i.children.push(e),wU(i,e))}function S4(i,e,t){if(!e||!t)return;e.parent=i;const n=i.children.indexOf(t);n!==-1?i.children.splice(n,0,e):i.children.push(e),wU(i,e,t)}function g7(i){if(typeof i.dispose=="function"){const e=()=>{try{i.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():x4.unstable_scheduleCallback(x4.unstable_IdlePriority,e)}}function IN(i,e,t){if(!e)return;e.parent=null;const n=i.children.indexOf(e);n!==-1&&i.children.splice(n,1),e.props.attach?PM(i,e):xo(e.object)&&xo(i.object)&&(i.object.remove(e.object),eue(a7(e),e.object));const s=e.props.dispose!==null&&t!==!1;for(let r=e.children.length-1;r>=0;r--){const a=e.children[r];IN(e,a,s)}e.children.length=0,delete e.object.__r3f,s&&e.type!=="primitive"&&e.object.type!=="Scene"&&g7(e.object),t===void 0&&Rv(e)}function uue(i,e){for(const t of[i,i.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const dM=[];function due(){for(const[t]of dM){const n=t.parent;if(n){t.props.attach?PM(n,t):xo(t.object)&&xo(n.object)&&n.object.remove(t.object);for(const s of t.children)s.props.attach?PM(t,s):xo(s.object)&&xo(t.object)&&t.object.remove(s.object)}t.isHidden&&m7(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&g7(t.object)}for(const[t,n,s]of dM){t.props=n;const r=t.parent;if(r){var i,e;const a=$y[I3(t.type)];t.object=(i=t.props.object)!=null?i:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,uue(s,t.object),ld(t.object,t.props),t.props.attach?IM(r,t):xo(t.object)&&xo(r.object)&&r.object.add(t.object);for(const o of t.children)o.props.attach?IM(t,o):xo(o.object)&&xo(t.object)&&t.object.add(o.object);Rv(t)}}dM.length=0}const f2=()=>{},T4={};let GE=h7;const fue=0,hue=4,FM=sue({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:lue,removeChild:IN,appendChild:d2,appendInitialChild:d2,insertBefore:S4,appendChildToContainer(i,e){const t=i.getState().scene.__r3f;!e||!t||d2(t,e)},removeChildFromContainer(i,e){const t=i.getState().scene.__r3f;!e||!t||IN(t,e)},insertInContainerBefore(i,e,t){const n=i.getState().scene.__r3f;!e||!t||!n||S4(n,e,t)},getRootHostContext:()=>T4,getChildHostContext:()=>T4,commitUpdate(i,e,t,n,s){var r,a,o;p7(e,n);let l=!1;if((i.type==="primitive"&&t.object!==n.object||((r=n.args)==null?void 0:r.length)!==((a=t.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((f,p)=>{var x;return f!==((x=t.args)==null?void 0:x[p])}))&&(l=!0),l)dM.push([i,{...n},s]);else{const f=Jce(i,n);Object.keys(f).length&&(Object.assign(i.props,f),ld(i.object,f))}(s.sibling===null||(s.flags&hue)===fue)&&due()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:i=>i?.object,prepareForCommit:()=>null,preparePortalMount:i=>LM(i.getState().scene,i,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:cue,unhideInstance:m7,createTextInstance:f2,hideTextInstance:f2,unhideTextInstance:f2,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:G.createContext(null),setCurrentUpdatePriority(i){GE=i},getCurrentUpdatePriority(){return GE},resolveUpdatePriority(){var i;if(GE!==h7)return GE;switch(typeof window<"u"&&((i=window.event)==null?void 0:i.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return cM.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return cM.ContinuousEventPriority;default:return cM.DefaultEventPriority}},resetFormInstance(){}}),u0=new Map,cy={objects:"shallow",strict:!1};function pue(i,e){if(!e&&typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:t,height:n,top:s,left:r}=i.parentElement.getBoundingClientRect();return{width:t,height:n,top:s,left:r}}else if(!e&&typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function mue(i){const e=u0.get(i),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,r=n||nue(GN,E4),a=t||FM.createContainer(r,cM.ConcurrentRoot,null,!1,null,"",s,s,s,null);e||u0.set(i,{fiber:a,store:r});let o,l,u=!1,f=null;return{async configure(p={}){let x;f=new Promise(K=>x=K);let{gl:y,size:_,scene:T,events:A,onCreated:S,shadows:C=!1,linear:w=!1,flat:B=!1,legacy:L=!1,orthographic:D=!1,frameloop:O="always",dpr:F=[1,2],performance:U,raycaster:P,camera:X,onPointerMissed:Z}=p,ee=r.getState(),te=ee.gl;if(!ee.gl){const K={canvas:i,powerPreference:"high-performance",antialias:!0,alpha:!0},pe=typeof y=="function"?await y(K):y;_4(pe)?te=pe:te=new SU({...K,...y}),ee.set({gl:te})}let re=ee.raycaster;re||ee.set({raycaster:re=new GT});const{params:W,...ne}=P||{};if(Is.equ(ne,re,cy)||ld(re,{...ne}),Is.equ(W,re.params,cy)||ld(re,{params:{...re.params,...W}}),!ee.camera||ee.camera===l&&!Is.equ(l,X,cy)){l=X;const K=X?.isCamera,pe=K?X:D?new Ac(0,0,0,0,.1,1e3):new bs(75,0,.1,1e3);K||(pe.position.z=5,X&&(ld(pe,X),pe.manual||("aspect"in X||"left"in X||"right"in X||"bottom"in X||"top"in X)&&(pe.manual=!0,pe.updateProjectionMatrix())),!ee.camera&&!(X!=null&&X.rotation)&&pe.lookAt(0,0,0)),ee.set({camera:pe}),re.camera=pe}if(!ee.scene){let K;T!=null&&T.isScene?(K=T,LM(K,r,"",{})):(K=new Qf,LM(K,r,"",{}),T&&ld(K,T)),ee.set({scene:K})}A&&!ee.events.handlers&&ee.set({events:A(r)});const se=pue(i,_);if(Is.equ(se,ee.size,cy)||ee.setSize(se.width,se.height,se.top,se.left),F&&ee.viewport.dpr!==l7(F)&&ee.setDpr(F),ee.frameloop!==O&&ee.setFrameloop(O),ee.onPointerMissed||ee.set({onPointerMissed:Z}),U&&!Is.equ(U,ee.performance,cy)&&ee.set(K=>({performance:{...K.performance,...U}})),!ee.xr){var ge;const K=(Ne,gt)=>{const Se=r.getState();Se.frameloop!=="never"&&E4(Ne,!0,Se,gt)},pe=()=>{const Ne=r.getState();Ne.gl.xr.enabled=Ne.gl.xr.isPresenting,Ne.gl.xr.setAnimationLoop(Ne.gl.xr.isPresenting?K:null),Ne.gl.xr.isPresenting||GN(Ne)},we={connect(){const Ne=r.getState().gl;Ne.xr.addEventListener("sessionstart",pe),Ne.xr.addEventListener("sessionend",pe)},disconnect(){const Ne=r.getState().gl;Ne.xr.removeEventListener("sessionstart",pe),Ne.xr.removeEventListener("sessionend",pe)}};typeof((ge=te.xr)==null?void 0:ge.addEventListener)=="function"&&we.connect(),ee.set({xr:we})}if(te.shadowMap){const K=te.shadowMap.enabled,pe=te.shadowMap.type;if(te.shadowMap.enabled=!!C,Is.boo(C))te.shadowMap.type=My;else if(Is.str(C)){var _e;const we={basic:oC,percentage:ev,soft:My,variance:Fa};te.shadowMap.type=(_e=we[C])!=null?_e:My}else Is.obj(C)&&Object.assign(te.shadowMap,C);(K!==te.shadowMap.enabled||pe!==te.shadowMap.type)&&(te.shadowMap.needsUpdate=!0)}return yn.enabled=!L,u||(te.outputColorSpace=w?Qo:Mr,te.toneMapping=B?zr:sT),ee.legacy!==L&&ee.set(()=>({legacy:L})),ee.linear!==w&&ee.set(()=>({linear:w})),ee.flat!==B&&ee.set(()=>({flat:B})),y&&!Is.fun(y)&&!_4(y)&&!Is.equ(y,te,cy)&&ld(te,y),o=S,u=!0,x(),this},render(p){return!u&&!f&&this.configure(),f.then(()=>{FM.updateContainer(Pt.jsx(gue,{store:r,children:p,onCreated:o,rootElement:i}),a,null,()=>{})}),r},unmount(){x7(i)}}}function gue({store:i,children:e,onCreated:t,rootElement:n}){return ZT(()=>{const s=i.getState();s.set(r=>({internal:{...r.internal,active:!0}})),t&&t(s),i.getState().events.connected||s.events.connect==null||s.events.connect(n)},[]),Pt.jsx(MU.Provider,{value:i,children:e})}function x7(i,e){const t=u0.get(i),n=t?.fiber;if(n){const s=t?.store.getState();s&&(s.internal.active=!1),FM.updateContainer(null,n,null,()=>{s&&setTimeout(()=>{try{var r,a,o,l;s.events.disconnect==null||s.events.disconnect(),(r=s.gl)==null||(a=r.renderLists)==null||a.dispose==null||a.dispose(),(o=s.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=s.gl)!=null&&l.xr&&s.xr.disconnect(),jce(s.scene),u0.delete(i)}catch{}},500)})}}function xue(i,e,t){return Pt.jsx(yue,{children:i,container:e,state:t})}function yue({state:i={},children:e,container:t}){const{events:n,size:s,...r}=i,a=CU(),[o]=G.useState(()=>new GT),[l]=G.useState(()=>new Ze),u=EU((p,x)=>{let y;if(x.camera&&s){const _=x.camera;y=p.viewport.getCurrentViewport(_,new Q,s),_!==p.camera&&u7(_,s)}return{...p,...x,scene:t,raycaster:o,pointer:l,mouse:l,previousRoot:a,events:{...p.events,...x.events,...n},size:{...p.size,...s},viewport:{...p.viewport,...y},setEvents:_=>x.set(T=>({...T,events:{...T.events,..._}}))}}),f=G.useMemo(()=>{const p=Qk((y,_)=>({...r,set:y,get:_})),x=y=>p.setState(_=>u.current(y,_));return x(a.getState()),a.subscribe(x),p},[a,t]);return Pt.jsx(Pt.Fragment,{children:FM.createPortal(Pt.jsx(MU.Provider,{value:f,children:e}),f,null)})}const vue=new Set,_ue=new Set,bue=new Set;function h2(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function pS(i,e){switch(i){case"before":return h2(vue,e);case"after":return h2(_ue,e);case"tail":return h2(bue,e)}}let p2,m2;function PN(i,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),p2=e.internal.subscribers;for(let s=0;s<p2.length;s++)m2=p2[s],m2.ref.current(m2.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let GM=!1,FN=!1,g2,A4,uy;function y7(i){A4=requestAnimationFrame(y7),GM=!0,g2=0,pS("before",i),FN=!0;for(const t of u0.values()){var e;uy=t.store.getState(),uy.internal.active&&(uy.frameloop==="always"||uy.internal.frames>0)&&!((e=uy.gl.xr)!=null&&e.isPresenting)&&(g2+=PN(i,uy))}if(FN=!1,pS("after",i),g2===0)return pS("tail",i),GM=!1,cancelAnimationFrame(A4)}function GN(i,e=1){var t;if(!i)return u0.forEach(n=>GN(n.store.getState(),e));(t=i.gl.xr)!=null&&t.isPresenting||!i.internal.active||i.frameloop==="never"||(e>1?i.internal.frames=Math.min(60,i.internal.frames+e):FN?i.internal.frames=2:i.internal.frames=1,GM||(GM=!0,requestAnimationFrame(y7)))}function E4(i,e=!0,t,n){if(e&&pS("before",i),t)PN(i,t,n);else for(const s of u0.values())PN(i,s.store.getState());e&&pS("after",i)}const x2={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Sue(i){const{handlePointer:e}=tue(i);return{priority:1,enabled:!0,compute(t,n,s){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(x2).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:s}=i.getState();(t=s.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(s.lastEvent.current)},connect:t=>{const{set:n,events:s}=i.getState();if(s.disconnect==null||s.disconnect(),n(r=>({events:{...r.events,connected:t}})),s.handlers)for(const r in s.handlers){const a=s.handlers[r],[o,l]=x2[r];t.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){if(n.handlers)for(const s in n.handlers){const r=n.handlers[s],[a]=x2[s];n.connected.removeEventListener(a,r)}t(s=>({events:{...s.events,connected:void 0}}))}}}}function M4(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function Tue({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const s=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,a]=G.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=G.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,u=i?typeof i=="number"?i:i.resize:null,f=G.useRef(!1);G.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[p,x,y]=G.useMemo(()=>{const S=()=>{if(!o.current.element)return;const{left:C,top:w,width:B,height:L,bottom:D,right:O,x:F,y:U}=o.current.element.getBoundingClientRect(),P={left:C,top:w,width:B,height:L,bottom:D,right:O,x:F,y:U};o.current.element instanceof HTMLElement&&n&&(P.height=o.current.element.offsetHeight,P.width=o.current.element.offsetWidth),Object.freeze(P),f.current&&!Cue(o.current.lastBounds,P)&&a(o.current.lastBounds=P)};return[S,u?M4(S,u):S,l?M4(S,l):S]},[a,n,l,u]);function _(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",y,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function T(){o.current.element&&(o.current.resizeObserver=new s(y),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(S=>S.addEventListener("scroll",y,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const A=S=>{!S||S===o.current.element||(_(),o.current.element=S,o.current.scrollContainers=v7(S),T())};return Eue(y,!!e),Aue(x),G.useEffect(()=>{_(),T()},[e,y,x]),G.useEffect(()=>_,[]),[A,r,p]}function Aue(i){G.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function Eue(i,e){G.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function v7(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:s}=window.getComputedStyle(i);return[t,n,s].some(r=>r==="auto"||r==="scroll")&&e.push(i),[...e,...v7(i.parentElement)]}const Mue=["x","y","top","bottom","left","right","width","height"],Cue=(i,e)=>Mue.every(t=>i[t]===e[t]);function Rue({ref:i,children:e,fallback:t,resize:n,style:s,gl:r,events:a=Sue,eventSource:o,eventPrefix:l,shadows:u,linear:f,flat:p,legacy:x,orthographic:y,frameloop:_,dpr:T,performance:A,raycaster:S,camera:C,scene:w,onPointerMissed:B,onCreated:L,...D}){G.useMemo(()=>P3(vce),[]);const O=Wce(),[F,U]=Tue({scroll:!0,debounce:{scroll:50,resize:0},...n}),P=G.useRef(null),X=G.useRef(null);G.useImperativeHandle(i,()=>P.current);const Z=EU(B),[ee,te]=G.useState(!1),[re,W]=G.useState(!1);if(ee)throw ee;if(re)throw re;const ne=G.useRef(null);ZT(()=>{const ge=P.current;if(U.width>0&&U.height>0&&ge){ne.current||(ne.current=mue(ge));async function _e(){await ne.current.configure({gl:r,scene:w,events:a,shadows:u,linear:f,flat:p,legacy:x,orthographic:y,frameloop:_,dpr:T,performance:A,raycaster:S,camera:C,size:U,onPointerMissed:(...K)=>Z.current==null?void 0:Z.current(...K),onCreated:K=>{K.events.connect==null||K.events.connect(o?Hce(o)?o.current:o:X.current),l&&K.setEvents({compute:(pe,we)=>{const Ne=pe[l+"X"],gt=pe[l+"Y"];we.pointer.set(Ne/we.size.width*2-1,-(gt/we.size.height)*2+1),we.raycaster.setFromCamera(we.pointer,we.camera)}}),L?.(K)}}),ne.current.render(Pt.jsx(O,{children:Pt.jsx(qce,{set:W,children:Pt.jsx(G.Suspense,{fallback:Pt.jsx(Xce,{set:te}),children:e??null})})}))}_e()}}),G.useEffect(()=>{const ge=P.current;if(ge)return()=>x7(ge)},[]);const se=o?"none":"auto";return Pt.jsx("div",{ref:X,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:se,...s},...D,children:Pt.jsx("div",{ref:F,style:{width:"100%",height:"100%"},children:Pt.jsx("canvas",{ref:P,style:{display:"block"},children:t})})})}function wue(i){return Pt.jsx(s7,{children:Pt.jsx(Rue,{...i})})}function ru(){return ru=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ru.apply(null,arguments)}const QT=new Q,NU=new Q,Nue=new Q,C4=new Ze;function Bue(i,e,t){const n=QT.setFromMatrixPosition(i.matrixWorld);n.project(e);const s=t.width/2,r=t.height/2;return[n.x*s+s,-(n.y*r)+r]}function Due(i,e){const t=QT.setFromMatrixPosition(i.matrixWorld),n=NU.setFromMatrixPosition(e.matrixWorld),s=t.sub(n),r=e.getWorldDirection(Nue);return s.angleTo(r)>Math.PI/2}function Oue(i,e,t,n){const s=QT.setFromMatrixPosition(i.matrixWorld),r=s.clone();r.project(e),C4.set(r.x,r.y),t.setFromCamera(C4,e);const a=t.intersectObjects(n,!0);if(a.length){const o=a[0].distance;return s.distanceTo(t.ray.origin)<o}return!0}function Uue(i,e){if(e instanceof Ac)return e.zoom;if(e instanceof bs){const t=QT.setFromMatrixPosition(i.matrixWorld),n=NU.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,r=t.distanceTo(n);return 1/(2*Math.tan(s/2)*r)}else return 1}function Lue(i,e,t){if(e instanceof bs||e instanceof Ac){const n=QT.setFromMatrixPosition(i.matrixWorld),s=NU.setFromMatrixPosition(e.matrixWorld),r=n.distanceTo(s),a=(t[1]-t[0])/(e.far-e.near),o=t[1]-a*e.far;return Math.round(a*r+o)}}const zN=i=>Math.abs(i)<1e-10?0:i;function _7(i,e,t=""){let n="matrix3d(";for(let s=0;s!==16;s++)n+=zN(e[s]*i.elements[s])+(s!==15?",":")");return t+n}const Iue=(i=>e=>_7(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Pue=(i=>(e,t)=>_7(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function Fue(i){return i&&typeof i=="object"&&"current"in i}const Gue=G.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:s,center:r,fullscreen:a,portal:o,distanceFactor:l,sprite:u=!1,transform:f=!1,occlude:p,onOcclude:x,castShadow:y,receiveShadow:_,material:T,geometry:A,zIndexRange:S=[16777271,0],calculatePosition:C=Bue,as:w="div",wrapperClass:B,pointerEvents:L="auto",...D},O)=>{const{gl:F,camera:U,scene:P,size:X,raycaster:Z,events:ee,viewport:te}=yo(),[re]=G.useState(()=>document.createElement(w)),W=G.useRef(null),ne=G.useRef(null),se=G.useRef(0),ge=G.useRef([0,0]),_e=G.useRef(null),K=G.useRef(null),pe=o?.current||ee.connected||F.domElement.parentNode,we=G.useRef(null),Ne=G.useRef(!1),gt=G.useMemo(()=>p&&p!=="blending"||Array.isArray(p)&&p.length&&Fue(p[0]),[p]);G.useLayoutEffect(()=>{const Nt=F.domElement;p&&p==="blending"?(Nt.style.zIndex=`${Math.floor(S[0]/2)}`,Nt.style.position="absolute",Nt.style.pointerEvents="none"):(Nt.style.zIndex=null,Nt.style.position=null,Nt.style.pointerEvents=null)},[p]),G.useLayoutEffect(()=>{if(ne.current){const Nt=W.current=xB.createRoot(re);if(P.updateMatrixWorld(),f)re.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const It=C(ne.current,U,X);re.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${It[0]}px,${It[1]}px,0);transform-origin:0 0;`}return pe&&(s?pe.prepend(re):pe.appendChild(re)),()=>{pe&&pe.removeChild(re),Nt.unmount()}}},[pe,f]),G.useLayoutEffect(()=>{B&&(re.className=B)},[B]);const Se=G.useMemo(()=>f?{position:"absolute",top:0,left:0,width:X.width,height:X.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:r?"translate3d(-50%,-50%,0)":"none",...a&&{top:-X.height/2,left:-X.width/2,width:X.width,height:X.height},...t},[t,r,a,X,f]),Be=G.useMemo(()=>({position:"absolute",pointerEvents:L}),[L]);G.useLayoutEffect(()=>{if(Ne.current=!1,f){var Nt;(Nt=W.current)==null||Nt.render(G.createElement("div",{ref:_e,style:Se},G.createElement("div",{ref:K,style:Be},G.createElement("div",{ref:O,className:n,style:t,children:i}))))}else{var It;(It=W.current)==null||It.render(G.createElement("div",{ref:O,style:Se,className:n,children:i}))}});const ct=G.useRef(!0);RU(Nt=>{if(ne.current){U.updateMatrixWorld(),ne.current.updateWorldMatrix(!0,!1);const It=f?ge.current:C(ne.current,U,X);if(f||Math.abs(se.current-U.zoom)>e||Math.abs(ge.current[0]-It[0])>e||Math.abs(ge.current[1]-It[1])>e){const Mn=Due(ne.current,U);let Gt=!1;gt&&(Array.isArray(p)?Gt=p.map(dt=>dt.current):p!=="blending"&&(Gt=[P]));const Qe=ct.current;if(Gt){const dt=Oue(ne.current,U,Z,Gt);ct.current=dt&&!Mn}else ct.current=!Mn;Qe!==ct.current&&(x?x(!ct.current):re.style.display=ct.current?"block":"none");const ie=Math.floor(S[0]/2),ot=p?gt?[S[0],ie]:[ie-1,0]:S;if(re.style.zIndex=`${Lue(ne.current,U,ot)}`,f){const[dt,Tt]=[X.width/2,X.height/2],ht=U.projectionMatrix.elements[5]*Tt,{isOrthographicCamera:Ut,top:At,left:Ht,bottom:q,right:V}=U,Te=Iue(U.matrixWorldInverse),Ge=Ut?`scale(${ht})translate(${zN(-(V+Ht)/2)}px,${zN((At+q)/2)}px)`:`translateZ(${ht}px)`;let $e=ne.current.matrixWorld;u&&($e=U.matrixWorldInverse.clone().transpose().copyPosition($e).scale(ne.current.scale),$e.elements[3]=$e.elements[7]=$e.elements[11]=0,$e.elements[15]=1),re.style.width=X.width+"px",re.style.height=X.height+"px",re.style.perspective=Ut?"":`${ht}px`,_e.current&&K.current&&(_e.current.style.transform=`${Ge}${Te}translate(${dt}px,${Tt}px)`,K.current.style.transform=Pue($e,1/((l||10)/400)))}else{const dt=l===void 0?1:Uue(ne.current,U)*l;re.style.transform=`translate3d(${It[0]}px,${It[1]}px,0) scale(${dt})`}ge.current=It,se.current=U.zoom}}if(!gt&&we.current&&!Ne.current)if(f){if(_e.current){const It=_e.current.children[0];if(It!=null&&It.clientWidth&&It!=null&&It.clientHeight){const{isOrthographicCamera:Mn}=U;if(Mn||A)D.scale&&(Array.isArray(D.scale)?D.scale instanceof Q?we.current.scale.copy(D.scale.clone().divideScalar(1)):we.current.scale.set(1/D.scale[0],1/D.scale[1],1/D.scale[2]):we.current.scale.setScalar(1/D.scale));else{const Gt=(l||10)/400,Qe=It.clientWidth*Gt,ie=It.clientHeight*Gt;we.current.scale.set(Qe,ie,1)}Ne.current=!0}}}else{const It=re.children[0];if(It!=null&&It.clientWidth&&It!=null&&It.clientHeight){const Mn=1/te.factor,Gt=It.clientWidth*Mn,Qe=It.clientHeight*Mn;we.current.scale.set(Gt,Qe,1),Ne.current=!0}we.current.lookAt(Nt.camera.position)}});const Dt=G.useMemo(()=>({vertexShader:f?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[f]);return G.createElement("group",ru({},D,{ref:ne}),p&&!gt&&G.createElement("mesh",{castShadow:y,receiveShadow:_,ref:we},A||G.createElement("planeGeometry",null),T||G.createElement("shaderMaterial",{side:hr,vertexShader:Dt.vertexShader,fragmentShader:Dt.fragmentShader})))}),zue=i=>i;function Vue(i,e=zue){const t=ue.useSyncExternalStore(i.subscribe,ue.useCallback(()=>e(i.getState()),[i,e]),ue.useCallback(()=>e(i.getInitialState()),[i,e]));return ue.useDebugValue(t),t}const R4=i=>{const e=Zk(i),t=n=>Vue(e,n);return Object.assign(t,e),t},Hue=(i=>i?R4(i):R4);let Fb=0;const kue=Hue(i=>(Mg.onStart=(e,t,n)=>{i({active:!0,item:e,loaded:t,total:n,progress:(t-Fb)/(n-Fb)*100})},Mg.onLoad=()=>{i({active:!1})},Mg.onError=e=>i(t=>({errors:[...t.errors,e]})),Mg.onProgress=(e,t,n)=>{t===n&&(Fb=n),i({active:!0,item:e,loaded:t,total:n,progress:(t-Fb)/(n-Fb)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Wue=i=>`Loading ${i.toFixed(2)}%`;function Xue({containerStyles:i,innerStyles:e,barStyles:t,dataStyles:n,dataInterpolation:s=Wue,initialState:r=a=>a}){const{active:a,progress:o}=kue(),l=G.useRef(0),u=G.useRef(0),f=G.useRef(null),[p,x]=G.useState(r(a));G.useEffect(()=>{let _;return a!==p&&(_=setTimeout(()=>x(a),300)),()=>clearTimeout(_)},[p,a]);const y=G.useCallback(()=>{f.current&&(l.current+=(o-l.current)/2,(l.current>.95*o||o===100)&&(l.current=o),f.current.innerText=s(l.current),l.current<o&&(u.current=requestAnimationFrame(y)))},[s,o]);return G.useEffect(()=>(y(),()=>cancelAnimationFrame(u.current)),[y]),p?G.createElement("div",{style:{...zE.container,opacity:a?1:0,...i}},G.createElement("div",null,G.createElement("div",{style:{...zE.inner,...e}},G.createElement("div",{style:{...zE.bar,transform:`scaleX(${o/100})`,...t}}),G.createElement("span",{ref:f,style:{...zE.data,...n}})))):null}const zE={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function que(i,e,t){return Math.max(e,Math.min(i,t))}const Va={toVector(i,e){return i===void 0&&(i=e),Array.isArray(i)?i:[i,i]},add(i,e){return[i[0]+e[0],i[1]+e[1]]},sub(i,e){return[i[0]-e[0],i[1]-e[1]]},addTo(i,e){i[0]+=e[0],i[1]+=e[1]},subTo(i,e){i[0]-=e[0],i[1]-=e[1]}};function w4(i,e,t){return e===0||Math.abs(e)===1/0?Math.pow(i,t*5):i*e*t/(e+t*i)}function N4(i,e,t,n=.15){return n===0?que(i,e,t):i<e?-w4(e-i,t-e,n)+e:i>t?+w4(i-t,t-e,n)+t:i}function Yue(i,[e,t],[n,s]){const[[r,a],[o,l]]=i;return[N4(e,r,a,n),N4(t,o,l,s)]}function jue(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function $ue(i){var e=jue(i,"string");return typeof e=="symbol"?e:String(e)}function Yo(i,e,t){return e=$ue(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function B4(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function Ys(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?B4(Object(t),!0).forEach(function(n){Yo(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):B4(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const b7={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function D4(i){return i?i[0].toUpperCase()+i.slice(1):""}const Kue=["enter","leave"];function Jue(i=!1,e){return i&&!Kue.includes(e)}function Zue(i,e="",t=!1){const n=b7[i],s=n&&n[e]||e;return"on"+D4(i)+D4(s)+(Jue(t,s)?"Capture":"")}const Que=["gotpointercapture","lostpointercapture"];function ede(i){let e=i.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=Que.includes(e)?"capturecapture":"capture",s=!!~e.indexOf(n);return s&&(e=e.replace("capture","")),{device:e,capture:s,passive:t}}function tde(i,e=""){const t=b7[i],n=t&&t[e]||e;return i+n}function F3(i){return"touches"in i}function S7(i){return F3(i)?"touch":"pointerType"in i?i.pointerType:"mouse"}function nde(i){return Array.from(i.touches).filter(e=>{var t,n;return e.target===i.currentTarget||((t=i.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function ide(i){return i.type==="touchend"||i.type==="touchcancel"?i.changedTouches:i.targetTouches}function T7(i){return F3(i)?ide(i)[0]:i}function sde(i){return nde(i).map(e=>e.identifier)}function y2(i){const e=T7(i);return F3(i)?e.identifier:e.pointerId}function O4(i){const e=T7(i);return[e.clientX,e.clientY]}function rde(i){const e={};if("buttons"in i&&(e.buttons=i.buttons),"shiftKey"in i){const{shiftKey:t,altKey:n,metaKey:s,ctrlKey:r}=i;Object.assign(e,{shiftKey:t,altKey:n,metaKey:s,ctrlKey:r})}return e}function zM(i,...e){return typeof i=="function"?i(...e):i}function ade(){}function ode(...i){return i.length===0?ade:i.length===1?i[0]:function(){let e;for(const t of i)e=t.apply(this,arguments)||e;return e}}function U4(i,e){return Object.assign({},e,i||{})}const lde=32;class cde{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:s}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?zM(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:s}=this;t.args=this.args;let r=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,rde(e)),s.down=s.pressed=s.buttons%2===1||s.touches>0,r=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const D=t._delta.map(Math.abs);Va.addTo(t._distance,D)}this.axisIntent&&this.axisIntent(e);const[a,o]=t._movement,[l,u]=n.threshold,{_step:f,values:p}=t;if(n.hasCustomTransform?(f[0]===!1&&(f[0]=Math.abs(a)>=l&&p[0]),f[1]===!1&&(f[1]=Math.abs(o)>=u&&p[1])):(f[0]===!1&&(f[0]=Math.abs(a)>=l&&Math.sign(a)*l),f[1]===!1&&(f[1]=Math.abs(o)>=u&&Math.sign(o)*u)),t.intentional=f[0]!==!1||f[1]!==!1,!t.intentional)return;const x=[0,0];if(n.hasCustomTransform){const[D,O]=p;x[0]=f[0]!==!1?D-f[0]:0,x[1]=f[1]!==!1?O-f[1]:0}else x[0]=f[0]!==!1?a-f[0]:0,x[1]=f[1]!==!1?o-f[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(x);const y=t.offset,_=t._active&&!t._blocked||t.active;_&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=s[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=zM(n.bounds,t)),this.setup&&this.setup()),t.movement=x,this.computeOffset()));const[T,A]=t.offset,[[S,C],[w,B]]=t._bounds;t.overflow=[T<S?-1:T>C?1:0,A<w?-1:A>B?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const L=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=Yue(t._bounds,t.offset,L),t.delta=Va.sub(t.offset,y),this.computeMovement(),_&&(!t.last||r>lde)){t.delta=Va.sub(t.offset,y);const D=t.delta.map(Math.abs);Va.addTo(t.distance,D),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&r>0&&(t.velocity=[D[0]/r,D[1]/r],t.timeDelta=r)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const s=this.handler(Ys(Ys(Ys({},t),e),{},{[this.aliasKey]:e.values}));s!==void 0&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function ude([i,e],t){const n=Math.abs(i),s=Math.abs(e);if(n>s&&n>t)return"x";if(s>n&&s>t)return"y"}class dde extends cde{constructor(...e){super(...e),Yo(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Va.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Va.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const s=typeof n.axisThreshold=="object"?n.axisThreshold[S7(e)]:n.axisThreshold;t.axis=ude(t._movement,s)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const fde=i=>i,L4=.15,A7={enabled(i=!0){return i},eventOptions(i,e,t){return Ys(Ys({},t.shared.eventOptions),i)},preventDefault(i=!1){return i},triggerAllEvents(i=!1){return i},rubberband(i=0){switch(i){case!0:return[L4,L4];case!1:return[0,0];default:return Va.toVector(i)}},from(i){if(typeof i=="function")return i;if(i!=null)return Va.toVector(i)},transform(i,e,t){const n=i||t.shared.transform;return this.hasCustomTransform=!!n,n||fde},threshold(i){return Va.toVector(i,0)}},hde=0,eA=Ys(Ys({},A7),{},{axis(i,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(i=hde){return i},bounds(i={}){if(typeof i=="function")return r=>eA.bounds(i(r));if("current"in i)return()=>i.current;if(typeof HTMLElement=="function"&&i instanceof HTMLElement)return i;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:s=1/0}=i;return[[e,t],[n,s]]}}),I4={ArrowRight:(i,e=1)=>[i*e,0],ArrowLeft:(i,e=1)=>[-1*i*e,0],ArrowUp:(i,e=1)=>[0,-1*i*e],ArrowDown:(i,e=1)=>[0,i*e]};class pde extends dde{constructor(...e){super(...e),Yo(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),s={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=eA.bounds(s)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const s=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(s&&s.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=y2(e),n._pointerActive=!0,this.computeValues(O4(e)),this.computeInitial(),t.preventScrollAxis&&S7(e)!=="mouse"?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const s=y2(e);if(t._pointerId!==void 0&&s!==t._pointerId)return;const r=O4(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Va.sub(r,t._values),this.computeValues(r)),Va.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(n.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===n.preventScrollAxis||n.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const s=y2(e);if(t._pointerId!==void 0&&s!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[r,a]=t._distance;if(t.tap=r<=n.tapsThreshold&&a<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[o,l]=t._delta,[u,f]=t._movement,[p,x]=n.swipe.velocity,[y,_]=n.swipe.distance,T=n.swipe.duration;if(t.elapsedTime<T){const A=Math.abs(o/t.timeDelta),S=Math.abs(l/t.timeDelta);A>p&&Math.abs(u)>y&&(t.swipe[0]=Math.sign(o)),S>x&&Math.abs(f)>_&&(t.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,mde(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=I4[e.key];if(t){const n=this.state,s=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,s),n._keyboardActive=!0,Va.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in I4&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function mde(i){"persist"in i&&typeof i.persist=="function"&&i.persist()}const tA=typeof window<"u"&&window.document&&window.document.createElement;function E7(){return tA&&"ontouchstart"in window}function gde(){return E7()||tA&&window.navigator.maxTouchPoints>1}function xde(){return tA&&"onpointerdown"in window}function yde(){return tA&&"exitPointerLock"in window.document}function vde(){try{return"constructor"in GestureEvent}catch{return!1}}const cc={isBrowser:tA,gesture:vde(),touch:E7(),touchscreen:gde(),pointer:xde(),pointerLock:yde()},_de=250,bde=180,Sde=.5,Tde=50,Ade=250,Ede=10,P4={mouse:0,touch:0,pen:8},Mde=Ys(Ys({},eA),{},{device(i,e,{pointer:{touch:t=!1,lock:n=!1,mouse:s=!1}={}}){return this.pointerLock=n&&cc.pointerLock,cc.touch&&t?"touch":this.pointerLock?"mouse":cc.pointer&&!s?"pointer":cc.touch?"touch":"mouse"},preventScrollAxis(i,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&i?_de:void 0,!(!cc.touchscreen||t===!1))return i||(t!==void 0?"y":void 0)},pointerCapture(i,e,{pointer:{capture:t=!0,buttons:n=1,keys:s=!0}={}}){return this.pointerButtons=n,this.keys=s,!this.pointerLock&&this.device==="pointer"&&t},threshold(i,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:s=void 0}){const r=Va.toVector(i,t?n:s?1:0);return this.filterTaps=t,this.tapsThreshold=n,r},swipe({velocity:i=Sde,distance:e=Tde,duration:t=Ade}={}){return{velocity:this.transform(Va.toVector(i)),distance:this.transform(Va.toVector(e)),duration:t}},delay(i=0){switch(i){case!0:return bde;case!1:return 0;default:return i}},axisThreshold(i){return i?Ys(Ys({},P4),i):P4},keyboardDisplacement(i=Ede){return i}});Ys(Ys({},A7),{},{device(i,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!cc.touch&&cc.gesture)return"gesture";if(cc.touch&&n)return"touch";if(cc.touchscreen){if(cc.pointer)return"pointer";if(cc.touch)return"touch"}},bounds(i,e,{scaleBounds:t={},angleBounds:n={}}){const s=a=>{const o=U4(zM(t,a),{min:-1/0,max:1/0});return[o.min,o.max]},r=a=>{const o=U4(zM(n,a),{min:-1/0,max:1/0});return[o.min,o.max]};return typeof t!="function"&&typeof n!="function"?[s(),r()]:a=>[s(a),r(a)]},threshold(i,e,t){return this.lockDirection=t.axis==="lock",Va.toVector(i,this.lockDirection?[.1,3]:0)},modifierKey(i){return i===void 0?"ctrlKey":i},pinchOnWheel(i=!0){return i}});Ys(Ys({},eA),{},{mouseOnly:(i=!0)=>i});Ys(Ys({},eA),{},{mouseOnly:(i=!0)=>i});const M7=new Map,VN=new Map;function Cde(i){M7.set(i.key,i.engine),VN.set(i.key,i.resolver)}const Rde={key:"drag",engine:pde,resolver:Mde};function wde(i,e){if(i==null)return{};var t={},n=Object.keys(i),s,r;for(r=0;r<n.length;r++)s=n[r],!(e.indexOf(s)>=0)&&(t[s]=i[s]);return t}function Nde(i,e){if(i==null)return{};var t=wde(i,e),n,s;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(s=0;s<r.length;s++)n=r[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}const Bde={target(i){if(i)return()=>"current"in i?i.current:i},enabled(i=!0){return i},window(i=cc.isBrowser?window:void 0){return i},eventOptions({passive:i=!0,capture:e=!1}={}){return{passive:i,capture:e}},transform(i){return i}},Dde=["target","eventOptions","window","enabled","transform"];function fM(i={},e){const t={};for(const[n,s]of Object.entries(e))switch(typeof s){case"function":t[n]=s.call(t,i[n],n,i);break;case"object":t[n]=fM(i[n],s);break;case"boolean":s&&(t[n]=i[n]);break}return t}function Ode(i,e,t={}){const n=i,{target:s,eventOptions:r,window:a,enabled:o,transform:l}=n,u=Nde(n,Dde);if(t.shared=fM({target:s,eventOptions:r,window:a,enabled:o,transform:l},Bde),e){const f=VN.get(e);t[e]=fM(Ys({shared:t.shared},u),f)}else for(const f in u){const p=VN.get(f);p&&(t[f]=fM(Ys({shared:t.shared},u[f]),p))}return t}class C7{constructor(e,t){Yo(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,s,r){const a=this._listeners,o=tde(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=Ys(Ys({},l),r);e.addEventListener(o,s,u);const f=()=>{e.removeEventListener(o,s,u),a.delete(f)};return a.add(f),f}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Ude{constructor(){Yo(this,"_timeouts",new Map)}add(e,t,n=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...s))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Lde{constructor(e){Yo(this,"gestures",new Set),Yo(this,"_targetEventStore",new C7(this)),Yo(this,"gestureEventStores",{}),Yo(this,"gestureTimeoutStores",{}),Yo(this,"handlers",{}),Yo(this,"config",{}),Yo(this,"pointerIds",new Set),Yo(this,"touchIds",new Set),Yo(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Ide(this,e)}setEventIds(e){if(F3(e))return this.touchIds=new Set(sde(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=Ode(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let s;if(!(t.target&&(s=t.target(),!s))){if(t.enabled){for(const a of this.gestures){const o=this.config[a],l=F4(n,o.eventOptions,!!s);if(o.enabled){const u=M7.get(a);new u(this,e,a).bind(l)}}const r=F4(n,t.eventOptions,!!s);for(const a in this.nativeHandlers)r(a,"",o=>this.nativeHandlers[a](Ys(Ys({},this.state.shared),{},{event:o,args:e})),void 0,!0)}for(const r in n)n[r]=ode(...n[r]);if(!s)return n;for(const r in n){const{device:a,capture:o,passive:l}=ede(r);this._targetEventStore.add(s,a,"",n[r],{capture:o,passive:l})}}}}function dy(i,e){i.gestures.add(e),i.gestureEventStores[e]=new C7(i,e),i.gestureTimeoutStores[e]=new Ude}function Ide(i,e){e.drag&&dy(i,"drag"),e.wheel&&dy(i,"wheel"),e.scroll&&dy(i,"scroll"),e.move&&dy(i,"move"),e.pinch&&dy(i,"pinch"),e.hover&&dy(i,"hover")}const F4=(i,e,t)=>(n,s,r,a={},o=!1)=>{var l,u;const f=(l=a.capture)!==null&&l!==void 0?l:e.capture,p=(u=a.passive)!==null&&u!==void 0?u:e.passive;let x=o?n:Zue(n,s,f);t&&p&&(x+="Passive"),i[x]=i[x]||[],i[x].push(r)};function Pde(i,e={},t,n){const s=ue.useMemo(()=>new Lde(i),[]);if(s.applyHandlers(i,n),s.applyConfig(e,t),ue.useEffect(s.effect.bind(s)),ue.useEffect(()=>s.clean.bind(s),[]),e.target===void 0)return s.bind.bind(s)}function Fde(i,e){return Cde(Rde),Pde({drag:i},e||{},"drag")}const BU=parseInt($f.replace(/\D+/g,""));function G4(i,e){if(e===RB)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===TS||e===yC){let t=i.getIndex();if(t===null){const a=[],o=i.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);i.setIndex(a),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(t)if(e===TS)for(let a=1;a<=n;a++)s.push(t.getX(0)),s.push(t.getX(a)),s.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(s.push(t.getX(a)),s.push(t.getX(a+1)),s.push(t.getX(a+2))):(s.push(t.getX(a+2)),s.push(t.getX(a+1)),s.push(t.getX(a)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}var uc=Uint8Array,dp=Uint16Array,HN=Uint32Array,R7=new uc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),w7=new uc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Gde=new uc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N7=function(i,e){for(var t=new dp(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var s=new HN(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},B7=N7(R7,2),D7=B7[0],zde=B7[1];D7[28]=258,zde[258]=28;var Vde=N7(w7,0),Hde=Vde[0],kN=new dp(32768);for(var Cs=0;Cs<32768;++Cs){var Zh=(Cs&43690)>>>1|(Cs&21845)<<1;Zh=(Zh&52428)>>>2|(Zh&13107)<<2,Zh=(Zh&61680)>>>4|(Zh&3855)<<4,kN[Cs]=((Zh&65280)>>>8|(Zh&255)<<8)>>>1}var mS=(function(i,e,t){for(var n=i.length,s=0,r=new dp(e);s<n;++s)++r[i[s]-1];var a=new dp(e);for(s=0;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;var o;if(t){o=new dp(1<<e);var l=15-e;for(s=0;s<n;++s)if(i[s])for(var u=s<<4|i[s],f=e-i[s],p=a[i[s]-1]++<<f,x=p|(1<<f)-1;p<=x;++p)o[kN[p]>>>l]=u}else for(o=new dp(n),s=0;s<n;++s)i[s]&&(o[s]=kN[a[i[s]-1]++]>>>15-i[s]);return o}),nA=new uc(288);for(var Cs=0;Cs<144;++Cs)nA[Cs]=8;for(var Cs=144;Cs<256;++Cs)nA[Cs]=9;for(var Cs=256;Cs<280;++Cs)nA[Cs]=7;for(var Cs=280;Cs<288;++Cs)nA[Cs]=8;var O7=new uc(32);for(var Cs=0;Cs<32;++Cs)O7[Cs]=5;var kde=mS(nA,9,1),Wde=mS(O7,5,1),v2=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Qc=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},_2=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Xde=function(i){return(i/8|0)+(i&7&&1)},qde=function(i,e,t){(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof dp?dp:i instanceof HN?HN:uc)(t-e);return n.set(i.subarray(e,t)),n},Yde=function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new uc(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new uc(n*3));var a=function(Se){var Be=e.length;if(Se>Be){var ct=new uc(Math.max(Be*2,Se));ct.set(e),e=ct}},o=t.f||0,l=t.p||0,u=t.b||0,f=t.l,p=t.d,x=t.m,y=t.n,_=n*8;do{if(!f){t.f=o=Qc(i,l,1);var T=Qc(i,l+1,3);if(l+=3,T)if(T==1)f=kde,p=Wde,x=9,y=5;else if(T==2){var w=Qc(i,l,31)+257,B=Qc(i,l+10,15)+4,L=w+Qc(i,l+5,31)+1;l+=14;for(var D=new uc(L),O=new uc(19),F=0;F<B;++F)O[Gde[F]]=Qc(i,l+F*3,7);l+=B*3;for(var U=v2(O),P=(1<<U)-1,X=mS(O,U,1),F=0;F<L;){var Z=X[Qc(i,l,P)];l+=Z&15;var A=Z>>>4;if(A<16)D[F++]=A;else{var ee=0,te=0;for(A==16?(te=3+Qc(i,l,3),l+=2,ee=D[F-1]):A==17?(te=3+Qc(i,l,7),l+=3):A==18&&(te=11+Qc(i,l,127),l+=7);te--;)D[F++]=ee}}var re=D.subarray(0,w),W=D.subarray(w);x=v2(re),y=v2(W),f=mS(re,x,1),p=mS(W,y,1)}else throw"invalid block type";else{var A=Xde(l)+4,S=i[A-4]|i[A-3]<<8,C=A+S;if(C>n){if(r)throw"unexpected EOF";break}s&&a(u+S),e.set(i.subarray(A,C),u),t.b=u+=S,t.p=l=C*8;continue}if(l>_){if(r)throw"unexpected EOF";break}}s&&a(u+131072);for(var ne=(1<<x)-1,se=(1<<y)-1,ge=l;;ge=l){var ee=f[_2(i,l)&ne],_e=ee>>>4;if(l+=ee&15,l>_){if(r)throw"unexpected EOF";break}if(!ee)throw"invalid length/literal";if(_e<256)e[u++]=_e;else if(_e==256){ge=l,f=null;break}else{var K=_e-254;if(_e>264){var F=_e-257,pe=R7[F];K=Qc(i,l,(1<<pe)-1)+D7[F],l+=pe}var we=p[_2(i,l)&se],Ne=we>>>4;if(!we)throw"invalid distance";l+=we&15;var W=Hde[Ne];if(Ne>3){var pe=w7[Ne];W+=_2(i,l)&(1<<pe)-1,l+=pe}if(l>_){if(r)throw"unexpected EOF";break}s&&a(u+131072);for(var gt=u+K;u<gt;u+=4)e[u]=e[u-W],e[u+1]=e[u+1-W],e[u+2]=e[u+2-W],e[u+3]=e[u+3-W];u=gt}}t.l=f,t.p=ge,t.b=u,f&&(o=1,t.m=x,t.d=p,t.n=y)}while(!o);return u==e.length?e:qde(e,0,u)},jde=new uc(0),$de=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function VE(i,e){return Yde(($de(i),i.subarray(2,-4)),e)}var Kde=typeof TextDecoder<"u"&&new TextDecoder,Jde=0;try{Kde.decode(jde,{stream:!0}),Jde=1}catch{}const Zde=i=>i&&i.isCubeTexture;class Qde extends Ui{constructor(e,t){var n,s;const r=Zde(e),o=((s=r?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?s:1024)/4,l=Math.floor(Math.log2(o)),u=Math.pow(2,l),f=3*Math.max(u,112),p=4*u,x=[r?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/f}`,`#define CUBEUV_TEXEL_HEIGHT ${1/p}`,`#define CUBEUV_MAX_MIP ${l}.0`],y=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,_=x.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${BU>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,T={map:{value:e},height:{value:t?.height||15},radius:{value:t?.radius||100}},A=new pv(1,16),S=new Xa({uniforms:T,fragmentShader:_,vertexShader:y,side:hr});super(A,S)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function U7(i,e,t={}){const n=new Q,s=new wr,r=new Q,a=new Yt,o=new Yt,l=new Yt;t.preserveMatrix=t.preserveMatrix!==void 0?t.preserveMatrix:!0,t.preservePosition=t.preservePosition!==void 0?t.preservePosition:!0,t.preserveHipPosition=t.preserveHipPosition!==void 0?t.preserveHipPosition:!1,t.useTargetMatrix=t.useTargetMatrix!==void 0?t.useTargetMatrix:!1,t.hip=t.hip!==void 0?t.hip:"hip",t.names=t.names||{};const u=e.isObject3D?e.skeleton.bones:VM(e),f=i.isObject3D?i.skeleton.bones:VM(i);let p,x,y,_,T;if(i.isObject3D?i.skeleton.pose():(t.useTargetMatrix=!0,t.preserveMatrix=!1),t.preservePosition){T=[];for(let A=0;A<f.length;A++)T.push(f[A].position.clone())}if(t.preserveMatrix){i.updateMatrixWorld(),i.matrixWorld.identity();for(let A=0;A<i.children.length;++A)i.children[A].updateMatrixWorld(!0)}if(t.offsets){p=[];for(let A=0;A<f.length;++A)x=f[A],y=t.names[x.name]||x.name,t.offsets[y]&&(x.matrix.multiply(t.offsets[y]),x.matrix.decompose(x.position,x.quaternion,x.scale),x.updateMatrixWorld()),p.push(x.matrixWorld.clone())}for(let A=0;A<f.length;++A){if(x=f[A],y=t.names[x.name]||x.name,_=L7(y,u),l.copy(x.matrixWorld),_){if(_.updateMatrixWorld(),t.useTargetMatrix?o.copy(_.matrixWorld):(o.copy(i.matrixWorld).invert(),o.multiply(_.matrixWorld)),r.setFromMatrixScale(o),o.scale(r.set(1/r.x,1/r.y,1/r.z)),l.makeRotationFromQuaternion(s.setFromRotationMatrix(o)),i.isObject3D){const S=f.indexOf(x),C=p?p[S]:a.copy(i.skeleton.boneInverses[S]).invert();l.multiply(C)}l.copyPosition(o)}x.parent&&x.parent.isBone?(x.matrix.copy(x.parent.matrixWorld).invert(),x.matrix.multiply(l)):x.matrix.copy(l),t.preserveHipPosition&&y===t.hip&&x.matrix.setPosition(n.set(0,x.position.y,0)),x.matrix.decompose(x.position,x.quaternion,x.scale),x.updateMatrixWorld()}if(t.preservePosition)for(let A=0;A<f.length;++A)x=f[A],y=t.names[x.name]||x.name,y!==t.hip&&x.position.copy(T[A]);t.preserveMatrix&&i.updateMatrixWorld(!0)}function efe(i,e,t,n={}){n.useFirstFramePosition=n.useFirstFramePosition!==void 0?n.useFirstFramePosition:!1,n.fps=n.fps!==void 0?n.fps:30,n.names=n.names||[],e.isObject3D||(e=nfe(e));const s=Math.round(t.duration*(n.fps/1e3)*1e3),r=1/n.fps,a=[],o=new AD(e),l=VM(i.skeleton),u=[];let f,p,x,y,_;o.clipAction(t).play(),o.update(0),e.updateMatrixWorld();for(let T=0;T<s;++T){const A=T*r;U7(i,e,n);for(let S=0;S<l.length;++S)_=n.names[l[S].name]||l[S].name,x=L7(_,e.skeleton),x&&(p=l[S],y=u[S]=u[S]||{bone:p},n.hip===_&&(y.pos||(y.pos={times:new Float32Array(s),values:new Float32Array(s*3)}),n.useFirstFramePosition&&(T===0&&(f=p.position.clone()),p.position.sub(f)),y.pos.times[T]=A,p.position.toArray(y.pos.values,T*3)),y.quat||(y.quat={times:new Float32Array(s),values:new Float32Array(s*4)}),y.quat.times[T]=A,p.quaternion.toArray(y.quat.values,T*4));o.update(r),e.updateMatrixWorld()}for(let T=0;T<u.length;++T)y=u[T],y&&(y.pos&&a.push(new Hf(".bones["+y.bone.name+"].position",y.pos.times,y.pos.values)),a.push(new Vf(".bones["+y.bone.name+"].quaternion",y.quat.times,y.quat.values)));return o.uncacheAction(t),new kp(t.name,-1,a)}function tfe(i){const e=new Map,t=new Map,n=i.clone();return I7(i,n,function(s,r){e.set(r,s),t.set(s,r)}),n.traverse(function(s){if(!s.isSkinnedMesh)return;const r=s,a=e.get(s),o=a.skeleton.bones;r.skeleton=a.skeleton.clone(),r.bindMatrix.copy(a.bindMatrix),r.skeleton.bones=o.map(function(l){return t.get(l)}),r.bind(r.skeleton,r.bindMatrix)}),n}function L7(i,e){for(let t=0,n=VM(e);t<n.length;t++)if(i===n[t].name)return n[t]}function VM(i){return Array.isArray(i)?i:i.bones}function nfe(i){const e=new CD(i.bones[0]);return e.skeleton=i,e}function I7(i,e,t){t(i,e);for(let n=0;n<i.children.length;n++)I7(i.children[n],e.children[n],t)}const ife={retarget:U7,retargetClip:efe,clone:tfe};function HM(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Bg="srgb",Pf="srgb-linear",z4=3001,sfe=3e3;class DU extends Xr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new cfe(t)}),this.register(function(t){return new ufe(t)}),this.register(function(t){return new vfe(t)}),this.register(function(t){return new _fe(t)}),this.register(function(t){return new bfe(t)}),this.register(function(t){return new ffe(t)}),this.register(function(t){return new hfe(t)}),this.register(function(t){return new pfe(t)}),this.register(function(t){return new mfe(t)}),this.register(function(t){return new lfe(t)}),this.register(function(t){return new gfe(t)}),this.register(function(t){return new dfe(t)}),this.register(function(t){return new yfe(t)}),this.register(function(t){return new xfe(t)}),this.register(function(t){return new afe(t)}),this.register(function(t){return new Sfe(t)}),this.register(function(t){return new Tfe(t)})}load(e,t,n,s){const r=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=Uf.extractUrlBase(e);a=Uf.resolveURL(u,this.path)}else a=Uf.extractUrlBase(e);this.manager.itemStart(e);const o=function(u){s?s(u):console.error(u),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Hr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{r.parse(u,a,function(f){t(f),r.manager.itemEnd(e)},o)}catch(f){o(f)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const a={},o={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(HM(new Uint8Array(e.slice(0,4)))===P7){try{a[hi.KHR_BINARY_GLTF]=new Afe(e)}catch(f){s&&s(f);return}r=JSON.parse(a[hi.KHR_BINARY_GLTF].content)}else r=JSON.parse(HM(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Pfe(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const f=this.pluginCallbacks[u](l);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[f.name]=f,a[f.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const f=r.extensionsUsed[u],p=r.extensionsRequired||[];switch(f){case hi.KHR_MATERIALS_UNLIT:a[f]=new ofe;break;case hi.KHR_DRACO_MESH_COMPRESSION:a[f]=new Efe(r,this.dracoLoader);break;case hi.KHR_TEXTURE_TRANSFORM:a[f]=new Mfe;break;case hi.KHR_MESH_QUANTIZATION:a[f]=new Cfe;break;default:p.indexOf(f)>=0&&o[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function rfe(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const hi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class afe{constructor(e){this.parser=e,this.name=hi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let u;const f=new Bt(16777215);l.color!==void 0&&f.setRGB(l.color[0],l.color[1],l.color[2],Pf);const p=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new FT(f),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new PT(f),u.distance=p;break;case"spot":u=new S0(f),u.distance=p,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),u.decay=2,Sf(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(u),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return n._getNodeRef(t.cache,o,l)})}}class ofe{constructor(){this.name=hi.KHR_MATERIALS_UNLIT}getMaterialType(){return er}extendParams(e,t,n){const s=[];e.color=new Bt(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const a=r.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Pf),e.opacity=a[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,Bg))}return Promise.all(s)}}class lfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class cfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ze(o,o)}return Promise.all(r)}}class ufe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class dfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}class ffe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Bt(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Pf)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Bg)),a.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}class hfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class pfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Bt().setRGB(o[0],o[1],o[2],Pf),Promise.all(r)}}class mfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class gfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Bt().setRGB(o[0],o[1],o[2],Pf),a.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,Bg)),Promise.all(r)}}class xfe{constructor(e){this.parser=e,this.name=hi.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&r.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}}class yfe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&r.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}}class vfe{constructor(e){this.parser=e,this.name=hi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}}class _fe{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=n.textureLoader;if(o.uri){const u=n.options.manager.getHandler(o.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class bfe{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=n.textureLoader;if(o.uri){const u=n.options.manager.getHandler(o.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Sfe{constructor(e){this.name=hi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){const l=s.byteOffset||0,u=s.byteLength||0,f=s.count,p=s.byteStride,x=new Uint8Array(o,l,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(f,p,x,s.mode,s.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(f*p);return a.decodeGltfBuffer(new Uint8Array(y),f,p,x,s.mode,s.filter),y})})}else return null}}class Tfe{constructor(e){this.name=hi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const u of s.primitives)if(u.mode!==sc.TRIANGLES&&u.mode!==sc.TRIANGLE_STRIP&&u.mode!==sc.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],l={};for(const u in a)o.push(this.parser.getDependency("accessor",a[u]).then(f=>(l[u]=f,l[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(u=>{const f=u.pop(),p=f.isGroup?f.children:[f],x=u[0].count,y=[];for(const _ of p){const T=new Yt,A=new Q,S=new wr,C=new Q(1,1,1),w=new AC(_.geometry,_.material,x);for(let B=0;B<x;B++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,B),l.ROTATION&&S.fromBufferAttribute(l.ROTATION,B),l.SCALE&&C.fromBufferAttribute(l.SCALE,B),w.setMatrixAt(B,T.compose(A,S,C));for(const B in l)if(B==="_COLOR_0"){const L=l[B];w.instanceColor=new Jo(L.array,L.itemSize,L.normalized)}else B!=="TRANSLATION"&&B!=="ROTATION"&&B!=="SCALE"&&_.geometry.setAttribute(B,l[B]);mi.prototype.copy.call(w,_),this.parser.assignFinalMaterial(w),y.push(w)}return f.isGroup?(f.clear(),f.add(...y),f):y[0]}))}}const P7="glTF",Gb=12,V4={JSON:1313821514,BIN:5130562};class Afe{constructor(e){this.name=hi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Gb);if(this.header={magic:HM(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==P7)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Gb,s=new DataView(e,Gb);let r=0;for(;r<n;){const a=s.getUint32(r,!0);r+=4;const o=s.getUint32(r,!0);if(r+=4,o===V4.JSON){const l=new Uint8Array(e,Gb+r,a);this.content=HM(l)}else if(o===V4.BIN){const l=Gb+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Efe{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},u={};for(const f in a){const p=WN[f]||f.toLowerCase();o[p]=a[f]}for(const f in e.attributes){const p=WN[f]||f.toLowerCase();if(a[f]!==void 0){const x=n.accessors[e.attributes[f]],y=Ly[x.componentType];u[p]=y.name,l[p]=x.normalized===!0}}return t.getDependency("bufferView",r).then(function(f){return new Promise(function(p,x){s.decodeDracoFile(f,function(y){for(const _ in y.attributes){const T=y.attributes[_],A=l[_];A!==void 0&&(T.normalized=A)}p(y)},o,u,Pf,x)})})}}class Mfe{constructor(){this.name=hi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Cfe{constructor(){this.name=hi.KHR_MESH_QUANTIZATION}}class F7 extends b0{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let a=0;a!==s;a++)t[a]=n[r+a];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,u=o*3,f=s-t,p=(n-t)/f,x=p*p,y=x*p,_=e*u,T=_-u,A=-2*y+3*x,S=y-x,C=1-A,w=S-x+p;for(let B=0;B!==o;B++){const L=a[T+B+o],D=a[T+B+l]*f,O=a[_+B+o],F=a[_+B]*f;r[B]=C*L+w*D+A*O+S*F}return r}}const Rfe=new wr;class wfe extends F7{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return Rfe.fromArray(r).normalize().toArray(r),r}}const sc={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ly={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H4={9728:es,9729:Dn,9984:p0,9985:ud,9986:Sl,9987:Cr},k4={33071:ts,33648:lu,10497:wl},b2={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},WN={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...BU>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Nfe={CUBICSPLINE:void 0,LINEAR:t0,STEP:e0},S2={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Bfe(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new _0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ha})),i.DefaultMaterial}function vg(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Sf(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Dfe(i,e,t){let n=!1,s=!1,r=!1;for(let u=0,f=e.length;u<f;u++){const p=e[u];if(p.POSITION!==void 0&&(n=!0),p.NORMAL!==void 0&&(s=!0),p.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const a=[],o=[],l=[];for(let u=0,f=e.length;u<f;u++){const p=e[u];if(n){const x=p.POSITION!==void 0?t.getDependency("accessor",p.POSITION):i.attributes.position;a.push(x)}if(s){const x=p.NORMAL!==void 0?t.getDependency("accessor",p.NORMAL):i.attributes.normal;o.push(x)}if(r){const x=p.COLOR_0!==void 0?t.getDependency("accessor",p.COLOR_0):i.attributes.color;l.push(x)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(u){const f=u[0],p=u[1],x=u[2];return n&&(i.morphAttributes.position=f),s&&(i.morphAttributes.normal=p),r&&(i.morphAttributes.color=x),i.morphTargetsRelative=!0,i})}function Ofe(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ufe(i){let e;const t=i.extensions&&i.extensions[hi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+T2(t.attributes):e=i.indices+":"+T2(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,s=i.targets.length;n<s;n++)e+=":"+T2(i.targets[n]);return e}function T2(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function XN(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Lfe(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ife=new Yt;class Pfe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new rfe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&r<98?this.textureLoader=new fD(this.options.manager):this.textureLoader=new yD(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:n,userData:{}};return vg(r,o,s),Sf(o,s),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const a=t[s].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[u,f]of a.children.entries())r(f,o.children[u])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[hi.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,a){n.load(Uf.resolveURL(t.uri,s.path),r,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const a=b2[s.type],o=Ly[s.componentType],l=s.normalized===!0,u=new o(s.count*a);return Promise.resolve(new li(u,a,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(a){const o=a[0],l=b2[s.type],u=Ly[s.componentType],f=u.BYTES_PER_ELEMENT,p=f*l,x=s.byteOffset||0,y=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,_=s.normalized===!0;let T,A;if(y&&y!==p){const S=Math.floor(x/y),C="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+S+":"+s.count;let w=t.cache.get(C);w||(T=new u(o,S*y,s.count*y/f),w=new x0(T,y/f),t.cache.add(C,w)),A=new Md(w,l,x%y/f,_)}else o===null?T=new u(s.count*l):T=new u(o,x,s.count*l),A=new li(T,l,_);if(s.sparse!==void 0){const S=b2.SCALAR,C=Ly[s.sparse.indices.componentType],w=s.sparse.indices.byteOffset||0,B=s.sparse.values.byteOffset||0,L=new C(a[1],w,s.sparse.count*S),D=new u(a[2],B,s.sparse.count*l);o!==null&&(A=new li(A.array.slice(),A.itemSize,A.normalized));for(let O=0,F=L.length;O<F;O++){const U=L[O];if(A.setX(U,D[O*l]),l>=2&&A.setY(U,D[O*l+1]),l>=3&&A.setZ(U,D[O*l+2]),l>=4&&A.setW(U,D[O*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,a=t.images[r];let o=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,n){const s=this,r=this.json,a=r.textures[e],o=r.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(t,n).then(function(f){f.flipY=!1,f.name=a.name||o.name||"",f.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(f.name=o.uri);const x=(r.samplers||{})[a.sampler]||{};return f.magFilter=H4[x.magFilter]||Dn,f.minFilter=H4[x.minFilter]||Cr,f.wrapS=k4[x.wrapS]||wl,f.wrapT=k4[x.wrapT]||wl,s.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const a=s.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",u=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(p){u=!0;const x=new Blob([p],{type:a.mimeType});return l=o.createObjectURL(x),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(l).then(function(p){return new Promise(function(x,y){let _=x;t.isImageBitmapLoader===!0&&(_=function(T){const A=new pi(T);A.needsUpdate=!0,x(A)}),t.load(Uf.resolveURL(p,r.path),_,void 0,y)})}).then(function(p){return u===!0&&o.revokeObjectURL(l),Sf(p,a),p.userData.mimeType=a.mimeType||Lfe(a.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),p});return this.sourceCache[e]=f,f}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),r.extensions[hi.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[hi.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=r.associations.get(a);a=r.extensions[hi.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,l)}}return s!==void 0&&(typeof s=="number"&&(s=s===z4?Bg:Pf),"colorSpace"in a?a.colorSpace=s:a.encoding=s===Bg?z4:sfe),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new fv,ir.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(o,l)),n=l}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new ua,ir.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(o,l)),n=l}if(s||r||a){let o="ClonedMaterial:"+n.uuid+":";s&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=n.clone(),r&&(l.vertexColors=!0),a&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return _0}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let a;const o={},l=r.extensions||{},u=[];if(l[hi.KHR_MATERIALS_UNLIT]){const p=s[hi.KHR_MATERIALS_UNLIT];a=p.getMaterialType(),u.push(p.extendParams(o,r,t))}else{const p=r.pbrMetallicRoughness||{};if(o.color=new Bt(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){const x=p.baseColorFactor;o.color.setRGB(x[0],x[1],x[2],Pf),o.opacity=x[3]}p.baseColorTexture!==void 0&&u.push(t.assignTexture(o,"map",p.baseColorTexture,Bg)),o.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,o.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),u.push(t.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture))),a=this._invokeOne(function(x){return x.getMaterialType&&x.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(x){return x.extendMaterialParams&&x.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=hr);const f=r.alphaMode||S2.OPAQUE;if(f===S2.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,f===S2.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&a!==er&&(u.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Ze(1,1),r.normalTexture.scale!==void 0)){const p=r.normalTexture.scale;o.normalScale.set(p,p)}if(r.occlusionTexture!==void 0&&a!==er&&(u.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&a!==er){const p=r.emissiveFactor;o.emissive=new Bt().setRGB(p[0],p[1],p[2],Pf)}return r.emissiveTexture!==void 0&&a!==er&&u.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,Bg)),Promise.all(u).then(function(){const p=new a(o);return r.name&&(p.name=r.name),Sf(p,r),t.associations.set(p,{materials:e}),r.extensions&&vg(s,p,r),p})}createUniqueName(e){const t=Ni.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(o){return n[hi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return W4(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const u=e[o],f=Ufe(u),p=s[f];if(p)a.push(p.promise);else{let x;u.extensions&&u.extensions[hi.KHR_DRACO_MESH_COMPRESSION]?x=r(u):x=W4(new Fn,u,t),s[f]={primitive:u,promise:x},a.push(x)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],a=r.primitives,o=[];for(let l=0,u=a.length;l<u;l++){const f=a[l].material===void 0?Bfe(this.cache):this.getDependency("material",a[l].material);o.push(f)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const u=l.slice(0,l.length-1),f=l[l.length-1],p=[];for(let y=0,_=f.length;y<_;y++){const T=f[y],A=a[y];let S;const C=u[y];if(A.mode===sc.TRIANGLES||A.mode===sc.TRIANGLE_STRIP||A.mode===sc.TRIANGLE_FAN||A.mode===void 0)S=r.isSkinnedMesh===!0?new TC(T,C):new Ui(T,C),S.isSkinnedMesh===!0&&S.normalizeSkinWeights(),A.mode===sc.TRIANGLE_STRIP?S.geometry=G4(S.geometry,yC):A.mode===sc.TRIANGLE_FAN&&(S.geometry=G4(S.geometry,TS));else if(A.mode===sc.LINES)S=new Sc(T,C);else if(A.mode===sc.LINE_STRIP)S=new Cd(T,C);else if(A.mode===sc.LINE_LOOP)S=new EC(T,C);else if(A.mode===sc.POINTS)S=new MC(T,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(S.geometry.morphAttributes).length>0&&Ofe(S,r),S.name=t.createUniqueName(r.name||"mesh_"+e),Sf(S,r),A.extensions&&vg(s,S,A),t.assignFinalMaterial(S),p.push(S)}for(let y=0,_=p.length;y<_;y++)t.associations.set(p[y],{meshes:e,primitives:y});if(p.length===1)return r.extensions&&vg(s,p[0],r),p[0];const x=new fc;r.extensions&&vg(s,x,r),t.associations.set(x,{meshes:e});for(let y=0,_=p.length;y<_;y++)x.add(p[y]);return x})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new bs(ov.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Ac(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Sf(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,r=t.joints.length;s<r;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const r=s.pop(),a=s,o=[],l=[];for(let u=0,f=a.length;u<f;u++){const p=a[u];if(p){o.push(p);const x=new Yt;r!==null&&x.fromArray(r.array,u*16),l.push(x)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new uv(o,l)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,a=[],o=[],l=[],u=[],f=[];for(let p=0,x=s.channels.length;p<x;p++){const y=s.channels[p],_=s.samplers[y.sampler],T=y.target,A=T.node,S=s.parameters!==void 0?s.parameters[_.input]:_.input,C=s.parameters!==void 0?s.parameters[_.output]:_.output;T.node!==void 0&&(a.push(this.getDependency("node",A)),o.push(this.getDependency("accessor",S)),l.push(this.getDependency("accessor",C)),u.push(_),f.push(T))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(u),Promise.all(f)]).then(function(p){const x=p[0],y=p[1],_=p[2],T=p[3],A=p[4],S=[];for(let C=0,w=x.length;C<w;C++){const B=x[C],L=y[C],D=_[C],O=T[C],F=A[C];if(B===void 0)continue;B.updateMatrix&&B.updateMatrix();const U=n._createAnimationTracks(B,L,D,O,F);if(U)for(let P=0;P<U.length;P++)S.push(U[P])}return new kp(r,void 0,S)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const a=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,u=s.weights.length;l<u;l++)o.morphTargetInfluences[l]=s.weights[l]}),a})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],r=n._loadNodeShallow(e),a=[],o=s.children||[];for(let u=0,f=o.length;u<f;u++)a.push(n.getDependency("node",o[u]));const l=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([r,Promise.all(a),l]).then(function(u){const f=u[0],p=u[1],x=u[2];x!==null&&f.traverse(function(y){y.isSkinnedMesh&&y.bind(x,Ife)});for(let y=0,_=p.length;y<_;y++)f.add(p[y]);return f})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],a=r.name?s.createUniqueName(r.name):"",o=[],l=s._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&o.push(l),r.camera!==void 0&&o.push(s.getDependency("camera",r.camera).then(function(u){return s._getNodeRef(s.cameraCache,r.camera,u)})),s._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){o.push(u)}),this.nodeCache[e]=Promise.all(o).then(function(u){let f;if(r.isBone===!0?f=new _T:u.length>1?f=new fc:u.length===1?f=u[0]:f=new mi,f!==u[0])for(let p=0,x=u.length;p<x;p++)f.add(u[p]);if(r.name&&(f.userData.name=r.name,f.name=a),Sf(f,r),r.extensions&&vg(n,f,r),r.matrix!==void 0){const p=new Yt;p.fromArray(r.matrix),f.applyMatrix4(p)}else r.translation!==void 0&&f.position.fromArray(r.translation),r.rotation!==void 0&&f.quaternion.fromArray(r.rotation),r.scale!==void 0&&f.scale.fromArray(r.scale);return s.associations.has(f)||s.associations.set(f,{}),s.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new fc;n.name&&(r.name=s.createUniqueName(n.name)),Sf(r,n),n.extensions&&vg(t,r,n);const a=n.nodes||[],o=[];for(let l=0,u=a.length;l<u;l++)o.push(s.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let f=0,p=l.length;f<p;f++)r.add(l[f]);const u=f=>{const p=new Map;for(const[x,y]of s.associations)(x instanceof ir||x instanceof pi)&&p.set(x,y);return f.traverse(x=>{const y=s.associations.get(x);y!=null&&p.set(x,y)}),p};return s.associations=u(r),r})}_createAnimationTracks(e,t,n,s,r){const a=[],o=e.name?e.name:e.uuid,l=[];Qh[r.path]===Qh.weights?e.traverse(function(x){x.morphTargetInfluences&&l.push(x.name?x.name:x.uuid)}):l.push(o);let u;switch(Qh[r.path]){case Qh.weights:u=Hp;break;case Qh.rotation:u=Vf;break;case Qh.position:case Qh.scale:u=Hf;break;default:switch(n.itemSize){case 1:u=Hp;break;case 2:case 3:default:u=Hf;break}break}const f=s.interpolation!==void 0?Nfe[s.interpolation]:t0,p=this._getArrayFromAccessor(n);for(let x=0,y=l.length;x<y;x++){const _=new u(l[x]+"."+Qh[r.path],t.array,p,f);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),a.push(_)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=XN(t.constructor),s=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=t[r]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof Vf?wfe:F7;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ffe(i,e,t){const n=e.attributes,s=new Vr;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],l=o.min,u=o.max;if(l!==void 0&&u!==void 0){if(s.set(new Q(l[0],l[1],l[2]),new Q(u[0],u[1],u[2])),o.normalized){const f=XN(Ly[o.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const o=new Q,l=new Q;for(let u=0,f=r.length;u<f;u++){const p=r[u];if(p.POSITION!==void 0){const x=t.json.accessors[p.POSITION],y=x.min,_=x.max;if(y!==void 0&&_!==void 0){if(l.setX(Math.max(Math.abs(y[0]),Math.abs(_[0]))),l.setY(Math.max(Math.abs(y[1]),Math.abs(_[1]))),l.setZ(Math.max(Math.abs(y[2]),Math.abs(_[2]))),x.normalized){const T=XN(Ly[x.componentType]);l.multiplyScalar(T)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}i.boundingBox=s;const a=new mr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=a}function W4(i,e,t){const n=e.attributes,s=[];function r(a,o){return t.getDependency("accessor",a).then(function(l){i.setAttribute(o,l)})}for(const a in n){const o=WN[a]||a.toLowerCase();o in i.attributes||s.push(r(n[a],o))}if(e.indices!==void 0&&!i.index){const a=t.getDependency("accessor",e.indices).then(function(o){i.setIndex(o)});s.push(a)}return Sf(i,e),Ffe(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Dfe(i,e.targets,t):i})}class Gfe extends kC{constructor(e){super(e),this.type=Ai}parse(e){const a=function(F,U){switch(F){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(U||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(U||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(U||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(U||""))}},p=function(F,U,P){U=U||1024;let Z=F.pos,ee=-1,te=0,re="",W=String.fromCharCode.apply(null,new Uint16Array(F.subarray(Z,Z+128)));for(;0>(ee=W.indexOf(`
`))&&te<U&&Z<F.byteLength;)re+=W,te+=W.length,Z+=128,W+=String.fromCharCode.apply(null,new Uint16Array(F.subarray(Z,Z+128)));return-1<ee?(F.pos+=te+ee+1,re+W.slice(0,ee)):!1},x=function(F){const U=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,X=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,ee=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,te={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let re,W;for((F.pos>=F.byteLength||!(re=p(F)))&&a(1,"no header found"),(W=re.match(U))||a(3,"bad initial token"),te.valid|=1,te.programtype=W[1],te.string+=re+`
`;re=p(F),re!==!1;){if(te.string+=re+`
`,re.charAt(0)==="#"){te.comments+=re+`
`;continue}if((W=re.match(P))&&(te.gamma=parseFloat(W[1])),(W=re.match(X))&&(te.exposure=parseFloat(W[1])),(W=re.match(Z))&&(te.valid|=2,te.format=W[1]),(W=re.match(ee))&&(te.valid|=4,te.height=parseInt(W[1],10),te.width=parseInt(W[2],10)),te.valid&2&&te.valid&4)break}return te.valid&2||a(3,"missing format specifier"),te.valid&4||a(3,"missing image size specifier"),te},y=function(F,U,P){const X=U;if(X<8||X>32767||F[0]!==2||F[1]!==2||F[2]&128)return new Uint8Array(F);X!==(F[2]<<8|F[3])&&a(3,"wrong scanline width");const Z=new Uint8Array(4*U*P);Z.length||a(4,"unable to allocate buffer space");let ee=0,te=0;const re=4*X,W=new Uint8Array(4),ne=new Uint8Array(re);let se=P;for(;se>0&&te<F.byteLength;){te+4>F.byteLength&&a(1),W[0]=F[te++],W[1]=F[te++],W[2]=F[te++],W[3]=F[te++],(W[0]!=2||W[1]!=2||(W[2]<<8|W[3])!=X)&&a(3,"bad rgbe scanline format");let ge=0,_e;for(;ge<re&&te<F.byteLength;){_e=F[te++];const pe=_e>128;if(pe&&(_e-=128),(_e===0||ge+_e>re)&&a(3,"bad scanline data"),pe){const we=F[te++];for(let Ne=0;Ne<_e;Ne++)ne[ge++]=we}else ne.set(F.subarray(te,te+_e),ge),ge+=_e,te+=_e}const K=X;for(let pe=0;pe<K;pe++){let we=0;Z[ee]=ne[pe+we],we+=X,Z[ee+1]=ne[pe+we],we+=X,Z[ee+2]=ne[pe+we],we+=X,Z[ee+3]=ne[pe+we],ee+=4}se--}return Z},_=function(F,U,P,X){const Z=F[U+3],ee=Math.pow(2,Z-128)/255;P[X+0]=F[U+0]*ee,P[X+1]=F[U+1]*ee,P[X+2]=F[U+2]*ee,P[X+3]=1},T=function(F,U,P,X){const Z=F[U+3],ee=Math.pow(2,Z-128)/255;P[X+0]=op.toHalfFloat(Math.min(F[U+0]*ee,65504)),P[X+1]=op.toHalfFloat(Math.min(F[U+1]*ee,65504)),P[X+2]=op.toHalfFloat(Math.min(F[U+2]*ee,65504)),P[X+3]=op.toHalfFloat(1)},A=new Uint8Array(e);A.pos=0;const S=x(A),C=S.width,w=S.height,B=y(A.subarray(A.pos),C,w);let L,D,O;switch(this.type){case Ti:O=B.length/4;const F=new Float32Array(O*4);for(let P=0;P<O;P++)_(B,P*4,F,P*4);L=F,D=Ti;break;case Ai:O=B.length/4;const U=new Uint16Array(O*4);for(let P=0;P<O;P++)T(B,P*4,U,P*4);L=U,D=Ai;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:C,height:w,data:L,header:S.string,gamma:S.gamma,exposure:S.exposure,type:D}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(a,o){switch(a.type){case Ti:case Ai:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Dn,a.magFilter=Dn,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,r,n,s)}}const zb=BU>=152;class zfe extends kC{constructor(e){super(e),this.type=Ai}parse(e){const U=Math.pow(2.7182818,2.2);function P(H,J){for(var xe=0,Ie=0;Ie<65536;++Ie)(Ie==0||H[Ie>>3]&1<<(Ie&7))&&(J[xe++]=Ie);for(var Ye=xe-1;xe<65536;)J[xe++]=0;return Ye}function X(H){for(var J=0;J<16384;J++)H[J]={},H[J].len=0,H[J].lit=0,H[J].p=null}const Z={l:0,c:0,lc:0};function ee(H,J,xe,Ie,Ye){for(;xe<H;)J=J<<8|nn(Ie,Ye),xe+=8;xe-=H,Z.l=J>>xe&(1<<H)-1,Z.c=J,Z.lc=xe}const te=new Array(59);function re(H){for(var J=0;J<=58;++J)te[J]=0;for(var J=0;J<65537;++J)te[H[J]]+=1;for(var xe=0,J=58;J>0;--J){var Ie=xe+te[J]>>1;te[J]=xe,xe=Ie}for(var J=0;J<65537;++J){var Ye=H[J];Ye>0&&(H[J]=Ye|te[Ye]++<<6)}}function W(H,J,xe,Ie,Ye,qe,vt){for(var mt=xe,xt=0,k=0;Ye<=qe;Ye++){if(mt.value-xe.value>Ie)return!1;ee(6,xt,k,H,mt);var ae=Z.l;if(xt=Z.c,k=Z.lc,vt[Ye]=ae,ae==63){if(mt.value-xe.value>Ie)throw"Something wrong with hufUnpackEncTable";ee(8,xt,k,H,mt);var ce=Z.l+6;if(xt=Z.c,k=Z.lc,Ye+ce>qe+1)throw"Something wrong with hufUnpackEncTable";for(;ce--;)vt[Ye++]=0;Ye--}else if(ae>=59){var ce=ae-59+2;if(Ye+ce>qe+1)throw"Something wrong with hufUnpackEncTable";for(;ce--;)vt[Ye++]=0;Ye--}}re(vt)}function ne(H){return H&63}function se(H){return H>>6}function ge(H,J,xe,Ie){for(;J<=xe;J++){var Ye=se(H[J]),qe=ne(H[J]);if(Ye>>qe)throw"Invalid table entry";if(qe>14){var vt=Ie[Ye>>qe-14];if(vt.len)throw"Invalid table entry";if(vt.lit++,vt.p){var mt=vt.p;vt.p=new Array(vt.lit);for(var xt=0;xt<vt.lit-1;++xt)vt.p[xt]=mt[xt]}else vt.p=new Array(1);vt.p[vt.lit-1]=J}else if(qe)for(var k=0,xt=1<<14-qe;xt>0;xt--){var vt=Ie[(Ye<<14-qe)+k];if(vt.len||vt.p)throw"Invalid table entry";vt.len=qe,vt.lit=J,k++}}return!0}const _e={c:0,lc:0};function K(H,J,xe,Ie){H=H<<8|nn(xe,Ie),J+=8,_e.c=H,_e.lc=J}const pe={c:0,lc:0};function we(H,J,xe,Ie,Ye,qe,vt,mt,xt,k){if(H==J){Ie<8&&(K(xe,Ie,Ye,vt),xe=_e.c,Ie=_e.lc),Ie-=8;var ae=xe>>Ie,ae=new Uint8Array([ae])[0];if(xt.value+ae>k)return!1;for(var ce=mt[xt.value-1];ae-- >0;)mt[xt.value++]=ce}else if(xt.value<k)mt[xt.value++]=H;else return!1;pe.c=xe,pe.lc=Ie}function Ne(H){return H&65535}function gt(H){var J=Ne(H);return J>32767?J-65536:J}const Se={a:0,b:0};function Be(H,J){var xe=gt(H),Ie=gt(J),Ye=Ie,qe=xe+(Ye&1)+(Ye>>1),vt=qe,mt=qe-Ye;Se.a=vt,Se.b=mt}function ct(H,J){var xe=Ne(H),Ie=Ne(J),Ye=xe-(Ie>>1)&65535,qe=Ie+Ye-32768&65535;Se.a=qe,Se.b=Ye}function Dt(H,J,xe,Ie,Ye,qe,vt){for(var mt=vt<16384,xt=xe>Ye?Ye:xe,k=1,ae;k<=xt;)k<<=1;for(k>>=1,ae=k,k>>=1;k>=1;){for(var ce=0,Ae=ce+qe*(Ye-ae),le=qe*k,ke=qe*ae,it=Ie*k,ft=Ie*ae,bt,Ft,Jt,$t;ce<=Ae;ce+=ke){for(var tn=ce,Gn=ce+Ie*(xe-ae);tn<=Gn;tn+=ft){var fn=tn+it,bn=tn+le,$n=bn+it;mt?(Be(H[tn+J],H[bn+J]),bt=Se.a,Jt=Se.b,Be(H[fn+J],H[$n+J]),Ft=Se.a,$t=Se.b,Be(bt,Ft),H[tn+J]=Se.a,H[fn+J]=Se.b,Be(Jt,$t),H[bn+J]=Se.a,H[$n+J]=Se.b):(ct(H[tn+J],H[bn+J]),bt=Se.a,Jt=Se.b,ct(H[fn+J],H[$n+J]),Ft=Se.a,$t=Se.b,ct(bt,Ft),H[tn+J]=Se.a,H[fn+J]=Se.b,ct(Jt,$t),H[bn+J]=Se.a,H[$n+J]=Se.b)}if(xe&k){var bn=tn+le;mt?Be(H[tn+J],H[bn+J]):ct(H[tn+J],H[bn+J]),bt=Se.a,H[bn+J]=Se.b,H[tn+J]=bt}}if(Ye&k)for(var tn=ce,Gn=ce+Ie*(xe-ae);tn<=Gn;tn+=ft){var fn=tn+it;mt?Be(H[tn+J],H[fn+J]):ct(H[tn+J],H[fn+J]),bt=Se.a,H[fn+J]=Se.b,H[tn+J]=bt}ae=k,k>>=1}return ce}function Nt(H,J,xe,Ie,Ye,qe,vt,mt,xt,k){for(var ae=0,ce=0,Ae=mt,le=Math.trunc(Ye.value+(qe+7)/8);Ye.value<le;)for(K(ae,ce,xe,Ye),ae=_e.c,ce=_e.lc;ce>=14;){var ke=ae>>ce-14&16383,it=J[ke];if(it.len)ce-=it.len,we(it.lit,vt,ae,ce,xe,Ie,Ye,xt,k,Ae),ae=pe.c,ce=pe.lc;else{if(!it.p)throw"hufDecode issues";var ft;for(ft=0;ft<it.lit;ft++){for(var bt=ne(H[it.p[ft]]);ce<bt&&Ye.value<le;)K(ae,ce,xe,Ye),ae=_e.c,ce=_e.lc;if(ce>=bt&&se(H[it.p[ft]])==(ae>>ce-bt&(1<<bt)-1)){ce-=bt,we(it.p[ft],vt,ae,ce,xe,Ie,Ye,xt,k,Ae),ae=pe.c,ce=pe.lc;break}}if(ft==it.lit)throw"hufDecode issues"}}var Ft=8-qe&7;for(ae>>=Ft,ce-=Ft;ce>0;){var it=J[ae<<14-ce&16383];if(it.len)ce-=it.len,we(it.lit,vt,ae,ce,xe,Ie,Ye,xt,k,Ae),ae=pe.c,ce=pe.lc;else throw"hufDecode issues"}return!0}function It(H,J,xe,Ie,Ye,qe){var vt={value:0},mt=xe.value,xt=st(J,xe),k=st(J,xe);xe.value+=4;var ae=st(J,xe);if(xe.value+=4,xt<0||xt>=65537||k<0||k>=65537)throw"Something wrong with HUF_ENCSIZE";var ce=new Array(65537),Ae=new Array(16384);X(Ae);var le=Ie-(xe.value-mt);if(W(H,J,xe,le,xt,k,ce),ae>8*(Ie-(xe.value-mt)))throw"Something wrong with hufUncompress";ge(ce,xt,k,Ae),Nt(ce,Ae,H,J,xe,ae,k,qe,Ye,vt)}function Mn(H,J,xe){for(var Ie=0;Ie<xe;++Ie)J[Ie]=H[J[Ie]]}function Gt(H){for(var J=1;J<H.length;J++){var xe=H[J-1]+H[J]-128;H[J]=xe}}function Qe(H,J){for(var xe=0,Ie=Math.floor((H.length+1)/2),Ye=0,qe=H.length-1;!(Ye>qe||(J[Ye++]=H[xe++],Ye>qe));)J[Ye++]=H[Ie++]}function ie(H){for(var J=H.byteLength,xe=new Array,Ie=0,Ye=new DataView(H);J>0;){var qe=Ye.getInt8(Ie++);if(qe<0){var vt=-qe;J-=vt+1;for(var mt=0;mt<vt;mt++)xe.push(Ye.getUint8(Ie++))}else{var vt=qe;J-=2;for(var xt=Ye.getUint8(Ie++),mt=0;mt<vt+1;mt++)xe.push(xt)}}return xe}function ot(H,J,xe,Ie,Ye,qe){var fn=new DataView(qe.buffer),vt=xe[H.idx[0]].width,mt=xe[H.idx[0]].height,xt=3,k=Math.floor(vt/8),ae=Math.ceil(vt/8),ce=Math.ceil(mt/8),Ae=vt-(ae-1)*8,le=mt-(ce-1)*8,ke={value:0},it=new Array(xt),ft=new Array(xt),bt=new Array(xt),Ft=new Array(xt),Jt=new Array(xt);for(let on=0;on<xt;++on)Jt[on]=J[H.idx[on]],it[on]=on<1?0:it[on-1]+ae*ce,ft[on]=new Float32Array(64),bt[on]=new Uint16Array(64),Ft[on]=new Uint16Array(ae*64);for(let on=0;on<ce;++on){var $t=8;on==ce-1&&($t=le);var tn=8;for(let xi=0;xi<ae;++xi){xi==ae-1&&(tn=Ae);for(let xn=0;xn<xt;++xn)bt[xn].fill(0),bt[xn][0]=Ye[it[xn]++],dt(ke,Ie,bt[xn]),Tt(bt[xn],ft[xn]),ht(ft[xn]);Ut(ft);for(let xn=0;xn<xt;++xn)At(ft[xn],Ft[xn],xi*64)}let ii=0;for(let xi=0;xi<xt;++xi){const xn=xe[H.idx[xi]].type;for(let As=8*on;As<8*on+$t;++As){ii=Jt[xi][As];for(let ci=0;ci<k;++ci){const Ei=ci*64+(As&7)*8;fn.setUint16(ii+0*xn,Ft[xi][Ei+0],!0),fn.setUint16(ii+2*xn,Ft[xi][Ei+1],!0),fn.setUint16(ii+4*xn,Ft[xi][Ei+2],!0),fn.setUint16(ii+6*xn,Ft[xi][Ei+3],!0),fn.setUint16(ii+8*xn,Ft[xi][Ei+4],!0),fn.setUint16(ii+10*xn,Ft[xi][Ei+5],!0),fn.setUint16(ii+12*xn,Ft[xi][Ei+6],!0),fn.setUint16(ii+14*xn,Ft[xi][Ei+7],!0),ii+=16*xn}}if(k!=ae)for(let As=8*on;As<8*on+$t;++As){const ci=Jt[xi][As]+8*k*2*xn,Ei=k*64+(As&7)*8;for(let $i=0;$i<tn;++$i)fn.setUint16(ci+$i*2*xn,Ft[xi][Ei+$i],!0)}}}for(var Gn=new Uint16Array(vt),fn=new DataView(qe.buffer),bn=0;bn<xt;++bn){xe[H.idx[bn]].decoded=!0;var $n=xe[H.idx[bn]].type;if(xe[bn].type==2)for(var hn=0;hn<mt;++hn){const on=Jt[bn][hn];for(var qn=0;qn<vt;++qn)Gn[qn]=fn.getUint16(on+qn*2*$n,!0);for(var qn=0;qn<vt;++qn)fn.setFloat32(on+qn*2*$n,ze(Gn[qn]),!0)}}}function dt(H,J,xe){for(var Ie,Ye=1;Ye<64;)Ie=J[H.value],Ie==65280?Ye=64:Ie>>8==255?Ye+=Ie&255:(xe[Ye]=Ie,Ye++),H.value++}function Tt(H,J){J[0]=ze(H[0]),J[1]=ze(H[1]),J[2]=ze(H[5]),J[3]=ze(H[6]),J[4]=ze(H[14]),J[5]=ze(H[15]),J[6]=ze(H[27]),J[7]=ze(H[28]),J[8]=ze(H[2]),J[9]=ze(H[4]),J[10]=ze(H[7]),J[11]=ze(H[13]),J[12]=ze(H[16]),J[13]=ze(H[26]),J[14]=ze(H[29]),J[15]=ze(H[42]),J[16]=ze(H[3]),J[17]=ze(H[8]),J[18]=ze(H[12]),J[19]=ze(H[17]),J[20]=ze(H[25]),J[21]=ze(H[30]),J[22]=ze(H[41]),J[23]=ze(H[43]),J[24]=ze(H[9]),J[25]=ze(H[11]),J[26]=ze(H[18]),J[27]=ze(H[24]),J[28]=ze(H[31]),J[29]=ze(H[40]),J[30]=ze(H[44]),J[31]=ze(H[53]),J[32]=ze(H[10]),J[33]=ze(H[19]),J[34]=ze(H[23]),J[35]=ze(H[32]),J[36]=ze(H[39]),J[37]=ze(H[45]),J[38]=ze(H[52]),J[39]=ze(H[54]),J[40]=ze(H[20]),J[41]=ze(H[22]),J[42]=ze(H[33]),J[43]=ze(H[38]),J[44]=ze(H[46]),J[45]=ze(H[51]),J[46]=ze(H[55]),J[47]=ze(H[60]),J[48]=ze(H[21]),J[49]=ze(H[34]),J[50]=ze(H[37]),J[51]=ze(H[47]),J[52]=ze(H[50]),J[53]=ze(H[56]),J[54]=ze(H[59]),J[55]=ze(H[61]),J[56]=ze(H[35]),J[57]=ze(H[36]),J[58]=ze(H[48]),J[59]=ze(H[49]),J[60]=ze(H[57]),J[61]=ze(H[58]),J[62]=ze(H[62]),J[63]=ze(H[63])}function ht(H){const J=.5*Math.cos(.7853975),xe=.5*Math.cos(3.14159/16),Ie=.5*Math.cos(3.14159/8),Ye=.5*Math.cos(3*3.14159/16),qe=.5*Math.cos(5*3.14159/16),vt=.5*Math.cos(3*3.14159/8),mt=.5*Math.cos(7*3.14159/16);for(var xt=new Array(4),k=new Array(4),ae=new Array(4),ce=new Array(4),Ae=0;Ae<8;++Ae){var le=Ae*8;xt[0]=Ie*H[le+2],xt[1]=vt*H[le+2],xt[2]=Ie*H[le+6],xt[3]=vt*H[le+6],k[0]=xe*H[le+1]+Ye*H[le+3]+qe*H[le+5]+mt*H[le+7],k[1]=Ye*H[le+1]-mt*H[le+3]-xe*H[le+5]-qe*H[le+7],k[2]=qe*H[le+1]-xe*H[le+3]+mt*H[le+5]+Ye*H[le+7],k[3]=mt*H[le+1]-qe*H[le+3]+Ye*H[le+5]-xe*H[le+7],ae[0]=J*(H[le+0]+H[le+4]),ae[3]=J*(H[le+0]-H[le+4]),ae[1]=xt[0]+xt[3],ae[2]=xt[1]-xt[2],ce[0]=ae[0]+ae[1],ce[1]=ae[3]+ae[2],ce[2]=ae[3]-ae[2],ce[3]=ae[0]-ae[1],H[le+0]=ce[0]+k[0],H[le+1]=ce[1]+k[1],H[le+2]=ce[2]+k[2],H[le+3]=ce[3]+k[3],H[le+4]=ce[3]-k[3],H[le+5]=ce[2]-k[2],H[le+6]=ce[1]-k[1],H[le+7]=ce[0]-k[0]}for(var ke=0;ke<8;++ke)xt[0]=Ie*H[16+ke],xt[1]=vt*H[16+ke],xt[2]=Ie*H[48+ke],xt[3]=vt*H[48+ke],k[0]=xe*H[8+ke]+Ye*H[24+ke]+qe*H[40+ke]+mt*H[56+ke],k[1]=Ye*H[8+ke]-mt*H[24+ke]-xe*H[40+ke]-qe*H[56+ke],k[2]=qe*H[8+ke]-xe*H[24+ke]+mt*H[40+ke]+Ye*H[56+ke],k[3]=mt*H[8+ke]-qe*H[24+ke]+Ye*H[40+ke]-xe*H[56+ke],ae[0]=J*(H[ke]+H[32+ke]),ae[3]=J*(H[ke]-H[32+ke]),ae[1]=xt[0]+xt[3],ae[2]=xt[1]-xt[2],ce[0]=ae[0]+ae[1],ce[1]=ae[3]+ae[2],ce[2]=ae[3]-ae[2],ce[3]=ae[0]-ae[1],H[0+ke]=ce[0]+k[0],H[8+ke]=ce[1]+k[1],H[16+ke]=ce[2]+k[2],H[24+ke]=ce[3]+k[3],H[32+ke]=ce[3]-k[3],H[40+ke]=ce[2]-k[2],H[48+ke]=ce[1]-k[1],H[56+ke]=ce[0]-k[0]}function Ut(H){for(var J=0;J<64;++J){var xe=H[0][J],Ie=H[1][J],Ye=H[2][J];H[0][J]=xe+1.5747*Ye,H[1][J]=xe-.1873*Ie-.4682*Ye,H[2][J]=xe+1.8556*Ie}}function At(H,J,xe){for(var Ie=0;Ie<64;++Ie)J[xe+Ie]=op.toHalfFloat(Ht(H[Ie]))}function Ht(H){return H<=1?Math.sign(H)*Math.pow(Math.abs(H),2.2):Math.sign(H)*Math.pow(U,Math.abs(H)-1)}function q(H){return new DataView(H.array.buffer,H.offset.value,H.size)}function V(H){var J=H.viewer.buffer.slice(H.offset.value,H.offset.value+H.size),xe=new Uint8Array(ie(J)),Ie=new Uint8Array(xe.length);return Gt(xe),Qe(xe,Ie),new DataView(Ie.buffer)}function Te(H){var J=H.array.slice(H.offset.value,H.offset.value+H.size),xe=VE(J),Ie=new Uint8Array(xe.length);return Gt(xe),Qe(xe,Ie),new DataView(Ie.buffer)}function Ge(H){for(var J=H.viewer,xe={value:H.offset.value},Ie=new Uint16Array(H.width*H.scanlineBlockSize*(H.channels*H.type)),Ye=new Uint8Array(8192),qe=0,vt=new Array(H.channels),mt=0;mt<H.channels;mt++)vt[mt]={},vt[mt].start=qe,vt[mt].end=vt[mt].start,vt[mt].nx=H.width,vt[mt].ny=H.lines,vt[mt].size=H.type,qe+=vt[mt].nx*vt[mt].ny*vt[mt].size;var xt=Et(J,xe),k=Et(J,xe);if(k>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(xt<=k)for(var mt=0;mt<k-xt+1;mt++)Ye[mt+xt]=zt(J,xe);var ae=new Uint16Array(65536),ce=P(Ye,ae),Ae=st(J,xe);It(H.array,J,xe,Ae,Ie,qe);for(var mt=0;mt<H.channels;++mt)for(var le=vt[mt],ke=0;ke<vt[mt].size;++ke)Dt(Ie,le.start+ke,le.nx,le.size,le.ny,le.nx*le.size,ce);Mn(ae,Ie,qe);for(var it=0,ft=new Uint8Array(Ie.buffer.byteLength),bt=0;bt<H.lines;bt++)for(var Ft=0;Ft<H.channels;Ft++){var le=vt[Ft],Jt=le.nx*le.size,$t=new Uint8Array(Ie.buffer,le.end*2,Jt*2);ft.set($t,it),it+=Jt*2,le.end+=Jt}return new DataView(ft.buffer)}function $e(H){var J=H.array.slice(H.offset.value,H.offset.value+H.size),xe=VE(J);const Ie=H.lines*H.channels*H.width,Ye=H.type==1?new Uint16Array(Ie):new Uint32Array(Ie);let qe=0,vt=0;const mt=new Array(4);for(let xt=0;xt<H.lines;xt++)for(let k=0;k<H.channels;k++){let ae=0;switch(H.type){case 1:mt[0]=qe,mt[1]=mt[0]+H.width,qe=mt[1]+H.width;for(let ce=0;ce<H.width;++ce){const Ae=xe[mt[0]++]<<8|xe[mt[1]++];ae+=Ae,Ye[vt]=ae,vt++}break;case 2:mt[0]=qe,mt[1]=mt[0]+H.width,mt[2]=mt[1]+H.width,qe=mt[2]+H.width;for(let ce=0;ce<H.width;++ce){const Ae=xe[mt[0]++]<<24|xe[mt[1]++]<<16|xe[mt[2]++]<<8;ae+=Ae,Ye[vt]=ae,vt++}break}}return new DataView(Ye.buffer)}function Ve(H){var J=H.viewer,xe={value:H.offset.value},Ie=new Uint8Array(H.width*H.lines*(H.channels*H.type*2)),Ye={version:Mt(J,xe),unknownUncompressedSize:Mt(J,xe),unknownCompressedSize:Mt(J,xe),acCompressedSize:Mt(J,xe),dcCompressedSize:Mt(J,xe),rleCompressedSize:Mt(J,xe),rleUncompressedSize:Mt(J,xe),rleRawSize:Mt(J,xe),totalAcUncompressedCount:Mt(J,xe),totalDcUncompressedCount:Mt(J,xe),acCompression:Mt(J,xe)};if(Ye.version<2)throw"EXRLoader.parse: "+xr.compression+" version "+Ye.version+" is unsupported";for(var qe=new Array,vt=Et(J,xe)-2;vt>0;){var mt=Xt(J.buffer,xe),xt=zt(J,xe),k=xt>>2&3,ae=(xt>>4)-1,ce=new Int8Array([ae])[0],Ae=zt(J,xe);qe.push({name:mt,index:ce,type:Ae,compression:k}),vt-=mt.length+3}for(var le=xr.channels,ke=new Array(H.channels),it=0;it<H.channels;++it){var ft=ke[it]={},bt=le[it];ft.name=bt.name,ft.compression=0,ft.decoded=!1,ft.type=bt.pixelType,ft.pLinear=bt.pLinear,ft.width=H.width,ft.height=H.lines}for(var Ft={idx:new Array(3)},Jt=0;Jt<H.channels;++Jt)for(var ft=ke[Jt],it=0;it<qe.length;++it){var $t=qe[it];ft.name==$t.name&&(ft.compression=$t.compression,$t.index>=0&&(Ft.idx[$t.index]=Jt),ft.offset=Jt)}if(Ye.acCompressedSize>0)switch(Ye.acCompression){case 0:var fn=new Uint16Array(Ye.totalAcUncompressedCount);It(H.array,J,xe,Ye.acCompressedSize,fn,Ye.totalAcUncompressedCount);break;case 1:var tn=H.array.slice(xe.value,xe.value+Ye.totalAcUncompressedCount),Gn=VE(tn),fn=new Uint16Array(Gn.buffer);xe.value+=Ye.totalAcUncompressedCount;break}if(Ye.dcCompressedSize>0){var bn={array:H.array,offset:xe,size:Ye.dcCompressedSize},$n=new Uint16Array(Te(bn).buffer);xe.value+=Ye.dcCompressedSize}if(Ye.rleRawSize>0){var tn=H.array.slice(xe.value,xe.value+Ye.rleCompressedSize),Gn=VE(tn),hn=ie(Gn.buffer);xe.value+=Ye.rleCompressedSize}for(var qn=0,on=new Array(ke.length),it=0;it<on.length;++it)on[it]=new Array;for(var ii=0;ii<H.lines;++ii)for(var xi=0;xi<ke.length;++xi)on[xi].push(qn),qn+=ke[xi].width*H.type*2;ot(Ft,on,ke,fn,$n,Ie);for(var it=0;it<ke.length;++it){var ft=ke[it];if(!ft.decoded)switch(ft.compression){case 2:for(var xn=0,As=0,ii=0;ii<H.lines;++ii){for(var ci=on[it][xn],Ei=0;Ei<ft.width;++Ei){for(var $i=0;$i<2*ft.type;++$i)Ie[ci++]=hn[As+$i*ft.width*ft.height];As++}xn++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Ie.buffer)}function Xt(H,J){for(var xe=new Uint8Array(H),Ie=0;xe[J.value+Ie]!=0;)Ie+=1;var Ye=new TextDecoder().decode(xe.slice(J.value,J.value+Ie));return J.value=J.value+Ie+1,Ye}function Ot(H,J,xe){var Ie=new TextDecoder().decode(new Uint8Array(H).slice(J.value,J.value+xe));return J.value=J.value+xe,Ie}function cn(H,J){var xe=et(H,J),Ie=st(H,J);return[xe,Ie]}function Qt(H,J){var xe=st(H,J),Ie=st(H,J);return[xe,Ie]}function et(H,J){var xe=H.getInt32(J.value,!0);return J.value=J.value+4,xe}function st(H,J){var xe=H.getUint32(J.value,!0);return J.value=J.value+4,xe}function nn(H,J){var xe=H[J.value];return J.value=J.value+1,xe}function zt(H,J){var xe=H.getUint8(J.value);return J.value=J.value+1,xe}const Mt=function(H,J){let xe;return"getBigInt64"in DataView.prototype?xe=Number(H.getBigInt64(J.value,!0)):xe=H.getUint32(J.value+4,!0)+Number(H.getUint32(J.value,!0)<<32),J.value+=8,xe};function Kt(H,J){var xe=H.getFloat32(J.value,!0);return J.value+=4,xe}function ve(H,J){return op.toHalfFloat(Kt(H,J))}function ze(H){var J=(H&31744)>>10,xe=H&1023;return(H>>15?-1:1)*(J?J===31?xe?NaN:1/0:Math.pow(2,J-15)*(1+xe/1024):6103515625e-14*(xe/1024))}function Et(H,J){var xe=H.getUint16(J.value,!0);return J.value+=2,xe}function wt(H,J){return ze(Et(H,J))}function pt(H,J,xe,Ie){for(var Ye=xe.value,qe=[];xe.value<Ye+Ie-1;){var vt=Xt(J,xe),mt=et(H,xe),xt=zt(H,xe);xe.value+=3;var k=et(H,xe),ae=et(H,xe);qe.push({name:vt,pixelType:mt,pLinear:xt,xSampling:k,ySampling:ae})}return xe.value+=1,qe}function lt(H,J){var xe=Kt(H,J),Ie=Kt(H,J),Ye=Kt(H,J),qe=Kt(H,J),vt=Kt(H,J),mt=Kt(H,J),xt=Kt(H,J),k=Kt(H,J);return{redX:xe,redY:Ie,greenX:Ye,greenY:qe,blueX:vt,blueY:mt,whiteX:xt,whiteY:k}}function en(H,J){var xe=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Ie=zt(H,J);return xe[Ie]}function Tn(H,J){var xe=st(H,J),Ie=st(H,J),Ye=st(H,J),qe=st(H,J);return{xMin:xe,yMin:Ie,xMax:Ye,yMax:qe}}function gi(H,J){var xe=["INCREASING_Y"],Ie=zt(H,J);return xe[Ie]}function ni(H,J){var xe=Kt(H,J),Ie=Kt(H,J);return[xe,Ie]}function rr(H,J){var xe=Kt(H,J),Ie=Kt(H,J),Ye=Kt(H,J);return[xe,Ie,Ye]}function Yr(H,J,xe,Ie,Ye){if(Ie==="string"||Ie==="stringvector"||Ie==="iccProfile")return Ot(J,xe,Ye);if(Ie==="chlist")return pt(H,J,xe,Ye);if(Ie==="chromaticities")return lt(H,xe);if(Ie==="compression")return en(H,xe);if(Ie==="box2i")return Tn(H,xe);if(Ie==="lineOrder")return gi(H,xe);if(Ie==="float")return Kt(H,xe);if(Ie==="v2f")return ni(H,xe);if(Ie==="v3f")return rr(H,xe);if(Ie==="int")return et(H,xe);if(Ie==="rational")return cn(H,xe);if(Ie==="timecode")return Qt(H,xe);if(Ie==="preview")return xe.value+=Ye,"skipped";xe.value+=Ye}function Ld(H,J,xe){const Ie={};if(H.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Ie.version=H.getUint8(4);const Ye=H.getUint8(5);Ie.spec={singleTile:!!(Ye&2),longName:!!(Ye&4),deepFormat:!!(Ye&8),multiPart:!!(Ye&16)},xe.value=8;for(var qe=!0;qe;){var vt=Xt(J,xe);if(vt==0)qe=!1;else{var mt=Xt(J,xe),xt=st(H,xe),k=Yr(H,J,xe,mt,xt);k===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${mt}'.`):Ie[vt]=k}}if((Ye&-5)!=0)throw console.error("EXRHeader:",Ie),"THREE.EXRLoader: provided file is currently unsupported.";return Ie}function Mc(H,J,xe,Ie,Ye){const qe={size:0,viewer:J,array:xe,offset:Ie,width:H.dataWindow.xMax-H.dataWindow.xMin+1,height:H.dataWindow.yMax-H.dataWindow.yMin+1,channels:H.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:H.channels[0].pixelType,uncompress:null,getter:null,format:null,[zb?"colorSpace":"encoding"]:null};switch(H.compression){case"NO_COMPRESSION":qe.lines=1,qe.uncompress=q;break;case"RLE_COMPRESSION":qe.lines=1,qe.uncompress=V;break;case"ZIPS_COMPRESSION":qe.lines=1,qe.uncompress=Te;break;case"ZIP_COMPRESSION":qe.lines=16,qe.uncompress=Te;break;case"PIZ_COMPRESSION":qe.lines=32,qe.uncompress=Ge;break;case"PXR24_COMPRESSION":qe.lines=16,qe.uncompress=$e;break;case"DWAA_COMPRESSION":qe.lines=32,qe.uncompress=Ve;break;case"DWAB_COMPRESSION":qe.lines=256,qe.uncompress=Ve;break;default:throw"EXRLoader.parse: "+H.compression+" is unsupported"}if(qe.scanlineBlockSize=qe.lines,qe.type==1)switch(Ye){case Ti:qe.getter=wt,qe.inputSize=2;break;case Ai:qe.getter=Et,qe.inputSize=2;break}else if(qe.type==2)switch(Ye){case Ti:qe.getter=Kt,qe.inputSize=4;break;case Ai:qe.getter=ve,qe.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+qe.type+" for "+H.compression+".";qe.blockCount=(H.dataWindow.yMax+1)/qe.scanlineBlockSize;for(var vt=0;vt<qe.blockCount;vt++)Mt(J,Ie);qe.outputChannels=qe.channels==3?4:qe.channels;const mt=qe.width*qe.height*qe.outputChannels;switch(Ye){case Ti:qe.byteArray=new Float32Array(mt),qe.channels<qe.outputChannels&&qe.byteArray.fill(1,0,mt);break;case Ai:qe.byteArray=new Uint16Array(mt),qe.channels<qe.outputChannels&&qe.byteArray.fill(15360,0,mt);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ye);break}return qe.bytesPerLine=qe.width*qe.inputSize*qe.channels,qe.outputChannels==4?qe.format=Oi:qe.format=Kf,zb?qe.colorSpace="srgb-linear":qe.encoding=3e3,qe}const Uo=new DataView(e),$s=new Uint8Array(e),Sa={value:0},xr=Ld(Uo,e,Sa),wn=Mc(xr,Uo,$s,Sa,this.type),ar={value:0},Wn={R:0,G:1,B:2,A:3,Y:0};for(let H=0;H<wn.height/wn.scanlineBlockSize;H++){const J=st(Uo,Sa);wn.size=st(Uo,Sa),wn.lines=J+wn.scanlineBlockSize>wn.height?wn.height-J:wn.scanlineBlockSize;const Ie=wn.size<wn.lines*wn.bytesPerLine?wn.uncompress(wn):q(wn);Sa.value+=wn.size;for(let Ye=0;Ye<wn.scanlineBlockSize;Ye++){const qe=Ye+H*wn.scanlineBlockSize;if(qe>=wn.height)break;for(let vt=0;vt<wn.channels;vt++){const mt=Wn[xr.channels[vt].name];for(let xt=0;xt<wn.width;xt++){ar.value=(Ye*(wn.channels*wn.width)+vt*wn.width+xt)*wn.inputSize;const k=(wn.height-1-qe)*(wn.width*wn.outputChannels)+xt*wn.outputChannels+mt;wn.byteArray[k]=wn.getter(Ie,ar)}}}}return{header:xr,width:wn.width,height:wn.height,data:wn.byteArray,format:wn.format,[zb?"colorSpace":"encoding"]:wn[zb?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(a,o){zb?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=Dn,a.magFilter=Dn,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,r,n,s)}}const A2=new WeakMap;class Vfe extends Xr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new Hr(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const u=t.attributeTypes[l];u.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=u.name)}const n=JSON.stringify(t);if(A2.has(e)){const l=A2.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(r,a).then(l=>(s=l,new Promise((u,f)=>{s._callbacks[r]={resolve:u,reject:f},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),A2.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new Fn;e.index&&t.setIndex(new li(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,a=s.array,o=s.itemSize;t.setAttribute(r,new li(a,o))}return t}_loadLibrary(e,t){const n=new Hr(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=Hfe.toString(),a=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const a=r.data;switch(a.type){case"decode":s._callbacks[a.id].resolve(a);break;case"error":s._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Hfe(){let i,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":i=o.decoderConfig,e=new Promise(function(f){i.onModuleLoaded=function(p){f({draco:p})},DracoDecoderModule(i)});break;case"decode":const l=o.buffer,u=o.taskConfig;e.then(f=>{const p=f.draco,x=new p.Decoder,y=new p.DecoderBuffer;y.Init(new Int8Array(l),l.byteLength);try{const _=t(p,x,y,u),T=_.attributes.map(A=>A.array.buffer);_.index&&T.push(_.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:_},T)}catch(_){console.error(_),self.postMessage({type:"error",id:o.id,error:_.message})}finally{p.destroy(y),p.destroy(x)}});break}};function t(a,o,l,u){const f=u.attributeIDs,p=u.attributeTypes;let x,y;const _=o.GetEncodedGeometryType(l);if(_===a.TRIANGULAR_MESH)x=new a.Mesh,y=o.DecodeBufferToMesh(l,x);else if(_===a.POINT_CLOUD)x=new a.PointCloud,y=o.DecodeBufferToPointCloud(l,x);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||x.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const T={index:null,attributes:[]};for(const A in f){const S=self[p[A]];let C,w;if(u.useUniqueIDs)w=f[A],C=o.GetAttributeByUniqueId(x,w);else{if(w=o.GetAttributeId(x,a[f[A]]),w===-1)continue;C=o.GetAttribute(x,w)}T.attributes.push(s(a,o,x,A,S,C))}return _===a.TRIANGULAR_MESH&&(T.index=n(a,o,x)),a.destroy(x),T}function n(a,o,l){const f=l.num_faces()*3,p=f*4,x=a._malloc(p);o.GetTrianglesUInt32Array(l,p,x);const y=new Uint32Array(a.HEAPF32.buffer,x,f).slice();return a._free(x),{array:y,itemSize:1}}function s(a,o,l,u,f,p){const x=p.num_components(),_=l.num_points()*x,T=_*f.BYTES_PER_ELEMENT,A=r(a,f),S=a._malloc(T);o.GetAttributeDataArrayForAllPoints(l,p,A,T,S);const C=new f(a.HEAPF32.buffer,S,_).slice();return a._free(S),{name:u,array:C,itemSize:x}}function r(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let HE;const E2=()=>{if(HE)return HE;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=i;WebAssembly.validate(t)&&(s=e);let r;const a=WebAssembly.instantiate(o(s),{}).then(p=>{r=p.instance,r.exports.__wasm_call_ctors()});function o(p){const x=new Uint8Array(p.length);for(let _=0;_<p.length;++_){const T=p.charCodeAt(_);x[_]=T>96?T-71:T>64?T-65:T>47?T+4:T>46?63:62}let y=0;for(let _=0;_<p.length;++_)x[y++]=x[_]<60?n[x[_]]:(x[_]-60)*64+x[++_];return x.buffer.slice(0,y)}function l(p,x,y,_,T,A){const S=r.exports.sbrk,C=y+3&-4,w=S(C*_),B=S(T.length),L=new Uint8Array(r.exports.memory.buffer);L.set(T,B);const D=p(w,y,_,B,T.length);if(D===0&&A&&A(w,C,_),x.set(L.subarray(w,w+y*_)),S(w-S(0)),D!==0)throw new Error(`Malformed buffer data: ${D}`)}const u={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},f={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return HE={ready:a,supported:!0,decodeVertexBuffer(p,x,y,_,T){l(r.exports.meshopt_decodeVertexBuffer,p,x,y,_,r.exports[u[T]])},decodeIndexBuffer(p,x,y,_){l(r.exports.meshopt_decodeIndexBuffer,p,x,y,_)},decodeIndexSequence(p,x,y,_){l(r.exports.meshopt_decodeIndexSequence,p,x,y,_)},decodeGltfBuffer(p,x,y,_,T,A){l(r.exports[f[T]],p,x,y,_,r.exports[u[A]])}},HE};function kfe(i,{keys:e=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:t,inject:n,castShadow:s,receiveShadow:r}){let a={};for(const o of e)a[o]=i[o];return t&&(a.geometry&&t!=="materialsOnly"&&(a.geometry=a.geometry.clone()),a.material&&t!=="geometriesOnly"&&(a.material=a.material.clone())),n&&(typeof n=="function"?a={...a,children:n(i)}:G.isValidElement(n)?a={...a,children:n}:a={...a,...n}),i instanceof Ui&&(s&&(a.castShadow=!0),r&&(a.receiveShadow=!0)),a}const qN=G.forwardRef(({isChild:i=!1,object:e,children:t,deep:n,castShadow:s,receiveShadow:r,inject:a,keys:o,...l},u)=>{const f={keys:o,deep:n,inject:a,castShadow:s,receiveShadow:r};if(e=G.useMemo(()=>{if(i===!1&&!Array.isArray(e)){let _=!1;if(e.traverse(T=>{T.isSkinnedMesh&&(_=!0)}),_)return ife.clone(e)}return e},[e,i]),Array.isArray(e))return G.createElement("group",ru({},l,{ref:u}),e.map(_=>G.createElement(qN,ru({key:_.uuid,object:_},f))),t);const{children:p,...x}=kfe(e,f),y=e.type[0].toLowerCase()+e.type.slice(1);return G.createElement(y,ru({},x,l,{ref:u}),e.children.map(_=>_.type==="Bone"?G.createElement("primitive",ru({key:_.uuid,object:_},f)):G.createElement(qN,ru({key:_.uuid,object:_},f,{isChild:!0}))),t,p)});let kE=null,G7="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function z7(i=!0,e=!0,t){return n=>{t&&t(n),i&&(kE||(kE=new Vfe),kE.setDecoderPath(typeof i=="string"?i:G7),n.setDRACOLoader(kE)),e&&n.setMeshoptDecoder(typeof E2=="function"?E2():E2)}}const wv=(i,e,t,n)=>Xf(DU,i,z7(e,t,n));wv.preload=(i,e,t,n)=>Xf.preload(DU,i,z7(e,t,n));wv.clear=i=>Xf.clear(DU,i);wv.setDecoderPath=i=>{G7=i};const Wfe=G.forwardRef(({src:i,useDraco:e,useMeshOpt:t,extendLoader:n,...s},r)=>{const{scene:a}=wv(i,e,t,n);return G.createElement(qN,ru({ref:r},s,{object:a}))});const ks={LEFT:1,RIGHT:2,MIDDLE:4},Fe=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),fy={NONE:0,IN:1,OUT:-1};function _g(i){return i.isPerspectiveCamera}function tp(i){return i.isOrthographicCamera}const ep=Math.PI*2,X4=Math.PI/2,V7=1e-5,Vb=Math.PI/180;function eu(i,e,t){return Math.max(e,Math.min(t,i))}function _s(i,e=V7){return Math.abs(i)<e}function Zi(i,e,t=V7){return _s(i-e,t)}function q4(i,e){return Math.round(i/e)*e}function Hb(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function kb(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function WE(i,e,t,n,s=1/0,r){n=Math.max(1e-4,n);const a=2/n,o=a*r,l=1/(1+o+.48*o*o+.235*o*o*o);let u=i-e;const f=e,p=s*n;u=eu(u,-p,p),e=i-u;const x=(t.value+a*u)*r;t.value=(t.value-a*x)*l;let y=e+(u+x)*l;return f-i>0==y>f&&(y=f,t.value=(y-f)/r),y}function Y4(i,e,t,n,s=1/0,r,a){n=Math.max(1e-4,n);const o=2/n,l=o*r,u=1/(1+l+.48*l*l+.235*l*l*l);let f=e.x,p=e.y,x=e.z,y=i.x-f,_=i.y-p,T=i.z-x;const A=f,S=p,C=x,w=s*n,B=w*w,L=y*y+_*_+T*T;if(L>B){const re=Math.sqrt(L);y=y/re*w,_=_/re*w,T=T/re*w}f=i.x-y,p=i.y-_,x=i.z-T;const D=(t.x+o*y)*r,O=(t.y+o*_)*r,F=(t.z+o*T)*r;t.x=(t.x-o*D)*u,t.y=(t.y-o*O)*u,t.z=(t.z-o*F)*u,a.x=f+(y+D)*u,a.y=p+(_+O)*u,a.z=x+(T+F)*u;const U=A-i.x,P=S-i.y,X=C-i.z,Z=a.x-A,ee=a.y-S,te=a.z-C;return U*Z+P*ee+X*te>0&&(a.x=A,a.y=S,a.z=C,t.x=(a.x-A)/r,t.y=(a.y-S)/r,t.z=(a.z-C)/r),a}function M2(i,e){e.set(0,0),i.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=i.length,e.y/=i.length}function C2(i,e){return tp(i)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Xfe{_listeners={};addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e)}}}const qfe="3.1.2",XE=1/8,Yfe=/Mac/.test(globalThis?.navigator?.platform);let Vn,j4,qE,R2,Xo,Qn,zi,hy,Wb,id,sd,bg,$4,K4,yl,py,my,J4,w2,Z4,N2,B2,YE,jfe=class YN extends Xfe{static install(e){Vn=e.THREE,j4=Object.freeze(new Vn.Vector3(0,0,0)),qE=Object.freeze(new Vn.Vector3(0,1,0)),R2=Object.freeze(new Vn.Vector3(0,0,1)),Xo=new Vn.Vector2,Qn=new Vn.Vector3,zi=new Vn.Vector3,hy=new Vn.Vector3,Wb=new Vn.Vector3,id=new Vn.Vector3,sd=new Vn.Vector3,bg=new Vn.Vector3,$4=new Vn.Vector3,K4=new Vn.Vector3,yl=new Vn.Spherical,py=new Vn.Spherical,my=new Vn.Box3,J4=new Vn.Box3,w2=new Vn.Sphere,Z4=new Vn.Quaternion,N2=new Vn.Quaternion,B2=new Vn.Matrix4,YE=new Vn.Raycaster}static get ACTION(){return Fe}minPolarAngle=0;maxPolarAngle=Math.PI;minAzimuthAngle=-1/0;maxAzimuthAngle=1/0;minDistance=Number.EPSILON;maxDistance=1/0;infinityDolly=!1;minZoom=.01;maxZoom=1/0;smoothTime=.25;draggingSmoothTime=.125;maxSpeed=1/0;azimuthRotateSpeed=1;polarRotateSpeed=1;dollySpeed=1;dollyDragInverted=!1;truckSpeed=2;dollyToCursor=!1;dragToOffset=!1;boundaryFriction=0;restThreshold=.01;colliderMeshes=[];mouseButtons;touches;cancel=()=>{};lockPointer;unlockPointer;_enabled=!0;_camera;_yAxisUpSpace;_yAxisUpSpaceInverse;_state=Fe.NONE;_domElement;_viewport=null;_target;_targetEnd;_focalOffset;_focalOffsetEnd;_spherical;_sphericalEnd;_lastDistance;_zoom;_zoomEnd;_lastZoom;_cameraUp0;_target0;_position0;_zoom0;_focalOffset0;_dollyControlCoord;_changedDolly=0;_changedZoom=0;_nearPlaneCorners;_hasRested=!0;_boundary;_boundaryEnclosesCamera=!1;_needsUpdate=!0;_updatedLastTime=!1;_elementRect=new DOMRect;_isDragging=!1;_dragNeedsUpdate=!0;_activePointers=[];_lockedPointer=null;_interactiveArea=new DOMRect(0,0,1,1);_isUserControllingRotate=!1;_isUserControllingDolly=!1;_isUserControllingTruck=!1;_isUserControllingOffset=!1;_isUserControllingZoom=!1;_lastDollyDirection=fy.NONE;_thetaVelocity={value:0};_phiVelocity={value:0};_radiusVelocity={value:0};_targetVelocity=new Vn.Vector3;_focalOffsetVelocity=new Vn.Vector3;_zoomVelocity={value:0};set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),typeof Vn>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Vn.Quaternion().setFromUnitVectors(this._camera.up,qE),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Fe.NONE,this._target=new Vn.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Vn.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Vn.Spherical().setFromVector3(Qn.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Vn.Vector3,new Vn.Vector3,new Vn.Vector3,new Vn.Vector3],this._updateNearPlaneCorners(),this._boundary=new Vn.Box3(new Vn.Vector3(-1/0,-1/0,-1/0),new Vn.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Vn.Vector2,this.mouseButtons={left:Fe.ROTATE,middle:Fe.DOLLY,right:Fe.TRUCK,wheel:_g(this._camera)?Fe.DOLLY:tp(this._camera)?Fe.ZOOM:Fe.NONE},this.touches={one:Fe.TOUCH_ROTATE,two:_g(this._camera)?Fe.TOUCH_DOLLY_TRUCK:tp(this._camera)?Fe.TOUCH_ZOOM_TRUCK:Fe.NONE,three:Fe.TOUCH_TRUCK};const n=new Vn.Vector2,s=new Vn.Vector2,r=new Vn.Vector2,a=S=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const B=this._domElement.getBoundingClientRect(),L=S.clientX/B.width,D=S.clientY/B.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}const C=S.pointerType!=="mouse"?null:(S.buttons&ks.LEFT)===ks.LEFT?ks.LEFT:(S.buttons&ks.MIDDLE)===ks.MIDDLE?ks.MIDDLE:(S.buttons&ks.RIGHT)===ks.RIGHT?ks.RIGHT:null;if(C!==null){const B=this._findPointerByMouseButton(C);B&&this._disposePointer(B)}if((S.buttons&ks.LEFT)===ks.LEFT&&this._lockedPointer)return;const w={pointerId:S.pointerId,clientX:S.clientX,clientY:S.clientY,deltaX:0,deltaY:0,mouseButton:C};this._activePointers.push(w),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,x(S)},o=S=>{S.cancelable&&S.preventDefault();const C=S.pointerId,w=this._lockedPointer||this._findPointerById(C);if(w){if(w.clientX=S.clientX,w.clientY=S.clientY,w.deltaX=S.movementX,w.deltaY=S.movementY,this._state=0,S.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(S.buttons&ks.LEFT)===ks.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(S.buttons&ks.MIDDLE)===ks.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(S.buttons&ks.RIGHT)===ks.RIGHT&&(this._state=this._state|this.mouseButtons.right);y()}},l=S=>{const C=this._findPointerById(S.pointerId);if(!(C&&C===this._lockedPointer)){if(C&&this._disposePointer(C),S.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Fe.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Fe.NONE;_()}};let u=-1;const f=S=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Fe.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),F=S.clientX/O.width,U=S.clientY/O.height;if(F<this._interactiveArea.left||F>this._interactiveArea.right||U<this._interactiveArea.top||U>this._interactiveArea.bottom)return}if(S.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Fe.ROTATE||this.mouseButtons.wheel===Fe.TRUCK){const O=performance.now();u-O<1e3&&this._getClientRect(this._elementRect),u=O}const C=Yfe?-1:-3,w=S.deltaMode===1&&!S.ctrlKey?S.deltaY/C:S.deltaY/(C*10),B=this.dollyToCursor?(S.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(S.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(S.ctrlKey?Fe.ZOOM:this.mouseButtons.wheel){case Fe.ROTATE:{this._rotateInternal(S.deltaX,S.deltaY),this._isUserControllingRotate=!0;break}case Fe.TRUCK:{this._truckInternal(S.deltaX,S.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case Fe.SCREEN_PAN:{this._truckInternal(S.deltaX,S.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case Fe.OFFSET:{this._truckInternal(S.deltaX,S.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case Fe.DOLLY:{this._dollyInternal(-w,B,L),this._isUserControllingDolly=!0;break}case Fe.ZOOM:{this._zoomInternal(-w,B,L),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},p=S=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===YN.ACTION.NONE){const C=S instanceof PointerEvent?S.pointerId:0,w=this._findPointerById(C);w&&this._disposePointer(w),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}S.preventDefault()}},x=S=>{if(!this._enabled)return;if(M2(this._activePointers,Xo),this._getClientRect(this._elementRect),n.copy(Xo),s.copy(Xo),this._activePointers.length>=2){const w=Xo.x-this._activePointers[1].clientX,B=Xo.y-this._activePointers[1].clientY,L=Math.sqrt(w*w+B*B);r.set(0,L);const D=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,O=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(D,O)}if(this._state=0,!S)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in S&&S.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(S.buttons&ks.LEFT)===ks.LEFT&&(this._state=this._state|this.mouseButtons.left),(S.buttons&ks.MIDDLE)===ks.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(S.buttons&ks.RIGHT)===ks.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Fe.ROTATE)===Fe.ROTATE||(this._state&Fe.TOUCH_ROTATE)===Fe.TOUCH_ROTATE||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Fe.TRUCK)===Fe.TRUCK||(this._state&Fe.SCREEN_PAN)===Fe.SCREEN_PAN||(this._state&Fe.TOUCH_TRUCK)===Fe.TOUCH_TRUCK||(this._state&Fe.TOUCH_SCREEN_PAN)===Fe.TOUCH_SCREEN_PAN||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_DOLLY_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK||(this._state&Fe.TOUCH_ZOOM_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Fe.DOLLY)===Fe.DOLLY||(this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_DOLLY_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Fe.ZOOM)===Fe.ZOOM||(this._state&Fe.TOUCH_ZOOM)===Fe.TOUCH_ZOOM||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK||(this._state&Fe.TOUCH_ZOOM_SCREEN_PAN)===Fe.TOUCH_ZOOM_SCREEN_PAN||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Fe.OFFSET)===Fe.OFFSET||(this._state&Fe.TOUCH_OFFSET)===Fe.TOUCH_OFFSET||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},y=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,M2(this._activePointers,Xo);const C=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,w=C?-C.deltaX:s.x-Xo.x,B=C?-C.deltaY:s.y-Xo.y;if(s.copy(Xo),((this._state&Fe.ROTATE)===Fe.ROTATE||(this._state&Fe.TOUCH_ROTATE)===Fe.TOUCH_ROTATE||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(w,B),this._isUserControllingRotate=!0),(this._state&Fe.DOLLY)===Fe.DOLLY||(this._state&Fe.ZOOM)===Fe.ZOOM){const L=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,D=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,O=this.dollyDragInverted?-1:1;(this._state&Fe.DOLLY)===Fe.DOLLY?(this._dollyInternal(O*B*XE,L,D),this._isUserControllingDolly=!0):(this._zoomInternal(O*B*XE,L,D),this._isUserControllingZoom=!0)}if((this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_ZOOM)===Fe.TOUCH_ZOOM||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK||(this._state&Fe.TOUCH_DOLLY_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN||(this._state&Fe.TOUCH_ZOOM_SCREEN_PAN)===Fe.TOUCH_ZOOM_SCREEN_PAN||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_ZOOM_ROTATE)===Fe.TOUCH_ZOOM_ROTATE){const L=Xo.x-this._activePointers[1].clientX,D=Xo.y-this._activePointers[1].clientY,O=Math.sqrt(L*L+D*D),F=r.y-O;r.set(0,O);const U=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Fe.TOUCH_DOLLY)===Fe.TOUCH_DOLLY||(this._state&Fe.TOUCH_DOLLY_ROTATE)===Fe.TOUCH_DOLLY_ROTATE||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_DOLLY_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET?(this._dollyInternal(F*XE,U,P),this._isUserControllingDolly=!0):(this._zoomInternal(F*XE,U,P),this._isUserControllingZoom=!0)}((this._state&Fe.TRUCK)===Fe.TRUCK||(this._state&Fe.TOUCH_TRUCK)===Fe.TOUCH_TRUCK||(this._state&Fe.TOUCH_DOLLY_TRUCK)===Fe.TOUCH_DOLLY_TRUCK||(this._state&Fe.TOUCH_ZOOM_TRUCK)===Fe.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(w,B,!1,!1),this._isUserControllingTruck=!0),((this._state&Fe.SCREEN_PAN)===Fe.SCREEN_PAN||(this._state&Fe.TOUCH_SCREEN_PAN)===Fe.TOUCH_SCREEN_PAN||(this._state&Fe.TOUCH_DOLLY_SCREEN_PAN)===Fe.TOUCH_DOLLY_SCREEN_PAN||(this._state&Fe.TOUCH_ZOOM_SCREEN_PAN)===Fe.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(w,B,!1,!0),this._isUserControllingTruck=!0),((this._state&Fe.OFFSET)===Fe.OFFSET||(this._state&Fe.TOUCH_OFFSET)===Fe.TOUCH_OFFSET||(this._state&Fe.TOUCH_DOLLY_OFFSET)===Fe.TOUCH_DOLLY_OFFSET||(this._state&Fe.TOUCH_ZOOM_OFFSET)===Fe.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(w,B,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{M2(this._activePointers,Xo),s.copy(Xo),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",T),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),x())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),this._domElement?.ownerDocument.exitPointerLock(),this._domElement?.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement?.ownerDocument.removeEventListener("pointerlockerror",A),this.cancel()};const T=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=S=>{this._domElement=S,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",p)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",p),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==Fe.NONE&&(this._state=Fe.NONE,this._activePointers.length=0,_())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=eu(e.width,0,1),this._interactiveArea.height=eu(e.height,0,1),this._interactiveArea.x=eu(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=eu(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const s=eu(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=eu(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const a=!n||Zi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Zi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=fy.NONE,this._changedDolly=0,this._dollyToNoClamp(eu(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const a=this._collisionTest(),o=Zi(a,this._spherical.radius);if(!(n>e)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,a)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||Zi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Wb).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Zi(this._target.x,this._targetEnd.x,this.restThreshold)&&Zi(this._target.y,this._targetEnd.y,this.restThreshold)&&Zi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=eu(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Zi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),id.setFromMatrixColumn(this._camera.matrix,0),sd.setFromMatrixColumn(this._camera.matrix,1),id.multiplyScalar(e),sd.multiplyScalar(-t);const s=Qn.copy(id).add(sd),r=zi.copy(this._targetEnd).add(s);return this.moveTo(r.x,r.y,r.z,n)}forward(e,t=!1){Qn.setFromMatrixColumn(this._camera.matrix,0),Qn.crossVectors(this._camera.up,Qn),Qn.multiplyScalar(e);const n=zi.copy(this._targetEnd).add(Qn);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return Qn.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Qn.x,this._targetEnd.y+Qn.y,this._targetEnd.z+Qn.z,t)}moveTo(e,t,n,s=!1){this._isUserControllingTruck=!1;const r=Qn.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);const a=!s||Zi(this._target.x,this._targetEnd.x,this.restThreshold)&&Zi(this._target.y,this._targetEnd.y,this.restThreshold)&&Zi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,n,s=!1){const o=Qn.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(o.x,o.y,o.z,s)}fitToBox(e,t,{cover:n=!1,paddingLeft:s=0,paddingRight:r=0,paddingBottom:a=0,paddingTop:o=0}={}){const l=[],u=e.isBox3?my.copy(e):my.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=q4(this._sphericalEnd.theta,X4),p=q4(this._sphericalEnd.phi,X4);l.push(this.rotateTo(f,p,t));const x=Qn.setFromSpherical(this._sphericalEnd).normalize(),y=Z4.setFromUnitVectors(x,R2),_=Zi(Math.abs(x.y),1);_&&y.multiply(N2.setFromAxisAngle(qE,f)),y.multiply(this._yAxisUpSpaceInverse);const T=J4.makeEmpty();zi.copy(u.min).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.min).setX(u.max.x).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.min).setY(u.max.y).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.max).setZ(u.min.z).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.min).setZ(u.max.z).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.max).setY(u.min.y).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.max).setX(u.min.x).applyQuaternion(y),T.expandByPoint(zi),zi.copy(u.max).applyQuaternion(y),T.expandByPoint(zi),T.min.x-=s,T.min.y-=a,T.max.x+=r,T.max.y+=o,y.setFromUnitVectors(R2,x),_&&y.premultiply(N2.invert()),y.premultiply(this._yAxisUpSpace);const A=T.getSize(Qn),S=T.getCenter(zi).applyQuaternion(y);if(_g(this._camera)){const C=this.getDistanceToFitBox(A.x,A.y,A.z,n);l.push(this.moveTo(S.x,S.y,S.z,t)),l.push(this.dollyTo(C,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(tp(this._camera)){const C=this._camera,w=C.right-C.left,B=C.top-C.bottom,L=n?Math.max(w/A.x,B/A.y):Math.min(w/A.x,B/A.y);l.push(this.moveTo(S.x,S.y,S.z,t)),l.push(this.zoomTo(L,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const n=[],r="isObject3D"in e?YN.createBoundingSphere(e,w2):w2.copy(e);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),_g(this._camera)){const a=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(a,t))}else if(tp(this._camera)){const a=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,l=2*r.radius,u=Math.min(a/l,o/l);n.push(this.zoomTo(u,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,s,r,a,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fy.NONE,this._changedDolly=0;const l=zi.set(s,r,a),u=Qn.set(e,t,n);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(u.sub(l).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!o||Zi(this._target.x,this._targetEnd.x,this.restThreshold)&&Zi(this._target.y,this._targetEnd.y,this.restThreshold)&&Zi(this._target.z,this._targetEnd.z,this.restThreshold)&&Zi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Zi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Zi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerp(e,t,n,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=fy.NONE,this._changedDolly=0;const r=Qn.set(...e.target);if("spherical"in e)yl.set(...e.spherical);else{const p=zi.set(...e.position);yl.setFromVector3(p.sub(r).applyQuaternion(this._yAxisUpSpace))}const a=hy.set(...t.target);if("spherical"in t)py.set(...t.spherical);else{const p=zi.set(...t.position);py.setFromVector3(p.sub(a).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(r.lerp(a,n));const o=py.theta-yl.theta,l=py.phi-yl.phi,u=py.radius-yl.radius;this._sphericalEnd.set(yl.radius+u*n,yl.phi+l*n,yl.theta+o*n),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!s||Zi(this._target.x,this._targetEnd.x,this.restThreshold)&&Zi(this._target.y,this._targetEnd.y,this.restThreshold)&&Zi(this._target.z,this._targetEnd.z,this.restThreshold)&&Zi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Zi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Zi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,n,s,r,a,o,l,u,f,p,x,y,_=!1){return this.lerp({position:[e,t,n],target:[s,r,a]},{position:[o,l,u],target:[f,p,x]},y,_)}setPosition(e,t,n,s=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(e,t,n,s=!1){const r=this.getPosition(Qn),a=this.setLookAt(r.x,r.y,r.z,e,t,n,s);return this._sphericalEnd.phi=eu(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,n,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);const r=!s||Zi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Zi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Zi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),id.setFromMatrixColumn(this._camera.matrixWorldInverse,0),sd.setFromMatrixColumn(this._camera.matrixWorldInverse,1),bg.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const s=Qn.set(e,t,n),r=s.distanceTo(this._camera.position),a=s.sub(this._camera.position);id.multiplyScalar(a.x),sd.multiplyScalar(a.y),bg.multiplyScalar(a.z),Qn.copy(id).add(sd).add(bg),Qn.z=Qn.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Qn.x,Qn.y,-Qn.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,s){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Vn.Vector4,typeof e=="number"?this._viewport.set(e,t,n,s):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,s=!1){if(C2(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,a=this._camera.getEffectiveFOV()*Vb,o=this._camera.aspect;return((s?r>o:r<o)?t:e/o)*.5/Math.tan(a*.5)+n*.5}getDistanceToFitSphere(e){if(C2(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Vb,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,s=1<this._camera.aspect?t:n;return e/Math.sin(s*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Vn.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Vn.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Vn.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Vn.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%ep+ep)%ep,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=ep),this._spherical.theta+=ep*Math.round((this._sphericalEnd.theta-this._spherical.theta)/ep),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Zi(this._camera.up.x,this._cameraUp0.x)||!Zi(this._camera.up.y,this._cameraUp0.y)||!Zi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(Qn);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,qE),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=Qn.subVectors(this._target,this._camera.position).normalize(),t=zi.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(Qn);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,r=$4.subVectors(this._targetEnd,this._target),a=K4.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(_s(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const p=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=WE(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,p,1/0,e),this._needsUpdate=!0}if(_s(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const p=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=WE(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,p,1/0,e),this._needsUpdate=!0}if(_s(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const p=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=WE(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,p,this.maxSpeed,e),this._needsUpdate=!0}if(_s(r.x)&&_s(r.y)&&_s(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const p=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Y4(this._target,this._targetEnd,this._targetVelocity,p,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(_s(a.x)&&_s(a.y)&&_s(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const p=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Y4(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,p,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(_s(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const p=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=WE(this._zoom,this._zoomEnd,this._zoomVelocity,p,1/0,e)}if(this.dollyToCursor){if(_g(this._camera)&&this._changedDolly!==0){const p=this._spherical.radius-this._lastDistance,x=this._camera,y=this._getCameraDirection(Wb),_=Qn.copy(y).cross(x.up).normalize();_.lengthSq()===0&&(_.x=1);const T=zi.crossVectors(_,y),A=this._sphericalEnd.radius*Math.tan(x.getEffectiveFOV()*Vb*.5),C=(this._sphericalEnd.radius-p-this._sphericalEnd.radius)/this._sphericalEnd.radius,w=hy.copy(this._targetEnd).add(_.multiplyScalar(this._dollyControlCoord.x*A*x.aspect)).add(T.multiplyScalar(this._dollyControlCoord.y*A)),B=Qn.copy(this._targetEnd).lerp(w,C),L=this._lastDollyDirection===fy.IN&&this._spherical.radius<=this.minDistance,D=this._lastDollyDirection===fy.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(L||D)){this._sphericalEnd.radius-=p,this._spherical.radius-=p;const F=zi.copy(y).multiplyScalar(-p);B.add(F)}this._boundary.clampPoint(B,B);const O=zi.subVectors(B,this._targetEnd);this._targetEnd.copy(B),this._target.add(O),this._changedDolly-=p,_s(this._changedDolly)&&(this._changedDolly=0)}else if(tp(this._camera)&&this._changedZoom!==0){const p=this._zoom-this._lastZoom,x=this._camera,y=Qn.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(x.near+x.far)/(x.near-x.far)).unproject(x),_=zi.set(0,0,-1).applyQuaternion(x.quaternion),T=hy.copy(y).add(_.multiplyScalar(-y.dot(x.up))),S=-(this._zoom-p-this._zoom)/this._zoom,C=this._getCameraDirection(Wb),w=this._targetEnd.dot(C),B=Qn.copy(this._targetEnd).lerp(T,S),L=B.dot(C),D=C.multiplyScalar(L-w);B.sub(D),this._boundary.clampPoint(B,B);const O=zi.subVectors(B,this._targetEnd);this._targetEnd.copy(B),this._target.add(O),this._changedZoom-=p,_s(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!_s(this._focalOffset.x)||!_s(this._focalOffset.y)||!_s(this._focalOffset.z))&&(this._camera.matrix.compose(this._camera.position,this._camera.quaternion,this._camera.scale),id.setFromMatrixColumn(this._camera.matrix,0),sd.setFromMatrixColumn(this._camera.matrix,1),bg.setFromMatrixColumn(this._camera.matrix,2),id.multiplyScalar(this._focalOffset.x),sd.multiplyScalar(-this._focalOffset.y),bg.multiplyScalar(this._focalOffset.z),Qn.copy(id).add(sd).add(bg),this._camera.position.add(Qn),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Qn.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),_s(t,this.restThreshold)&&_s(n,this.restThreshold)&&_s(s,this.restThreshold)&&_s(r.x,this.restThreshold)&&_s(r.y,this.restThreshold)&&_s(r.z,this.restThreshold)&&_s(a.x,this.restThreshold)&&_s(a.y,this.restThreshold)&&_s(a.z,this.restThreshold)&&_s(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Hb(this.maxDistance),minZoom:this.minZoom,maxZoom:Hb(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Hb(this.maxPolarAngle),minAzimuthAngle:Hb(this.minAzimuthAngle),maxAzimuthAngle:Hb(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:Qn.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=kb(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=kb(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=kb(n.maxPolarAngle),this.minAzimuthAngle=kb(n.minAzimuthAngle),this.maxAzimuthAngle=kb(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),yl.setFromVector3(Qn.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(yl.theta,yl.phi,t),this.dollyTo(yl.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",qfe),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const s=t.lengthSq();if(s===0)return e;const r=zi.copy(t).add(e),o=this._boundary.clampPoint(r,hy).sub(r),l=o.lengthSq();if(l===0)return e.add(t);if(l===s)return e;if(n===0)return e.add(t).add(o);{const u=1+n*l/t.dot(o);return e.add(zi.copy(t).multiplyScalar(u)).add(o.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(_g(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*Vb,s=Math.tan(n*.5)*t,r=s*e.aspect;this._nearPlaneCorners[0].set(-r,-s,0),this._nearPlaneCorners[1].set(r,-s,0),this._nearPlaneCorners[2].set(r,s,0),this._nearPlaneCorners[3].set(-r,s,0)}else if(tp(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,s=e.right*t,r=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(n,r,0),this._nearPlaneCorners[1].set(s,r,0),this._nearPlaneCorners[2].set(s,a,0),this._nearPlaneCorners[3].set(n,a,0)}}_truckInternal=(e,t,n,s)=>{let r,a;if(_g(this._camera)){const o=Qn.copy(this._camera.position).sub(this._target),l=this._camera.getEffectiveFOV()*Vb,u=o.length()*Math.tan(l*.5);r=this.truckSpeed*e*u/this._elementRect.height,a=this.truckSpeed*t*u/this._elementRect.height}else if(tp(this._camera)){const o=this._camera;r=this.truckSpeed*e*(o.right-o.left)/o.zoom/this._elementRect.width,a=this.truckSpeed*t*(o.top-o.bottom)/o.zoom/this._elementRect.height}else return;s?(n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(r,0,!0),this.forward(-a,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(r,a,!0)};_rotateInternal=(e,t)=>{const n=ep*this.azimuthRotateSpeed*e/this._elementRect.height,s=ep*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,s,!0)};_dollyInternal=(e,t,n)=>{const s=Math.pow(.95,-e*this.dollySpeed),r=this._sphericalEnd.radius,a=this._sphericalEnd.radius*s,o=eu(a,this.minDistance,this.maxDistance),l=o-a;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(l,!0),this._dollyToNoClamp(o,!0)):this._dollyToNoClamp(o,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:o)-r,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)};_zoomInternal=(e,t,n)=>{const s=Math.pow(.95,e*this.dollySpeed),r=this._zoom,a=this._zoom*s;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-r,this._dollyControlCoord.set(t,n))};_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||C2(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(Wb);B2.lookAt(j4,n,this._camera.up);for(let s=0;s<4;s++){const r=zi.copy(this._nearPlaneCorners[s]);r.applyMatrix4(B2);const a=hy.addVectors(this._target,r);YE.set(a,n),YE.far=this._spherical.radius+1;const o=YE.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Vn.Sphere){const n=t,s=n.center;my.makeEmpty(),e.traverseVisible(a=>{a.isMesh&&my.expandByObject(a)}),my.getCenter(s);let r=0;return e.traverseVisible(a=>{if(!a.isMesh)return;const o=a;if(!o.geometry)return;const l=o.geometry.clone();l.applyMatrix4(o.matrixWorld);const f=l.attributes.position;for(let p=0,x=f.count;p<x;p++)Qn.fromBufferAttribute(f,p),r=Math.max(r,s.distanceToSquared(Qn))}),n.radius=Math.sqrt(r),n}};const $fe=G.forwardRef((i,e)=>{const{impl:t,camera:n,domElement:s,makeDefault:r,onControlStart:a,onControl:o,onControlEnd:l,onTransitionStart:u,onUpdate:f,onWake:p,onRest:x,onSleep:y,onStart:_,onEnd:T,onChange:A,regress:S,...C}=i,w=t??jfe;G.useMemo(()=>{const re={Box3:Vr,MathUtils:{clamp:ov.clamp},Matrix4:Yt,Quaternion:wr,Raycaster:GT,Sphere:mr,Spherical:MD,Vector2:Ze,Vector3:Q,Vector4:mn};w.install({THREE:re}),P3({CameraControlsImpl:w})},[w]);const B=yo(re=>re.camera),L=yo(re=>re.gl),D=yo(re=>re.invalidate),O=yo(re=>re.events),F=yo(re=>re.setEvents),U=yo(re=>re.set),P=yo(re=>re.get),X=yo(re=>re.performance),Z=n||B,ee=s||O.connected||L.domElement,te=G.useMemo(()=>new w(Z),[w,Z]);return RU((re,W)=>{te.update(W)},-1),G.useEffect(()=>(te.connect(ee),()=>void te.disconnect()),[ee,te]),G.useEffect(()=>{function re(){D(),S&&X.regress()}const W=Ne=>{re(),a?.(Ne),_?.(Ne)},ne=Ne=>{re(),o?.(Ne),A?.(Ne)},se=Ne=>{l?.(Ne),T?.(Ne)},ge=Ne=>{re(),u?.(Ne),A?.(Ne)},_e=Ne=>{re(),f?.(Ne),A?.(Ne)},K=Ne=>{re(),p?.(Ne),A?.(Ne)},pe=Ne=>{x?.(Ne)},we=Ne=>{y?.(Ne)};return te.addEventListener("controlstart",W),te.addEventListener("control",ne),te.addEventListener("controlend",se),te.addEventListener("transitionstart",ge),te.addEventListener("update",_e),te.addEventListener("wake",K),te.addEventListener("rest",pe),te.addEventListener("sleep",we),()=>{te.removeEventListener("controlstart",W),te.removeEventListener("control",ne),te.removeEventListener("controlend",se),te.removeEventListener("transitionstart",ge),te.removeEventListener("update",_e),te.removeEventListener("wake",K),te.removeEventListener("rest",pe),te.removeEventListener("sleep",we)}},[te,D,F,S,X,a,o,l,u,f,p,x,y,A,_,T]),G.useEffect(()=>{if(r){const re=P().controls;return U({controls:te}),()=>U({controls:re})}},[r,te]),G.createElement("primitive",ru({ref:e,object:te},C))}),H7=(i,e,t)=>{let n;switch(i){case ss:n=new Uint8ClampedArray(e*t*4);break;case Ai:n=new Uint16Array(e*t*4);break;case Xi:n=new Uint32Array(e*t*4);break;case dd:n=new Int8Array(e*t*4);break;case fd:n=new Int16Array(e*t*4);break;case fr:n=new Int32Array(e*t*4);break;case Ti:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let jE;const Kfe=(i,e,t,n)=>{if(jE!==void 0)return jE;const s=new Bl(1,1,n);e.setRenderTarget(s);const r=new Ui(new Bd,new er({color:16777215}));e.render(r,t),e.setRenderTarget(null);const a=H7(i,s.width,s.height);return e.readRenderTargetPixels(s,0,0,s.width,s.height,a),s.dispose(),r.geometry.dispose(),r.material.dispose(),jE=a[0]!==0,jE};class OU{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Oi,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0?e.renderTargetOptions?.generateMipmaps:!1,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:Dn,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:Dn,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:ts,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:ts};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=OU.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Qf,this._camera=new Ac,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Kfe(this._type,this._renderer,this._camera,t)){let n;switch(this._type){case Ai:n=this._renderer.extensions.has("EXT_color_buffer_float")?Ti:void 0;break}n!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ti}`),this._type=n):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Ui(new Bd,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Bl(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:Td}static instantiateRenderer(){const e=new SU;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=H7(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new No(this.toArray(),this.width,this.height,Oi,this._type,e?.mapping||Td,e?.wrapS||ts,e?.wrapT||ts,e?.magFilter||Dn,e?.minFilter||Dn,e?.anisotropy||1,Qo);return t.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Xa&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof pi&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof pi&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class k7 extends Error{}class W7 extends Error{}const Xb=(i,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(i);if(n)return n[1];const s=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(i);if(s){const r=s[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return r&&r.length===3?r.map(a=>a.replace(/<\/?rdf:li>/g,"")):s[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},Jfe=i=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(i):e=i.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),s=e.slice(t,n+10);try{const r=Xb(s,"hdrgm:GainMapMin","0"),a=Xb(s,"hdrgm:GainMapMax"),o=Xb(s,"hdrgm:Gamma","1"),l=Xb(s,"hdrgm:OffsetSDR","0.015625"),u=Xb(s,"hdrgm:OffsetHDR","0.015625"),f=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(s),p=f?f[1]:"0",x=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(s);if(!x)throw new Error("Incomplete gainmap metadata");const y=x[1];return{gainMapMin:Array.isArray(r)?r.map(_=>parseFloat(_)):[parseFloat(r),parseFloat(r),parseFloat(r)],gainMapMax:Array.isArray(a)?a.map(_=>parseFloat(_)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(o)?o.map(_=>parseFloat(_)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(l)?l.map(_=>parseFloat(_)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(u)?u.map(_=>parseFloat(_)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(p),hdrCapacityMax:parseFloat(y)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class Zfe{options;constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const s=this.options.debug,r=new DataView(e.buffer);if(r.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const a=r.byteLength;let o=2,l=0,u;for(;o<a;){if(++l>250){n(new Error(`Found no marker after ${l} loops `));return}if(r.getUint8(o)!==255){n(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${r.getUint8(o).toString(16)}`));return}if(u=r.getUint8(o+1),s&&console.log(`Marker: ${u.toString(16)}`),u===226){s&&console.log("Found APP2 marker (0xffe2)");const f=o+4;if(r.getUint32(f)===1297106432){const p=f+4;let x;if(r.getUint16(p)===18761)x=!1;else if(r.getUint16(p)===19789)x=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(r.getUint16(p+2,!x)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const y=r.getUint32(p+4,!x);if(y<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const _=p+y,T=r.getUint16(_,!x),A=_+2;let S=0;for(let L=A;L<A+12*T;L+=12)r.getUint16(L,!x)===45057&&(S=r.getUint32(L+8,!x));const w=_+2+T*12+4,B=[];for(let L=w;L<w+S*16;L+=16){const D={MPType:r.getUint32(L,!x),size:r.getUint32(L+4,!x),dataOffset:r.getUint32(L+8,!x),dependantImages:r.getUint32(L+12,!x),start:-1,end:-1,isFII:!1};D.dataOffset?(D.start=p+D.dataOffset,D.isFII=!1):(D.start=0,D.isFII=!0),D.end=D.start+D.size,B.push(D)}if(this.options.extractNonFII&&B.length){const L=new Blob([r]),D=[];for(const O of B){if(O.isFII&&!this.options.extractFII)continue;const F=L.slice(O.start,O.end+1,"image/jpeg");D.push(F)}t(D)}}}o+=2+r.getUint16(o+2)}})}}const Qfe=async i=>{const e=Jfe(i);if(!e)throw new W7("Gain map XMP metadata not found");const n=await new Zfe({extractFII:!0,extractNonFII:!0}).extract(i);if(n.length!==2)throw new k7("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},Q4=i=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=s=>{t(s)},n.src=URL.createObjectURL(i)});class ehe extends Xr{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new IT}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new pi,sdr:new pi});return this._config.createQuadRenderer({width:16,height:16,type:Ai,colorSpace:Qo,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,n){const s=t?new Blob([t],{type:"image/jpeg"}):void 0,r=new Blob([e],{type:"image/jpeg"});let a,o,l=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([s?Q4(s):Promise.resolve(void 0),Q4(r)]);o=u[0],a=u[1],l=n==="flipY"}else{const u=await Promise.all([s?createImageBitmap(s,{imageOrientation:n||"flipY"}):Promise.resolve(void 0),createImageBitmap(r,{imageOrientation:n||"flipY"})]);o=u[0],a=u[1]}return{sdrImage:a,gainMapImage:o,needsFlip:l}}createTextures(e,t,n){const s=new pi(t||new ImageData(2,2),Td,ts,ts,Dn,_S,Oi,ss,1,Qo);s.flipY=n,s.needsUpdate=!0;const r=new pi(e,Td,ts,ts,Dn,_S,Oi,ss,1,Mr);return r.flipY=n,r.needsUpdate=!0,{gainMap:s,sdr:r}}updateQuadRenderer(e,t,n,s,r){e.width=t.width,e.height=t.height,e.material.gainMap=n,e.material.sdr=s,e.material.gainMapMin=r.gainMapMin,e.material.gainMapMax=r.gainMapMax,e.material.offsetHdr=r.offsetHdr,e.material.offsetSdr=r.offsetSdr,e.material.gamma=r.gamma,e.material.hdrCapacityMin=r.hdrCapacityMin,e.material.hdrCapacityMax=r.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,r.hdrCapacityMax),e.material.needsUpdate=!0}}const the=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,nhe=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class ihe extends Xa{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:s,gainMapMax:r,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:l,sdr:u,gainMap:f}){super({name:"GainMapDecoderMaterial",vertexShader:the,fragmentShader:nhe,uniforms:{sdr:{value:u},gainMap:{value:f},gamma:{value:new Q(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new Q().fromArray(t)},offsetSdr:{value:new Q().fromArray(n)},gainMapMin:{value:new Q().fromArray(s)},gainMapMax:{value:new Q().fromArray(r)},weightFactor:{value:(Math.log2(a)-o)/(l-o)}},blending:ca,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class X7 extends ehe{constructor(e,t){super({renderer:e,createMaterial:n=>new ihe(n),createQuadRenderer:n=>new OU(n)},t)}async render(e,t,n,s){const{sdrImage:r,gainMapImage:a,needsFlip:o}=await this.processImages(n,s,"flipY"),{gainMap:l,sdr:u}=this.createTextures(r,a,o);this.updateQuadRenderer(e,r,l,u,t),e.render()}}class she extends X7{load([e,t,n],s,r,a){const o=this.prepareQuadRenderer();let l,u,f;const p=async()=>{if(l&&u&&f){try{await this.render(o,f,l,u)}catch(U){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof a=="function"&&a(U),o.disposeOnDemandRenderer();return}typeof s=="function"&&s(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),o.disposeOnDemandRenderer()}};let x=!0,y=0,_=0,T=!0,A=0,S=0,C=!0,w=0,B=0;const L=()=>{if(typeof r=="function"){const U=y+A+w,P=_+S+B,X=x&&T&&C;r(new ProgressEvent("progress",{lengthComputable:X,loaded:P,total:U}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const D=new Hr(this._internalLoadingManager);D.setResponseType("arraybuffer"),D.setRequestHeader(this.requestHeader),D.setPath(this.path),D.setWithCredentials(this.withCredentials),D.load(e,async U=>{if(typeof U=="string")throw new Error("Invalid sdr buffer");l=U,await p()},U=>{x=U.lengthComputable,_=U.loaded,y=U.total,L()},U=>{this.manager.itemError(e),typeof a=="function"&&a(U)});const O=new Hr(this._internalLoadingManager);O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setPath(this.path),O.setWithCredentials(this.withCredentials),O.load(t,async U=>{if(typeof U=="string")throw new Error("Invalid gainmap buffer");u=U,await p()},U=>{T=U.lengthComputable,S=U.loaded,A=U.total,L()},U=>{this.manager.itemError(t),typeof a=="function"&&a(U)});const F=new Hr(this._internalLoadingManager);return F.setRequestHeader(this.requestHeader),F.setPath(this.path),F.setWithCredentials(this.withCredentials),F.load(n,async U=>{if(typeof U!="string")throw new Error("Invalid metadata string");f=JSON.parse(U),await p()},U=>{C=U.lengthComputable,B=U.loaded,w=U.total,L()},U=>{this.manager.itemError(n),typeof a=="function"&&a(U)}),o}}class rhe extends X7{load(e,t,n,s){const r=this.prepareQuadRenderer(),a=new Hr(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async o=>{if(typeof o=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(o);let u,f,p;try{const x=await Qfe(l);u=x.sdr,f=x.gainMap,p=x.metadata}catch(x){if(x instanceof W7||x instanceof k7)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),p={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=l;else throw x}try{await this.render(r,p,u.buffer,f?.buffer)}catch(x){this.manager.itemError(e),typeof s=="function"&&s(x),r.disposeOnDemandRenderer();return}typeof t=="function"&&t(r),this.manager.itemEnd(e),r.disposeOnDemandRenderer()},n,o=>{this.manager.itemError(e),typeof s=="function"&&s(o)}),r}}const HS={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},q7="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Iy=i=>Array.isArray(i),UU=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function G3({files:i=UU,path:e="",preset:t=void 0,colorSpace:n=void 0,extensions:s}={}){t&&(LU(t),i=HS[t],e=q7);const r=Iy(i),{extension:a,isCubemap:o}=IU(i),l=PU(a);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+i);const u=yo(y=>y.gl);G.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function y(){Xf.clear(l,r?[i]:i)}u.domElement.addEventListener("webglcontextlost",y,{once:!0})},[i,u.domElement]);const f=Xf(l,r?[i]:i,y=>{(a==="webp"||a==="jpg"||a==="jpeg")&&y.setRenderer(u),y.setPath==null||y.setPath(e),s&&s(y)});let p=r?f[0]:f;if(a==="jpg"||a==="jpeg"||a==="webp"){var x;p=(x=p.renderTarget)==null?void 0:x.texture}return p.mapping=o?Do:Ad,p.colorSpace=n??(o?"srgb":"srgb-linear"),p}const ahe={files:UU,path:"",preset:void 0,extensions:void 0};G3.preload=i=>{const e={...ahe,...i};let{files:t,path:n=""}=e;const{preset:s,extensions:r}=e;s&&(LU(s),t=HS[s],n=q7);const{extension:a}=IU(t);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=PU(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+t);Xf.preload(o,Iy(t)?[t]:t,l=>{l.setPath==null||l.setPath(n),r&&r(l)})};const ohe={files:UU,preset:void 0};G3.clear=i=>{const e={...ohe,...i};let{files:t}=e;const{preset:n}=e;n&&(LU(n),t=HS[n]);const{extension:s}=IU(t),r=PU(s);if(!r)throw new Error("useEnvironment: Unrecognized file extension: "+t);Xf.clear(r,Iy(t)?[t]:t)};function LU(i){if(!(i in HS))throw new Error("Preset must be one of: "+Object.keys(HS).join(", "))}function IU(i){var e;const t=Iy(i)&&i.length===6,n=Iy(i)&&i.length===3&&i.some(a=>a.endsWith("json")),s=Iy(i)?i[0]:i;return{extension:t?"cube":n?"webp":s.startsWith("data:application/exr")?"exr":s.startsWith("data:application/hdr")?"hdr":s.startsWith("data:image/jpeg")?"jpg":(e=s.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function PU(i){return i==="cube"?dD:i==="hdr"?Gfe:i==="exr"?zfe:i==="jpg"||i==="jpeg"?rhe:i==="webp"?she:null}const lhe=i=>i.current&&i.current.isScene,che=i=>lhe(i)?i.current:i;function FU(i,e,t,n,s={}){var r,a,o,l;s={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...s};const u=che(e||t),f=u.background,p=u.environment,x={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(r=(a=u.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&r!==void 0?r:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(o=(l=u.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&o!==void 0?o:[0,0,0]};return i!=="only"&&(u.environment=n),i&&(u.background=n),ld(u,s),()=>{i!=="only"&&(u.environment=p),i&&(u.background=f),ld(u,x)}}function GU({scene:i,background:e=!1,map:t,...n}){const s=yo(r=>r.scene);return G.useLayoutEffect(()=>{if(t)return FU(e,i,s,t,n)}),null}function Y7({background:i=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:s,backgroundRotation:r,environmentIntensity:a,environmentRotation:o,...l}){const u=G3(l),f=yo(p=>p.scene);return G.useLayoutEffect(()=>FU(i,e,f,u,{backgroundBlurriness:t??n,backgroundIntensity:s,backgroundRotation:r,environmentIntensity:a,environmentRotation:o})),G.useEffect(()=>()=>{u.dispose()},[u]),null}function uhe({children:i,near:e=.1,far:t=1e3,resolution:n=256,frames:s=1,map:r,background:a=!1,blur:o,backgroundBlurriness:l,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:p,environmentRotation:x,scene:y,files:_,path:T,preset:A=void 0,extensions:S}){const C=yo(F=>F.gl),w=yo(F=>F.scene),B=G.useRef(null),[L]=G.useState(()=>new Qf),D=G.useMemo(()=>{const F=new gT(n);return F.texture.type=Ai,F},[n]);G.useEffect(()=>()=>{D.dispose()},[D]),G.useLayoutEffect(()=>{if(s===1){const F=C.autoClear;C.autoClear=!0,B.current.update(C,L),C.autoClear=F}return FU(a,y,w,D.texture,{backgroundBlurriness:o??l,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:p,environmentRotation:x})},[i,L,D.texture,y,w,a,s,C]);let O=1;return RU(()=>{if(s===1/0||O<s){const F=C.autoClear;C.autoClear=!0,B.current.update(C,L),C.autoClear=F,O++}}),G.createElement(G.Fragment,null,xue(G.createElement(G.Fragment,null,i,G.createElement("cubeCamera",{ref:B,args:[e,t,D]}),_||A?G.createElement(Y7,{background:!0,files:_,preset:A,path:T,extensions:S}):r?G.createElement(GU,{background:!0,map:r,extensions:S}):null),L))}function dhe(i){var e,t,n,s;const r=G3(i),a=i.map||r;G.useMemo(()=>P3({GroundProjectedEnvImpl:Qde}),[]),G.useEffect(()=>()=>{r.dispose()},[r]);const o=G.useMemo(()=>[a],[a]),l=(e=i.ground)==null?void 0:e.height,u=(t=i.ground)==null?void 0:t.radius,f=(n=(s=i.ground)==null?void 0:s.scale)!==null&&n!==void 0?n:1e3;return G.createElement(G.Fragment,null,G.createElement(GU,ru({},i,{map:a})),G.createElement("groundProjectedEnvImpl",{args:o,scale:f,height:l,radius:u}))}function fhe(i){return i.ground?G.createElement(dhe,i):i.map?G.createElement(GU,i):i.children?G.createElement(uhe,i):G.createElement(Y7,i)}var zU=Az();const hhe=$p(zU);function eG(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function E0(...i){return e=>{let t=!1;const n=i.map(s=>{const r=eG(s,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let s=0;s<n.length;s++){const r=n[s];typeof r=="function"?r():eG(i[s],null)}}}}function M0(...i){return G.useCallback(E0(...i),i)}var phe=Symbol.for("react.lazy"),kM=gB[" use ".trim().toString()];function mhe(i){return typeof i=="object"&&i!==null&&"then"in i}function j7(i){return i!=null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===phe&&"_payload"in i&&mhe(i._payload)}function ghe(i){const e=xhe(i),t=G.forwardRef((n,s)=>{let{children:r,...a}=n;j7(r)&&typeof kM=="function"&&(r=kM(r._payload));const o=G.Children.toArray(r),l=o.find(vhe);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function xhe(i){const e=G.forwardRef((t,n)=>{let{children:s,...r}=t;if(j7(s)&&typeof kM=="function"&&(s=kM(s._payload)),G.isValidElement(s)){const a=bhe(s),o=_he(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var yhe=Symbol("radix.slottable");function vhe(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===yhe}function _he(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function bhe(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var She=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],The=She.reduce((i,e)=>{const t=ghe(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{}),Xp=globalThis?.document?G.useLayoutEffect:()=>{},Ahe="Portal",$7=G.forwardRef((i,e)=>{const{container:t,...n}=i,[s,r]=G.useState(!1);Xp(()=>r(!0),[]);const a=t||s&&globalThis?.document?.body;return a?hhe.createPortal(Pt.jsx(The.div,{...n,ref:e}),a):null});$7.displayName=Ahe;var Ehe=$7,tG=Object.prototype.hasOwnProperty;function kS(i,e){var t,n;if(i===e)return!0;if(i&&e&&(t=i.constructor)===e.constructor){if(t===Date)return i.getTime()===e.getTime();if(t===RegExp)return i.toString()===e.toString();if(t===Array){if((n=i.length)===e.length)for(;n--&&kS(i[n],e[n]););return n===-1}if(!t||typeof i=="object"){n=0;for(t in i)if(tG.call(i,t)&&++n&&!tG.call(e,t)||!(t in e)||!kS(i[t],e[t]))return!1;return Object.keys(e).length===n}}return i!==i&&e!==e}function z3(i,e){if(Object.is(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;const t=Object.keys(i);if(t.length!==Object.keys(e).length)return!1;for(let n=0;n<t.length;n++)if(!Object.prototype.hasOwnProperty.call(e,t[n])||!Object.is(i[t[n]],e[t[n]]))return!1;return!0}var V3=function(e,t,n,s){this.name=e,this.fn=t,this.args=n,this.modifiers=s};V3.prototype._test=function(e){var t=this.fn;try{Py(this.modifiers.slice(),t,this)(e)}catch{t=function(){return!1}}try{return Py(this.modifiers.slice(),t,this)(e)}catch{return!1}};V3.prototype._check=function(e){try{Py(this.modifiers.slice(),this.fn,this)(e)}catch{if(Py(this.modifiers.slice(),function(n){return n},this)(!1))return}if(!Py(this.modifiers.slice(),this.fn,this)(e))throw null};V3.prototype._testAsync=function(e){var t=this;return new Promise(function(n,s){J7(t.modifiers.slice(),t.fn,t)(e).then(function(r){r?n(e):s(null)}).catch(function(r){return s(r)})})};function K7(i,e){return e===void 0&&(e="simple"),typeof i=="object"?i[e]:i}function Py(i,e,t){if(i.length){var n=i.shift(),s=Py(i,e,t);return n.perform(s,t)}else return K7(e)}function J7(i,e,t){if(i.length){var n=i.shift(),s=J7(i,e,t);return n.performAsync(s,t)}else return function(r){return Promise.resolve(K7(e,"async")(r))}}var Mhe=function(e,t,n){this.name=e,this.perform=t,this.performAsync=n},VU=(function(i){function e(t,n,s,r){for(var a=[],o=arguments.length-4;o-- >0;)a[o]=arguments[o+4];i.call(this,a),i.captureStackTrace&&i.captureStackTrace(this,e),this.rule=t,this.value=n,this.cause=s,this.target=r}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e})(Error),Rd=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=[]),this.chain=e,this.nextRuleModifiers=t};Rd.prototype._applyRule=function(e,t){var n=this;return function(){for(var s=[],r=arguments.length;r--;)s[r]=arguments[r];return n.chain.push(new V3(t,e.apply(n,s),s,n.nextRuleModifiers)),n.nextRuleModifiers=[],n}};Rd.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new Mhe(t,e.simple,e.async)),this};Rd.prototype._clone=function(){return new Rd(this.chain.slice(),this.nextRuleModifiers.slice())};Rd.prototype.test=function(e){return this.chain.every(function(t){return t._test(e)})};Rd.prototype.testAll=function(e){var t=[];return this.chain.forEach(function(n){try{n._check(e)}catch(s){t.push(new VU(n,e,s))}}),t};Rd.prototype.check=function(e){this.chain.forEach(function(t){try{t._check(e)}catch(n){throw new VU(t,e,n)}})};Rd.prototype.testAsync=function(e){var t=this;return new Promise(function(n,s){Z7(e,t.chain.slice(),n,s)})};function Z7(i,e,t,n){if(e.length){var s=e.shift();s._testAsync(i).then(function(){Z7(i,e,t,n)},function(r){n(new VU(s,i,r))})}else t(i)}var nG=function(i,e){return e&&typeof i=="string"&&i.trim().length===0?!0:i==null};function Che(i,e){return e===void 0&&(e=!1),{simple:function(t){return nG(t,e)||i.check(t)===void 0},async:function(t){return nG(t,e)||i.testAsync(t)}}}function Ko(){return typeof Proxy<"u"?Q7(new Rd):jN(new Rd)}var WS={};Ko.extend=function(i){Object.assign(WS,i)};Ko.clearCustomRules=function(){WS={}};function Q7(i){return new Proxy(i,{get:function(t,n){if(n in t)return t[n];var s=Q7(i._clone());if(n in WM)return s._applyModifier(WM[n],n);if(n in WS)return s._applyRule(WS[n],n);if(n in $N)return s._applyRule($N[n],n)}})}function jN(i){var e=function(s,r){return Object.keys(s).forEach(function(a){r[a]=function(){for(var o=[],l=arguments.length;l--;)o[l]=arguments[l];var u=jN(r._clone()),f=u._applyRule(s[a],a).apply(void 0,o);return f}}),r},t=e($N,i),n=e(WS,t);return Object.keys(WM).forEach(function(s){Object.defineProperty(n,s,{get:function(){var r=jN(n._clone());return r._applyModifier(WM[s],s)}})}),n}var WM={not:{simple:function(i){return function(e){return!i(e)}},async:function(i){return function(e){return Promise.resolve(i(e)).then(function(t){return!t}).catch(function(){return!0})}}},some:{simple:function(i){return function(e){return $E(e).some(function(t){try{return i(t)}catch{return!1}})}},async:function(i){return function(e){return Promise.all($E(e).map(function(t){try{return i(t).catch(function(){return!1})}catch{return!1}})).then(function(t){return t.some(Boolean)})}}},every:{simple:function(i){return function(e){return e!==!1&&$E(e).every(i)}},async:function(i){return function(e){return Promise.all($E(e).map(i)).then(function(t){return t.every(Boolean)})}}},strict:{simple:function(i,e){return function(t){return iG(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&i(t):i(t)}},async:function(i,e){return function(t){return Promise.resolve(i(t)).then(function(n){return iG(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&n:n}).catch(function(){return!1})}}}};function iG(i){return i&&i.name==="schema"&&i.args.length>0&&typeof i.args[0]=="object"}function $E(i){return typeof i=="string"?i.split(""):i}var $N={equal:function(i){return function(e){return e==i}},exact:function(i){return function(e){return e===i}},number:function(i){return i===void 0&&(i=!0),function(e){return typeof e=="number"&&(i||isFinite(e))}},integer:function(){return function(i){var e=Number.isInteger||Rhe;return e(i)}},numeric:function(){return function(i){return!isNaN(parseFloat(i))&&isFinite(i)}},string:function(){return gy("string")},boolean:function(){return gy("boolean")},undefined:function(){return gy("undefined")},null:function(){return gy("null")},array:function(){return gy("array")},object:function(){return gy("object")},instanceOf:function(i){return function(e){return e instanceof i}},pattern:function(i){return function(e){return i.test(e)}},lowercase:function(){return function(i){return typeof i=="boolean"||i===i.toLowerCase()&&i.trim()!==""}},uppercase:function(){return function(i){return i===i.toUpperCase()&&i.trim()!==""}},vowel:function(){return function(i){return/^[aeiou]+$/i.test(i)}},consonant:function(){return function(i){return/^(?=[^aeiou])([a-z]+)$/i.test(i)}},first:function(i){return function(e){return e[0]==i}},last:function(i){return function(e){return e[e.length-1]==i}},empty:function(){return function(i){return i.length===0}},length:function(i,e){return function(t){return t.length>=i&&t.length<=(e||i)}},minLength:function(i){return function(e){return e.length>=i}},maxLength:function(i){return function(e){return e.length<=i}},negative:function(){return function(i){return i<0}},positive:function(){return function(i){return i>=0}},between:function(i,e){return function(t){return t>=i&&t<=e}},range:function(i,e){return function(t){return t>=i&&t<=e}},lessThan:function(i){return function(e){return e<i}},lessThanOrEqual:function(i){return function(e){return e<=i}},greaterThan:function(i){return function(e){return e>i}},greaterThanOrEqual:function(i){return function(e){return e>=i}},even:function(){return function(i){return i%2===0}},odd:function(){return function(i){return i%2!==0}},includes:function(i){return function(e){return~e.indexOf(i)}},schema:function(i){return whe(i)},passesAnyOf:function(){for(var i=[],e=arguments.length;e--;)i[e]=arguments[e];return function(t){return i.some(function(n){return n.test(t)})}},optional:Che};function gy(i){return function(e){return Array.isArray(e)&&i==="array"||e===null&&i==="null"||typeof e===i}}function Rhe(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i}function whe(i){return{simple:function(e){var t=[];if(Object.keys(i).forEach(function(n){var s=i[n];try{s.check((e||{})[n])}catch(r){r.target=n,t.push(r)}}),t.length>0)throw t;return!0},async:function(e){var t=[],n=Object.keys(i).map(function(s){var r=i[s];return r.testAsync((e||{})[s]).catch(function(a){a.target=s,t.push(a)})});return Promise.all(n).then(function(){if(t.length>0)throw t;return!0})}}}var cs="colors",ho="sizes",dn="space",Nhe={gap:dn,gridGap:dn,columnGap:dn,gridColumnGap:dn,rowGap:dn,gridRowGap:dn,inset:dn,insetBlock:dn,insetBlockEnd:dn,insetBlockStart:dn,insetInline:dn,insetInlineEnd:dn,insetInlineStart:dn,margin:dn,marginTop:dn,marginRight:dn,marginBottom:dn,marginLeft:dn,marginBlock:dn,marginBlockEnd:dn,marginBlockStart:dn,marginInline:dn,marginInlineEnd:dn,marginInlineStart:dn,padding:dn,paddingTop:dn,paddingRight:dn,paddingBottom:dn,paddingLeft:dn,paddingBlock:dn,paddingBlockEnd:dn,paddingBlockStart:dn,paddingInline:dn,paddingInlineEnd:dn,paddingInlineStart:dn,top:dn,right:dn,bottom:dn,left:dn,scrollMargin:dn,scrollMarginTop:dn,scrollMarginRight:dn,scrollMarginBottom:dn,scrollMarginLeft:dn,scrollMarginX:dn,scrollMarginY:dn,scrollMarginBlock:dn,scrollMarginBlockEnd:dn,scrollMarginBlockStart:dn,scrollMarginInline:dn,scrollMarginInlineEnd:dn,scrollMarginInlineStart:dn,scrollPadding:dn,scrollPaddingTop:dn,scrollPaddingRight:dn,scrollPaddingBottom:dn,scrollPaddingLeft:dn,scrollPaddingX:dn,scrollPaddingY:dn,scrollPaddingBlock:dn,scrollPaddingBlockEnd:dn,scrollPaddingBlockStart:dn,scrollPaddingInline:dn,scrollPaddingInlineEnd:dn,scrollPaddingInlineStart:dn,fontSize:"fontSizes",background:cs,backgroundColor:cs,backgroundImage:cs,borderImage:cs,border:cs,borderBlock:cs,borderBlockEnd:cs,borderBlockStart:cs,borderBottom:cs,borderBottomColor:cs,borderColor:cs,borderInline:cs,borderInlineEnd:cs,borderInlineStart:cs,borderLeft:cs,borderLeftColor:cs,borderRight:cs,borderRightColor:cs,borderTop:cs,borderTopColor:cs,caretColor:cs,color:cs,columnRuleColor:cs,fill:cs,outline:cs,outlineColor:cs,stroke:cs,textDecorationColor:cs,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:ho,minBlockSize:ho,maxBlockSize:ho,inlineSize:ho,minInlineSize:ho,maxInlineSize:ho,width:ho,minWidth:ho,maxWidth:ho,height:ho,minHeight:ho,maxHeight:ho,flexBasis:ho,gridTemplateColumns:ho,gridTemplateRows:ho,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Bhe=(i,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,Nv=()=>{const i=Object.create(null);return(e,t,...n)=>{const s=(r=>JSON.stringify(r,Bhe))(e);return s in i?i[s]:i[s]=t(e,...n)}},Gg=Symbol.for("sxs.internal"),HU=(i,e)=>Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)),sG=i=>{for(const e in i)return!0;return!1},{hasOwnProperty:Dhe}=Object.prototype,KN=i=>i.includes("-")?i:i.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),Ohe=/\s+(?![^()]*\))/,xy=i=>e=>i(...typeof e=="string"?String(e).split(Ohe):[e]),rG={appearance:i=>({WebkitAppearance:i,appearance:i}),backfaceVisibility:i=>({WebkitBackfaceVisibility:i,backfaceVisibility:i}),backdropFilter:i=>({WebkitBackdropFilter:i,backdropFilter:i}),backgroundClip:i=>({WebkitBackgroundClip:i,backgroundClip:i}),boxDecorationBreak:i=>({WebkitBoxDecorationBreak:i,boxDecorationBreak:i}),clipPath:i=>({WebkitClipPath:i,clipPath:i}),content:i=>({content:i.includes('"')||i.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(i)?i:`"${i}"`}),hyphens:i=>({WebkitHyphens:i,hyphens:i}),maskImage:i=>({WebkitMaskImage:i,maskImage:i}),maskSize:i=>({WebkitMaskSize:i,maskSize:i}),tabSize:i=>({MozTabSize:i,tabSize:i}),textSizeAdjust:i=>({WebkitTextSizeAdjust:i,textSizeAdjust:i}),userSelect:i=>({WebkitUserSelect:i,userSelect:i}),marginBlock:xy(((i,e)=>({marginBlockStart:i,marginBlockEnd:e||i}))),marginInline:xy(((i,e)=>({marginInlineStart:i,marginInlineEnd:e||i}))),maxSize:xy(((i,e)=>({maxBlockSize:i,maxInlineSize:e||i}))),minSize:xy(((i,e)=>({minBlockSize:i,minInlineSize:e||i}))),paddingBlock:xy(((i,e)=>({paddingBlockStart:i,paddingBlockEnd:e||i}))),paddingInline:xy(((i,e)=>({paddingInlineStart:i,paddingInlineEnd:e||i})))},D2=/([\d.]+)([^]*)/,Uhe=(i,e)=>i.length?i.reduce(((t,n)=>(t.push(...e.map((s=>s.includes("&")?s.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(s)?`:is(${n})`:n):n+" "+s))),t)),[]):e,Lhe=(i,e)=>i in Ihe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,n,s,r)=>n+(s==="stretch"?`-moz-available${r};${KN(i)}:${n}-webkit-fill-available`:`-moz-fit-content${r};${KN(i)}:${n}fit-content`)+r)):String(e),Ihe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},qf=i=>i?i+"-":"",eW=(i,e,t)=>i.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((n,s,r,a,o)=>a=="$"==!!r?n:(s||a=="--"?"calc(":"")+"var(--"+(a==="$"?qf(e)+(o.includes("$")?"":qf(t))+o.replace(/\$/g,"-"):o)+")"+(s||a=="--"?"*"+(s||"")+(r||"1")+")":""))),Phe=/\s*,\s*(?![^()]*\))/,Fhe=Object.prototype.toString,Ey=(i,e,t,n,s)=>{let r,a,o;const l=(u,f,p)=>{let x,y;const _=T=>{for(x in T){const C=x.charCodeAt(0)===64,w=C&&Array.isArray(T[x])?T[x]:[T[x]];for(y of w){const B=/[A-Z]/.test(S=x)?S:S.replace(/-[^]/g,(D=>D[1].toUpperCase())),L=typeof y=="object"&&y&&y.toString===Fhe&&(!n.utils[B]||!f.length);if(B in n.utils&&!L){const D=n.utils[B];if(D!==a){a=D,_(D(y)),a=null;continue}}else if(B in rG){const D=rG[B];if(D!==o){o=D,_(D(y)),o=null;continue}}if(C&&(A=x.slice(1)in n.media?"@media "+n.media[x.slice(1)]:x,x=A.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((D,O,F,U,P,X)=>{const Z=D2.test(O),ee=.0625*(Z?-1:1),[te,re]=Z?[U,O]:[O,U];return"("+(F[0]==="="?"":F[0]===">"===Z?"max-":"min-")+te+":"+(F[0]!=="="&&F.length===1?re.replace(D2,((W,ne,se)=>Number(ne)+ee*(F===">"?1:-1)+se)):re)+(P?") and ("+(P[0]===">"?"min-":"max-")+te+":"+(P.length===1?X.replace(D2,((W,ne,se)=>Number(ne)+ee*(P===">"?-1:1)+se)):X):"")+")"}))),L){const D=C?p.concat(x):[...p],O=C?[...f]:Uhe(f,x.split(Phe));r!==void 0&&s(aG(...r)),r=void 0,l(y,O,D)}else r===void 0&&(r=[[],f,p]),x=C||x.charCodeAt(0)!==36?x:`--${qf(n.prefix)}${x.slice(1).replace(/\$/g,"-")}`,y=L?y:typeof y=="number"?y&&B in Ghe?String(y)+"px":String(y):eW(Lhe(B,y??""),n.prefix,n.themeMap[B]),r[0].push(`${C?`${x} `:`${KN(x)}:`}${y}`)}}var A,S};_(u),r!==void 0&&s(aG(...r)),r=void 0};l(i,e,t)},aG=(i,e,t)=>`${t.map((n=>`${n}{`)).join("")}${e.length?`${e.join(",")}{`:""}${i.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,Ghe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},oG=i=>String.fromCharCode(i+(i>25?39:97)),zg=i=>(e=>{let t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=oG(t%52)+n;return oG(t%52)+n})(((e,t)=>{let n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return e})(5381,JSON.stringify(i))>>>0),eS=["themed","global","styled","onevar","resonevar","allvar","inline"],zhe=i=>{if(i.href&&!i.href.startsWith(location.origin))return!1;try{return!!i.cssRules}catch{return!1}},Vhe=i=>{let e;const t=()=>{const{cssRules:s}=e.sheet;return[].map.call(s,((r,a)=>{const{cssText:o}=r;let l="";if(o.startsWith("--sxs"))return"";if(s[a-1]&&(l=s[a-1].cssText).startsWith("--sxs")){if(!r.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===r)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${o}`;return r.cssRules.length?`${l}${o}`:""}return o})).join("")},n=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in o)delete o[u]}const s=Object(i).styleSheets||[];for(const o of s)if(zhe(o)){for(let l=0,u=o.cssRules;u[l];++l){const f=Object(u[l]);if(f.type!==1)continue;const p=Object(u[l+1]);if(p.type!==4)continue;++l;const{cssText:x}=f;if(!x.startsWith("--sxs"))continue;const y=x.slice(14,-3).trim().split(/\s+/),_=eS[y[0]];_&&(e||(e={sheet:o,reset:n,rules:{},toString:t}),e.rules[_]={group:p,index:l,cache:new Set(y)})}if(e)break}if(!e){const o=(l,u)=>({type:u,cssRules:[],insertRule(f,p){this.cssRules.splice(p,0,o(f,{import:3,undefined:1}[(f.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,(f=>f.cssText)).join("")}}`:l}});e={sheet:i?(i.head||i).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:n,toString:t}}const{sheet:r,rules:a}=e;for(let o=eS.length-1;o>=0;--o){const l=eS[o];if(!a[l]){const u=eS[o+1],f=a[u]?a[u].index:r.cssRules.length;r.insertRule("@media{}",f),r.insertRule(`--sxs{--sxs:${o}}`,f),a[l]={group:r.cssRules[f+1],index:f,cache:new Set([o])}}Hhe(a[l])}};return n(),e},Hhe=i=>{const e=i.group;let t=e.cssRules.length;i.apply=n=>{try{e.insertRule(n,t),++t}catch{}}},qb=Symbol(),khe=Nv(),lG=(i,e)=>khe(i,(()=>(...t)=>{let n={type:null,composers:new Set};for(const s of t)if(s!=null)if(s[Gg]){n.type==null&&(n.type=s[Gg].type);for(const r of s[Gg].composers)n.composers.add(r)}else s.constructor!==Object||s.$$typeof?n.type==null&&(n.type=s):n.composers.add(Whe(s,i));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),Xhe(i,n,e)})),Whe=({variants:i,compoundVariants:e,defaultVariants:t,...n},s)=>{const r=`${qf(s.prefix)}c-${zg(n)}`,a=[],o=[],l=Object.create(null),u=[];for(const x in t)l[x]=String(t[x]);if(typeof i=="object"&&i)for(const x in i){f=l,p=x,Dhe.call(f,p)||(l[x]="undefined");const y=i[x];for(const _ in y){const T={[x]:String(_)};String(_)==="undefined"&&u.push(x);const A=y[_],S=[T,A,!sG(A)];a.push(S)}}var f,p;if(typeof e=="object"&&e)for(const x of e){let{css:y,..._}=x;y=typeof y=="object"&&y||{};for(const A in _)_[A]=String(_[A]);const T=[_,y,!sG(y)];o.push(T)}return[r,n,a,o,l,u]},Xhe=(i,e,t)=>{const[n,s,r,a]=qhe(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(p=>{function x(){for(let y=0;y<x[qb].length;y++){const[_,T]=x[qb][y];p.rules[_].apply(T)}return x[qb]=[],null}return x[qb]=[],x.rules={},eS.forEach((y=>x.rules[y]={apply:_=>x[qb].push([y,_])})),x})(t):null,l=(o||t).rules,u=`.${n}${s.length>1?`:where(.${s.slice(1).join(".")})`:""}`,f=p=>{p=typeof p=="object"&&p||Yhe;const{css:x,...y}=p,_={};for(const S in r)if(delete y[S],S in p){let C=p[S];typeof C=="object"&&C?_[S]={"@initial":r[S],...C}:(C=String(C),_[S]=C!=="undefined"||a.has(S)?C:r[S])}else _[S]=r[S];const T=new Set([...s]);for(const[S,C,w,B]of e.composers){t.rules.styled.cache.has(S)||(t.rules.styled.cache.add(S),Ey(C,[`.${S}`],[],i,(O=>{l.styled.apply(O)})));const L=cG(w,_,i.media),D=cG(B,_,i.media,!0);for(const O of L)if(O!==void 0)for(const[F,U,P]of O){const X=`${S}-${zg(U)}-${F}`;T.add(X);const Z=(P?t.rules.resonevar:t.rules.onevar).cache,ee=P?l.resonevar:l.onevar;Z.has(X)||(Z.add(X),Ey(U,[`.${X}`],[],i,(te=>{ee.apply(te)})))}for(const O of D)if(O!==void 0)for(const[F,U]of O){const P=`${S}-${zg(U)}-${F}`;T.add(P),t.rules.allvar.cache.has(P)||(t.rules.allvar.cache.add(P),Ey(U,[`.${P}`],[],i,(X=>{l.allvar.apply(X)})))}}if(typeof x=="object"&&x){const S=`${n}-i${zg(x)}-css`;T.add(S),t.rules.inline.cache.has(S)||(t.rules.inline.cache.add(S),Ey(x,[`.${S}`],[],i,(C=>{l.inline.apply(C)})))}for(const S of String(p.className||"").trim().split(/\s+/))S&&T.add(S);const A=y.className=[...T].join(" ");return{type:e.type,className:A,selector:u,props:y,toString:()=>A,deferredInjector:o}};return HU(f,{className:n,selector:u,[Gg]:e,toString:()=>(t.rules.styled.cache.has(n)||f(),n)})},qhe=i=>{let e="";const t=[],n={},s=[];for(const[r,,,,a,o]of i){e===""&&(e=r),t.push(r),s.push(...o);for(const l in a){const u=a[l];(n[l]===void 0||u!=="undefined"||o.includes(u))&&(n[l]=u)}}return[e,t,n,new Set(s)]},cG=(i,e,t,n)=>{const s=[];e:for(let[r,a,o]of i){if(o)continue;let l,u=0,f=!1;for(l in r){const p=r[l];let x=e[l];if(x!==p){if(typeof x!="object"||!x)continue e;{let y,_,T=0;for(const A in x){if(p===String(x[A])){if(A!=="@initial"){const S=A.slice(1);(_=_||[]).push(S in t?t[S]:A.replace(/^@media ?/,"")),f=!0}u+=T,y=!0}++T}if(_&&_.length&&(a={["@media "+_.join(", ")]:a}),!y)continue e}}}(s[u]=s[u]||[]).push([n?"cv":`${l}-${r[l]}`,a,f])}return s},Yhe={},jhe=Nv(),$he=(i,e)=>jhe(i,(()=>(...t)=>{const n=()=>{for(let s of t){s=typeof s=="object"&&s||{};let r=zg(s);if(!e.rules.global.cache.has(r)){if(e.rules.global.cache.add(r),"@import"in s){let a=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(s["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,a++);delete s["@import"]}Ey(s,[],[],i,(a=>{e.rules.global.apply(a)}))}}return""};return HU(n,{toString:n})})),Khe=Nv(),Jhe=(i,e)=>Khe(i,(()=>t=>{const n=`${qf(i.prefix)}k-${zg(t)}`,s=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const r=[];Ey(t,[],[],i,(o=>r.push(o)));const a=`@keyframes ${n}{${r.join("")}}`;e.rules.global.apply(a)}return n};return HU(s,{get name(){return s()},toString:s})})),Zhe=class{constructor(i,e,t,n){this.token=i==null?"":String(i),this.value=e==null?"":String(e),this.scale=t==null?"":String(t),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+qf(this.prefix)+qf(this.scale)+this.token}toString(){return this.computedValue}},Qhe=Nv(),epe=(i,e)=>Qhe(i,(()=>(t,n)=>{n=typeof t=="object"&&t||Object(n);const s=`.${t=(t=typeof t=="string"?t:"")||`${qf(i.prefix)}t-${zg(n)}`}`,r={},a=[];for(const l in n){r[l]={};for(const u in n[l]){const f=`--${qf(i.prefix)}${l}-${u}`,p=eW(String(n[l][u]),i.prefix,l);r[l][u]=new Zhe(u,p,l,i.prefix),a.push(`${f}:${p}`)}}const o=()=>{if(a.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const l=`${n===i.theme?":root,":""}.${t}{${a.join(";")}}`;e.rules.themed.apply(l)}return t};return{...r,get className(){return o()},selector:s,toString:o}})),tpe=Nv(),npe=Nv(),ipe=i=>{const e=(t=>{let n=!1;const s=tpe(t,(r=>{n=!0;const a="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",o=typeof r.media=="object"&&r.media||{},l=typeof r.root=="object"?r.root||null:globalThis.document||null,u=typeof r.theme=="object"&&r.theme||{},f={prefix:a,media:o,theme:u,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...Nhe},utils:typeof r.utils=="object"&&r.utils||{}},p=Vhe(l),x={css:lG(f,p),globalCss:$he(f,p),keyframes:Jhe(f,p),createTheme:epe(f,p),reset(){p.reset(),x.theme.toString()},theme:{},sheet:p,config:f,prefix:a,getCssText:p.toString,toString:p.toString};return String(x.theme=x.createTheme(u)),x}));return n||s.reset(),s})(i);return e.styled=(({config:t,sheet:n})=>npe(t,(()=>{const s=lG(t,n);return(...r)=>{const a=s(...r),o=a[Gg].type,l=ue.forwardRef(((u,f)=>{const p=u&&u.as||o,{props:x,deferredInjector:y}=a(u);return delete x.as,x.ref=f,y?ue.createElement(ue.Fragment,null,ue.createElement(p,x),ue.createElement(y,null)):ue.createElement(p,x)}));return l.className=a.className,l.displayName=`Styled.${o.displayName||o.name||o}`,l.selector=a.selector,l.toString=()=>a.selector,l[Gg]=a[Gg],l}})))(e),e};function Ef(i,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(i?.(s),t===!1||!s.defaultPrevented)return e?.(s)}}function tW(i,e=[]){let t=[];function n(r,a){const o=G.createContext(a),l=t.length;t=[...t,a];const u=p=>{const{scope:x,children:y,..._}=p,T=x?.[i]?.[l]||o,A=G.useMemo(()=>_,Object.values(_));return Pt.jsx(T.Provider,{value:A,children:y})};u.displayName=r+"Provider";function f(p,x){const y=x?.[i]?.[l]||o,_=G.useContext(y);if(_)return _;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${r}\``)}return[u,f]}const s=()=>{const r=t.map(a=>G.createContext(a));return function(o){const l=o?.[i]||r;return G.useMemo(()=>({[`__scope${i}`]:{...o,[i]:l}}),[o,l])}};return s.scopeName=i,[n,spe(s,...e)]}function spe(...i){const e=i[0];if(i.length===1)return e;const t=()=>{const n=i.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(r){const a=n.reduce((o,{useScope:l,scopeName:u})=>{const p=l(r)[`__scope${u}`];return{...o,...p}},{});return G.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function rpe(i){const e=ape(i),t=G.forwardRef((n,s)=>{const{children:r,...a}=n,o=G.Children.toArray(r),l=o.find(lpe);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function ape(i){const e=G.forwardRef((t,n)=>{const{children:s,...r}=t;if(G.isValidElement(s)){const a=upe(s),o=cpe(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var ope=Symbol("radix.slottable");function lpe(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===ope}function cpe(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function upe(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var dpe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nW=dpe.reduce((i,e)=>{const t=rpe(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{});function fpe(i,e){i&&zU.flushSync(()=>i.dispatchEvent(e))}function H3(i){const e=G.useRef(i);return G.useEffect(()=>{e.current=i}),G.useMemo(()=>(...t)=>e.current?.(...t),[])}function hpe(i,e=globalThis?.document){const t=H3(i);G.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var ppe="DismissableLayer",JN="dismissableLayer.update",mpe="dismissableLayer.pointerDownOutside",gpe="dismissableLayer.focusOutside",uG,iW=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),sW=G.forwardRef((i,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:r,onInteractOutside:a,onDismiss:o,...l}=i,u=G.useContext(iW),[f,p]=G.useState(null),x=f?.ownerDocument??globalThis?.document,[,y]=G.useState({}),_=M0(e,O=>p(O)),T=Array.from(u.layers),[A]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),S=T.indexOf(A),C=f?T.indexOf(f):-1,w=u.layersWithOutsidePointerEventsDisabled.size>0,B=C>=S,L=vpe(O=>{const F=O.target,U=[...u.branches].some(P=>P.contains(F));!B||U||(s?.(O),a?.(O),O.defaultPrevented||o?.())},x),D=_pe(O=>{const F=O.target;[...u.branches].some(P=>P.contains(F))||(r?.(O),a?.(O),O.defaultPrevented||o?.())},x);return hpe(O=>{C===u.layers.size-1&&(n?.(O),!O.defaultPrevented&&o&&(O.preventDefault(),o()))},x),G.useEffect(()=>{if(f)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(uG=x.body.style.pointerEvents,x.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(f)),u.layers.add(f),dG(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(x.body.style.pointerEvents=uG)}},[f,x,t,u]),G.useEffect(()=>()=>{f&&(u.layers.delete(f),u.layersWithOutsidePointerEventsDisabled.delete(f),dG())},[f,u]),G.useEffect(()=>{const O=()=>y({});return document.addEventListener(JN,O),()=>document.removeEventListener(JN,O)},[]),Pt.jsx(nW.div,{...l,ref:_,style:{pointerEvents:w?B?"auto":"none":void 0,...i.style},onFocusCapture:Ef(i.onFocusCapture,D.onFocusCapture),onBlurCapture:Ef(i.onBlurCapture,D.onBlurCapture),onPointerDownCapture:Ef(i.onPointerDownCapture,L.onPointerDownCapture)})});sW.displayName=ppe;var xpe="DismissableLayerBranch",ype=G.forwardRef((i,e)=>{const t=G.useContext(iW),n=G.useRef(null),s=M0(e,n);return G.useEffect(()=>{const r=n.current;if(r)return t.branches.add(r),()=>{t.branches.delete(r)}},[t.branches]),Pt.jsx(nW.div,{...i,ref:s})});ype.displayName=xpe;function vpe(i,e=globalThis?.document){const t=H3(i),n=G.useRef(!1),s=G.useRef(()=>{});return G.useEffect(()=>{const r=o=>{if(o.target&&!n.current){let l=function(){rW(mpe,t,u,{discrete:!0})};const u={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);n.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",r),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function _pe(i,e=globalThis?.document){const t=H3(i),n=G.useRef(!1);return G.useEffect(()=>{const s=r=>{r.target&&!n.current&&rW(gpe,t,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function dG(){const i=new CustomEvent(JN);document.dispatchEvent(i)}function rW(i,e,t,{discrete:n}){const s=t.originalEvent.target,r=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(i,e,{once:!0}),n?fpe(s,r):s.dispatchEvent(r)}var bpe=gB[" useId ".trim().toString()]||(()=>{}),Spe=0;function Tpe(i){const[e,t]=G.useState(bpe());return Xp(()=>{t(n=>n??String(Spe++))},[i]),e?`radix-${e}`:""}const Ape=["top","right","bottom","left"],qp=Math.min,bl=Math.max,XM=Math.round,KE=Math.floor,bd=i=>({x:i,y:i}),Epe={left:"right",right:"left",bottom:"top",top:"bottom"},Mpe={start:"end",end:"start"};function ZN(i,e,t){return bl(i,qp(e,t))}function Yf(i,e){return typeof i=="function"?i(e):i}function jf(i){return i.split("-")[0]}function Bv(i){return i.split("-")[1]}function kU(i){return i==="x"?"y":"x"}function WU(i){return i==="y"?"height":"width"}const Cpe=new Set(["top","bottom"]);function cd(i){return Cpe.has(jf(i))?"y":"x"}function XU(i){return kU(cd(i))}function Rpe(i,e,t){t===void 0&&(t=!1);const n=Bv(i),s=XU(i),r=WU(s);let a=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(a=qM(a)),[a,qM(a)]}function wpe(i){const e=qM(i);return[QN(i),e,QN(e)]}function QN(i){return i.replace(/start|end/g,e=>Mpe[e])}const fG=["left","right"],hG=["right","left"],Npe=["top","bottom"],Bpe=["bottom","top"];function Dpe(i,e,t){switch(i){case"top":case"bottom":return t?e?hG:fG:e?fG:hG;case"left":case"right":return e?Npe:Bpe;default:return[]}}function Ope(i,e,t,n){const s=Bv(i);let r=Dpe(jf(i),t==="start",n);return s&&(r=r.map(a=>a+"-"+s),e&&(r=r.concat(r.map(QN)))),r}function qM(i){return i.replace(/left|right|bottom|top/g,e=>Epe[e])}function Upe(i){return{top:0,right:0,bottom:0,left:0,...i}}function aW(i){return typeof i!="number"?Upe(i):{top:i,right:i,bottom:i,left:i}}function YM(i){const{x:e,y:t,width:n,height:s}=i;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function pG(i,e,t){let{reference:n,floating:s}=i;const r=cd(e),a=XU(e),o=WU(a),l=jf(e),u=r==="y",f=n.x+n.width/2-s.width/2,p=n.y+n.height/2-s.height/2,x=n[o]/2-s[o]/2;let y;switch(l){case"top":y={x:f,y:n.y-s.height};break;case"bottom":y={x:f,y:n.y+n.height};break;case"right":y={x:n.x+n.width,y:p};break;case"left":y={x:n.x-s.width,y:p};break;default:y={x:n.x,y:n.y}}switch(Bv(e)){case"start":y[a]-=x*(t&&u?-1:1);break;case"end":y[a]+=x*(t&&u?-1:1);break}return y}const Lpe=async(i,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:r=[],platform:a}=t,o=r.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let u=await a.getElementRects({reference:i,floating:e,strategy:s}),{x:f,y:p}=pG(u,n,l),x=n,y={},_=0;for(let T=0;T<o.length;T++){const{name:A,fn:S}=o[T],{x:C,y:w,data:B,reset:L}=await S({x:f,y:p,initialPlacement:n,placement:x,strategy:s,middlewareData:y,rects:u,platform:a,elements:{reference:i,floating:e}});f=C??f,p=w??p,y={...y,[A]:{...y[A],...B}},L&&_<=50&&(_++,typeof L=="object"&&(L.placement&&(x=L.placement),L.rects&&(u=L.rects===!0?await a.getElementRects({reference:i,floating:e,strategy:s}):L.rects),{x:f,y:p}=pG(u,x,l)),T=-1)}return{x:f,y:p,placement:x,strategy:s,middlewareData:y}};async function XS(i,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:r,rects:a,elements:o,strategy:l}=i,{boundary:u="clippingAncestors",rootBoundary:f="viewport",elementContext:p="floating",altBoundary:x=!1,padding:y=0}=Yf(e,i),_=aW(y),A=o[x?p==="floating"?"reference":"floating":p],S=YM(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(A)))==null||t?A:A.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(o.floating)),boundary:u,rootBoundary:f,strategy:l})),C=p==="floating"?{x:n,y:s,width:a.floating.width,height:a.floating.height}:a.reference,w=await(r.getOffsetParent==null?void 0:r.getOffsetParent(o.floating)),B=await(r.isElement==null?void 0:r.isElement(w))?await(r.getScale==null?void 0:r.getScale(w))||{x:1,y:1}:{x:1,y:1},L=YM(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:C,offsetParent:w,strategy:l}):C);return{top:(S.top-L.top+_.top)/B.y,bottom:(L.bottom-S.bottom+_.bottom)/B.y,left:(S.left-L.left+_.left)/B.x,right:(L.right-S.right+_.right)/B.x}}const Ipe=i=>({name:"arrow",options:i,async fn(e){const{x:t,y:n,placement:s,rects:r,platform:a,elements:o,middlewareData:l}=e,{element:u,padding:f=0}=Yf(i,e)||{};if(u==null)return{};const p=aW(f),x={x:t,y:n},y=XU(s),_=WU(y),T=await a.getDimensions(u),A=y==="y",S=A?"top":"left",C=A?"bottom":"right",w=A?"clientHeight":"clientWidth",B=r.reference[_]+r.reference[y]-x[y]-r.floating[_],L=x[y]-r.reference[y],D=await(a.getOffsetParent==null?void 0:a.getOffsetParent(u));let O=D?D[w]:0;(!O||!await(a.isElement==null?void 0:a.isElement(D)))&&(O=o.floating[w]||r.floating[_]);const F=B/2-L/2,U=O/2-T[_]/2-1,P=qp(p[S],U),X=qp(p[C],U),Z=P,ee=O-T[_]-X,te=O/2-T[_]/2+F,re=ZN(Z,te,ee),W=!l.arrow&&Bv(s)!=null&&te!==re&&r.reference[_]/2-(te<Z?P:X)-T[_]/2<0,ne=W?te<Z?te-Z:te-ee:0;return{[y]:x[y]+ne,data:{[y]:re,centerOffset:te-re-ne,...W&&{alignmentOffset:ne}},reset:W}}}),Ppe=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var t,n;const{placement:s,middlewareData:r,rects:a,initialPlacement:o,platform:l,elements:u}=e,{mainAxis:f=!0,crossAxis:p=!0,fallbackPlacements:x,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:_="none",flipAlignment:T=!0,...A}=Yf(i,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const S=jf(s),C=cd(o),w=jf(o)===o,B=await(l.isRTL==null?void 0:l.isRTL(u.floating)),L=x||(w||!T?[qM(o)]:wpe(o)),D=_!=="none";!x&&D&&L.push(...Ope(o,T,_,B));const O=[o,...L],F=await XS(e,A),U=[];let P=((n=r.flip)==null?void 0:n.overflows)||[];if(f&&U.push(F[S]),p){const te=Rpe(s,a,B);U.push(F[te[0]],F[te[1]])}if(P=[...P,{placement:s,overflows:U}],!U.every(te=>te<=0)){var X,Z;const te=(((X=r.flip)==null?void 0:X.index)||0)+1,re=O[te];if(re&&(!(p==="alignment"?C!==cd(re):!1)||P.every(se=>cd(se.placement)===C?se.overflows[0]>0:!0)))return{data:{index:te,overflows:P},reset:{placement:re}};let W=(Z=P.filter(ne=>ne.overflows[0]<=0).sort((ne,se)=>ne.overflows[1]-se.overflows[1])[0])==null?void 0:Z.placement;if(!W)switch(y){case"bestFit":{var ee;const ne=(ee=P.filter(se=>{if(D){const ge=cd(se.placement);return ge===C||ge==="y"}return!0}).map(se=>[se.placement,se.overflows.filter(ge=>ge>0).reduce((ge,_e)=>ge+_e,0)]).sort((se,ge)=>se[1]-ge[1])[0])==null?void 0:ee[0];ne&&(W=ne);break}case"initialPlacement":W=o;break}if(s!==W)return{reset:{placement:W}}}return{}}}};function mG(i,e){return{top:i.top-e.height,right:i.right-e.width,bottom:i.bottom-e.height,left:i.left-e.width}}function gG(i){return Ape.some(e=>i[e]>=0)}const Fpe=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=Yf(i,e);switch(n){case"referenceHidden":{const r=await XS(e,{...s,elementContext:"reference"}),a=mG(r,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:gG(a)}}}case"escaped":{const r=await XS(e,{...s,altBoundary:!0}),a=mG(r,t.floating);return{data:{escapedOffsets:a,escaped:gG(a)}}}default:return{}}}}},oW=new Set(["left","top"]);async function Gpe(i,e){const{placement:t,platform:n,elements:s}=i,r=await(n.isRTL==null?void 0:n.isRTL(s.floating)),a=jf(t),o=Bv(t),l=cd(t)==="y",u=oW.has(a)?-1:1,f=r&&l?-1:1,p=Yf(e,i);let{mainAxis:x,crossAxis:y,alignmentAxis:_}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return o&&typeof _=="number"&&(y=o==="end"?_*-1:_),l?{x:y*f,y:x*u}:{x:x*u,y:y*f}}const zpe=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var t,n;const{x:s,y:r,placement:a,middlewareData:o}=e,l=await Gpe(e,i);return a===((t=o.offset)==null?void 0:t.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:r+l.y,data:{...l,placement:a}}}}},Vpe=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:r=!0,crossAxis:a=!1,limiter:o={fn:A=>{let{x:S,y:C}=A;return{x:S,y:C}}},...l}=Yf(i,e),u={x:t,y:n},f=await XS(e,l),p=cd(jf(s)),x=kU(p);let y=u[x],_=u[p];if(r){const A=x==="y"?"top":"left",S=x==="y"?"bottom":"right",C=y+f[A],w=y-f[S];y=ZN(C,y,w)}if(a){const A=p==="y"?"top":"left",S=p==="y"?"bottom":"right",C=_+f[A],w=_-f[S];_=ZN(C,_,w)}const T=o.fn({...e,[x]:y,[p]:_});return{...T,data:{x:T.x-t,y:T.y-n,enabled:{[x]:r,[p]:a}}}}}},Hpe=function(i){return i===void 0&&(i={}),{options:i,fn(e){const{x:t,y:n,placement:s,rects:r,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:u=!0}=Yf(i,e),f={x:t,y:n},p=cd(s),x=kU(p);let y=f[x],_=f[p];const T=Yf(o,e),A=typeof T=="number"?{mainAxis:T,crossAxis:0}:{mainAxis:0,crossAxis:0,...T};if(l){const w=x==="y"?"height":"width",B=r.reference[x]-r.floating[w]+A.mainAxis,L=r.reference[x]+r.reference[w]-A.mainAxis;y<B?y=B:y>L&&(y=L)}if(u){var S,C;const w=x==="y"?"width":"height",B=oW.has(jf(s)),L=r.reference[p]-r.floating[w]+(B&&((S=a.offset)==null?void 0:S[p])||0)+(B?0:A.crossAxis),D=r.reference[p]+r.reference[w]+(B?0:((C=a.offset)==null?void 0:C[p])||0)-(B?A.crossAxis:0);_<L?_=L:_>D&&(_=D)}return{[x]:y,[p]:_}}}},kpe=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(e){var t,n;const{placement:s,rects:r,platform:a,elements:o}=e,{apply:l=()=>{},...u}=Yf(i,e),f=await XS(e,u),p=jf(s),x=Bv(s),y=cd(s)==="y",{width:_,height:T}=r.floating;let A,S;p==="top"||p==="bottom"?(A=p,S=x===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(S=p,A=x==="end"?"top":"bottom");const C=T-f.top-f.bottom,w=_-f.left-f.right,B=qp(T-f[A],C),L=qp(_-f[S],w),D=!e.middlewareData.shift;let O=B,F=L;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(F=w),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(O=C),D&&!x){const P=bl(f.left,0),X=bl(f.right,0),Z=bl(f.top,0),ee=bl(f.bottom,0);y?F=_-2*(P!==0||X!==0?P+X:bl(f.left,f.right)):O=T-2*(Z!==0||ee!==0?Z+ee:bl(f.top,f.bottom))}await l({...e,availableWidth:F,availableHeight:O});const U=await a.getDimensions(o.floating);return _!==U.width||T!==U.height?{reset:{rects:!0}}:{}}}};function k3(){return typeof window<"u"}function Dv(i){return lW(i)?(i.nodeName||"").toLowerCase():"#document"}function Cl(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function Ud(i){var e;return(e=(lW(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function lW(i){return k3()?i instanceof Node||i instanceof Cl(i).Node:!1}function mu(i){return k3()?i instanceof Element||i instanceof Cl(i).Element:!1}function wd(i){return k3()?i instanceof HTMLElement||i instanceof Cl(i).HTMLElement:!1}function xG(i){return!k3()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Cl(i).ShadowRoot}const Wpe=new Set(["inline","contents"]);function iA(i){const{overflow:e,overflowX:t,overflowY:n,display:s}=gu(i);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!Wpe.has(s)}const Xpe=new Set(["table","td","th"]);function qpe(i){return Xpe.has(Dv(i))}const Ype=[":popover-open",":modal"];function W3(i){return Ype.some(e=>{try{return i.matches(e)}catch{return!1}})}const jpe=["transform","translate","scale","rotate","perspective"],$pe=["transform","translate","scale","rotate","perspective","filter"],Kpe=["paint","layout","strict","content"];function qU(i){const e=YU(),t=mu(i)?gu(i):i;return jpe.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||$pe.some(n=>(t.willChange||"").includes(n))||Kpe.some(n=>(t.contain||"").includes(n))}function Jpe(i){let e=Yp(i);for(;wd(e)&&!Ky(e);){if(qU(e))return e;if(W3(e))return null;e=Yp(e)}return null}function YU(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Zpe=new Set(["html","body","#document"]);function Ky(i){return Zpe.has(Dv(i))}function gu(i){return Cl(i).getComputedStyle(i)}function X3(i){return mu(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Yp(i){if(Dv(i)==="html")return i;const e=i.assignedSlot||i.parentNode||xG(i)&&i.host||Ud(i);return xG(e)?e.host:e}function cW(i){const e=Yp(i);return Ky(e)?i.ownerDocument?i.ownerDocument.body:i.body:wd(e)&&iA(e)?e:cW(e)}function qS(i,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=cW(i),r=s===((n=i.ownerDocument)==null?void 0:n.body),a=Cl(s);if(r){const o=eB(a);return e.concat(a,a.visualViewport||[],iA(s)?s:[],o&&t?qS(o):[])}return e.concat(s,qS(s,[],t))}function eB(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function uW(i){const e=gu(i);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=wd(i),r=s?i.offsetWidth:t,a=s?i.offsetHeight:n,o=XM(t)!==r||XM(n)!==a;return o&&(t=r,n=a),{width:t,height:n,$:o}}function jU(i){return mu(i)?i:i.contextElement}function Fy(i){const e=jU(i);if(!wd(e))return bd(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:r}=uW(e);let a=(r?XM(t.width):t.width)/n,o=(r?XM(t.height):t.height)/s;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const Qpe=bd(0);function dW(i){const e=Cl(i);return!YU()||!e.visualViewport?Qpe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function eme(i,e,t){return e===void 0&&(e=!1),!t||e&&t!==Cl(i)?!1:e}function d0(i,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=i.getBoundingClientRect(),r=jU(i);let a=bd(1);e&&(n?mu(n)&&(a=Fy(n)):a=Fy(i));const o=eme(r,t,n)?dW(r):bd(0);let l=(s.left+o.x)/a.x,u=(s.top+o.y)/a.y,f=s.width/a.x,p=s.height/a.y;if(r){const x=Cl(r),y=n&&mu(n)?Cl(n):n;let _=x,T=eB(_);for(;T&&n&&y!==_;){const A=Fy(T),S=T.getBoundingClientRect(),C=gu(T),w=S.left+(T.clientLeft+parseFloat(C.paddingLeft))*A.x,B=S.top+(T.clientTop+parseFloat(C.paddingTop))*A.y;l*=A.x,u*=A.y,f*=A.x,p*=A.y,l+=w,u+=B,_=Cl(T),T=eB(_)}}return YM({width:f,height:p,x:l,y:u})}function q3(i,e){const t=X3(i).scrollLeft;return e?e.left+t:d0(Ud(i)).left+t}function fW(i,e){const t=i.getBoundingClientRect(),n=t.left+e.scrollLeft-q3(i,t),s=t.top+e.scrollTop;return{x:n,y:s}}function tme(i){let{elements:e,rect:t,offsetParent:n,strategy:s}=i;const r=s==="fixed",a=Ud(n),o=e?W3(e.floating):!1;if(n===a||o&&r)return t;let l={scrollLeft:0,scrollTop:0},u=bd(1);const f=bd(0),p=wd(n);if((p||!p&&!r)&&((Dv(n)!=="body"||iA(a))&&(l=X3(n)),wd(n))){const y=d0(n);u=Fy(n),f.x=y.x+n.clientLeft,f.y=y.y+n.clientTop}const x=a&&!p&&!r?fW(a,l):bd(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-l.scrollLeft*u.x+f.x+x.x,y:t.y*u.y-l.scrollTop*u.y+f.y+x.y}}function nme(i){return Array.from(i.getClientRects())}function ime(i){const e=Ud(i),t=X3(i),n=i.ownerDocument.body,s=bl(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=bl(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let a=-t.scrollLeft+q3(i);const o=-t.scrollTop;return gu(n).direction==="rtl"&&(a+=bl(e.clientWidth,n.clientWidth)-s),{width:s,height:r,x:a,y:o}}const yG=25;function sme(i,e){const t=Cl(i),n=Ud(i),s=t.visualViewport;let r=n.clientWidth,a=n.clientHeight,o=0,l=0;if(s){r=s.width,a=s.height;const f=YU();(!f||f&&e==="fixed")&&(o=s.offsetLeft,l=s.offsetTop)}const u=q3(n);if(u<=0){const f=n.ownerDocument,p=f.body,x=getComputedStyle(p),y=f.compatMode==="CSS1Compat"&&parseFloat(x.marginLeft)+parseFloat(x.marginRight)||0,_=Math.abs(n.clientWidth-p.clientWidth-y);_<=yG&&(r-=_)}else u<=yG&&(r+=u);return{width:r,height:a,x:o,y:l}}const rme=new Set(["absolute","fixed"]);function ame(i,e){const t=d0(i,!0,e==="fixed"),n=t.top+i.clientTop,s=t.left+i.clientLeft,r=wd(i)?Fy(i):bd(1),a=i.clientWidth*r.x,o=i.clientHeight*r.y,l=s*r.x,u=n*r.y;return{width:a,height:o,x:l,y:u}}function vG(i,e,t){let n;if(e==="viewport")n=sme(i,t);else if(e==="document")n=ime(Ud(i));else if(mu(e))n=ame(e,t);else{const s=dW(i);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return YM(n)}function hW(i,e){const t=Yp(i);return t===e||!mu(t)||Ky(t)?!1:gu(t).position==="fixed"||hW(t,e)}function ome(i,e){const t=e.get(i);if(t)return t;let n=qS(i,[],!1).filter(o=>mu(o)&&Dv(o)!=="body"),s=null;const r=gu(i).position==="fixed";let a=r?Yp(i):i;for(;mu(a)&&!Ky(a);){const o=gu(a),l=qU(a);!l&&o.position==="fixed"&&(s=null),(r?!l&&!s:!l&&o.position==="static"&&!!s&&rme.has(s.position)||iA(a)&&!l&&hW(i,a))?n=n.filter(f=>f!==a):s=o,a=Yp(a)}return e.set(i,n),n}function lme(i){let{element:e,boundary:t,rootBoundary:n,strategy:s}=i;const a=[...t==="clippingAncestors"?W3(e)?[]:ome(e,this._c):[].concat(t),n],o=a[0],l=a.reduce((u,f)=>{const p=vG(e,f,s);return u.top=bl(p.top,u.top),u.right=qp(p.right,u.right),u.bottom=qp(p.bottom,u.bottom),u.left=bl(p.left,u.left),u},vG(e,o,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function cme(i){const{width:e,height:t}=uW(i);return{width:e,height:t}}function ume(i,e,t){const n=wd(e),s=Ud(e),r=t==="fixed",a=d0(i,!0,r,e);let o={scrollLeft:0,scrollTop:0};const l=bd(0);function u(){l.x=q3(s)}if(n||!n&&!r)if((Dv(e)!=="body"||iA(s))&&(o=X3(e)),n){const y=d0(e,!0,r,e);l.x=y.x+e.clientLeft,l.y=y.y+e.clientTop}else s&&u();r&&!n&&s&&u();const f=s&&!n&&!r?fW(s,o):bd(0),p=a.left+o.scrollLeft-l.x-f.x,x=a.top+o.scrollTop-l.y-f.y;return{x:p,y:x,width:a.width,height:a.height}}function O2(i){return gu(i).position==="static"}function _G(i,e){if(!wd(i)||gu(i).position==="fixed")return null;if(e)return e(i);let t=i.offsetParent;return Ud(i)===t&&(t=t.ownerDocument.body),t}function pW(i,e){const t=Cl(i);if(W3(i))return t;if(!wd(i)){let s=Yp(i);for(;s&&!Ky(s);){if(mu(s)&&!O2(s))return s;s=Yp(s)}return t}let n=_G(i,e);for(;n&&qpe(n)&&O2(n);)n=_G(n,e);return n&&Ky(n)&&O2(n)&&!qU(n)?t:n||Jpe(i)||t}const dme=async function(i){const e=this.getOffsetParent||pW,t=this.getDimensions,n=await t(i.floating);return{reference:ume(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function fme(i){return gu(i).direction==="rtl"}const hme={convertOffsetParentRelativeRectToViewportRelativeRect:tme,getDocumentElement:Ud,getClippingRect:lme,getOffsetParent:pW,getElementRects:dme,getClientRects:nme,getDimensions:cme,getScale:Fy,isElement:mu,isRTL:fme};function mW(i,e){return i.x===e.x&&i.y===e.y&&i.width===e.width&&i.height===e.height}function pme(i,e){let t=null,n;const s=Ud(i);function r(){var o;clearTimeout(n),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),r();const u=i.getBoundingClientRect(),{left:f,top:p,width:x,height:y}=u;if(o||e(),!x||!y)return;const _=KE(p),T=KE(s.clientWidth-(f+x)),A=KE(s.clientHeight-(p+y)),S=KE(f),w={rootMargin:-_+"px "+-T+"px "+-A+"px "+-S+"px",threshold:bl(0,qp(1,l))||1};let B=!0;function L(D){const O=D[0].intersectionRatio;if(O!==l){if(!B)return a();O?a(!1,O):n=setTimeout(()=>{a(!1,1e-7)},1e3)}O===1&&!mW(u,i.getBoundingClientRect())&&a(),B=!1}try{t=new IntersectionObserver(L,{...w,root:s.ownerDocument})}catch{t=new IntersectionObserver(L,w)}t.observe(i)}return a(!0),r}function mme(i,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:r=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,u=jU(i),f=s||r?[...u?qS(u):[],...qS(e)]:[];f.forEach(S=>{s&&S.addEventListener("scroll",t,{passive:!0}),r&&S.addEventListener("resize",t)});const p=u&&o?pme(u,t):null;let x=-1,y=null;a&&(y=new ResizeObserver(S=>{let[C]=S;C&&C.target===u&&y&&(y.unobserve(e),cancelAnimationFrame(x),x=requestAnimationFrame(()=>{var w;(w=y)==null||w.observe(e)})),t()}),u&&!l&&y.observe(u),y.observe(e));let _,T=l?d0(i):null;l&&A();function A(){const S=d0(i);T&&!mW(T,S)&&t(),T=S,_=requestAnimationFrame(A)}return t(),()=>{var S;f.forEach(C=>{s&&C.removeEventListener("scroll",t),r&&C.removeEventListener("resize",t)}),p?.(),(S=y)==null||S.disconnect(),y=null,l&&cancelAnimationFrame(_)}}const gme=zpe,xme=Vpe,yme=Ppe,vme=kpe,_me=Fpe,bG=Ipe,bme=Hpe,Sme=(i,e,t)=>{const n=new Map,s={platform:hme,...t},r={...s.platform,_c:n};return Lpe(i,e,{...s,platform:r})};var Tme=typeof document<"u",Ame=function(){},hM=Tme?G.useLayoutEffect:Ame;function jM(i,e){if(i===e)return!0;if(typeof i!=typeof e)return!1;if(typeof i=="function"&&i.toString()===e.toString())return!0;let t,n,s;if(i&&e&&typeof i=="object"){if(Array.isArray(i)){if(t=i.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!jM(i[n],e[n]))return!1;return!0}if(s=Object.keys(i),t=s.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=t;n--!==0;){const r=s[n];if(!(r==="_owner"&&i.$$typeof)&&!jM(i[r],e[r]))return!1}return!0}return i!==i&&e!==e}function gW(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function SG(i,e){const t=gW(i);return Math.round(e*t)/t}function U2(i){const e=G.useRef(i);return hM(()=>{e.current=i}),e}function Eme(i){i===void 0&&(i={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:s,elements:{reference:r,floating:a}={},transform:o=!0,whileElementsMounted:l,open:u}=i,[f,p]=G.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[x,y]=G.useState(n);jM(x,n)||y(n);const[_,T]=G.useState(null),[A,S]=G.useState(null),C=G.useCallback(se=>{se!==D.current&&(D.current=se,T(se))},[]),w=G.useCallback(se=>{se!==O.current&&(O.current=se,S(se))},[]),B=r||_,L=a||A,D=G.useRef(null),O=G.useRef(null),F=G.useRef(f),U=l!=null,P=U2(l),X=U2(s),Z=U2(u),ee=G.useCallback(()=>{if(!D.current||!O.current)return;const se={placement:e,strategy:t,middleware:x};X.current&&(se.platform=X.current),Sme(D.current,O.current,se).then(ge=>{const _e={...ge,isPositioned:Z.current!==!1};te.current&&!jM(F.current,_e)&&(F.current=_e,zU.flushSync(()=>{p(_e)}))})},[x,e,t,X,Z]);hM(()=>{u===!1&&F.current.isPositioned&&(F.current.isPositioned=!1,p(se=>({...se,isPositioned:!1})))},[u]);const te=G.useRef(!1);hM(()=>(te.current=!0,()=>{te.current=!1}),[]),hM(()=>{if(B&&(D.current=B),L&&(O.current=L),B&&L){if(P.current)return P.current(B,L,ee);ee()}},[B,L,ee,P,U]);const re=G.useMemo(()=>({reference:D,floating:O,setReference:C,setFloating:w}),[C,w]),W=G.useMemo(()=>({reference:B,floating:L}),[B,L]),ne=G.useMemo(()=>{const se={position:t,left:0,top:0};if(!W.floating)return se;const ge=SG(W.floating,f.x),_e=SG(W.floating,f.y);return o?{...se,transform:"translate("+ge+"px, "+_e+"px)",...gW(W.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:ge,top:_e}},[t,o,W.floating,f.x,f.y]);return G.useMemo(()=>({...f,update:ee,refs:re,elements:W,floatingStyles:ne}),[f,ee,re,W,ne])}const Mme=i=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:i,fn(t){const{element:n,padding:s}=typeof i=="function"?i(t):i;return n&&e(n)?n.current!=null?bG({element:n.current,padding:s}).fn(t):{}:n?bG({element:n,padding:s}).fn(t):{}}}},Cme=(i,e)=>({...gme(i),options:[i,e]}),Rme=(i,e)=>({...xme(i),options:[i,e]}),wme=(i,e)=>({...bme(i),options:[i,e]}),Nme=(i,e)=>({...yme(i),options:[i,e]}),Bme=(i,e)=>({...vme(i),options:[i,e]}),Dme=(i,e)=>({..._me(i),options:[i,e]}),Ome=(i,e)=>({...Mme(i),options:[i,e]});function Ume(i){const e=Lme(i),t=G.forwardRef((n,s)=>{const{children:r,...a}=n,o=G.Children.toArray(r),l=o.find(Pme);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function Lme(i){const e=G.forwardRef((t,n)=>{const{children:s,...r}=t;if(G.isValidElement(s)){const a=Gme(s),o=Fme(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var Ime=Symbol("radix.slottable");function Pme(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===Ime}function Fme(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function Gme(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var zme=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Vme=zme.reduce((i,e)=>{const t=Ume(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{}),Hme="Arrow",xW=G.forwardRef((i,e)=>{const{children:t,width:n=10,height:s=5,...r}=i;return Pt.jsx(Vme.svg,{...r,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?t:Pt.jsx("polygon",{points:"0,0 30,0 15,10"})})});xW.displayName=Hme;var kme=xW;function Wme(i){const e=Xme(i),t=G.forwardRef((n,s)=>{const{children:r,...a}=n,o=G.Children.toArray(r),l=o.find(Yme);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function Xme(i){const e=G.forwardRef((t,n)=>{const{children:s,...r}=t;if(G.isValidElement(s)){const a=$me(s),o=jme(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var qme=Symbol("radix.slottable");function Yme(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===qme}function jme(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function $me(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var Kme=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yW=Kme.reduce((i,e)=>{const t=Wme(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{});function Jme(i){const[e,t]=G.useState(void 0);return Xp(()=>{if(i){t({width:i.offsetWidth,height:i.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const r=s[0];let a,o;if("borderBoxSize"in r){const l=r.borderBoxSize,u=Array.isArray(l)?l[0]:l;a=u.inlineSize,o=u.blockSize}else a=i.offsetWidth,o=i.offsetHeight;t({width:a,height:o})});return n.observe(i,{box:"border-box"}),()=>n.unobserve(i)}else t(void 0)},[i]),e}var $U="Popper",[vW,_W]=tW($U),[Zme,bW]=vW($U),SW=i=>{const{__scopePopper:e,children:t}=i,[n,s]=G.useState(null);return Pt.jsx(Zme,{scope:e,anchor:n,onAnchorChange:s,children:t})};SW.displayName=$U;var TW="PopperAnchor",AW=G.forwardRef((i,e)=>{const{__scopePopper:t,virtualRef:n,...s}=i,r=bW(TW,t),a=G.useRef(null),o=M0(e,a),l=G.useRef(null);return G.useEffect(()=>{const u=l.current;l.current=n?.current||a.current,u!==l.current&&r.onAnchorChange(l.current)}),n?null:Pt.jsx(yW.div,{...s,ref:o})});AW.displayName=TW;var KU="PopperContent",[Qme,ege]=vW(KU),EW=G.forwardRef((i,e)=>{const{__scopePopper:t,side:n="bottom",sideOffset:s=0,align:r="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:f=0,sticky:p="partial",hideWhenDetached:x=!1,updatePositionStrategy:y="optimized",onPlaced:_,...T}=i,A=bW(KU,t),[S,C]=G.useState(null),w=M0(e,Be=>C(Be)),[B,L]=G.useState(null),D=Jme(B),O=D?.width??0,F=D?.height??0,U=n+(r!=="center"?"-"+r:""),P=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},X=Array.isArray(u)?u:[u],Z=X.length>0,ee={padding:P,boundary:X.filter(nge),altBoundary:Z},{refs:te,floatingStyles:re,placement:W,isPositioned:ne,middlewareData:se}=Eme({strategy:"fixed",placement:U,whileElementsMounted:(...Be)=>mme(...Be,{animationFrame:y==="always"}),elements:{reference:A.anchor},middleware:[Cme({mainAxis:s+F,alignmentAxis:a}),l&&Rme({mainAxis:!0,crossAxis:!1,limiter:p==="partial"?wme():void 0,...ee}),l&&Nme({...ee}),Bme({...ee,apply:({elements:Be,rects:ct,availableWidth:Dt,availableHeight:Nt})=>{const{width:It,height:Mn}=ct.reference,Gt=Be.floating.style;Gt.setProperty("--radix-popper-available-width",`${Dt}px`),Gt.setProperty("--radix-popper-available-height",`${Nt}px`),Gt.setProperty("--radix-popper-anchor-width",`${It}px`),Gt.setProperty("--radix-popper-anchor-height",`${Mn}px`)}}),B&&Ome({element:B,padding:o}),ige({arrowWidth:O,arrowHeight:F}),x&&Dme({strategy:"referenceHidden",...ee})]}),[ge,_e]=RW(W),K=H3(_);Xp(()=>{ne&&K?.()},[ne,K]);const pe=se.arrow?.x,we=se.arrow?.y,Ne=se.arrow?.centerOffset!==0,[gt,Se]=G.useState();return Xp(()=>{S&&Se(window.getComputedStyle(S).zIndex)},[S]),Pt.jsx("div",{ref:te.setFloating,"data-radix-popper-content-wrapper":"",style:{...re,transform:ne?re.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:gt,"--radix-popper-transform-origin":[se.transformOrigin?.x,se.transformOrigin?.y].join(" "),...se.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:Pt.jsx(Qme,{scope:t,placedSide:ge,onArrowChange:L,arrowX:pe,arrowY:we,shouldHideArrow:Ne,children:Pt.jsx(yW.div,{"data-side":ge,"data-align":_e,...T,ref:w,style:{...T.style,animation:ne?void 0:"none"}})})})});EW.displayName=KU;var MW="PopperArrow",tge={top:"bottom",right:"left",bottom:"top",left:"right"},CW=G.forwardRef(function(e,t){const{__scopePopper:n,...s}=e,r=ege(MW,n),a=tge[r.placedSide];return Pt.jsx("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:Pt.jsx(kme,{...s,ref:t,style:{...s.style,display:"block"}})})});CW.displayName=MW;function nge(i){return i!==null}var ige=i=>({name:"transformOrigin",options:i,fn(e){const{placement:t,rects:n,middlewareData:s}=e,a=s.arrow?.centerOffset!==0,o=a?0:i.arrowWidth,l=a?0:i.arrowHeight,[u,f]=RW(t),p={start:"0%",center:"50%",end:"100%"}[f],x=(s.arrow?.x??0)+o/2,y=(s.arrow?.y??0)+l/2;let _="",T="";return u==="bottom"?(_=a?p:`${x}px`,T=`${-l}px`):u==="top"?(_=a?p:`${x}px`,T=`${n.floating.height+l}px`):u==="right"?(_=`${-l}px`,T=a?p:`${y}px`):u==="left"&&(_=`${n.floating.width+l}px`,T=a?p:`${y}px`),{data:{x:_,y:T}}}});function RW(i){const[e,t="center"]=i.split("-");return[e,t]}var sge=SW,rge=AW,age=EW,oge=CW;function lge(i){const e=cge(i),t=G.forwardRef((n,s)=>{const{children:r,...a}=n,o=G.Children.toArray(r),l=o.find(dge);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function cge(i){const e=G.forwardRef((t,n)=>{const{children:s,...r}=t;if(G.isValidElement(s)){const a=hge(s),o=fge(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var wW=Symbol("radix.slottable");function uge(i){const e=({children:t})=>Pt.jsx(Pt.Fragment,{children:t});return e.displayName=`${i}.Slottable`,e.__radixId=wW,e}function dge(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===wW}function fge(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function hge(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var pge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],mge=pge.reduce((i,e)=>{const t=lge(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{});function gge(i,e){return G.useReducer((t,n)=>e[t][n]??t,i)}var NW=i=>{const{present:e,children:t}=i,n=xge(e),s=typeof t=="function"?t({present:n.isPresent}):G.Children.only(t),r=M0(n.ref,yge(s));return typeof t=="function"||n.isPresent?G.cloneElement(s,{ref:r}):null};NW.displayName="Presence";function xge(i){const[e,t]=G.useState(),n=G.useRef(null),s=G.useRef(i),r=G.useRef("none"),a=i?"mounted":"unmounted",[o,l]=gge(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const u=JE(n.current);r.current=o==="mounted"?u:"none"},[o]),Xp(()=>{const u=n.current,f=s.current;if(f!==i){const x=r.current,y=JE(u);i?l("MOUNT"):y==="none"||u?.display==="none"?l("UNMOUNT"):l(f&&x!==y?"ANIMATION_OUT":"UNMOUNT"),s.current=i}},[i,l]),Xp(()=>{if(e){let u;const f=e.ownerDocument.defaultView??window,p=y=>{const T=JE(n.current).includes(CSS.escape(y.animationName));if(y.target===e&&T&&(l("ANIMATION_END"),!s.current)){const A=e.style.animationFillMode;e.style.animationFillMode="forwards",u=f.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=A)})}},x=y=>{y.target===e&&(r.current=JE(n.current))};return e.addEventListener("animationstart",x),e.addEventListener("animationcancel",p),e.addEventListener("animationend",p),()=>{f.clearTimeout(u),e.removeEventListener("animationstart",x),e.removeEventListener("animationcancel",p),e.removeEventListener("animationend",p)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:G.useCallback(u=>{n.current=u?getComputedStyle(u):null,t(u)},[])}}function JE(i){return i?.animationName||"none"}function yge(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var vge=gB[" useInsertionEffect ".trim().toString()]||Xp;function _ge({prop:i,defaultProp:e,onChange:t=()=>{},caller:n}){const[s,r,a]=bge({defaultProp:e,onChange:t}),o=i!==void 0,l=o?i:s;{const f=G.useRef(i!==void 0);G.useEffect(()=>{const p=f.current;p!==o&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=o},[o,n])}const u=G.useCallback(f=>{if(o){const p=Sge(f)?f(i):f;p!==i&&a.current?.(p)}else r(f)},[o,i,r,a]);return[l,u]}function bge({defaultProp:i,onChange:e}){const[t,n]=G.useState(i),s=G.useRef(t),r=G.useRef(e);return vge(()=>{r.current=e},[e]),G.useEffect(()=>{s.current!==t&&(r.current?.(t),s.current=t)},[t,s]),[t,n,r]}function Sge(i){return typeof i=="function"}function Tge(i){const e=Age(i),t=G.forwardRef((n,s)=>{const{children:r,...a}=n,o=G.Children.toArray(r),l=o.find(Mge);if(l){const u=l.props.children,f=o.map(p=>p===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:p);return Pt.jsx(e,{...a,ref:s,children:G.isValidElement(u)?G.cloneElement(u,void 0,f):null})}return Pt.jsx(e,{...a,ref:s,children:r})});return t.displayName=`${i}.Slot`,t}function Age(i){const e=G.forwardRef((t,n)=>{const{children:s,...r}=t;if(G.isValidElement(s)){const a=Rge(s),o=Cge(r,s.props);return s.type!==G.Fragment&&(o.ref=n?E0(n,a):a),G.cloneElement(s,o)}return G.Children.count(s)>1?G.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var Ege=Symbol("radix.slottable");function Mge(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===Ege}function Cge(i,e){const t={...e};for(const n in e){const s=i[n],r=e[n];/^on[A-Z]/.test(n)?s&&r?t[n]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...r}:n==="className"&&(t[n]=[s,r].filter(Boolean).join(" "))}return{...i,...t}}function Rge(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var wge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Nge=wge.reduce((i,e)=>{const t=Tge(`Primitive.${e}`),n=G.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Pt.jsx(l,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...i,[e]:n}},{}),Bge=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Dge="VisuallyHidden",BW=G.forwardRef((i,e)=>Pt.jsx(Nge.span,{...i,ref:e,style:{...Bge,...i.style}}));BW.displayName=Dge;var Oge=BW,[Y3]=tW("Tooltip",[_W]),j3=_W(),DW="TooltipProvider",Uge=700,tB="tooltip.open",[Lge,JU]=Y3(DW),OW=i=>{const{__scopeTooltip:e,delayDuration:t=Uge,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:r}=i,a=G.useRef(!0),o=G.useRef(!1),l=G.useRef(0);return G.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),Pt.jsx(Lge,{scope:e,isOpenDelayedRef:a,delayDuration:t,onOpen:G.useCallback(()=>{window.clearTimeout(l.current),a.current=!1},[]),onClose:G.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.current=!0,n)},[n]),isPointerInTransitRef:o,onPointerInTransitChange:G.useCallback(u=>{o.current=u},[]),disableHoverableContent:s,children:r})};OW.displayName=DW;var YS="Tooltip",[Ige,$3]=Y3(YS),UW=i=>{const{__scopeTooltip:e,children:t,open:n,defaultOpen:s,onOpenChange:r,disableHoverableContent:a,delayDuration:o}=i,l=JU(YS,i.__scopeTooltip),u=j3(e),[f,p]=G.useState(null),x=Tpe(),y=G.useRef(0),_=a??l.disableHoverableContent,T=o??l.delayDuration,A=G.useRef(!1),[S,C]=_ge({prop:n,defaultProp:s??!1,onChange:O=>{O?(l.onOpen(),document.dispatchEvent(new CustomEvent(tB))):l.onClose(),r?.(O)},caller:YS}),w=G.useMemo(()=>S?A.current?"delayed-open":"instant-open":"closed",[S]),B=G.useCallback(()=>{window.clearTimeout(y.current),y.current=0,A.current=!1,C(!0)},[C]),L=G.useCallback(()=>{window.clearTimeout(y.current),y.current=0,C(!1)},[C]),D=G.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>{A.current=!0,C(!0),y.current=0},T)},[T,C]);return G.useEffect(()=>()=>{y.current&&(window.clearTimeout(y.current),y.current=0)},[]),Pt.jsx(sge,{...u,children:Pt.jsx(Ige,{scope:e,contentId:x,open:S,stateAttribute:w,trigger:f,onTriggerChange:p,onTriggerEnter:G.useCallback(()=>{l.isOpenDelayedRef.current?D():B()},[l.isOpenDelayedRef,D,B]),onTriggerLeave:G.useCallback(()=>{_?L():(window.clearTimeout(y.current),y.current=0)},[L,_]),onOpen:B,onClose:L,disableHoverableContent:_,children:t})})};UW.displayName=YS;var nB="TooltipTrigger",LW=G.forwardRef((i,e)=>{const{__scopeTooltip:t,...n}=i,s=$3(nB,t),r=JU(nB,t),a=j3(t),o=G.useRef(null),l=M0(e,o,s.onTriggerChange),u=G.useRef(!1),f=G.useRef(!1),p=G.useCallback(()=>u.current=!1,[]);return G.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),Pt.jsx(rge,{asChild:!0,...a,children:Pt.jsx(mge.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:l,onPointerMove:Ef(i.onPointerMove,x=>{x.pointerType!=="touch"&&!f.current&&!r.isPointerInTransitRef.current&&(s.onTriggerEnter(),f.current=!0)}),onPointerLeave:Ef(i.onPointerLeave,()=>{s.onTriggerLeave(),f.current=!1}),onPointerDown:Ef(i.onPointerDown,()=>{s.open&&s.onClose(),u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:Ef(i.onFocus,()=>{u.current||s.onOpen()}),onBlur:Ef(i.onBlur,s.onClose),onClick:Ef(i.onClick,s.onClose)})})});LW.displayName=nB;var Pge="TooltipPortal",[bbe,Fge]=Y3(Pge,{forceMount:void 0}),Jy="TooltipContent",IW=G.forwardRef((i,e)=>{const t=Fge(Jy,i.__scopeTooltip),{forceMount:n=t.forceMount,side:s="top",...r}=i,a=$3(Jy,i.__scopeTooltip);return Pt.jsx(NW,{present:n||a.open,children:a.disableHoverableContent?Pt.jsx(PW,{side:s,...r,ref:e}):Pt.jsx(Gge,{side:s,...r,ref:e})})}),Gge=G.forwardRef((i,e)=>{const t=$3(Jy,i.__scopeTooltip),n=JU(Jy,i.__scopeTooltip),s=G.useRef(null),r=M0(e,s),[a,o]=G.useState(null),{trigger:l,onClose:u}=t,f=s.current,{onPointerInTransitChange:p}=n,x=G.useCallback(()=>{o(null),p(!1)},[p]),y=G.useCallback((_,T)=>{const A=_.currentTarget,S={x:_.clientX,y:_.clientY},C=kge(S,A.getBoundingClientRect()),w=Wge(S,C),B=Xge(T.getBoundingClientRect()),L=Yge([...w,...B]);o(L),p(!0)},[p]);return G.useEffect(()=>()=>x(),[x]),G.useEffect(()=>{if(l&&f){const _=A=>y(A,f),T=A=>y(A,l);return l.addEventListener("pointerleave",_),f.addEventListener("pointerleave",T),()=>{l.removeEventListener("pointerleave",_),f.removeEventListener("pointerleave",T)}}},[l,f,y,x]),G.useEffect(()=>{if(a){const _=T=>{const A=T.target,S={x:T.clientX,y:T.clientY},C=l?.contains(A)||f?.contains(A),w=!qge(S,a);C?x():w&&(x(),u())};return document.addEventListener("pointermove",_),()=>document.removeEventListener("pointermove",_)}},[l,f,a,u,x]),Pt.jsx(PW,{...i,ref:r})}),[zge,Vge]=Y3(YS,{isInside:!1}),Hge=uge("TooltipContent"),PW=G.forwardRef((i,e)=>{const{__scopeTooltip:t,children:n,"aria-label":s,onEscapeKeyDown:r,onPointerDownOutside:a,...o}=i,l=$3(Jy,t),u=j3(t),{onClose:f}=l;return G.useEffect(()=>(document.addEventListener(tB,f),()=>document.removeEventListener(tB,f)),[f]),G.useEffect(()=>{if(l.trigger){const p=x=>{x.target?.contains(l.trigger)&&f()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[l.trigger,f]),Pt.jsx(sW,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:p=>p.preventDefault(),onDismiss:f,children:Pt.jsxs(age,{"data-state":l.stateAttribute,...u,...o,ref:e,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[Pt.jsx(Hge,{children:n}),Pt.jsx(zge,{scope:t,isInside:!0,children:Pt.jsx(Oge,{id:l.contentId,role:"tooltip",children:s||n})})]})})});IW.displayName=Jy;var FW="TooltipArrow",GW=G.forwardRef((i,e)=>{const{__scopeTooltip:t,...n}=i,s=j3(t);return Vge(FW,t).isInside?null:Pt.jsx(oge,{...s,...n,ref:e})});GW.displayName=FW;function kge(i,e){const t=Math.abs(e.top-i.y),n=Math.abs(e.bottom-i.y),s=Math.abs(e.right-i.x),r=Math.abs(e.left-i.x);switch(Math.min(t,n,s,r)){case r:return"left";case s:return"right";case t:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Wge(i,e,t=5){const n=[];switch(e){case"top":n.push({x:i.x-t,y:i.y+t},{x:i.x+t,y:i.y+t});break;case"bottom":n.push({x:i.x-t,y:i.y-t},{x:i.x+t,y:i.y-t});break;case"left":n.push({x:i.x+t,y:i.y-t},{x:i.x+t,y:i.y+t});break;case"right":n.push({x:i.x-t,y:i.y-t},{x:i.x-t,y:i.y+t});break}return n}function Xge(i){const{top:e,right:t,bottom:n,left:s}=i;return[{x:s,y:e},{x:t,y:e},{x:t,y:n},{x:s,y:n}]}function qge(i,e){const{x:t,y:n}=i;let s=!1;for(let r=0,a=e.length-1;r<e.length;a=r++){const o=e[r],l=e[a],u=o.x,f=o.y,p=l.x,x=l.y;f>n!=x>n&&t<(p-u)*(n-f)/(x-f)+u&&(s=!s)}return s}function Yge(i){const e=i.slice();return e.sort((t,n)=>t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0),jge(e)}function jge(i){if(i.length<=1)return i.slice();const e=[];for(let n=0;n<i.length;n++){const s=i[n];for(;e.length>=2;){const r=e[e.length-1],a=e[e.length-2];if((r.x-a.x)*(s.y-a.y)>=(r.y-a.y)*(s.x-a.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let n=i.length-1;n>=0;n--){const s=i[n];for(;t.length>=2;){const r=t[t.length-1],a=t[t.length-2];if((r.x-a.x)*(s.y-a.y)>=(r.y-a.y)*(s.x-a.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var $ge=OW,Kge=UW,Jge=LW,Zge=IW,Qge=GW;function e0e(i,e){if(i==null)return{};var t={};for(var n in i)if({}.hasOwnProperty.call(i,n)){if(e.indexOf(n)!==-1)continue;t[n]=i[n]}return t}function fs(i,e){if(i==null)return{};var t,n,s=e0e(i,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(n=0;n<r.length;n++)t=r[n],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(i,t)&&(s[t]=i[t])}return s}let Ar=(function(i){return i[i.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",i[i.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",i[i.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",i[i.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",i[i.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",i[i.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",i[i.THEME_ERROR=6]="THEME_ERROR",i[i.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",i[i.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",i[i.EMPTY_KEY=9]="EMPTY_KEY",i})({});const t0e={[Ar.UNSUPPORTED_INPUT]:(i,e)=>[`An input with type \`${i}\` input was found at path \`${e}\` but it's not supported yet.`],[Ar.NO_COMPONENT_FOR_TYPE]:(i,e)=>[`Type \`${i}\` found at path \`${e}\` can't be displayed in panel because no component supports it yet.`],[Ar.UNKNOWN_INPUT]:(i,e)=>[`input at path \`${i}\` is not recognized.`,e],[Ar.DUPLICATE_KEYS]:(i,e,t)=>[`Key \`${i}\` of path \`${e}\` already exists at path \`${t}\`. Even nested keys need to be unique. Rename one of the keys.`],[Ar.ALREADY_REGISTERED_TYPE]:i=>[`Type ${i} has already been registered. You can't register a component with the same type.`],[Ar.CLIPBOARD_ERROR]:i=>["Error copying the value",i],[Ar.THEME_ERROR]:(i,e)=>[`Error accessing the theme \`${i}.${e}\` value.`],[Ar.PATH_DOESNT_EXIST]:i=>[`Error getting the value at path \`${i}\`. There is probably an error in your \`render\` function.`],[Ar.INPUT_TYPE_OVERRIDE]:(i,e,t)=>[`Input at path \`${i}\` already exists with type: \`${e}\`. Its type cannot be overridden with type \`${t}\`.`],[Ar.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function zW(i,e,...t){const n=t0e[e],[s,...r]=n(...t);console[i]("LEVA: "+s,...r)}const Nf=zW.bind(null,"warn"),n0e=zW.bind(null,"log"),i0e=["value"],s0e=["schema"],r0e=["value"],VW=[],f0={};function TG(i){let{value:e}=i,t=fs(i,i0e);for(let n of VW){const s=n(e,t);if(s)return s}}function ih(i,e){let{schema:t}=e,n=fs(e,s0e);if(i in f0){Nf(Ar.ALREADY_REGISTERED_TYPE,i);return}VW.push((s,r)=>t(s,r)&&i),f0[i]=n}function L2(i,e,t,n){const{normalize:s}=f0[i];if(s)return s(e,t,n);if(typeof e!="object"||!("value"in e))return{value:e};const{value:r}=e,a=fs(e,r0e);return{value:r,settings:a}}function a0e(i,e,t,n,s,r){const{sanitize:a}=f0[i];return a?a(e,t,n,s,r):e}function AG(i,e,t){const{format:n}=f0[i];return n?n(e,t):e}function o0e(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function l0e(i){var e=o0e(i,"string");return typeof e=="symbol"?e:e+""}function c0e(i,e,t){return(e=l0e(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function EG(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function In(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?EG(Object(t),!0).forEach(function(n){c0e(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):EG(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const jp=(i,e,t)=>i>t?t:i<e?e:i,u0e=i=>{if(i===""||typeof i=="number")return i;try{const e=_y(i);if(!isNaN(e))return e}catch{}return parseFloat(i)},d0e=Math.log(10);function MG(i){let e=Math.abs(+String(i).replace(".",""));if(e===0)return .01;for(;e!==0&&e%10===0;)e/=10;const t=Math.floor(Math.log(e)/d0e)+1,n=Math.floor(Math.log10(Math.abs(i))),s=Math.pow(10,n-t);return Math.max(s,.001)}const $M=(i,e,t)=>t===e?0:(jp(i,e,t)-e)/(t-e),KM=(i,e,t)=>i*(t-e)+e,f0e=()=>"_"+Math.random().toString(36).substr(2,9),CG=/\(([^\(\)]+)\)/,RG=/(-?\d+(?:\.\d+)?)\s*\^\s*(-?\d+(?:\.\d+)?)/,wG=/(-?\d+(?:\.\d+)?)\s*([*/])\s*(-?\d+(?:\.\d+)?)/,NG=/(-?\d+(?:\.\d+)?)\s*([+-])\s*(-?\d+(?:\.\d+)?)/;function _y(i){return i=i.replace(/\s+/g,""),CG.test(i)?_y(i.replace(CG,(e,t)=>_y(t).toString())):RG.test(i)?_y(i.replace(RG,(e,t,n)=>Math.pow(Number(t),Number(n)).toString())):wG.test(i)?_y(i.replace(wG,(e,t,n,s)=>n==="*"?(Number(t)*Number(s)).toString():Number(s)===0?(()=>{throw new Error("Division by zero")})():(Number(t)/Number(s)).toString())):NG.test(i)?_y(i.replace(NG,(e,t,n,s)=>n==="+"?(Number(t)+Number(s)).toString():(Number(t)-Number(s)).toString())):Number(i)}function h0e(i,e){return e.reduce((t,n)=>(i&&i.hasOwnProperty(n)&&(t[n]=i[n]),t),{})}function p0e(i,e){const t=In({},i);return e.forEach(n=>n in i&&delete t[n]),t}function m0e(i,e){return i.reduce((t,n,s)=>Object.assign(t,{[e[s]]:n}),{})}function HW(i){return Object.prototype.toString.call(i)==="[object Object]"}const g0e=i=>HW(i)&&Object.keys(i).length===0;let Ff=(function(i){return i.BUTTON="BUTTON",i.BUTTON_GROUP="BUTTON_GROUP",i.MONITOR="MONITOR",i.FOLDER="FOLDER",i})({}),sh=(function(i){return i.SELECT="SELECT",i.IMAGE="IMAGE",i.NUMBER="NUMBER",i.COLOR="COLOR",i.STRING="STRING",i.BOOLEAN="BOOLEAN",i.INTERVAL="INTERVAL",i.VECTOR3D="VECTOR3D",i.VECTOR2D="VECTOR2D",i})({});const x0e=["type","__customInput"],y0e=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],v0e=["type"];function kW(i,e,t={},n){var s,r;if(typeof i!="object"||Array.isArray(i))return{type:n,input:i,options:In({key:e,label:e,optional:!1,disabled:!1,order:0},t)};if("__customInput"in i){const{type:L,__customInput:D}=i,O=fs(i,x0e);return kW(D,e,O,L)}const{render:a,label:o,optional:l,order:u=0,disabled:f,hint:p,onChange:x,onEditStart:y,onEditEnd:_,transient:T}=i,A=fs(i,y0e),S=In({render:a,key:e,label:o??e,hint:p,transient:T??!!x,onEditStart:y,onEditEnd:_,disabled:f,optional:l,order:u},t);let{type:C}=A,w=fs(A,v0e);if(C=n??C,C in Ff)return{type:C,input:w,options:S};let B;return n&&HW(w)&&"value"in w?B=w.value:B=g0e(w)?void 0:w,{type:C,input:B,options:In(In({},S),{},{onChange:x,optional:(s=S.optional)!==null&&s!==void 0?s:!1,disabled:(r=S.disabled)!==null&&r!==void 0?r:!1})}}function _0e(i,e,t,n){const s=kW(i,e),{type:r,input:a,options:o}=s;if(r)return r in Ff?s:{type:r,input:L2(r,a,t,n),options:o};let l=TG(a);return l?{type:l,input:L2(l,a,t,n),options:o}:(l=TG({value:a}),l?{type:l,input:L2(l,{value:a},t,n),options:o}:!1)}function BG(i,e,t,n,s){const{value:r,type:a,settings:o}=i;i.value=WW({type:a,value:r,settings:o},e,t,n),i.fromPanel=s}const b0e=function(e,t,n){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=n};function WW({type:i,value:e,settings:t},n,s,r){const a=i!=="SELECT"&&typeof n=="function"?n(e):n;let o;try{o=a0e(i,a,t,e,s,r)}catch(l){throw new b0e(`The value \`${n}\` did not result in a correct value.`,e,l)}return kS(o,e)?e:o}const XW=(i,e,t=!1)=>{let n=0;return function(){const s=arguments,r=t&&!n,a=()=>i.apply(this,s);window.clearTimeout(n),n=window.setTimeout(a,e),r&&a()}},qW=i=>i.shiftKey?5:i.altKey?1/5:1,S0e=["value"],T0e=["min","max"],A0e=i=>{if(typeof i=="number")return!0;if(typeof i=="string"){const e=parseFloat(i);return isNaN(e)?!1:i.substring((""+e).length).trim().length<4}return!1},YW=(i,{min:e=-1/0,max:t=1/0,suffix:n})=>{const s=parseFloat(i);if(i===""||isNaN(s))throw Error("Invalid number");const r=jp(s,e,t);return n?r+n:r},E0e=(i,{pad:e=0,suffix:t})=>{const n=parseFloat(i).toFixed(e);return t?n+t:n},jW=i=>{let{value:e}=i,t=fs(i,S0e);const{min:n=-1/0,max:s=1/0}=t,r=fs(t,T0e);let a=parseFloat(e);const o=typeof e=="string"?e.substring((""+a).length):void 0;a=jp(a,n,s);let l=t.step;l||(Number.isFinite(n)?Number.isFinite(s)?l=+(Math.abs(s-n)/100).toPrecision(1):l=+(Math.abs(a-n)/100).toPrecision(1):Number.isFinite(s)&&(l=+(Math.abs(s-a)/100).toPrecision(1)));const u=l?MG(l)*10:MG(a);l=l||u/10;const f=Math.round(jp(Math.log10(1/u),0,2));return{value:o?a+o:a,settings:In({initialValue:a,step:l,pad:f,min:n,max:s,suffix:o},r)}},$W=(i,{step:e,initialValue:t})=>{const n=Math.round((i-t)/e);return t+n*e};var KW=Object.freeze({__proto__:null,schema:A0e,sanitize:YW,format:E0e,normalize:jW,sanitizeStep:$W});function sr(){return sr=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},sr.apply(null,arguments)}const JW=G.createContext({});function Ya(){return G.useContext(JW)}const ZU=G.createContext(null),ZW=G.createContext(null),QW=G.createContext(null);function sA(){return G.useContext(ZW)}function M0e(){return G.useContext(QW)}const eX=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function ZE(i,e){const[t,n]=i.split(" "),s={};return t!=="none"&&(s.boxShadow=`${e.inset?"inset ":""}0 0 0 $borderWidths${[e.key]} $colors${t!=="default"&&t||e.borderColor}`),n&&(s.backgroundColor=n),s}const Yb={$inputStyle:()=>i=>ZE(i,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>i=>ZE(i,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>i=>ZE(i,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>i=>ZE(i,{key:"$active",borderColor:"$accent1",inset:!0})},rA=ipe({prefix:"leva",theme:eX(),utils:In(In({},Yb),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:i=>({"&:focus":Yb.$focusStyle()(i)}),$focusWithin:i=>({"&:focus-within":Yb.$focusStyle()(i)}),$hover:i=>({"&:hover":Yb.$hoverStyle()(i)}),$active:i=>({"&:active":Yb.$activeStyle()(i)})})}),Rn=rA.styled;rA.css;const C0e=rA.createTheme,R0e=rA.globalCss;rA.keyframes;const w0e=R0e({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function N0e(i){const e=eX();if(!i)return{theme:e,className:""};Object.keys(i).forEach(n=>{Object.assign(e[n],i[n])});const t=C0e(e);return{theme:e,className:t.className}}function Gf(i,e){const{theme:t}=G.useContext(ZU);if(!(i in t)||!(e in t[i]))return Nf(Ar.THEME_ERROR,i,e),"";let n=e;for(;;){let s=t[i][n];if(typeof s=="string"&&s.charAt(0)==="$")n=s.substr(1);else return s}}const tX=Rn("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),nX=Rn("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${tX}`]:{paddingLeft:0}}),B0e=Rn(nX,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),D0e=Rn("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),O0e=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],U0e=["onUpdate"];function QU(i){let{innerLabel:e,value:t,onUpdate:n,onChange:s,onKeyDown:r,type:a,id:o,inputType:l="text",rows:u=0}=i,f=fs(i,O0e);const{id:p,emitOnEditStart:x,emitOnEditEnd:y,disabled:_}=Ya(),T=o||p,A=G.useRef(null),S=u>0,C=S?"textarea":"input",w=G.useCallback(D=>O=>{const F=O.currentTarget.value;D(F)},[]);ue.useEffect(()=>{const D=A.current,O=w(F=>{n(F),y()});return D?.addEventListener("blur",O),()=>D?.removeEventListener("blur",O)},[w,n,y]);const B=G.useCallback(D=>{D.key==="Enter"&&w(n)(D)},[w,n]),L=Object.assign({as:C},S?{rows:u}:{},f);return ue.createElement(D0e,{textArea:S},e&&typeof e=="string"?ue.createElement(nX,null,e):e,ue.createElement(tX,sr({levaType:a,ref:A,id:T,type:l,autoComplete:"off",spellCheck:"false",value:t,onChange:w(s),onFocus:()=>x(),onKeyPress:B,onKeyDown:r,disabled:_},L)))}function L0e(i){let{onUpdate:e}=i,t=fs(i,U0e);const n=G.useCallback(r=>e(u0e(r)),[e]),s=G.useCallback(r=>{const a=r.key==="ArrowUp"?1:r.key==="ArrowDown"?-1:0;if(a){r.preventDefault();const o=r.altKey?.1:r.shiftKey?10:1;e(l=>parseFloat(l)+a*o)}},[e]);return ue.createElement(QU,sr({},t,{onUpdate:n,onKeyDown:s,type:"number"}))}const JM=Rn("div",{}),iB=Rn("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),I0e=Rn("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${iB}::after`]:{opacity:.6},[`${JM}:hover > & + ${iB}::after`]:{opacity:.6},[`${JM}:hover > & > svg`]:{opacity:1}}),iX=Rn("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${JM}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),sX=Rn("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${iX} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),rX=Rn(sX,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),P0e=Rn("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),F0e=Rn("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),sB=Rn("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),G0e=Rn("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${sB}`]:{pointerEvents:"auto"}}}}}),aX=Rn("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),z0e=Rn("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),V0e=Rn(Qge,{fill:"$toolTipBackground"});function eL({children:i,container:e=(t=>globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body)()}){const{className:t}=G.useContext(ZU);return ue.createElement(Ehe,{className:t,container:e},i)}const H0e=["align"];function k0e(){const{id:i,disable:e,disabled:t}=Ya();return ue.createElement(ue.Fragment,null,ue.createElement(F0e,{id:i+"__disable",type:"checkbox",checked:!t,onChange:()=>e(!t)}),ue.createElement("label",{htmlFor:i+"__disable"}))}function W0e(i){const{id:e,optional:t,hint:n}=Ya(),s=i.htmlFor||e||void 0,r=!n&&typeof i.children=="string"?i.children:void 0;return ue.createElement(ue.Fragment,null,t&&ue.createElement(k0e,null),n!==void 0?ue.createElement(Kge,null,ue.createElement(Jge,{asChild:!0},ue.createElement(sB,sr({htmlFor:s},i))),ue.createElement(Zge,{side:"top",sideOffset:2},ue.createElement(z0e,null,n,ue.createElement(V0e,null)))):ue.createElement(sB,sr({htmlFor:s,title:r},i)))}function xu(i){let{align:e}=i,t=fs(i,H0e);const{value:n,label:s,key:r,disabled:a}=Ya(),{hideCopyButton:o}=M0e(),l=!o&&r!==void 0,[u,f]=G.useState(!1),p=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[r]:n??""})),f(!0)}catch{Nf(Ar.CLIPBOARD_ERROR,{[r]:n})}};return ue.createElement(P0e,{align:e,onPointerLeave:()=>f(!1)},ue.createElement(W0e,t),l&&!a&&ue.createElement("div",{title:`Click to copy ${typeof s=="string"?s:r} value`},u?ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ue.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),ue.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):ue.createElement("svg",{onClick:p,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ue.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),ue.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const X0e=["toggled"],q0e=Rn("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function tL(i){let{toggled:e}=i,t=fs(i,X0e);return ue.createElement(q0e,sr({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${e?0:-90}deg)`}},t),ue.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const Y0e=["input"];function Ec(i){let{input:e}=i,t=fs(i,Y0e);return e?ue.createElement(rX,t):ue.createElement(sX,t)}function oX({value:i,type:e,settings:t,setValue:n}){const[s,r]=G.useState(AG(e,i,t)),a=G.useRef(i),o=G.useRef(t);o.current=t;const l=G.useCallback(f=>r(AG(e,f,o.current)),[e]),u=G.useCallback(f=>{try{n(f)}catch(p){const{type:x,previousValue:y}=p;if(x!=="LEVA_ERROR")throw p;l(y)}},[l,n]);return G.useEffect(()=>{kS(i,a.current)||l(i),a.current=i},[i,l]),{displayValue:s,onChange:r,onUpdate:u}}function aA(i,e){const{emitOnEditStart:t,emitOnEditEnd:n}=Ya();return Fde(s=>{s.first&&(document.body.classList.add("leva__panel__dragged"),t?.());const r=i(s);return s.last&&(document.body.classList.remove("leva__panel__dragged"),n?.()),r},e)}function j0e(i){const e=G.useRef(null),t=G.useRef(null),n=G.useRef(!1);return G.useEffect(()=>{const s=XW(()=>{e.current.width=e.current.offsetWidth*window.devicePixelRatio,e.current.height=e.current.offsetHeight*window.devicePixelRatio,i(e.current,t.current)},250);return window.addEventListener("resize",s),n.current||(s(),n.current=!0),()=>window.removeEventListener("resize",s)},[i]),G.useEffect(()=>{t.current=e.current.getContext("2d")},[]),[e,t]}function lX(){const i=G.useRef(null),e=G.useRef({x:0,y:0}),t=G.useCallback(n=>{Object.assign(e.current,n),i.current&&(i.current.style.transform=`translate3d(${e.current.x}px, ${e.current.y}px, 0)`)},[]);return[i,t]}const $0e=["__refCount"],I2=(i,e)=>{if(!i[e])return null;const t=i[e];return fs(t,$0e)};function K0e(i){const e=sA(),[t,n]=G.useState(I2(e.getData(),i)),s=G.useCallback(u=>e.setValueAtPath(i,u,!0),[i,e]),r=G.useCallback(u=>e.setSettingsAtPath(i,u),[i,e]),a=G.useCallback(u=>e.disableInputAtPath(i,u),[i,e]),o=G.useCallback(()=>e.emitOnEditStart(i),[i,e]),l=G.useCallback(()=>e.emitOnEditEnd(i),[i,e]);return G.useEffect(()=>{n(I2(e.getData(),i));const u=e.useStore.subscribe(f=>I2(f.data,i),n,{equalityFn:z3});return()=>u()},[e,i]),[t,{set:s,setSettings:r,disable:a,storeId:e.storeId,emitOnEditStart:o,emitOnEditEnd:l}]}const J0e=Rn("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),cX=Rn("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),rB=Rn("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),uX=Rn("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),dX=Rn("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function Z0e({value:i,min:e,max:t,onDrag:n,step:s,initialValue:r}){const a=G.useRef(null),o=G.useRef(null),l=G.useRef(0),u=Gf("sizes","scrubberWidth"),f=aA(({event:x,first:y,xy:[_],movement:[T],memo:A})=>{if(y){const{width:C,left:w}=a.current.getBoundingClientRect();l.current=C-parseFloat(u),A=x?.target===o.current?i:KM((_-w)/C,e,t)}const S=A+KM(T/l.current,0,t-e);return n($W(S,{step:s,initialValue:r})),A}),p=$M(i,e,t);return ue.createElement(uX,sr({ref:a},f()),ue.createElement(cX,null,ue.createElement(dX,{style:{left:0,right:`${(1-p)*100}%`}})),ue.createElement(rB,{ref:o,style:{left:`calc(${p} * (100% - ${u}))`}}))}const Q0e=ue.memo(({label:i,onUpdate:e,step:t,innerLabelTrim:n})=>{const[s,r]=G.useState(!1),a=aA(({active:o,delta:[l],event:u,memo:f=0,first:p,last:x,target:y})=>(p&&y.requestPointerLock(),x&&document.exitPointerLock(),r(o),f+=l/2,Math.abs(f)>=1&&(e(_=>parseFloat(_)+Math.floor(f)*t*qW(u)),f=0),f));return ue.createElement(B0e,sr({dragging:s,title:i.length>1?i:""},a()),i.slice(0,n))});function fX({label:i,id:e,displayValue:t,onUpdate:n,onChange:s,settings:r,innerLabelTrim:a=1}){const o=a>0&&ue.createElement(Q0e,{label:i,step:r.step,onUpdate:n,innerLabelTrim:a});return ue.createElement(L0e,{id:e,value:String(t),onUpdate:n,onChange:s,innerLabel:o})}function exe(){const i=Ya(),{label:e,value:t,onUpdate:n,settings:s,id:r}=i,{min:a,max:o}=s,l=o!==1/0&&a!==-1/0;return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,e),ue.createElement(J0e,{hasRange:l},l&&ue.createElement(Z0e,sr({value:parseFloat(t),onDrag:n},s)),ue.createElement(fX,sr({},i,{id:r,label:"value",innerLabelTrim:l?0:1}))))}const{sanitizeStep:txe}=KW,nxe=fs(KW,["sanitizeStep"]);var ixe=In({component:exe},nxe);const sxe=(i,e)=>Ko().schema({options:Ko().passesAnyOf(Ko().object(),Ko().array())}).test(e),rxe=(i,{values:e})=>{if(e.indexOf(i)<0)throw Error("Selected value doesn't match Select options");return i},axe=(i,{values:e})=>e.indexOf(i),oxe=i=>{let{value:e,options:t}=i,n,s;return Array.isArray(t)?(s=t,n=t.map(r=>String(r))):(s=Object.values(t),n=Object.keys(t)),"value"in i?s.includes(e)||(n.unshift(String(e)),s.unshift(e)):e=s[0],Object.values(t).includes(e)||(t[String(e)]=e),{value:e,settings:{keys:n,values:s}}};var lxe=Object.freeze({__proto__:null,schema:sxe,sanitize:rxe,format:axe,normalize:oxe});const cxe=Rn("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),aB=Rn("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),uxe=Rn("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${aB}:focus + &`]:{$focusStyle:""},[`${aB}:hover + &`]:{$hoverStyle:""}});function dxe({displayValue:i,value:e,onUpdate:t,id:n,settings:s,disabled:r}){const{keys:a,values:o}=s,l=G.useRef();return e===o[i]&&(l.current=a[i]),ue.createElement(cxe,null,ue.createElement(aB,{id:n,value:i,onChange:u=>t(o[Number(u.currentTarget.value)]),disabled:r},a.map((u,f)=>ue.createElement("option",{key:u,value:f},u))),ue.createElement(uxe,null,l.current),ue.createElement(tL,{toggled:!0}))}function fxe(){const{label:i,value:e,displayValue:t,onUpdate:n,id:s,disabled:r,settings:a}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(dxe,{id:s,value:e,displayValue:t,onUpdate:n,settings:a,disabled:r}))}var hxe=In({component:fxe},lxe);const pxe=i=>Ko().string().test(i),mxe=i=>{if(typeof i!="string")throw Error("Invalid string");return i},gxe=({value:i,editable:e=!0,rows:t=!1})=>({value:i,settings:{editable:e,rows:typeof t=="number"?t:t?5:0}});var xxe=Object.freeze({__proto__:null,schema:pxe,sanitize:mxe,normalize:gxe});const yxe=["displayValue","onUpdate","onChange","editable"],vxe=Rn("div",{whiteSpace:"pre-wrap"});function _xe(i){let{displayValue:e,onUpdate:t,onChange:n,editable:s=!0}=i,r=fs(i,yxe);return s?ue.createElement(QU,sr({value:e,onUpdate:t,onChange:n},r)):ue.createElement(vxe,null,e)}function bxe(){const{label:i,settings:e,displayValue:t,onUpdate:n,onChange:s}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(_xe,sr({displayValue:t,onUpdate:n,onChange:s},e)))}var Sxe=In({component:bxe},xxe);const Txe=i=>Ko().boolean().test(i),Axe=i=>{if(typeof i!="boolean")throw Error("Invalid boolean");return i};var Exe=Object.freeze({__proto__:null,schema:Txe,sanitize:Axe});const Mxe=Rn("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Cxe({value:i,onUpdate:e,id:t,disabled:n}){return ue.createElement(Mxe,null,ue.createElement("input",{id:t,type:"checkbox",checked:i,onChange:s=>e(s.currentTarget.checked),disabled:n}),ue.createElement("label",{htmlFor:t},ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ue.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function Rxe(){const{label:i,value:e,onUpdate:t,disabled:n,id:s}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(Cxe,{value:e,onUpdate:t,id:s,disabled:n}))}var wxe=In({component:Rxe},Exe);const Nxe=["locked"];function Bxe({value:i,id:e,valueKey:t,settings:n,onUpdate:s,innerLabelTrim:r}){const a=G.useRef(i[t]);a.current=i[t];const o=G.useCallback(u=>s({[t]:WW({type:"NUMBER",value:a.current,settings:n},u)}),[s,n,t]),l=oX({type:"NUMBER",value:i[t],settings:n,setValue:o});return ue.createElement(fX,{id:e,label:t,value:i[t],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:n,innerLabelTrim:r})}const Dxe=Rn("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function Oxe(i){let{locked:e}=i,t=fs(i,Nxe);return ue.createElement("svg",sr({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e?ue.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):ue.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function nL({value:i,onUpdate:e,settings:t,innerLabelTrim:n}){const{id:s,setSettings:r}=Ya(),{lock:a,locked:o}=t;return ue.createElement(Dxe,{withLock:a},a&&ue.createElement(Oxe,{locked:o,onClick:()=>r({locked:!o})}),Object.keys(i).map((l,u)=>ue.createElement(Bxe,{id:u===0?s:`${s}.${l}`,key:l,valueKey:l,value:i,settings:t[l],onUpdate:e,innerLabelTrim:n})))}const hX=(i,e)=>{const t={};let n=0,s=1/0;Object.entries(i).forEach(([r,a])=>{t[r]=jW(In({value:a},e[r])).settings,n=Math.max(n,t[r].step),s=Math.min(s,t[r].pad)});for(let r in t){const{step:a,min:o,max:l}=e[r]||{};!isFinite(a)&&(!isFinite(o)||!isFinite(l))&&(t[r].step=n,t[r].pad=s)}return t},Uxe=["lock"],Lxe=["value"];function Ixe(i){const e=Ko().array().length(i).every.number(),t=n=>{if(!n||typeof n!="object")return!1;const s=Object.values(n);return s.length===i&&s.every(r=>isFinite(r))};return n=>e.test(n)||t(n)}function Pxe(i){return Array.isArray(i)?"array":"object"}function gS(i,e,t){return Pxe(i)===e?i:e==="array"?Object.values(i):m0e(i,t)}const Fxe=(i,e,t)=>{const n=gS(i,"object",e.keys);for(let a in n)n[a]=YW(n[a],e[a]);const s=Object.keys(n);let r={};if(s.length===e.keys.length)r=n;else{const a=gS(t,"object",e.keys);if(s.length===1&&e.locked){const o=s[0],l=n[o],u=a[o],f=u!==0?l/u:1;for(let p in a)p===o?r[o]=l:r[p]=a[p]*f}else r=In(In({},a),n)}return gS(r,e.format,e.keys)},Gxe=(i,e)=>gS(i,"object",e.keys),zxe=i=>!!i&&("step"in i||"min"in i||"max"in i);function Vxe(i,e,t=[]){const{lock:n=!1}=e,s=fs(e,Uxe),r=Array.isArray(i)?"array":"object",a=r==="object"?Object.keys(i):t,o=gS(i,"object",a),l=zxe(s)?a.reduce((f,p)=>Object.assign(f,{[p]:s}),{}):s,u=hX(o,l);return{value:r==="array"?i:o,settings:In(In({},u),{},{format:r,keys:a,lock:n,locked:!1})}}function pX(i){return{schema:Ixe(i.length),normalize:e=>{let{value:t}=e,n=fs(e,Lxe);return Vxe(t,n,i)},format:(e,t)=>Gxe(e,t),sanitize:(e,t,n)=>Fxe(e,t,n)}}var Hxe={grad:.9,turn:360,rad:360/(2*Math.PI)},bf=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},ra=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*i)/t+0},xc=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),i>t?t:i>e?i:e},mX=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},DG=function(i){return{r:xc(i.r,0,255),g:xc(i.g,0,255),b:xc(i.b,0,255),a:xc(i.a)}},P2=function(i){return{r:ra(i.r),g:ra(i.g),b:ra(i.b),a:ra(i.a,3)}},kxe=/^#([0-9a-f]{3,8})$/i,QE=function(i){var e=i.toString(16);return e.length<2?"0"+e:e},gX=function(i){var e=i.r,t=i.g,n=i.b,s=i.a,r=Math.max(e,t,n),a=r-Math.min(e,t,n),o=a?r===e?(t-n)/a:r===t?2+(n-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:r?a/r*100:0,v:r/255*100,a:s}},xX=function(i){var e=i.h,t=i.s,n=i.v,s=i.a;e=e/360*6,t/=100,n/=100;var r=Math.floor(e),a=n*(1-t),o=n*(1-(e-r)*t),l=n*(1-(1-e+r)*t),u=r%6;return{r:255*[n,o,a,a,l,n][u],g:255*[l,n,n,o,a,a][u],b:255*[a,a,l,n,n,o][u],a:s}},OG=function(i){return{h:mX(i.h),s:xc(i.s,0,100),l:xc(i.l,0,100),a:xc(i.a)}},UG=function(i){return{h:ra(i.h),s:ra(i.s),l:ra(i.l),a:ra(i.a,3)}},LG=function(i){return xX((t=(e=i).s,{h:e.h,s:(t*=((n=e.l)<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:e.a}));var e,t,n},xS=function(i){return{h:(e=gX(i)).h,s:(s=(200-(t=e.s))*(n=e.v)/100)>0&&s<200?t*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,t,n,s},Wxe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xxe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,qxe=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Yxe=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,oB={string:[[function(i){var e=kxe.exec(i);return e?(i=e[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?ra(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?ra(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var e=qxe.exec(i)||Yxe.exec(i);return e?e[2]!==e[4]||e[4]!==e[6]?null:DG({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(i){var e=Wxe.exec(i)||Xxe.exec(i);if(!e)return null;var t,n,s=OG({h:(t=e[1],n=e[2],n===void 0&&(n="deg"),Number(t)*(Hxe[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return LG(s)},"hsl"]],object:[[function(i){var e=i.r,t=i.g,n=i.b,s=i.a,r=s===void 0?1:s;return bf(e)&&bf(t)&&bf(n)?DG({r:Number(e),g:Number(t),b:Number(n),a:Number(r)}):null},"rgb"],[function(i){var e=i.h,t=i.s,n=i.l,s=i.a,r=s===void 0?1:s;if(!bf(e)||!bf(t)||!bf(n))return null;var a=OG({h:Number(e),s:Number(t),l:Number(n),a:Number(r)});return LG(a)},"hsl"],[function(i){var e=i.h,t=i.s,n=i.v,s=i.a,r=s===void 0?1:s;if(!bf(e)||!bf(t)||!bf(n))return null;var a=(function(o){return{h:mX(o.h),s:xc(o.s,0,100),v:xc(o.v,0,100),a:xc(o.a)}})({h:Number(e),s:Number(t),v:Number(n),a:Number(r)});return xX(a)},"hsv"]]},IG=function(i,e){for(var t=0;t<e.length;t++){var n=e[t][0](i);if(n)return[n,e[t][1]]}return[null,void 0]},yX=function(i){return typeof i=="string"?IG(i.trim(),oB.string):typeof i=="object"&&i!==null?IG(i,oB.object):[null,void 0]},jxe=function(i){return yX(i)[1]},F2=function(i,e){var t=xS(i);return{h:t.h,s:xc(t.s+100*e,0,100),l:t.l,a:t.a}},G2=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},PG=function(i,e){var t=xS(i);return{h:t.h,s:t.s,l:xc(t.l+100*e,0,100),a:t.a}},lB=(function(){function i(e){this.parsed=yX(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return ra(G2(this.rgba),2)},i.prototype.isDark=function(){return G2(this.rgba)<.5},i.prototype.isLight=function(){return G2(this.rgba)>=.5},i.prototype.toHex=function(){return e=P2(this.rgba),t=e.r,n=e.g,s=e.b,a=(r=e.a)<1?QE(ra(255*r)):"","#"+QE(t)+QE(n)+QE(s)+a;var e,t,n,s,r,a},i.prototype.toRgb=function(){return P2(this.rgba)},i.prototype.toRgbString=function(){return e=P2(this.rgba),t=e.r,n=e.g,s=e.b,(r=e.a)<1?"rgba("+t+", "+n+", "+s+", "+r+")":"rgb("+t+", "+n+", "+s+")";var e,t,n,s,r},i.prototype.toHsl=function(){return UG(xS(this.rgba))},i.prototype.toHslString=function(){return e=UG(xS(this.rgba)),t=e.h,n=e.s,s=e.l,(r=e.a)<1?"hsla("+t+", "+n+"%, "+s+"%, "+r+")":"hsl("+t+", "+n+"%, "+s+"%)";var e,t,n,s,r},i.prototype.toHsv=function(){return e=gX(this.rgba),{h:ra(e.h),s:ra(e.s),v:ra(e.v),a:ra(e.a,3)};var e},i.prototype.invert=function(){return go({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},i.prototype.saturate=function(e){return e===void 0&&(e=.1),go(F2(this.rgba,e))},i.prototype.desaturate=function(e){return e===void 0&&(e=.1),go(F2(this.rgba,-e))},i.prototype.grayscale=function(){return go(F2(this.rgba,-1))},i.prototype.lighten=function(e){return e===void 0&&(e=.1),go(PG(this.rgba,e))},i.prototype.darken=function(e){return e===void 0&&(e=.1),go(PG(this.rgba,-e))},i.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},i.prototype.alpha=function(e){return typeof e=="number"?go({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):ra(this.rgba.a,3);var t},i.prototype.hue=function(e){var t=xS(this.rgba);return typeof e=="number"?go({h:e,s:t.s,l:t.l,a:t.a}):ra(t.h)},i.prototype.isEqual=function(e){return this.toHex()===go(e).toHex()},i})(),go=function(i){return i instanceof lB?i:new lB(i)},FG=[],$xe=function(i){i.forEach(function(e){FG.indexOf(e)<0&&(e(lB,oB),FG.push(e))})};function Kxe(i,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var s in t)n[t[s]]=s;var r={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,u=n[this.toHex()];if(u)return u;if(a?.closest){var f=this.toRgb(),p=1/0,x="black";if(!r.length)for(var y in t)r[y]=new i(t[y]).toRgb();for(var _ in t){var T=(o=f,l=r[_],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));T<p&&(p=T,x=_)}return x}},e.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":t[o];return l?new i(l).toRgb():null},"name"])}function Ov(){return(Ov=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i}).apply(this,arguments)}function iL(i,e){if(i==null)return{};var t,n,s={},r=Object.keys(i);for(n=0;n<r.length;n++)e.indexOf(t=r[n])>=0||(s[t]=i[t]);return s}function cB(i){var e=G.useRef(i),t=G.useRef(function(n){e.current&&e.current(n)});return e.current=i,t.current}var Zy=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),i>t?t:i<e?e:i},yS=function(i){return"touches"in i},uB=function(i){return i&&i.ownerDocument.defaultView||self},GG=function(i,e,t){var n=i.getBoundingClientRect(),s=yS(e)?(function(r,a){for(var o=0;o<r.length;o++)if(r[o].identifier===a)return r[o];return r[0]})(e.touches,t):e;return{left:Zy((s.pageX-(n.left+uB(i).pageXOffset))/n.width),top:Zy((s.pageY-(n.top+uB(i).pageYOffset))/n.height)}},zG=function(i){!yS(i)&&i.preventDefault()},sL=ue.memo(function(i){var e=i.onMove,t=i.onKey,n=iL(i,["onMove","onKey"]),s=G.useRef(null),r=cB(e),a=cB(t),o=G.useRef(null),l=G.useRef(!1),u=G.useMemo(function(){var y=function(A){zG(A),(yS(A)?A.touches.length>0:A.buttons>0)&&s.current?r(GG(s.current,A,o.current)):T(!1)},_=function(){return T(!1)};function T(A){var S=l.current,C=uB(s.current),w=A?C.addEventListener:C.removeEventListener;w(S?"touchmove":"mousemove",y),w(S?"touchend":"mouseup",_)}return[function(A){var S=A.nativeEvent,C=s.current;if(C&&(zG(S),!(function(B,L){return L&&!yS(B)})(S,l.current)&&C)){if(yS(S)){l.current=!0;var w=S.changedTouches||[];w.length&&(o.current=w[0].identifier)}C.focus(),r(GG(C,S,o.current)),T(!0)}},function(A){var S=A.which||A.keyCode;S<37||S>40||(A.preventDefault(),a({left:S===39?.05:S===37?-.05:0,top:S===40?.05:S===38?-.05:0}))},T]},[a,r]),f=u[0],p=u[1],x=u[2];return G.useEffect(function(){return x},[x]),ue.createElement("div",Ov({},n,{onTouchStart:f,onMouseDown:f,className:"react-colorful__interactive",ref:s,onKeyDown:p,tabIndex:0,role:"slider"}))}),oA=function(i){return i.filter(Boolean).join(" ")},rL=function(i){var e=i.color,t=i.left,n=i.top,s=n===void 0?.5:n,r=oA(["react-colorful__pointer",i.className]);return ue.createElement("div",{className:r,style:{top:100*s+"%",left:100*t+"%"}},ue.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},Eo=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*i)/t},vX=function(i){var e=i.s,t=i.v,n=i.a,s=(200-e)*t/100;return{h:Eo(i.h),s:Eo(s>0&&s<200?e*t/100/(s<=100?s:200-s)*100:0),l:Eo(s/2),a:Eo(n,2)}},dB=function(i){var e=vX(i);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},z2=function(i){var e=vX(i);return"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"},_X=function(i){var e=i.h,t=i.s,n=i.v,s=i.a;e=e/360*6,t/=100,n/=100;var r=Math.floor(e),a=n*(1-t),o=n*(1-(e-r)*t),l=n*(1-(1-e+r)*t),u=r%6;return{r:Eo(255*[n,o,a,a,l,n][u]),g:Eo(255*[l,n,n,o,a,a][u]),b:Eo(255*[a,a,l,n,n,o][u]),a:Eo(s,2)}},bX=function(i){var e=i.r,t=i.g,n=i.b,s=i.a,r=Math.max(e,t,n),a=r-Math.min(e,t,n),o=a?r===e?(t-n)/a:r===t?2+(n-e)/a:4+(e-t)/a:0;return{h:Eo(60*(o<0?o+6:o)),s:Eo(r?a/r*100:0),v:Eo(r/255*100),a:s}},SX=ue.memo(function(i){var e=i.hue,t=i.onChange,n=oA(["react-colorful__hue",i.className]);return ue.createElement("div",{className:n},ue.createElement(sL,{onMove:function(s){t({h:360*s.left})},onKey:function(s){t({h:Zy(e+360*s.left,0,360)})},"aria-label":"Hue","aria-valuenow":Eo(e),"aria-valuemax":"360","aria-valuemin":"0"},ue.createElement(rL,{className:"react-colorful__hue-pointer",left:e/360,color:dB({h:e,s:100,v:100,a:1})})))}),TX=ue.memo(function(i){var e=i.hsva,t=i.onChange,n={backgroundColor:dB({h:e.h,s:100,v:100,a:1})};return ue.createElement("div",{className:"react-colorful__saturation",style:n},ue.createElement(sL,{onMove:function(s){t({s:100*s.left,v:100-100*s.top})},onKey:function(s){t({s:Zy(e.s+100*s.left,0,100),v:Zy(e.v-100*s.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Eo(e.s)+"%, Brightness "+Eo(e.v)+"%"},ue.createElement(rL,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:dB(e)})))}),aL=function(i,e){if(i===e)return!0;for(var t in i)if(i[t]!==e[t])return!1;return!0};function AX(i,e,t){var n=cB(t),s=G.useState(function(){return i.toHsva(e)}),r=s[0],a=s[1],o=G.useRef({color:e,hsva:r});G.useEffect(function(){if(!i.equal(e,o.current.color)){var u=i.toHsva(e);o.current={hsva:u,color:e},a(u)}},[e,i]),G.useEffect(function(){var u;aL(r,o.current.hsva)||i.equal(u=i.fromHsva(r),o.current.color)||(o.current={hsva:r,color:u},n(u))},[r,i,n]);var l=G.useCallback(function(u){a(function(f){return Object.assign({},f,u)})},[]);return[r,l]}var Jxe=typeof window<"u"?G.useLayoutEffect:G.useEffect,Zxe=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},VG=new Map,EX=function(i){Jxe(function(){var e=i.current?i.current.ownerDocument:document;if(e!==void 0&&!VG.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,VG.set(e,t);var n=Zxe();n&&t.setAttribute("nonce",n),e.head.appendChild(t)}},[])},Qxe=function(i){var e=i.className,t=i.colorModel,n=i.color,s=n===void 0?t.defaultColor:n,r=i.onChange,a=iL(i,["className","colorModel","color","onChange"]),o=G.useRef(null);EX(o);var l=AX(t,s,r),u=l[0],f=l[1],p=oA(["react-colorful",e]);return ue.createElement("div",Ov({},a,{ref:o,className:p}),ue.createElement(TX,{hsva:u,onChange:f}),ue.createElement(SX,{hue:u.h,onChange:f,className:"react-colorful__last-control"}))},eye=function(i){var e=i.className,t=i.hsva,n=i.onChange,s={backgroundImage:"linear-gradient(90deg, "+z2(Object.assign({},t,{a:0}))+", "+z2(Object.assign({},t,{a:1}))+")"},r=oA(["react-colorful__alpha",e]),a=Eo(100*t.a);return ue.createElement("div",{className:r},ue.createElement("div",{className:"react-colorful__alpha-gradient",style:s}),ue.createElement(sL,{onMove:function(o){n({a:o.left})},onKey:function(o){n({a:Zy(t.a+o.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},ue.createElement(rL,{className:"react-colorful__alpha-pointer",left:t.a,color:z2(t)})))},tye=function(i){var e=i.className,t=i.colorModel,n=i.color,s=n===void 0?t.defaultColor:n,r=i.onChange,a=iL(i,["className","colorModel","color","onChange"]),o=G.useRef(null);EX(o);var l=AX(t,s,r),u=l[0],f=l[1],p=oA(["react-colorful",e]);return ue.createElement("div",Ov({},a,{ref:o,className:p}),ue.createElement(TX,{hsva:u,onChange:f}),ue.createElement(SX,{hue:u.h,onChange:f}),ue.createElement(eye,{hsva:u,onChange:f,className:"react-colorful__last-control"}))},nye={defaultColor:{r:0,g:0,b:0,a:1},toHsva:bX,fromHsva:_X,equal:aL},iye=function(i){return ue.createElement(tye,Ov({},i,{colorModel:nye}))},sye={defaultColor:{r:0,g:0,b:0},toHsva:function(i){return bX({r:i.r,g:i.g,b:i.b,a:1})},fromHsva:function(i){return{r:(e=_X(i)).r,g:e.g,b:e.b};var e},equal:aL},rye=function(i){return ue.createElement(Qxe,Ov({},i,{colorModel:sye}))},V2={exports:{}},H2,HG;function aye(){if(HG)return H2;HG=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return H2=i,H2}var k2,kG;function oye(){if(kG)return k2;kG=1;var i=aye();function e(){}function t(){}return t.resetWarningCache=e,k2=function(){function n(a,o,l,u,f,p){if(p!==i){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}n.isRequired=n;function s(){return n}var r={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return r.PropTypes=r,r},k2}var WG;function lye(){return WG||(WG=1,V2.exports=oye()()),V2.exports}var cye=lye();const vs=$p(cye);function Uv(i,e,t,n){function s(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(f){try{u(n.next(f))}catch(p){a(p)}}function l(f){try{u(n.throw(f))}catch(p){a(p)}}function u(f){f.done?r(f.value):s(f.value).then(o,l)}u((n=n.apply(i,e||[])).next())})}function Lv(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(t=0)),t;)try{if(n=1,s&&(r=u[0]&2?s.return:u[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,u[1])).done)return r;switch(s=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){t.label=u[1];break}if(u[0]===6&&t.label<r[1]){t.label=r[1],r=u;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(u);break}r[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(f){u=[6,f],s=0}finally{n=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function uye(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var n=t.call(i),s,r=[],a;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)r.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return r}function dye(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(uye(arguments[e]));return i}var fye=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function lA(i,e){var t=hye(i);if(typeof t.path!="string"){var n=i.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof e=="string"?e:typeof n=="string"&&n.length>0?n:i.name,writable:!1,configurable:!1,enumerable:!0})}return t}function hye(i){var e=i.name,t=e&&e.lastIndexOf(".")!==-1;if(t&&!i.type){var n=e.split(".").pop().toLowerCase(),s=fye.get(n);s&&Object.defineProperty(i,"type",{value:s,writable:!1,configurable:!1,enumerable:!0})}return i}var pye=[".DS_Store","Thumbs.db"];function mye(i){return Uv(this,void 0,void 0,function(){return Lv(this,function(e){return ZM(i)&&gye(i)?[2,_ye(i.dataTransfer,i.type)]:xye(i)?[2,yye(i)]:Array.isArray(i)&&i.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,vye(i)]:[2,[]]})})}function gye(i){return ZM(i.dataTransfer)}function xye(i){return ZM(i)&&ZM(i.target)}function ZM(i){return typeof i=="object"&&i!==null}function yye(i){return fB(i.target.files).map(function(e){return lA(e)})}function vye(i){return Uv(this,void 0,void 0,function(){var e;return Lv(this,function(t){switch(t.label){case 0:return[4,Promise.all(i.map(function(n){return n.getFile()}))];case 1:return e=t.sent(),[2,e.map(function(n){return lA(n)})]}})})}function _ye(i,e){return Uv(this,void 0,void 0,function(){var t,n;return Lv(this,function(s){switch(s.label){case 0:return i===null?[2,[]]:i.items?(t=fB(i.items).filter(function(r){return r.kind==="file"}),e!=="drop"?[2,t]:[4,Promise.all(t.map(bye))]):[3,2];case 1:return n=s.sent(),[2,XG(MX(n))];case 2:return[2,XG(fB(i.files).map(function(r){return lA(r)}))]}})})}function XG(i){return i.filter(function(e){return pye.indexOf(e.name)===-1})}function fB(i){if(i===null)return[];for(var e=[],t=0;t<i.length;t++){var n=i[t];e.push(n)}return e}function bye(i){if(typeof i.webkitGetAsEntry!="function")return qG(i);var e=i.webkitGetAsEntry();return e&&e.isDirectory?CX(e):qG(i)}function MX(i){return i.reduce(function(e,t){return dye(e,Array.isArray(t)?MX(t):[t])},[])}function qG(i){var e=i.getAsFile();if(!e)return Promise.reject(i+" is not a File");var t=lA(e);return Promise.resolve(t)}function Sye(i){return Uv(this,void 0,void 0,function(){return Lv(this,function(e){return[2,i.isDirectory?CX(i):Tye(i)]})})}function CX(i){var e=i.createReader();return new Promise(function(t,n){var s=[];function r(){var a=this;e.readEntries(function(o){return Uv(a,void 0,void 0,function(){var l,u,f;return Lv(this,function(p){switch(p.label){case 0:if(o.length)return[3,5];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Promise.all(s)];case 2:return l=p.sent(),t(l),[3,4];case 3:return u=p.sent(),n(u),[3,4];case 4:return[3,6];case 5:f=Promise.all(o.map(Sye)),s.push(f),r(),p.label=6;case 6:return[2]}})})},function(o){n(o)})}r()})}function Tye(i){return Uv(this,void 0,void 0,function(){return Lv(this,function(e){return[2,new Promise(function(t,n){i.file(function(s){var r=lA(s,i.fullPath);t(r)},function(s){n(s)})})]})})}var eM={},YG;function Aye(){return YG||(YG=1,eM.__esModule=!0,eM.default=function(i,e){if(i&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var n=i.name||"",s=(i.type||"").toLowerCase(),r=s.replace(/\/.*$/,"");return t.some(function(a){var o=a.trim().toLowerCase();return o.charAt(0)==="."?n.toLowerCase().endsWith(o):o.endsWith("/*")?r===o.replace(/\/.*$/,""):s===o})}return!0}),eM}var Eye=Aye();const Mye=$p(Eye);function jG(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function $G(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jG(Object(t),!0).forEach(function(n){RX(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):jG(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function RX(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function KG(i,e){return Nye(i)||wye(i,e)||Rye(i,e)||Cye()}function Cye(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rye(i,e){if(i){if(typeof i=="string")return JG(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return JG(i,e)}}function JG(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function wye(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n=[],s=!0,r=!1,a,o;try{for(t=t.call(i);!(s=(a=t.next()).done)&&(n.push(a.value),!(e&&n.length===e));s=!0);}catch(l){r=!0,o=l}finally{try{!s&&t.return!=null&&t.return()}finally{if(r)throw o}}return n}}function Nye(i){if(Array.isArray(i))return i}var Bye="file-invalid-type",Dye="file-too-large",Oye="file-too-small",Uye="too-many-files",Lye=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:Bye,message:"File type must be ".concat(t)}},ZG=function(e){return{code:Dye,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},QG=function(e){return{code:Oye,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Iye={code:Uye,message:"Too many files"};function wX(i,e){var t=i.type==="application/x-moz-file"||Mye(i,e);return[t,t?null:Lye(e)]}function NX(i,e,t){if(jb(i.size))if(jb(e)&&jb(t)){if(i.size>t)return[!1,ZG(t)];if(i.size<e)return[!1,QG(e)]}else{if(jb(e)&&i.size<e)return[!1,QG(e)];if(jb(t)&&i.size>t)return[!1,ZG(t)]}return[!0,null]}function jb(i){return i!=null}function Pye(i){var e=i.files,t=i.accept,n=i.minSize,s=i.maxSize,r=i.multiple,a=i.maxFiles;return!r&&e.length>1||r&&a>=1&&e.length>a?!1:e.every(function(o){var l=wX(o,t),u=KG(l,1),f=u[0],p=NX(o,n,s),x=KG(p,1),y=x[0];return f&&y})}function QM(i){return typeof i.isPropagationStopped=="function"?i.isPropagationStopped():typeof i.cancelBubble<"u"?i.cancelBubble:!1}function tM(i){return i.dataTransfer?Array.prototype.some.call(i.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!i.target&&!!i.target.files}function ez(i){i.preventDefault()}function Fye(i){return i.indexOf("MSIE")!==-1||i.indexOf("Trident/")!==-1}function Gye(i){return i.indexOf("Edge/")!==-1}function zye(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Fye(i)||Gye(i)}function rd(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(n){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return e.some(function(o){return!QM(n)&&o&&o.apply(void 0,[n].concat(r)),QM(n)})}}function Vye(){return"showOpenFilePicker"in window}function Hye(i){return i=typeof i=="string"?i.split(","):i,[{description:"everything",accept:Array.isArray(i)?i.filter(function(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}).reduce(function(e,t){return $G($G({},e),{},RX({},t,[]))},{}):{}}]}function kye(i){return i instanceof DOMException&&(i.name==="AbortError"||i.code===i.ABORT_ERR)}function Wye(i){return i instanceof DOMException&&(i.name==="SecurityError"||i.code===i.SECURITY_ERR)}var Xye=["children"],qye=["open"],Yye=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],jye=["refKey","onChange","onClick"];function $ye(i){return Zye(i)||Jye(i)||BX(i)||Kye()}function Kye(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jye(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Zye(i){if(Array.isArray(i))return hB(i)}function W2(i,e){return tve(i)||eve(i,e)||BX(i,e)||Qye()}function Qye(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BX(i,e){if(i){if(typeof i=="string")return hB(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hB(i,e)}}function hB(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function eve(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n=[],s=!0,r=!1,a,o;try{for(t=t.call(i);!(s=(a=t.next()).done)&&(n.push(a.value),!(e&&n.length===e));s=!0);}catch(l){r=!0,o=l}finally{try{!s&&t.return!=null&&t.return()}finally{if(r)throw o}}return n}}function tve(i){if(Array.isArray(i))return i}function tz(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function Ws(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tz(Object(t),!0).forEach(function(n){pB(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):tz(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function pB(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function eC(i,e){if(i==null)return{};var t=nve(i,e),n,s;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(s=0;s<r.length;s++)n=r[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}function nve(i,e){if(i==null)return{};var t={},n=Object.keys(i),s,r;for(r=0;r<n.length;r++)s=n[r],!(e.indexOf(s)>=0)&&(t[s]=i[s]);return t}var oL=G.forwardRef(function(i,e){var t=i.children,n=eC(i,Xye),s=OX(n),r=s.open,a=eC(s,qye);return G.useImperativeHandle(e,function(){return{open:r}},[r]),ue.createElement(G.Fragment,null,t(Ws(Ws({},a),{},{open:r})))});oL.displayName="Dropzone";var DX={disabled:!1,getFilesFromEvent:mye,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};oL.defaultProps=DX;oL.propTypes={children:vs.func,accept:vs.oneOfType([vs.string,vs.arrayOf(vs.string)]),multiple:vs.bool,preventDropOnDocument:vs.bool,noClick:vs.bool,noKeyboard:vs.bool,noDrag:vs.bool,noDragEventsBubbling:vs.bool,minSize:vs.number,maxSize:vs.number,maxFiles:vs.number,disabled:vs.bool,getFilesFromEvent:vs.func,onFileDialogCancel:vs.func,onFileDialogOpen:vs.func,useFsAccessApi:vs.bool,onDragEnter:vs.func,onDragLeave:vs.func,onDragOver:vs.func,onDrop:vs.func,onDropAccepted:vs.func,onDropRejected:vs.func,validator:vs.func};var mB={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function OX(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Ws(Ws({},DX),i),t=e.accept,n=e.disabled,s=e.getFilesFromEvent,r=e.maxSize,a=e.minSize,o=e.multiple,l=e.maxFiles,u=e.onDragEnter,f=e.onDragLeave,p=e.onDragOver,x=e.onDrop,y=e.onDropAccepted,_=e.onDropRejected,T=e.onFileDialogCancel,A=e.onFileDialogOpen,S=e.useFsAccessApi,C=e.preventDropOnDocument,w=e.noClick,B=e.noKeyboard,L=e.noDrag,D=e.noDragEventsBubbling,O=e.validator,F=G.useMemo(function(){return typeof A=="function"?A:nz},[A]),U=G.useMemo(function(){return typeof T=="function"?T:nz},[T]),P=G.useRef(null),X=G.useRef(null),Z=G.useReducer(ive,mB),ee=W2(Z,2),te=ee[0],re=ee[1],W=te.isFocused,ne=te.isFileDialogActive,se=te.draggedFiles,ge=G.useRef(typeof window<"u"&&window.isSecureContext&&S&&Vye()),_e=function(){!ge.current&&ne&&setTimeout(function(){if(X.current){var V=X.current.files;V.length||(re({type:"closeDialog"}),U())}},300)};G.useEffect(function(){return window.addEventListener("focus",_e,!1),function(){window.removeEventListener("focus",_e,!1)}},[X,ne,U,ge]);var K=G.useRef([]),pe=function(V){P.current&&P.current.contains(V.target)||(V.preventDefault(),K.current=[])};G.useEffect(function(){return C&&(document.addEventListener("dragover",ez,!1),document.addEventListener("drop",pe,!1)),function(){C&&(document.removeEventListener("dragover",ez),document.removeEventListener("drop",pe))}},[P,C]);var we=G.useCallback(function(q){q.preventDefault(),q.persist(),ot(q),K.current=[].concat($ye(K.current),[q.target]),tM(q)&&Promise.resolve(s(q)).then(function(V){QM(q)&&!D||(re({draggedFiles:V,isDragActive:!0,type:"setDraggedFiles"}),u&&u(q))})},[s,u,D]),Ne=G.useCallback(function(q){q.preventDefault(),q.persist(),ot(q);var V=tM(q);if(V&&q.dataTransfer)try{q.dataTransfer.dropEffect="copy"}catch{}return V&&p&&p(q),!1},[p,D]),gt=G.useCallback(function(q){q.preventDefault(),q.persist(),ot(q);var V=K.current.filter(function(Ge){return P.current&&P.current.contains(Ge)}),Te=V.indexOf(q.target);Te!==-1&&V.splice(Te,1),K.current=V,!(V.length>0)&&(re({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),tM(q)&&f&&f(q))},[P,f,D]),Se=G.useCallback(function(q,V){var Te=[],Ge=[];q.forEach(function($e){var Ve=wX($e,t),Xt=W2(Ve,2),Ot=Xt[0],cn=Xt[1],Qt=NX($e,a,r),et=W2(Qt,2),st=et[0],nn=et[1],zt=O?O($e):null;if(Ot&&st&&!zt)Te.push($e);else{var Mt=[cn,nn];zt&&(Mt=Mt.concat(zt)),Ge.push({file:$e,errors:Mt.filter(function(Kt){return Kt})})}}),(!o&&Te.length>1||o&&l>=1&&Te.length>l)&&(Te.forEach(function($e){Ge.push({file:$e,errors:[Iye]})}),Te.splice(0)),re({acceptedFiles:Te,fileRejections:Ge,type:"setFiles"}),x&&x(Te,Ge,V),Ge.length>0&&_&&_(Ge,V),Te.length>0&&y&&y(Te,V)},[re,o,t,a,r,l,x,y,_,O]),Be=G.useCallback(function(q){q.preventDefault(),q.persist(),ot(q),K.current=[],tM(q)&&Promise.resolve(s(q)).then(function(V){QM(q)&&!D||Se(V,q)}),re({type:"reset"})},[s,Se,D]),ct=G.useCallback(function(){if(ge.current){re({type:"openDialog"}),F();var q={multiple:o,types:Hye(t)};window.showOpenFilePicker(q).then(function(V){return s(V)}).then(function(V){Se(V,null),re({type:"closeDialog"})}).catch(function(V){kye(V)?(U(V),re({type:"closeDialog"})):Wye(V)&&(ge.current=!1,X.current&&(X.current.value=null,X.current.click()))});return}X.current&&(re({type:"openDialog"}),F(),X.current.value=null,X.current.click())},[re,F,U,S,Se,t,o]),Dt=G.useCallback(function(q){!P.current||!P.current.isEqualNode(q.target)||(q.key===" "||q.key==="Enter"||q.keyCode===32||q.keyCode===13)&&(q.preventDefault(),ct())},[P,ct]),Nt=G.useCallback(function(){re({type:"focus"})},[]),It=G.useCallback(function(){re({type:"blur"})},[]),Mn=G.useCallback(function(){w||(zye()?setTimeout(ct,0):ct())},[w,ct]),Gt=function(V){return n?null:V},Qe=function(V){return B?null:Gt(V)},ie=function(V){return L?null:Gt(V)},ot=function(V){D&&V.stopPropagation()},dt=G.useMemo(function(){return function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=q.refKey,Te=V===void 0?"ref":V,Ge=q.role,$e=q.onKeyDown,Ve=q.onFocus,Xt=q.onBlur,Ot=q.onClick,cn=q.onDragEnter,Qt=q.onDragOver,et=q.onDragLeave,st=q.onDrop,nn=eC(q,Yye);return Ws(Ws(pB({onKeyDown:Qe(rd($e,Dt)),onFocus:Qe(rd(Ve,Nt)),onBlur:Qe(rd(Xt,It)),onClick:Gt(rd(Ot,Mn)),onDragEnter:ie(rd(cn,we)),onDragOver:ie(rd(Qt,Ne)),onDragLeave:ie(rd(et,gt)),onDrop:ie(rd(st,Be)),role:typeof Ge=="string"&&Ge!==""?Ge:"button"},Te,P),!n&&!B?{tabIndex:0}:{}),nn)}},[P,Dt,Nt,It,Mn,we,Ne,gt,Be,B,L,n]),Tt=G.useCallback(function(q){q.stopPropagation()},[]),ht=G.useMemo(function(){return function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=q.refKey,Te=V===void 0?"ref":V,Ge=q.onChange,$e=q.onClick,Ve=eC(q,jye),Xt=pB({accept:t,multiple:o,type:"file",style:{display:"none"},onChange:Gt(rd(Ge,Be)),onClick:Gt(rd($e,Tt)),tabIndex:-1},Te,X);return Ws(Ws({},Xt),Ve)}},[X,t,o,Be,n]),Ut=se.length,At=Ut>0&&Pye({files:se,accept:t,minSize:a,maxSize:r,multiple:o,maxFiles:l}),Ht=Ut>0&&!At;return Ws(Ws({},te),{},{isDragAccept:At,isDragReject:Ht,isFocused:W&&!n,getRootProps:dt,getInputProps:ht,rootRef:P,inputRef:X,open:Gt(ct)})}function ive(i,e){switch(e.type){case"focus":return Ws(Ws({},i),{},{isFocused:!0});case"blur":return Ws(Ws({},i),{},{isFocused:!1});case"openDialog":return Ws(Ws({},mB),{},{isFileDialogActive:!0});case"closeDialog":return Ws(Ws({},i),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=e.isDragActive,n=e.draggedFiles;return Ws(Ws({},i),{},{draggedFiles:n,isDragActive:t});case"setFiles":return Ws(Ws({},i),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return Ws({},mB);default:return i}}function nz(){}function sve(i){let e;const t=new Set,n=(u,f)=>{const p=typeof u=="function"?u(e):u;if(p!==e){const x=e;e=f?p:Object.assign({},e,p),t.forEach(y=>y(e,x))}},s=()=>e,r=(u,f=s,p=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let x=f(e);function y(){const _=f(e);if(!p(x,_)){const T=x;u(x=_,T)}}return t.add(y),()=>t.delete(y)},l={setState:n,getState:s,subscribe:(u,f,p)=>f||p?r(u,f,p):(t.add(u),()=>t.delete(u)),destroy:()=>t.clear()};return e=i(n,s,l),l}const rve=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),iz=rve?G.useEffect:G.useLayoutEffect;function ave(i){const e=typeof i=="function"?sve(i):i,t=(n=e.getState,s=Object.is)=>{const[,r]=G.useReducer(A=>A+1,0),a=e.getState(),o=G.useRef(a),l=G.useRef(n),u=G.useRef(s),f=G.useRef(!1),p=G.useRef();p.current===void 0&&(p.current=n(a));let x,y=!1;(o.current!==a||l.current!==n||u.current!==s||f.current)&&(x=n(a),y=!s(p.current,x)),iz(()=>{y&&(p.current=x),o.current=a,l.current=n,u.current=s,f.current=!1});const _=G.useRef(a);iz(()=>{const A=()=>{try{const C=e.getState(),w=l.current(C);u.current(p.current,w)||(o.current=C,p.current=w,r())}catch{f.current=!0,r()}},S=e.subscribe(A);return e.getState()!==_.current&&A(),S},[]);const T=y?x:p.current;return G.useDebugValue(T),T};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const s=n.length<=0;return{value:n.shift(),done:s}}}},t}const ove=i=>(e,t,n)=>{const s=n.subscribe;return n.subscribe=(a,o,l)=>{let u=a;if(o){const f=l?.equalityFn||Object.is;let p=a(n.getState());u=x=>{const y=a(x);if(!f(p,y)){const _=p;o(p=y,_)}},l?.fireImmediately&&o(p,p)}return s(u)},i(e,t,n)};var X2,sz;function lve(){return sz||(sz=1,X2=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),X2}var q2,rz;function UX(){if(rz)return q2;rz=1;var i=lve();function e(t){return i(t)===!0&&Object.prototype.toString.call(t)==="[object Object]"}return q2=function(n){var s,r;return!(e(n)===!1||(s=n.constructor,typeof s!="function")||(r=s.prototype,e(r)===!1)||r.hasOwnProperty("isPrototypeOf")===!1)},q2}var Y2,az;function lL(){if(az)return Y2;az=1;var i=UX();return Y2=function(t){return i(t)||typeof t=="function"||Array.isArray(t)},Y2}var j2,oz;function cve(){return oz||(oz=1,j2=function(e,t,n){for(var s in e)if(t.call(n,e[s],s,e)===!1)break}),j2}var $2,lz;function uve(){if(lz)return $2;lz=1;var i=lL(),e=cve();function t(a,o){for(var l=arguments.length,u=0;++u<l;){var f=arguments[u];s(f)&&e(f,n,a)}return a}function n(a,o){if(r(o)){var l=this[o];s(a)&&s(l)?t(l,a):this[o]=a}}function s(a){return i(a)&&!Array.isArray(a)}function r(a){return a!=="__proto__"&&a!=="constructor"&&a!=="prototype"}return $2=t,$2}var K2,cz;function dve(){if(cz)return K2;cz=1,K2=function(t,n,s,r,a){if(!i(t)||!n)return t;if(n=e(n),s&&(n+="."+e(s)),r&&(n+="."+e(r)),a&&(n+="."+e(a)),n in t)return t[n];for(var o=n.split("."),l=o.length,u=-1;t&&++u<l;){for(var f=o[u];f[f.length-1]==="\\";)f=f.slice(0,-1)+"."+o[++u];t=t[f]}return t};function i(t){return t!==null&&(typeof t=="object"||typeof t=="function")}function e(t){return t?Array.isArray(t)?t.join("."):t:""}return K2}var J2,uz;function fve(){return uz||(uz=1,J2=function(i,e){if(i===null||typeof i>"u")throw new TypeError("expected first argument to be an object.");if(typeof e>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return i;for(var t=Object.prototype.propertyIsEnumerable,n=Object(i),s=arguments.length,r=0;++r<s;)for(var a=Object(arguments[r]),o=Object.getOwnPropertySymbols(a),l=0;l<o.length;l++){var u=o[l];t.call(a,u)&&(n[u]=a[u])}return n}),J2}var Z2,dz;function hve(){if(dz)return Z2;dz=1;var i=lL(),e=fve();Z2=Object.assign||function(o){if(o===null||typeof o>"u")throw new TypeError("Cannot convert undefined or null to object");r(o)||(o={});for(var l=1;l<arguments.length;l++){var u=arguments[l];n(u)&&(u=s(u)),r(u)&&(t(o,u),e(o,u))}return o};function t(o,l){for(var u in l)a(l,u)&&(o[u]=l[u])}function n(o){return o&&typeof o=="string"}function s(o){var l={};for(var u in o)l[u]=o[u];return l}function r(o){return o&&typeof o=="object"||i(o)}function a(o,l){return Object.prototype.hasOwnProperty.call(o,l)}return Z2}var Q2,fz;function pve(){if(fz)return Q2;fz=1;var i=hve();Q2=function(s,r,a){if(typeof s!="string")throw new TypeError("expected a string");typeof r=="function"&&(a=r,r=null),typeof r=="string"&&(r={sep:r});var o=i({sep:"."},r),l=o.quotes||['"',"'","`"],u;o.brackets===!0?u={"<":">","(":")","[":"]","{":"}"}:o.brackets&&(u=o.brackets);var f=[],p=[],x=[""],y=o.sep,_=s.length,T=-1,A;function S(){if(u&&p.length)return u[p[p.length-1]]}for(;++T<_;){var C=s[T],w=s[T+1],B={val:C,idx:T,arr:x,str:s};if(f.push(B),C==="\\"){B.val=n(o,s,T)===!0?C+w:w,B.escaped=!0,typeof a=="function"&&a(B),x[x.length-1]+=B.val,T++;continue}if(u&&u[C]){p.push(C);var L=S(),D=T+1;if(s.indexOf(L,D+1)!==-1)for(;p.length&&D<_;){var O=s[++D];if(O==="\\"){O++;continue}if(l.indexOf(O)!==-1){D=e(s,O,D+1);continue}if(L=S(),p.length&&s.indexOf(L,D+1)===-1)break;if(u[O]){p.push(O);continue}L===O&&p.pop()}if(A=D,A===-1){x[x.length-1]+=C;continue}C=s.slice(T,A+1),B.val=C,B.idx=T=A}if(l.indexOf(C)!==-1){if(A=e(s,C,T+1),A===-1){x[x.length-1]+=C;continue}t(C,o)===!0?C=s.slice(T,A+1):C=s.slice(T+1,A),B.val=C,B.idx=T=A}if(typeof a=="function"&&(a(B,f),C=B.val,T=B.idx),B.val===y&&B.split!==!1){x.push("");continue}x[x.length-1]+=B.val}return x};function e(s,r,a,o){var l=s.indexOf(r,a);return s.charAt(l-1)==="\\"?e(s,r,l+1):l}function t(s,r){return r.keepDoubleQuotes===!0&&s==='"'||r.keepSingleQuotes===!0&&s==="'"?!0:r.keepQuotes}function n(s,r,a){return typeof s.keepEscaping=="function"?s.keepEscaping(r,a):s.keepEscaping===!0||r[a+1]==="\\"}return Q2}var eN,hz;function mve(){return hz||(hz=1,eN=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),eN}var tN,pz;function gve(){if(pz)return tN;pz=1;var i=mve();tN=function(s){i(s)||(s={});for(var r=arguments.length,a=1;a<r;a++){var o=arguments[a];i(o)&&e(s,o)}return s};function e(n,s){for(var r in s)t(s,r)&&(n[r]=s[r])}function t(n,s){return Object.prototype.hasOwnProperty.call(n,s)}return tN}var nN,mz;function xve(){return mz||(mz=1,nN=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),nN}var iN,gz;function yve(){if(gz)return iN;gz=1;var i=pve(),e=gve(),t=UX(),n=xve();iN=function(r,a,o){if(!n(r)||(Array.isArray(a)&&(a=[].concat.apply([],a).join(".")),typeof a!="string"))return r;for(var l=i(a,{sep:".",brackets:!0}).filter(s),u=l.length,f=-1,p=r;++f<u;){var x=l[f];if(f!==u-1){n(p[x])||(p[x]={}),p=p[x];continue}t(p[x])&&t(o)?p[x]=e({},p[x],o):p[x]=o}return r};function s(r){return r!=="__proto__"&&r!=="constructor"&&r!=="prototype"}return iN}var sN,xz;function vve(){if(xz)return sN;xz=1;var i=lL(),e=uve(),t=dve(),n=yve();return sN=function(r,a,o){if(!i(r))throw new TypeError("expected an object");if(typeof a!="string"||o==null)return e.apply(null,arguments);if(typeof o=="string")return n(r,a,o),r;var l=t(r,a);return i(o)&&i(l)&&(o=e({},l,o)),n(r,a,o),r},sN}var _ve=vve();const bve=$p(_ve),cL=(...i)=>i.filter(Boolean).join(".");function Sve(i){const e=i.split(".");return[e.pop(),e.join(".")||void 0]}function Tve(i,e){return Object.entries(h0e(i,e)).reduce((t,[,{value:n,disabled:s,key:r}])=>(t[r]=s?void 0:n,t),{})}function Ave(i,e){const t=G.useRef();return kS(i,t.current)||(t.current=i),t.current}function LX(i,e){var t;return G.useMemo(i,(t=Ave(e))!==null&&t!==void 0?t:[])}function Eve(i){const e=G.useRef(null),t=G.useRef(null),n=G.useRef(!0);return G.useLayoutEffect(()=>{i||(e.current.style.height="0px",e.current.style.overflow="hidden")},[]),G.useEffect(()=>{if(n.current){n.current=!1;return}let s;const r=e.current,a=()=>{i&&(r.style.removeProperty("height"),r.style.removeProperty("overflow"),t.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};r.addEventListener("transitionend",a,{once:!0});const{height:o}=t.current.getBoundingClientRect();return r.style.height=o+"px",i||(r.style.overflow="hidden",s=window.setTimeout(()=>r.style.height="0px",50)),()=>{r.removeEventListener("transitionend",a),clearTimeout(s)}},[i]),{wrapperRef:e,contentRef:t}}const Mve=i=>{const[e,t]=G.useState(i.getVisiblePaths());return G.useEffect(()=>{t(i.getVisiblePaths());const n=i.useStore.subscribe(i.getVisiblePaths,t,{equalityFn:z3});return()=>n()},[i]),e};function Cve(i,e,t){return i.useStore(s=>{const r=In(In({},t),s.data);return Tve(r,e)},z3)}function IX(i=3){const e=G.useRef(null),t=G.useRef(null),[n,s]=G.useState(!1),r=G.useCallback(()=>s(!0),[]),a=G.useCallback(()=>s(!1),[]);return G.useLayoutEffect(()=>{if(n){const{bottom:o,top:l,left:u}=e.current.getBoundingClientRect(),{height:f}=t.current.getBoundingClientRect(),p=o+f>window.innerHeight-40?"up":"down";t.current.style.position="fixed",t.current.style.zIndex="10000",t.current.style.left=u+"px",p==="down"?t.current.style.top=o+i+"px":t.current.style.bottom=window.innerHeight-l+i+"px"}},[i,n]),{popinRef:e,wrapperRef:t,shown:n,show:r,hide:a}}$xe([Kxe]);const Rve={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};Ko.extend({color:()=>i=>go(i).isValid()});const wve=i=>Ko().color().test(i);function PX(i,{format:e,hasAlpha:t,isString:n}){const s=Rve[e]+(n&&e!=="hex"?"String":""),r=i[s]();return typeof r=="object"&&!t?p0e(r,["a"]):r}const FX=(i,e)=>{const t=go(i);if(!t.isValid())throw Error("Invalid color");return PX(t,e)},Nve=(i,e)=>PX(go(i),In(In({},e),{},{isString:!0,format:"hex"})),Bve=({value:i})=>{const e=jxe(i),t=e==="name"?"hex":e,n=typeof i=="object"?"a"in i:e==="hex"&&i.length===8||/^(rgba)|(hsla)|(hsva)/.test(i),s={format:t,hasAlpha:n,isString:typeof i=="string"};return{value:FX(i,s),settings:s}};var Dve=Object.freeze({__proto__:null,schema:wve,sanitize:FX,format:Nve,normalize:Bve});const Ove=Rn("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),Uve=Rn("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),Lve=Rn("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function yz(i,e){return e!=="rgb"?go(i).toRgb():i}function Ive({value:i,displayValue:e,settings:t,onUpdate:n}){const{emitOnEditStart:s,emitOnEditEnd:r}=Ya(),{format:a,hasAlpha:o}=t,{popinRef:l,wrapperRef:u,shown:f,show:p,hide:x}=IX(),y=G.useRef(0),[_,T]=G.useState(()=>yz(i,a)),A=o?iye:rye,S=()=>{T(yz(i,a)),p(),s()},C=()=>{x(),r(),window.clearTimeout(y.current)},w=()=>{y.current=window.setTimeout(C,500)};return G.useEffect(()=>()=>window.clearTimeout(y.current),[]),ue.createElement(ue.Fragment,null,ue.createElement(Ove,{ref:l,active:f,onClick:()=>S(),style:{color:e}}),f&&ue.createElement(eL,null,ue.createElement(aX,{onPointerUp:C}),ue.createElement(Lve,{ref:u,onMouseEnter:()=>window.clearTimeout(y.current),onMouseLeave:B=>B.buttons===0&&w()},ue.createElement(A,{color:_,onChange:n}))))}function Pve(){const{value:i,displayValue:e,label:t,onChange:n,onUpdate:s,settings:r}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,t),ue.createElement(Uve,null,ue.createElement(Ive,{value:i,displayValue:e,onChange:n,onUpdate:s,settings:r}),ue.createElement(QU,{value:e,onChange:n,onUpdate:s})))}var Fve=In({component:Pve},Dve);function Gve(){const{label:i,displayValue:e,onUpdate:t,settings:n}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(nL,{value:e,settings:n,onUpdate:t}))}var zve=In({component:Gve},pX(["x","y","z"]));const Vve=Rn("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),Hve=Rn("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function kve({value:i,settings:e,onUpdate:t}){const n=G.useRef(),s=G.useRef(0),r=G.useRef(0),a=G.useRef(1),[o,l]=G.useState(!1),[u,f]=G.useState(!1),[p,x]=lX(),y=G.useRef(null),_=G.useRef(null);G.useLayoutEffect(()=>{if(o){const{top:Z,left:ee,width:te,height:re}=y.current.getBoundingClientRect();_.current.style.left=ee+te/2+"px",_.current.style.top=Z+re/2+"px"}},[o]);const{keys:[T,A],joystick:S}=e,C=S==="invertY"?1:-1,{[T]:{step:w},[A]:{step:B}}=e,L=Gf("sizes","joystickWidth"),D=Gf("sizes","joystickHeight"),O=parseFloat(L)*.8/2,F=parseFloat(D)*.8/2,U=G.useCallback(()=>{n.current||(f(!0),s.current&&x({x:s.current*O}),r.current&&x({y:r.current*-F}),n.current=window.setInterval(()=>{t(Z=>{const ee=w*s.current*a.current,te=C*B*r.current*a.current;return Array.isArray(Z)?{[T]:Z[0]+ee,[A]:Z[1]+te}:{[T]:Z[T]+ee,[A]:Z[A]+te}})},16))},[O,F,t,x,w,B,T,A,C]),P=G.useCallback(()=>{window.clearTimeout(n.current),n.current=void 0,f(!1)},[]);G.useEffect(()=>{function Z(ee){a.current=qW(ee)}return window.addEventListener("keydown",Z),window.addEventListener("keyup",Z),()=>{window.clearTimeout(n.current),window.removeEventListener("keydown",Z),window.removeEventListener("keyup",Z)}},[]);const X=aA(({first:Z,active:ee,delta:[te,re],movement:[W,ne]})=>{Z&&l(!0);const se=jp(W,-O,O),ge=jp(ne,-F,F);s.current=Math.abs(W)>Math.abs(se)?Math.sign(W-se):0,r.current=Math.abs(ne)>Math.abs(ge)?Math.sign(ge-ne):0;let _e=i[T],K=i[A];ee?(s.current||(_e+=te*w*a.current,x({x:se})),r.current||(K-=C*re*B*a.current,x({y:ge})),s.current||r.current?U():P(),t({[T]:_e,[A]:K})):(l(!1),s.current=0,r.current=0,x({x:0,y:0}),P())});return ue.createElement(Vve,sr({ref:y},X()),o&&ue.createElement(eL,null,ue.createElement(Hve,{ref:_,isOutOfBounds:u},ue.createElement("div",null),ue.createElement("span",{ref:p}))))}const Wve=Rn("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function Xve(){const{label:i,displayValue:e,onUpdate:t,settings:n}=Ya();return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(Wve,{withJoystick:!!n.joystick},n.joystick&&ue.createElement(kve,{value:e,settings:n,onUpdate:t}),ue.createElement(nL,{value:e,settings:n,onUpdate:t})))}const qve=["joystick"],GX=pX(["x","y"]),Yve=i=>{let{joystick:e=!0}=i,t=fs(i,qve);const{value:n,settings:s}=GX.normalize(t);return{value:n,settings:In(In({},s),{},{joystick:e})}};var jve=In(In({component:Xve},GX),{},{normalize:Yve});const $ve=i=>{if(i!==void 0){if(i instanceof File)try{return URL.createObjectURL(i)}catch{return}if(typeof i=="string"&&i.indexOf("blob:")===0)return i;throw Error("Invalid image format [undefined | blob |File].")}},Kve=(i,e)=>typeof e=="object"&&"image"in e,Jve=({image:i})=>({value:i});var Zve=Object.freeze({__proto__:null,sanitize:$ve,schema:Kve,normalize:Jve});const Qve=Rn("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),e_e=Rn("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),t_e=Rn("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),n_e=Rn("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),i_e=Rn("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),s_e=Rn("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function r_e(){const{label:i,value:e,onUpdate:t,disabled:n}=Ya(),{popinRef:s,wrapperRef:r,shown:a,show:o,hide:l}=IX(),u=G.useCallback(_=>{_.length&&t(_[0])},[t]),f=G.useCallback(_=>{_.stopPropagation(),t(void 0)},[t]),{getRootProps:p,getInputProps:x,isDragAccept:y}=OX({maxFiles:1,accept:"image/*",onDrop:u,disabled:n});return ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(Qve,null,ue.createElement(t_e,{ref:s,hasImage:!!e,onPointerDown:()=>!!e&&o(),onPointerUp:l,style:{backgroundImage:e?`url(${e})`:"none"}}),a&&!!e&&ue.createElement(eL,null,ue.createElement(aX,{onPointerUp:l,style:{cursor:"pointer"}}),ue.createElement(n_e,{ref:r,style:{backgroundImage:`url(${e})`}})),ue.createElement(e_e,p({isDragAccept:y}),ue.createElement("input",x()),ue.createElement(i_e,null,y?"drop image":"click or drop")),ue.createElement(s_e,{onClick:f,disabled:!e})))}var a_e=In({component:r_e},Zve);const vz=Ko().number(),o_e=(i,e)=>Ko().array().length(2).every.number().test(i)&&Ko().schema({min:vz,max:vz}).test(e),tC=i=>({min:i[0],max:i[1]}),zX=(i,{bounds:[e,t]},n)=>{const s=Array.isArray(i)?tC(i):i,r={min:n[0],max:n[1]},{min:a,max:o}=In(In({},r),s);return[jp(Number(a),e,Math.max(e,o)),jp(Number(o),Math.min(t,a),t)]},l_e=({value:i,min:e,max:t})=>{const n={min:e,max:t},s=hX(tC(i),{min:n,max:n}),r=[e,t],a=In(In({},s),{},{bounds:r});return{value:zX(tC(i),a,i),settings:a}};var c_e=Object.freeze({__proto__:null,schema:o_e,format:tC,sanitize:zX,normalize:l_e});const u_e=["value","bounds","onDrag"],d_e=["bounds"],f_e=Rn("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function h_e(i){let{value:e,bounds:[t,n],onDrag:s}=i,r=fs(i,u_e);const a=G.useRef(null),o=G.useRef(null),l=G.useRef(null),u=G.useRef(0),f=Gf("sizes","scrubberWidth"),p=aA(({event:_,first:T,xy:[A],movement:[S],memo:C={}})=>{if(T){const{width:B,left:L}=a.current.getBoundingClientRect();u.current=B-parseFloat(f);const D=_?.target===o.current||_?.target===l.current;C.pos=KM((A-L)/B,t,n);const O=Math.abs(C.pos-e.min)-Math.abs(C.pos-e.max);C.key=O<0||O===0&&C.pos<=e.min?"min":"max",D&&(C.pos=e[C.key])}const w=C.pos+KM(S/u.current,0,n-t);return s({[C.key]:txe(w,r[C.key])}),C}),x=`calc(${$M(e.min,t,n)} * (100% - ${f} - 8px) + 4px)`,y=`calc(${1-$M(e.max,t,n)} * (100% - ${f} - 8px) + 4px)`;return ue.createElement(uX,sr({ref:a},p()),ue.createElement(cX,null,ue.createElement(dX,{style:{left:x,right:y}})),ue.createElement(rB,{position:"left",ref:o,style:{left:x}}),ue.createElement(rB,{position:"right",ref:l,style:{right:y}}))}function p_e(){const{label:i,displayValue:e,onUpdate:t,settings:n}=Ya(),s=fs(n,d_e);return ue.createElement(ue.Fragment,null,ue.createElement(Ec,{input:!0},ue.createElement(xu,null,i),ue.createElement(f_e,null,ue.createElement(h_e,sr({value:e},n,{onDrag:t})),ue.createElement(nL,{value:e,settings:s,onUpdate:t,innerLabelTrim:0}))))}var m_e=In({component:p_e},c_e);const g_e=()=>{const i=new Map;return{on:(e,t)=>{let n=i.get(e);n===void 0&&(n=new Set,i.set(e,n)),n.add(t)},off:(e,t)=>{const n=i.get(e);n!==void 0&&(n.delete(t),n.size===0&&i.delete(e))},emit:(e,...t)=>{const n=i.get(e);if(n!==void 0)for(const s of n)s(...t)}}},x_e=["type","value"],y_e=["onChange","transient","onEditStart","onEditEnd"],v_e=function(){const e=ave(ove(()=>({data:{}}))),t=g_e();this.storeId=f0e(),this.useStore=e;const n={},s=new Set;this.getVisiblePaths=()=>{const a=this.getData(),o=Object.keys(a),l=[];Object.entries(n).forEach(([f,p])=>{p.render&&o.some(x=>x.indexOf(f)===0)&&!p.render(this.get)&&l.push(f+".")});const u=[];return s.forEach(f=>{f in a&&a[f].__refCount>0&&l.every(p=>f.indexOf(p)===-1)&&(!a[f].render||a[f].render(this.get))&&u.push(f)}),u},this.setOrderedPaths=a=>{a.forEach(o=>s.add(o))},this.orderPaths=a=>(this.setOrderedPaths(a),a),this.disposePaths=a=>{e.setState(o=>{const l=o.data;return a.forEach(u=>{if(u in l){const f=l[u];f.__refCount--,f.__refCount===0&&f.type in Ff&&delete l[u]}}),{data:l}})},this.dispose=()=>{e.setState(()=>({data:{}}))},this.getFolderSettings=a=>n[a]||{},this.getData=()=>e.getState().data,this.addData=(a,o)=>{e.setState(l=>{const u=l.data;return Object.entries(a).forEach(([f,p])=>{let x=u[f];if(x){const{type:y,value:_}=p,T=fs(p,x_e);y!==x.type?Nf(Ar.INPUT_TYPE_OVERRIDE,f,x.type,y):((x.__refCount===0||o)&&Object.assign(x,T),x.__refCount++)}else u[f]=In(In({},p),{},{__refCount:1})}),{data:u}})},this.setValueAtPath=(a,o,l)=>{e.setState(u=>{const f=u.data;return BG(f[a],o,a,this,l),{data:f}})},this.setSettingsAtPath=(a,o)=>{e.setState(l=>{const u=l.data;return u[a].settings=In(In({},u[a].settings),o),{data:u}})},this.disableInputAtPath=(a,o)=>{e.setState(l=>{const u=l.data;return u[a].disabled=o,{data:u}})},this.set=(a,o)=>{e.setState(l=>{const u=l.data;return Object.entries(a).forEach(([f,p])=>{try{BG(u[f],p,void 0,void 0,o)}catch{}}),{data:u}})},this.getInput=a=>{try{return this.getData()[a]}catch{Nf(Ar.PATH_DOESNT_EXIST,a)}},this.get=a=>{var o;return(o=this.getInput(a))===null||o===void 0?void 0:o.value},this.emitOnEditStart=a=>{t.emit(`onEditStart:${a}`,this.get(a),a,In(In({},this.getInput(a)),{},{get:this.get}))},this.emitOnEditEnd=a=>{t.emit(`onEditEnd:${a}`,this.get(a),a,In(In({},this.getInput(a)),{},{get:this.get}))},this.subscribeToEditStart=(a,o)=>{const l=`onEditStart:${a}`;return t.on(l,o),()=>t.off(l,o)},this.subscribeToEditEnd=(a,o)=>{const l=`onEditEnd:${a}`;return t.on(l,o),()=>t.off(l,o)};const r=(a,o,l)=>{const u={};return Object.entries(a).forEach(([f,p])=>{if(f==="")return Nf(Ar.EMPTY_KEY);let x=cL(o,f);if(p.type===Ff.FOLDER){const y=r(p.schema,x,l);Object.assign(u,y),x in n||(n[x]=p.settings)}else if(f in l)Nf(Ar.DUPLICATE_KEYS,f,x,l[f].path);else{const y=_0e(p,f,x,u);if(y){const{type:_,options:T,input:A}=y,{onChange:S,transient:C,onEditStart:w,onEditEnd:B}=T,L=fs(T,y_e);u[x]=In(In(In({type:_},L),A),{},{fromPanel:!0}),l[f]={path:x,onChange:S,transient:C,onEditStart:w,onEditEnd:B}}else Nf(Ar.UNKNOWN_INPUT,x,p)}}),u};this.getDataFromSchema=a=>{const o={};return[r(a,"",o),o]}},VX=new v_e,__e={collapsed:!1};function b_e(i,e){return{type:Ff.FOLDER,schema:i,settings:In(In({},__e),e)}}const _z=i=>"__levaInput"in i,S_e=(i,e)=>{const t={},n=e?e.toLowerCase():null;return i.forEach(s=>{const[r,a]=Sve(s);(!n||r.toLowerCase().indexOf(n)>-1)&&bve(t,a,{[r]:{__levaInput:!0,path:s}})}),t},T_e=["type","label","path","valueKey","value","settings","setValue","disabled"];function A_e(i){let{type:e,label:t,path:n,valueKey:s,value:r,settings:a,setValue:o,disabled:l}=i,u=fs(i,T_e);const{displayValue:f,onChange:p,onUpdate:x}=oX({type:e,value:r,settings:a,setValue:o}),y=f0[e].component;return y?ue.createElement(JW.Provider,{value:In({key:s,path:n,id:""+n,label:t,displayValue:f,value:r,onChange:p,onUpdate:x,settings:a,setValue:o,disabled:l},u)},ue.createElement(G0e,{disabled:l},ue.createElement(y,null))):(Nf(Ar.NO_COMPONENT_FOR_TYPE,e,n),null)}const E_e=Rn("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function M_e({onClick:i,settings:e,label:t}){const n=sA();return ue.createElement(Ec,null,ue.createElement(E_e,{disabled:e.disabled,onClick:()=>i(n.get)},t))}const C_e=Rn("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),R_e=Rn("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),w_e=({label:i,opts:e})=>{let t=typeof i=="string"&&i.trim()===""?null:i,n=e;return typeof e.opts=="object"&&(n.label!==void 0&&(t=e.label),n=e.opts),{label:t,opts:n}};function N_e(i){const{label:e,opts:t}=w_e(i),n=sA();return ue.createElement(Ec,{input:!!e},e&&ue.createElement(xu,null,e),ue.createElement(C_e,null,Object.entries(t).map(([s,r])=>ue.createElement(R_e,{key:s,onClick:()=>r(n.get)},s))))}const B_e=Rn("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),HX=100;function D_e(i,e){i.push(e),i.length>HX&&i.shift()}const O_e=G.forwardRef(function({initialValue:i},e){const t=Gf("colors","highlight3"),n=Gf("colors","elevation2"),s=Gf("colors","highlight1"),[r,a]=G.useMemo(()=>[go(s).alpha(.4).toRgbString(),go(s).alpha(.1).toRgbString()],[s]),o=G.useRef([i]),l=G.useRef(i),u=G.useRef(i),f=G.useRef(),p=G.useCallback((_,T)=>{if(!_)return;const{width:A,height:S}=_,C=new Path2D,w=A/HX,B=S*.05;for(let O=0;O<o.current.length;O++){const F=$M(o.current[O],l.current,u.current),U=w*O,P=S-F*(S-B*2)-B;C.lineTo(U,P)}T.clearRect(0,0,A,S);const L=new Path2D(C);L.lineTo(w*(o.current.length+1),S),L.lineTo(0,S),L.lineTo(0,0);const D=T.createLinearGradient(0,0,0,S);D.addColorStop(0,r),D.addColorStop(1,a),T.fillStyle=D,T.fill(L),T.strokeStyle=n,T.lineJoin="round",T.lineWidth=14,T.stroke(C),T.strokeStyle=t,T.lineWidth=2,T.stroke(C)},[t,n,r,a]),[x,y]=j0e(p);return G.useImperativeHandle(e,()=>({frame:_=>{(l.current===void 0||_<l.current)&&(l.current=_),(u.current===void 0||_>u.current)&&(u.current=_),D_e(o.current,_),f.current=requestAnimationFrame(()=>p(x.current,y.current))}}),[x,y,p]),G.useEffect(()=>()=>cancelAnimationFrame(f.current),[]),ue.createElement(B_e,{ref:x})}),bz=i=>Number.isFinite(i)?i.toPrecision(2):i.toString(),U_e=G.forwardRef(function({initialValue:i},e){const[t,n]=G.useState(bz(i));return G.useImperativeHandle(e,()=>({frame:s=>n(bz(s))}),[]),ue.createElement("div",null,t)});function Sz(i){return typeof i=="function"?i():i.current}function L_e({label:i,objectOrFn:e,settings:t}){const n=G.useRef(),s=G.useRef(Sz(e));return G.useEffect(()=>{const r=window.setInterval(()=>{var a;document.hidden||(a=n.current)===null||a===void 0||a.frame(Sz(e))},t.interval);return()=>window.clearInterval(r)},[e,t.interval]),ue.createElement(Ec,{input:!0},ue.createElement(xu,{align:"top"},i),t.graph?ue.createElement(O_e,{ref:n,initialValue:s.current}):ue.createElement(U_e,{ref:n,initialValue:s.current}))}const I_e=["type","label","key"],P_e={[Ff.BUTTON]:M_e,[Ff.BUTTON_GROUP]:N_e,[Ff.MONITOR]:L_e},F_e=ue.memo(({path:i})=>{const[e,{set:t,setSettings:n,disable:s,storeId:r,emitOnEditStart:a,emitOnEditEnd:o}]=K0e(i);if(!e)return null;const{type:l,label:u,key:f}=e,p=fs(e,I_e);if(l in Ff){const x=P_e[l];return ue.createElement(x,sr({label:u,path:i},p))}return l in f0?ue.createElement(A_e,sr({key:r+i,type:l,label:u,storeId:r,path:i,valueKey:f,setValue:t,setSettings:n,disable:s,emitOnEditStart:a,emitOnEditEnd:o},p)):(n0e(Ar.UNSUPPORTED_INPUT,l,i),null)});function G_e({toggle:i,toggled:e,name:t}){return ue.createElement(I0e,{onClick:()=>i()},ue.createElement(tL,{toggled:e}),ue.createElement("div",null,t))}const z_e=({name:i,path:e,tree:t})=>{const n=sA(),s=cL(e,i),{collapsed:r,color:a}=n.getFolderSettings(s),[o,l]=G.useState(!r),u=G.useRef(null),f=Gf("colors","folderWidgetColor"),p=Gf("colors","folderTextColor");return G.useLayoutEffect(()=>{u.current.style.setProperty("--leva-colors-folderWidgetColor",a||f),u.current.style.setProperty("--leva-colors-folderTextColor",a||p)},[a,f,p]),ue.createElement(JM,{ref:u},ue.createElement(G_e,{name:i,toggled:o,toggle:()=>l(x=>!x)}),ue.createElement(kX,{parent:s,tree:t,toggled:o}))},kX=ue.memo(({isRoot:i=!1,fill:e=!1,flat:t=!1,parent:n,tree:s,toggled:r})=>{const{wrapperRef:a,contentRef:o}=Eve(r),l=sA(),u=([p,x])=>{var y;return(_z(x)?(y=l.getInput(x.path))===null||y===void 0?void 0:y.order:l.getFolderSettings(cL(n,p)).order)||0},f=Object.entries(s).sort((p,x)=>u(p)-u(x));return ue.createElement(iB,{ref:a,isRoot:i,fill:e,flat:t},ue.createElement(iX,{ref:o,isRoot:i,toggled:r},f.map(([p,x])=>_z(x)?ue.createElement(F_e,{key:x.path,valueKey:x.valueKey,path:x.path}):ue.createElement(z_e,{key:p,name:p,path:n,tree:x}))))}),V_e=Rn("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${rX}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),WX=40,nC=Rn("i",{$flexCenter:"",width:WX,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),H_e=Rn("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),k_e=Rn("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${nC}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),W_e=Rn("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),X_e=Rn("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:WX}}}}),q_e=ue.forwardRef(({setFilter:i,toggle:e},t)=>{const[n,s]=G.useState(""),r=G.useMemo(()=>XW(i,250),[i]),a=()=>{i(""),s("")},o=l=>{const u=l.currentTarget.value;e(!0),s(u)};return G.useEffect(()=>{r(n)},[n,r]),ue.createElement(ue.Fragment,null,ue.createElement(W_e,{ref:t,value:n,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:l=>l.stopPropagation(),onChange:o}),ue.createElement(nC,{onClick:()=>a(),style:{visibility:n?"visible":"hidden"}},ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},ue.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function Y_e({setFilter:i,onDrag:e,onDragStart:t,onDragEnd:n,toggle:s,toggled:r,title:a,drag:o,filterEnabled:l,from:u}){const[f,p]=G.useState(!1),x=G.useRef(null);G.useEffect(()=>{var _,T;f?(_=x.current)===null||_===void 0||_.focus():(T=x.current)===null||T===void 0||T.blur()},[f]);const y=aA(({offset:[_,T],first:A,last:S})=>{e({x:_,y:T}),A&&t({x:_,y:T}),S&&n({x:_,y:T})},{filterTaps:!0,from:({offset:[_,T]})=>[u?.x||_,u?.y||T]});return G.useEffect(()=>{const _=T=>{T.key==="L"&&T.shiftKey&&T.metaKey&&p(A=>!A)};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[]),ue.createElement(ue.Fragment,null,ue.createElement(H_e,{mode:o?"drag":void 0},ue.createElement(nC,{active:!r,onClick:()=>s()},ue.createElement(tL,{toggled:r,width:12,height:8})),ue.createElement(X_e,sr({},o?y():{},{drag:o,filterEnabled:l}),a===void 0&&o?ue.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},ue.createElement("circle",{cx:"2",cy:"2",r:"2"}),ue.createElement("circle",{cx:"14",cy:"2",r:"2"}),ue.createElement("circle",{cx:"26",cy:"2",r:"2"}),ue.createElement("circle",{cx:"2",cy:"12",r:"2"}),ue.createElement("circle",{cx:"14",cy:"12",r:"2"}),ue.createElement("circle",{cx:"26",cy:"12",r:"2"})):a),l&&ue.createElement(nC,{active:f,onClick:()=>p(_=>!_)},ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},ue.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),ue.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),ue.createElement(k_e,{toggled:f},ue.createElement(q_e,{ref:x,setFilter:i,toggle:s})))}const j_e=["store","hidden","theme","collapsed"];function $_e(i){let{store:e,hidden:t=!1,theme:n,collapsed:s=!1}=i,r=fs(i,j_e);const a=LX(()=>N0e(n),[n]),[o,l]=G.useState(!s),u=typeof s=="object"?!s.collapsed:o,f=G.useMemo(()=>typeof s=="object"?p=>{typeof p=="function"?s.onChange(!p(!s.collapsed)):s.onChange(!p)}:l,[s]);return!e||t?null:ue.createElement(ZU.Provider,{value:a},ue.createElement(K_e,sr({store:e},r,{toggled:u,setToggle:f,rootClass:a.className})))}const K_e=ue.memo(({store:i,rootClass:e,fill:t=!1,flat:n=!1,neverHide:s=!1,oneLineLabels:r=!1,titleBar:a={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:o=!1,toggled:l,setToggle:u})=>{var f,p;const x=Mve(i),[y,_]=G.useState(""),T=G.useMemo(()=>S_e(x,y),[x,y]),[A,S]=lX(),C=s||x.length>0,w=typeof a=="object"&&a.title||void 0,B=typeof a=="object"&&(f=a.drag)!==null&&f!==void 0?f:!0,L=typeof a=="object"&&(p=a.filter)!==null&&p!==void 0?p:!0,D=typeof a=="object"&&a.position||void 0,O=typeof a=="object"&&a.onDrag||void 0,F=typeof a=="object"&&a.onDragStart||void 0,U=typeof a=="object"&&a.onDragEnd||void 0;return ue.useEffect(()=>{S({x:D?.x,y:D?.y})},[D,S]),w0e(),ue.createElement($ge,null,ue.createElement(QW.Provider,{value:{hideCopyButton:o}},ue.createElement(V_e,{ref:A,className:e,fill:t,flat:n,oneLineLabels:r,hideTitleBar:!a,style:{display:C?"block":"none"}},a&&ue.createElement(Y_e,{onDrag:P=>{S(P),O?.(P)},onDragStart:P=>F?.(P),onDragEnd:P=>U?.(P),setFilter:_,toggle:P=>u(X=>P??!X),toggled:l,title:w,drag:B,filterEnabled:L,from:D}),C&&ue.createElement(ZW.Provider,{value:i},ue.createElement(kX,{isRoot:!0,fill:t,flat:n,tree:T,toggled:l})))))}),J_e=["isRoot"];let iC=!1,Dg=null;function Z_e(i){let{isRoot:e=!1}=i,t=fs(i,J_e);return G.useEffect(()=>(iC=!0,!e&&Dg&&(Dg.remove(),Dg=null),()=>{e||(iC=!1)}),[e]),ue.createElement($_e,sr({store:VX},t))}function Q_e(i){G.useEffect(()=>{i&&!iC&&(Dg||(Dg=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(Dg),xB.createRoot(Dg).render(ue.createElement(Z_e,{isRoot:!0})))),iC=!0)},[i])}function ebe(i,e,t,n,s){let r,a,o,l,u;return typeof i=="string"?(a=i,r=e,Array.isArray(t)&&(u=t)):(r=i,Array.isArray(e)?u=e:(l=e,u=t)),{schema:r,folderName:a,folderSettings:o,hookSettings:l,deps:u||[]}}function tbe(i,e,t,n,s){const{folderName:r,schema:a,folderSettings:o,hookSettings:l,deps:u}=ebe(i,e,t),f=typeof a=="function",p=G.useRef(!1),x=G.useRef(!0),y=LX(()=>{p.current=!0;const X=typeof a=="function"?a():a;return r?{[r]:b_e(X,o)}:X},u),_=!(l!=null&&l.store);Q_e(_);const[T]=G.useState(()=>l?.store||VX),[A,S]=G.useMemo(()=>T.getDataFromSchema(y),[T,y]),[C,w,B,L,D]=G.useMemo(()=>{const X=[],Z=[],ee={},te={},re={};return Object.values(S).forEach(({path:W,onChange:ne,onEditStart:se,onEditEnd:ge,transient:_e})=>{X.push(W),ne?(ee[W]=ne,_e||Z.push(W)):Z.push(W),se&&(te[W]=se),ge&&(re[W]=ge)}),[X,Z,ee,te,re]},[S]),O=G.useMemo(()=>T.orderPaths(C),[C,T]),F=Cve(T,w,A),U=G.useCallback(X=>{const Z=Object.entries(X).reduce((ee,[te,re])=>Object.assign(ee,{[S[te].path]:re}),{});T.set(Z,!1)},[T,S]),P=G.useCallback(X=>T.get(S[X].path),[T,S]);return G.useEffect(()=>{const X=!x.current&&p.current;return T.addData(A,X),x.current=!1,p.current=!1,()=>T.disposePaths(O)},[T,O,A]),G.useEffect(()=>{const X=[];return Object.entries(B).forEach(([Z,ee])=>{ee(T.get(Z),Z,In({initial:!0,get:T.get},T.getInput(Z)));const te=T.useStore.subscribe(re=>{const W=re.data[Z];return[W.disabled?void 0:W.value,W]},([re,W])=>ee(re,Z,In({initial:!1,get:T.get},W)),{equalityFn:z3});X.push(te)}),()=>X.forEach(Z=>Z())},[T,B]),G.useEffect(()=>{const X=[];return Object.entries(L).forEach(([Z,ee])=>X.push(T.subscribeToEditStart(Z,ee))),Object.entries(D).forEach(([Z,ee])=>X.push(T.subscribeToEditEnd(Z,ee))),()=>X.forEach(Z=>Z())},[L,D,T]),f?[F,U,P]:F}ih(sh.SELECT,hxe);ih(sh.IMAGE,a_e);ih(sh.NUMBER,ixe);ih(sh.COLOR,Fve);ih(sh.STRING,Sxe);ih(sh.BOOLEAN,wxe);ih(sh.INTERVAL,m_e);ih(sh.VECTOR3D,zve);ih(sh.VECTOR2D,jve);const nbe=Math.PI/180;function ibe(i){return i*nbe}function Tz(...i){return i.map(e=>e.replace(/^\/+|\/+$/g,"")).join("/")}const sC={Gltf:{LivingRoom:Tz("models","Living-room.glb"),LivingRoomBaked:Tz("models","Living-room_baked_002.glb")}},sbe=({children:i,fallback:e})=>{const[t,n]=G.useState(!1);return G.useEffect(()=>{const s=()=>n(!0);return window.addEventListener("error",s),()=>window.removeEventListener("error",s)},[]),t?Pt.jsx(Gue,{center:!0,children:Pt.jsx("div",{style:{color:"red",fontSize:"16px"},children:e||"Failed to load model!"})}):i},rbe=()=>{const i=yo(n=>n.controls),{showBakedScene:e}=tbe({showBakedScene:!0}),t=async()=>{i.setLookAt(8,8,8,3,0,0),await new Promise(n=>setTimeout(n,1e3)),i.smoothTime=.6,await i.setLookAt(1.2,.5,1.2,0,.2,0,!0)};return G.useEffect(()=>{i&&t()},[i]),Pt.jsxs(Pt.Fragment,{children:[Pt.jsx($fe,{makeDefault:!0,maxDistance:8,minDistance:1,minPolarAngle:0,maxPolarAngle:ibe(80)}),Pt.jsx(fhe,{preset:"dawn",background:!0,blur:3}),Pt.jsx(sbe,{children:Pt.jsx(Wfe,{src:e?sC.Gltf.LivingRoomBaked:sC.Gltf.LivingRoom,receiveShadow:!0,castShadow:!0})})]})};wv.preload(sC.Gltf.LivingRoomBaked);wv.preload(sC.Gltf.LivingRoom);function abe(){const[i,e]=G.useState("never");return Pt.jsxs(Pt.Fragment,{children:[Pt.jsx(Xue,{}),Pt.jsxs(wue,{shadows:!0,camera:{position:[3,3,3],fov:30},frameloop:i,gl:t=>{P3(Dse);const n=new kk({...t,powerPreference:"high-performance",antialias:!0,alpha:!1,stencil:!1,shadowMap:!0});return n.init().then(()=>{e("always")}),n},children:[Pt.jsx("color",{attach:"background",args:["#111"]}),Pt.jsx(G.Suspense,{children:Pt.jsx(rbe,{})})]})]})}Wq.createRoot(document.getElementById("root")).render(Pt.jsx(ue.StrictMode,{children:Pt.jsx(abe,{})}));
